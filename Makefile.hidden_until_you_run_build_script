
### This should help not recompile everything always
###



CC=$(shell grep 'CMAKE_CXX_COMPILER:FILEPATH=' build/CMakeCache.txt | sed s,'CMAKE_CXX_COMPILER:FILEPATH=',,)
RED=\033[0;31m
NC=\033[0m # No Color

.PHONY: all configure clean install distclean update build 

all: build
clean: cmake-clean
install: cmake-install 


### TODO add doxygen into CMakelists 
doc: legacy-doc

build: build/Makefile 
	@+make -C  ./build || make error-report

update: 
	./updateComponents.sh

configure: build/Makefile 
	@ccmake . build 

cmake-install: 
	@make -C ./build install

error-report:
	@echo -e "${RED}*****************************************************************************${NC}"
	@echo -e "${RED}Error! Could not build the ANITA software suite.${NC}"
	@echo -e "${RED}Please post the ENTIRE output in the ANITA slack #bugzilla channel.${NC}"
	@echo -e "${RED}https://anitamission.slack.com/messages/C4DCY5PDG/${NC}"
	@echo -e "${RED}The root version is $(shell root-config --version)${NC}"
	@echo -e "${RED}The compiler is $(shell $(CC) --version | head -1)${NC}"
	@echo -e "${RED}The system info is $(shell uname -a)${NC}"
	@echo -e "${RED}*****************************************************************************${NC}"

build/Makefile: 
	@rm -rf build  # 
	@mkdir -p build 
	@cd build && cmake ../ 

distclean: 
	@echo "Removing cmake directory" 
	@rm -rf build 
	unlink cmake
	unlink Makefile 

cmake-clean: build/Makefile 
	@make -C ./build clean 
