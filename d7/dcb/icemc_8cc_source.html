<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>ANITA Software: components/icemc/icemc.cc Source File</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
	<table cellspacing="0" cellpadding="0">
	  <tbody>	    
	    <tr style="height: 56px;">
	      <td id="projectlogo"><img width="960" alt="Logo" src="../../anitaSoftware.png"/></td>
	    </tr>
	  </tbody>
	</table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Introduction</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="../../dir_de1961011fa38df2c6d5e9e49bef1e29.html">icemc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">icemc.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;ctype.h&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;TTreeIndex.h&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;TChain.h&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;TH1.h&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;TH2.h&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;TF1.h&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;TF2.h&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;TFile.h&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;TObject.h&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;icemc_random.h&quot;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;TTree.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;TLegend.h&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;TLine.h&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;TROOT.h&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;TPostScript.h&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;TText.h&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;TProfile.h&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;TGraphErrors.h&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;TGraphAsymmErrors.h&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;TStyle.h&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;TMath.h&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;TMarker.h&quot;</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;TVector3.h&quot;</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;TRotation.h&quot;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;TSpline.h&quot;</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;Math/InterpolationTypes.h&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;Math/Interpolator.h&quot;</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;signal.h&quot;</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//#include &quot;rx.hpp&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;Constants.h&quot;</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;position.hh&quot;</span></div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;earthmodel.hh&quot;</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;Tools.h&quot;</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;vector.hh&quot;</span></div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;roughness.hh&quot;</span></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;anita.hh&quot;</span></div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;balloon.hh&quot;</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;icemodel.hh&quot;</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">// #include &quot;trigger.hh&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;Spectra.h&quot;</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;signal.hh&quot;</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;secondaries.hh&quot;</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;ray.hh&quot;</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;counting.hh&quot;</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;Primaries.h&quot;</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;Taumodel.hh&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;screen.hh&quot;</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;GlobalTrigger.h&quot;</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;ChanTrigger.h&quot;</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;SimulatedSignal.h&quot;</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;EnvironmentVariable.h&quot;</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;source.hh&quot;</span> </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &lt;typeinfo&gt;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &lt;sstream&gt;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#if __cplusplus &gt; 199711L</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#define isnan std::isnan </span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &lt;type_traits&gt;</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &lt;typeinfo&gt;</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &lt;fenv.h&gt;</span> </div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="preprocessor">#include &quot;UsefulAnitaEvent.h&quot;</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="preprocessor">#ifdef  ANITA3_EVENTCORRELATOR</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="preprocessor">#include &quot;SkyMap.h&quot;</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="preprocessor">#include &quot;AnitaGeomTool.h&quot;</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="preprocessor">#include &quot;AnitaConventions.h&quot;</span></div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="preprocessor">#include &quot;RawAnitaHeader.h&quot;</span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="preprocessor">#include &quot;Adu5Pat.h&quot;</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="preprocessor">#include &quot;FFTtools.h&quot;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="preprocessor">#include &quot;UsefulAdu5Pat.h&quot;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<a class="code" href="../../d9/d4a/class_useful_anita_event.html">UsefulAnitaEvent</a>*     realEvPtr    = NULL;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<a class="code" href="../../d0/dc4/class_raw_anita_header.html">RawAnitaHeader</a>*       rawHeaderPtr = NULL;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<a class="code" href="../../d2/dbf/class_adu5_pat.html">Adu5Pat</a>*         Adu5PatPtr   = NULL;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="preprocessor">#include &quot;TruthAnitaEvent.h&quot;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<a class="code" href="../../d7/dd8/class_truth_anita_event.html">TruthAnitaEvent</a>*      truthEvPtr   = NULL;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<a class="code" href="../../d6/dc1/class_taumodel.html">Taumodel</a>* TauPtr = NULL;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="keyword">const</span> <span class="keywordtype">string</span> ICEMC_SRC_DIR = <a class="code" href="../../d4/d7f/namespace_environment_variable.html#a064f876067320b15e34beb8c29c8ffdc">EnvironmentVariable::ICEMC_SRC_DIR</a>();</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;ClassImp(<a class="code" href="../../df/d22/class_r_x.html">RX</a>);</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">//ClassImp(Settings);</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="keyword">using namespace </span><a class="code" href="../../d8/dcc/namespacestd.html">std</a>;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">class </span><a class="code" href="../../d1/d3b/class_earth_model.html">EarthModel</a>;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="keyword">class </span><a class="code" href="../../d7/d3b/class_position.html">Position</a>;</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="keyword">class </span><a class="code" href="../../db/d2b/class_settings.html">Settings</a>;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">/************MOVED FROM shared.hh and shared.cc*****************/</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">// These need to be moved elsewhere.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// They were all global variables inside of shared.hh.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// Most of these should not be global variables.</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> NVIEWANGLE=100; <span class="comment">// number of viewing angles to look at the signal,  on Seckel&#39;s request</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">// int irays; // counts rays (for roughness) // LC: commented out because not used</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="keywordtype">int</span> inu; <span class="comment">// counts neutrinos as they are generated</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keywordtype">double</span> eventsfound_beforetrigger=0.;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="keywordtype">double</span> eventsfound_crust=0; <span class="comment">//number of events that only traverse the crust</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="keywordtype">double</span> eventsfound_weightgt01=0; <span class="comment">// summing weights &gt; 0.1</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="keywordtype">double</span> eventsfound_belowhorizon=0; <span class="comment">// how many are below horizon</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="keywordtype">double</span> eventsfound=0;   <span class="comment">// how many events found</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="keywordtype">double</span> eventsfound_prob=0;   <span class="comment">// how many events found,  probabilities</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="keywordtype">double</span> eventsfound_divided_by_lint = 0; </div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="keywordtype">double</span> sum[3]; <span class="comment">// sum of weight for events found for 3 flavors</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keywordtype">double</span> sum_prob[3]; <span class="comment">// sum of weight for events found for 3 flavors</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">// These numbers are from Feldman and Cousins wonderful paper:  physics/9711021</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="keywordtype">double</span> poissonerror_minus[21] = {0.-0.00, 1.-0.37, 2.-0.74, 3.-1.10, 4.-2.34, 5.-2.75, 6.-3.82, 7.-4.25, 8.-5.30, 9.-6.33, 10.-6.78, 11.-7.81, 12.-8.83, 13.-9.28, 14.-10.30, 15.-11.32, 16.-12.33, 17.-12.79, 18.-13.81, 19.-14.82, 20.-15.83};</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keywordtype">double</span> poissonerror_plus[21] = {1.29-0., 2.75-1., 4.25-2., 5.30-3., 6.78-4., 7.81-5., 9.28-6., 10.30-7., 11.32-8., 12.79-9., 13.81-10., 14.82-11., 16.29-12., 17.30-13., 18.32-14., 19.32-15., 20.80-16., 21.81-17., 22.82-18., 23.82-19., 25.30-20.};</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> NBINS=10; <span class="comment">// keep track of the number of events found,  binned</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">// by weights</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="keywordtype">double</span> MIN_LOGWEIGHT=-3;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keywordtype">double</span> MAX_LOGWEIGHT=-1;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="keywordtype">int</span> index_weights=0; <span class="comment">// which bin the weight falls into</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="keywordtype">double</span> eventsfound_binned[NBINS];</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="keywordtype">double</span> eventsfound_binned_e[NBINS];</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keywordtype">double</span> eventsfound_binned_mu[NBINS];</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="keywordtype">double</span> eventsfound_binned_tau[NBINS];</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="keywordtype">double</span> km3sr = 0;                      <span class="comment">// total km3sr</span></div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="keywordtype">double</span> km3sr_e=0;                       <span class="comment">// to calculate km3sr for electrons</span></div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="keywordtype">double</span> km3sr_mu=0;                       <span class="comment">// to calculate km3sr for muons</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordtype">double</span> km3sr_tau=0;                       <span class="comment">// to calculate km3sr for taus</span></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="keywordtype">double</span> km2sr = 0;                        <span class="comment">// aperture km**2-sr</span></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="keywordtype">double</span> error_plus=0;          <span class="comment">// keeping track of asymmetric error bars</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="keywordtype">double</span> error_e_plus=0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="keywordtype">double</span> error_mu_plus=0;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keywordtype">double</span> error_tau_plus=0;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="keywordtype">double</span> error_minus=0;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keywordtype">double</span> error_e_minus=0;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keywordtype">double</span> error_mu_minus=0;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keywordtype">double</span> error_tau_minus=0;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keywordtype">int</span> ierr=0; <span class="comment">// integer for returning error from functions.</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keywordtype">double</span> gain_dipole=2.15;  <span class="comment">// antenna gain (nominal value for dipole is 2.15)</span></div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keywordtype">double</span> changle_deg=0; <span class="comment">// same,  in degrees.</span></div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">// inputs</span></div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="keywordtype">int</span> NNU;        <span class="comment">// number of neutrinos</span></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keywordtype">int</span> whichray=0; <span class="comment">// indexes the rays that we look at (actually just used for ice but we use it in GetNuFlavor so keep it here)</span></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keywordtype">double</span> RANDOMISEPOL=0.;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">/************MOVED FROM shared.hh and shared.cc*****************/</span></div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;std::vector&lt;int&gt; NNU_per_source; </div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;std::vector&lt;std::string&gt; source_names; </div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;std::vector&lt;double&gt; eventsfound_per_source; </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;std::vector&lt;double&gt; eventsfound_prob_per_source; </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="keywordtype">double</span> volume_thishorizon; <span class="comment">// for plotting volume within the horizon of the balloon</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="keywordtype">double</span> realtime_this;  <span class="comment">// for plotting real unix time</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="keywordtype">double</span> longitude_this; <span class="comment">// for plotting longitude</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keywordtype">double</span> latitude_this; <span class="comment">// for plotting latitude</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="keywordtype">double</span> altitude_this; <span class="comment">// for plotting altitude</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keywordtype">double</span> heading_this=0.;<span class="comment">// for plotting heading</span></div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;<span class="keywordtype">double</span> gps_offset=0;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment">// inputs</span></div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="keywordtype">double</span> pnu=pow(10., 20);   </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="keywordtype">double</span> MEANX=0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="keywordtype">double</span> MEANY=0.;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordtype">double</span> SIGNALRADIUS=2.; <span class="comment">// in degrees</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">// frequency binning</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> FREQ_LOW_DISCONES=120.E6; <span class="comment">// min frequency for discones</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="keyword">const</span> <span class="keywordtype">double</span> FREQ_HIGH_DISCONES=1000.E6; <span class="comment">// max frequency for discones</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keywordtype">double</span> bwslice_vnoise_thislayer[4];<span class="comment">// for filling tree6b,  noise for each bandwidth on each layer</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="keywordtype">int</span> passes_thisevent=0; <span class="comment">// this event passes</span></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keywordtype">int</span> unmasked_thisevent=0; <span class="comment">// this event is unmasked</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="keywordtype">int</span> discones_passing;  <span class="comment">// number of discones that pass</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keywordtype">int</span> NDISCONES=8;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="keywordtype">double</span> heff_discone=0; <span class="comment">// effective height of a discone antenna</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="keywordtype">double</span> polarfactor_discone=0.;<span class="comment">// factor to account for antenna beam pattern.</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="keywordtype">double</span> thislambda=0;<span class="comment">// for finding wavelength at each frequency</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keywordtype">double</span> volts_discone=0.;<span class="comment">// for finding voltage at each discone</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="keywordtype">double</span> vnoise_discone=0.; <span class="comment">// noise on each discone</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="keywordtype">double</span> BW_DISCONES=300.E6-120.E6; <span class="comment">// bandwidth of the discones</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;<span class="comment">// ray tracing</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;<span class="keywordtype">double</span> fresnel1=0;  </div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keywordtype">double</span> fresnel1_eachboresight[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>];  <span class="comment">// for slac simulation</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="keywordtype">double</span> fresnel2=0;  </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keywordtype">double</span> mag1=0;  <span class="comment">// magnification factor on field at ice-firn interface</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="keywordtype">double</span> mag1_eachboresight[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>];<span class="comment">// for slac simulation</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordtype">double</span> mag2=0;  <span class="comment">// magnification factor on field in firn-air</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">double</span> t_coeff_pokey, t_coeff_slappy;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordtype">double</span> rflength=0;  <span class="comment">// distance from interaction to ice-air exit point</span></div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordtype">double</span> e_comp_max1=0;</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordtype">double</span> h_comp_max1=0;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordtype">double</span> e_comp_max2=0;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordtype">double</span> h_comp_max2=0;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordtype">double</span> e_comp_max3=0;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">double</span> h_comp_max3=0;</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordtype">double</span> diffexit=0;  <span class="comment">// checking exit point between_MAX interations</span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordtype">double</span> diff_3tries=0;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="keywordtype">double</span> diffnorm=0;  <span class="comment">// checking angle of surf normal between iterations</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keywordtype">double</span> diffrefr=0;  <span class="comment">// checking angle of refr between iterations</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">double</span> costheta_inc=0;  <span class="comment">// cos angle of incidence wrt surface normal</span></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordtype">double</span> costheta_exit=0; <span class="comment">// theta of exit point wrt earth (costheta=1 at south pole)</span></div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keywordtype">double</span> theta_rf_atbn; <span class="comment">// polar angle of the signal as seen by perfect eyes at the balloon.</span></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordtype">double</span> theta_rf_atbn_measured; <span class="comment">//polar angle of the signal as measured at the balloon (just the above variable smeared by 0.5 degrees)</span></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordtype">double</span> theta_nnu_atbn;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;<span class="keywordtype">double</span> theta_nnu_rf_diff_atbn;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keywordtype">double</span> phi_rf_atbn;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordtype">double</span> phi_nnu_atbn;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keywordtype">double</span> phi_nnu_rf_diff_atbn; </div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> nnu_xy;</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> r_bn_xy;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> rf_xy; </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160; </div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordtype">double</span> costhetanu=-1000; <span class="comment">// costheta of neutrino direction wrt earth (costheta=1 at south pole)</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">// neutrino path</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="keywordtype">double</span> theta_in=0; <span class="comment">// theta where neutrino enters earth (radians, south pole=0)</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keywordtype">double</span> lat_in=0; <span class="comment">// latitude where neutrino enters earth (degrees, south pole=-90)</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="keywordtype">double</span> nearthlayers=0; <span class="comment">// how many layers (core, mantle, crust) does nnu traverse</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordtype">double</span> weight_prob=0.;<span class="comment">//event weight,  including probability it interacts somewhere in ice along its path</span></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keywordtype">double</span> weight1=0; <span class="comment">// event weight,  just based on absorption in earth,  see note</span></div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordtype">double</span> weight=0.; <span class="comment">// total event weight (product of the previous 2)</span></div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordtype">double</span> logweight=0.;<span class="comment">// log of the previous number</span></div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordtype">double</span> len_int=0;<span class="comment">// interaction length in m</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordtype">double</span> pieceofkm2sr=0; <span class="comment">// Use this for making plots comparing different cross sections.  The integral of a plot from a run will be the total Area*sr of the detector.  That way it is proportional to the cross section and the integral is something meaningful to people.</span></div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment">// counting variables</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keywordtype">int</span> count_inthisloop1=0; <span class="comment">// for debugging</span></div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;<span class="keywordtype">int</span> count_inthisloop2=0;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="keywordtype">int</span> count_inthisloop3=0;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keywordtype">double</span> averaging_thetas1=0; <span class="comment">// for debugging</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keywordtype">double</span> averaging_thetas2=0;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="keywordtype">double</span> averaging_thetas3=0;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keywordtype">int</span> count_total=0; <span class="comment">// number of neutrinos looped over.  should always equal inu</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">// i.e.,  is theoretically visible by balloon</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="keywordtype">int</span> count_asktrigger=0;</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;<span class="keywordtype">int</span> count_asktrigger_nfb=0;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;<span class="keywordtype">int</span> count_pass=0;  <span class="comment">// how many total trigger channels pass (4 bandwidth slices*2 pol * nrx)</span></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keywordtype">double</span> count_passestrigger_w=0; <span class="comment">// same as above,  but sum weights</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keywordtype">int</span> passestrigger=0; <span class="comment">// 1=this event passes trigger, 0=does not</span></div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;<span class="comment">// so that we know to increment count_passestrigger_w at the end of the event</span></div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;<span class="keywordtype">int</span> allcuts[2]={0, 0}; <span class="comment">// index is which ray (upward or downward)</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;<span class="comment">// 1=this ray for this event passes all cuts,  0=does not</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keywordtype">double</span> allcuts_weighted[2]={0, 0}; <span class="comment">// same as above but weighted</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="keywordtype">double</span> allcuts_weighted_polarization[3]={0, 0, 0}; <span class="comment">// same as above but divided into [0] vpol, [1] hpol, [2] both vpol and hpol</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;<span class="comment">//signal has a chance to pass after accounting for 1/r</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="keywordtype">int</span> count_chanceofsurviving=0; <span class="comment">// based on neutrino direction,  has a chance of making it through earth.</span></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="keywordtype">int</span> count_chanceinhell0=0; <span class="comment">// based on 1/r,  and best case attenuation</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;<span class="comment">// (after 2nd guess at rf exit point)</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">// signal has a chance of passing</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keywordtype">double</span> count_chanceinhell2_w=0; <span class="comment">//same as above,  but sum weights</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;<span class="keywordtype">int</span> chanceinhell2=0; <span class="comment">// 1=this event has chance to pass, 0=does not-</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment">// so that we know to increment count_chanceinhell2_w by weight1 at the end.</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="keywordtype">int</span> count_chordgoodlength=0; <span class="comment">// Incremented if neutrino path through earth is more than 1m</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keywordtype">int</span> count_d2goodlength=0; <span class="comment">// neutrino path through ice is more than 1m</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;<span class="keywordtype">int</span> count_rx=0; <span class="comment">// counting antennas we loop through them</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="keywordtype">double</span> sum_frac[3]; <span class="comment">// fraction of passing events that are e, mu, tau adding weights</span></div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keywordtype">double</span> sum_frac_db[3]; <span class="comment">// same for double bangs</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> NBINS_DISTANCE=28; <span class="comment">// keep track of number that pass as a function of distance to make Peter&#39;s plot</span></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;<span class="keywordtype">double</span> eventsfound_binned_distance[NBINS_DISTANCE] = {0.};  <span class="comment">// binning cumulative events found vs. distance</span></div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keywordtype">int</span> index_distance=0; <span class="comment">// index for filling array above</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="keywordtype">double</span> km3sr_distance[NBINS_DISTANCE] = {0.}; <span class="comment">// result of conversion of events to sensitivity</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="keywordtype">double</span> error_distance_plus[NBINS_DISTANCE] = {0.}; <span class="comment">// errors on above</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="keywordtype">double</span> error_distance_minus[NBINS_DISTANCE] = {0.};</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="keywordtype">int</span> eventsfound_binned_distance_forerror[NBINS_DISTANCE][NBINS] = {{0}}; <span class="comment">// for propagation of errors</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">//taus</span></div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="keywordtype">double</span> km3sr_db = 0;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="keywordtype">double</span> km3sr_nfb=0;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keywordtype">double</span> ptau=0;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordtype">int</span> count_passestrigger_nfb=0;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keywordtype">double</span> percent_increase_db=0;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="keywordtype">double</span> percent_increase_nfb=0;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="keywordtype">double</span> percent_increase_total=0;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="keywordtype">double</span> error_nfb=0;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="keywordtype">double</span> error_km3sr_nfb=0;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="keywordtype">double</span> error_percent_increase_nfb=0;</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_exit2bn_db[5];</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> nrf_iceside_db[5];  <span class="comment">// direction of rf [tries][3d]</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="keywordtype">double</span> n_exit_phi;  <span class="comment">//phi angle of the ray from the surface to the balloon</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="keywordtype">int</span> count_dbexitsice=0;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">// int count_interacts_in_earth=0;</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="keywordtype">double</span> eventsfound_nfb_binned[NBINS]; <span class="comment">// counting events without first bang</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">// rf parameters</span></div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="keywordtype">double</span> heff_max=0.62639; <span class="comment">// maximum value of the effective height based on antenna specs</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment">// event geometry</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="keywordtype">double</span> scalefactor_distance=0; <span class="comment">// 1/r scalefactor</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keywordtype">double</span> scalefactor_attenuation=0; <span class="comment">//scalefactor due to attenuation in ice</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="keywordtype">double</span> MAX_ATTENLENGTH=1671;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="keywordtype">double</span> maxtaper=0; <span class="comment">// this is just for plotting - maximum you are ever off cerenkov cone while</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment">//an event is detectable</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="keywordtype">double</span> dviewangle_deg=0; </div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keywordtype">double</span> forseckel[NVIEWANGLE][Anita::NFREQ];<span class="comment">// Per Seckel&#39;s request,  get strength of signal across frequencies for different viewing angles.</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="keywordtype">double</span> viewangles[NVIEWANGLE];</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="keywordtype">double</span> GetAirDistance(<span class="keywordtype">double</span> altitude_bn,  <span class="keywordtype">double</span> beta); <span class="comment">// given beta=angle wrt horizontal that the ray hits the balloon,  calculate distance that the ray traveled in air,  including curvature of earth</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">//Input files</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;<span class="keywordtype">int</span> err = 1; <span class="comment">// errors from GetDirection function</span></div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordtype">double</span> djunk; <span class="comment">// junk variable</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">//For verification plots - added by Stephen</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keywordtype">int</span> max_antenna0 = -1;  <span class="comment">//antenna with the peak voltage,  top layer</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="keywordtype">int</span> max_antenna1 = -1;  <span class="comment">//antenna with the peak voltage,  middle layer</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="keywordtype">int</span> max_antenna2 = -1;  <span class="comment">//antenna with the peak voltage,  bottom layer</span></div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="keywordtype">double</span> max_antenna_volts0 = 0; <span class="comment">//Voltage on the antenna with maximum signal,  top layer</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="keywordtype">double</span> max_antenna_volts0_em = 0; <span class="comment">//Component of voltage from em shower on the antenna with maximum signal,  top layer</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;<span class="keywordtype">double</span> max_antenna_volts1 = 0; <span class="comment">//Voltage on the antenna with maximum signal,  middle layer</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="keywordtype">double</span> max_antenna_volts2 = 0; <span class="comment">//Voltage on the antenna with maximum signal,  bottom layer</span></div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="keywordtype">double</span> rx0_signal_eachband[2][5];</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="keywordtype">double</span> rx0_threshold_eachband[2][5];</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="keywordtype">double</span> rx0_noise_eachband[2][5];</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="keywordtype">int</span> rx0_passes_eachband[2][5];</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="keywordtype">double</span> voltagearray[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>*<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">//Records max voltages on each antenna for one neutrino</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> ant_max_normal0; <span class="comment">//Vector normal to the face of the antenna with the maximum signal for a single neutrino,  top layer</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> ant_max_normal1; <span class="comment">//Vector normal to the face of the antenna with the maximum signal for a single neutrino,  middle layer</span></div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> ant_max_normal2; <span class="comment">//Vector normal to the face of the antenna with the maximum signal for a single neutrino,  bottom layer</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="keywordtype">double</span> vmmhz1m_visible = 0; <span class="comment">//Actual V/m/Mhz at 1m</span></div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="keywordtype">int</span> freq_bins = Anita::NFREQ; <span class="comment">//Because the compiler objected to using the const directly</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;<span class="keywordtype">double</span> nnu_array[3];</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;<span class="keywordtype">double</span> r_in_array[3];</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;<span class="keywordtype">double</span> nsurf_rfexit_array[3];</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="keywordtype">double</span> nsurf_rfexit_db_array[3];</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;<span class="keywordtype">double</span> r_bn_array[3];</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="keywordtype">double</span> n_bn_array[3];</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="keywordtype">double</span> posnu_array[3];</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="keywordtype">double</span> nrf_iceside_array[5][3];</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keywordtype">double</span> nrf_iceside_db_array[5][3];</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="keywordtype">double</span> ant_max_normal0_array[3];</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keywordtype">double</span> ant_max_normal1_array[3];</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keywordtype">double</span> ant_max_normal2_array[3];</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keywordtype">double</span> n_pol_array[3];</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keywordtype">double</span> n_exit2bn_array[5][3];</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keywordtype">double</span> r_enterice_array[3];</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keywordtype">double</span> n_exit2bn_db_array[5][3];</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keywordtype">double</span> rfexit_array[5][3];</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keywordtype">double</span> rfexit_db_array[5][3];</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordtype">int</span> times_crust_entered_det=0;  <span class="comment">//Counter for total times each Earth layer is entered for detected neutrinos only</span></div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">int</span> times_mantle_entered_det=0;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordtype">int</span> times_core_entered_det=0;</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordtype">int</span> neutrinos_passing_all_cuts=0;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">double</span> sum_weights=0;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">//End verification plot block</span></div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordtype">int</span> xsecParam_nutype = 0; <span class="comment">// neutrino = 0, antineutrino = 1;</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordtype">int</span> thisNuType = xsecParam_nutype; </div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keywordtype">int</span> xsecParam_nuint  = 1; <span class="comment">// NC = 0, CC = 1;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;<span class="keywordtype">double</span> justNoise_trig[2][48][512];</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="keywordtype">double</span> justSignal_trig[2][48][512];</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="keywordtype">double</span> justNoise_dig[2][48][512];</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;<span class="keywordtype">double</span> justSignal_dig[2][48][512];</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">// functions</span></div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">// set up array of viewing angles for making plots for seckel</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordtype">void</span> SetupViewangles(<a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1);</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;<span class="keywordtype">void</span> GetAir(<span class="keywordtype">double</span> *col1); <span class="comment">// get air column as a function of theta- only important for black hole studies</span></div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;<span class="keywordtype">double</span> GetThisAirColumn(<a class="code" href="../../db/d2b/class_settings.html">Settings</a>*,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> r_in,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> nnu, <a class="code" href="../../d7/d3b/class_position.html">Position</a> posnu,  <span class="keywordtype">double</span> *col1,  <span class="keywordtype">double</span>&amp; cosalpha, <span class="keywordtype">double</span>&amp; mytheta,  <span class="keywordtype">double</span>&amp; cosbeta0, <span class="keywordtype">double</span>&amp; mybeta);</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;<span class="keywordtype">double</span> ScaleVmMHz(<span class="keywordtype">double</span> vmmhz1m_max, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu1, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;r_bn, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit);</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;<span class="keywordtype">double</span> IsItDoubleBang(<span class="keywordtype">double</span> exitlength,  <span class="keywordtype">double</span> plepton);</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="keywordtype">int</span> WhereIsSecondBang(<span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a>&amp; posnu,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a>&amp; nnu,  <span class="keywordtype">double</span> nuexitlength,  <span class="keywordtype">double</span> pnu,  <a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica1,  <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a>&amp; r_bn, <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu2,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit_db,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2bn_db);</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="keywordtype">void</span> GetCurrent(<span class="keywordtype">string</span>&amp; current);</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordtype">double</span> GetAverageVoltageFromAntennasHit(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <span class="keywordtype">int</span> *nchannels_perrx_triggered,  <span class="keywordtype">double</span> *voltagearray,  <span class="keywordtype">double</span>&amp; volts_rx_sum);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> GetPolarization(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside);</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="keywordtype">void</span> Attenuate(<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antartica1, <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <span class="keywordtype">double</span>&amp; vmmhz_max,  <span class="keywordtype">double</span> rflength,  <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu);</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="keywordtype">void</span> Attenuate_down(<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica1,  <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <span class="keywordtype">double</span>&amp; vmmhz_max,  <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit2,  <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu,  <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu_down);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keywordtype">void</span> IsAbsorbed(<span class="keywordtype">double</span> chord_kgm2,  <span class="keywordtype">double</span> len_int_kgm2,  <span class="keywordtype">double</span>&amp; weight);</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;<span class="keywordtype">void</span> GetBalloonLocation(<a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *interaction1,<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> *ray1,<a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1,<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordtype">int</span> GetRayIceSide(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2rx,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nsurf_rfexit,  <span class="keywordtype">double</span> nexit,  <span class="keywordtype">double</span> nenter,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;<span class="keywordtype">int</span> GetDirection(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *interaction1,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;refr,  <span class="keywordtype">double</span> deltheta_em,  <span class="keywordtype">double</span> deltheta_had,  <span class="keywordtype">double</span> emfrac,  <span class="keywordtype">double</span> hadfrac,  <span class="keywordtype">double</span> vmmhz1m_max,  <span class="keywordtype">double</span> r_fromballoon,  <a class="code" href="../../d2/d1f/class_ray.html">Ray</a> *ray1,  <a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> posnu,  Anita *anita1,  <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu,  <span class="keywordtype">double</span>&amp; costhetanu,  <span class="keywordtype">double</span>&amp; theta_threshold);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordtype">void</span> GetFresnel(<a class="code" href="../../da/d10/class_roughness.html">Roughness</a> *rough1,  <span class="keywordtype">int</span> ROUGHNESS_SETTING,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nsurf_rfexit,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2rx,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_pol,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside,  <span class="keywordtype">double</span> efield,  <span class="keywordtype">double</span> emfrac,  <span class="keywordtype">double</span> hadfrac,  <span class="keywordtype">double</span> deltheta_em, <span class="keywordtype">double</span> deltheta_had,  <span class="keywordtype">double</span> &amp;t_coeff_pokey,  <span class="keywordtype">double</span> &amp;t_coeff_slappy,  <span class="keywordtype">double</span> &amp;fresnel,  <span class="keywordtype">double</span> &amp;mag);</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;<span class="keywordtype">double</span> GetViewAngle(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu);</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;<span class="keywordtype">int</span> TIR(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_surf,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside,  <span class="keywordtype">double</span> N_IN,  <span class="keywordtype">double</span> N_OUT);</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="keywordtype">void</span> IntegrateBands(Anita *anita1,  <span class="keywordtype">int</span> k,  Screen *panel1,  <span class="keywordtype">double</span> *freq,  <span class="keywordtype">double</span> scalefactor,  <span class="keywordtype">double</span> *sumsignal);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="keywordtype">void</span> Integrate(Anita *anita1,  <span class="keywordtype">int</span> j,  <span class="keywordtype">int</span> k,  <span class="keywordtype">double</span> *vmmhz,  <span class="keywordtype">double</span> *freq,  <span class="keywordtype">double</span> scalefactor,  <span class="keywordtype">double</span> sumsignal);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;<span class="keywordtype">void</span> interrupt_signal_handler(<span class="keywordtype">int</span>);  <span class="comment">// This catches the Control-C interrupt,  SIGINT</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;<span class="keywordtype">bool</span> ABORT_EARLY = <span class="keyword">false</span>;    <span class="comment">// This flag is set to true when interrupt_signal_handler() is called</span></div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;<span class="keywordtype">void</span> Summarize(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  Anita* anita1,  <a class="code" href="../../d4/de2/class_counting.html">Counting</a> *count1,  <a class="code" href="../../d7/d9c/class_spectra.html">Spectra</a> *spectra1, <a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1,  <a class="code" href="../../de/d7b/class_primaries.html">Primaries</a> *primary1,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span> eventsfound,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span>,  <span class="keywordtype">double</span>&amp;,  <span class="keywordtype">double</span>&amp;,  <span class="keywordtype">double</span>&amp;,  <span class="keywordtype">double</span>&amp;,  ofstream&amp;,  ofstream&amp;, TString, <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a>*, <a class="code" href="../../de/d30/class_source_model.html">SourceModel</a> * src_model);</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;<span class="keywordtype">void</span> WriteNeutrinoInfo(<a class="code" href="../../d7/d3b/class_position.html">Position</a>&amp;,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a>&amp;,  <a class="code" href="../../d7/d3b/class_position.html">Position</a>&amp;,  <span class="keywordtype">double</span>,  <span class="keywordtype">string</span>,  <span class="keywordtype">string</span>,  <span class="keywordtype">double</span>,  ofstream &amp;nu_out);</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;<span class="keywordtype">void</span> CloseTFile(TFile *hfile);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;<span class="keywordtype">int</span> Getmine(<span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;<span class="keywordtype">void</span> Getearth(<span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*,  <span class="keywordtype">double</span>*);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;<span class="keywordtype">int</span> GetIceMCAntfromUsefulEventAnt(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <span class="keywordtype">int</span> UsefulEventAnt);</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="preprocessor">#ifdef R_EARTH</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;<span class="preprocessor">#undef R_EARTH</span></div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;<span class="keywordtype">double</span> thresholdsAnt[48][2][5];</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;<span class="keywordtype">double</span> thresholdsAntPass[48][2][5];</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">//do a threshold scan</span></div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="keywordtype">double</span> threshold_start=-1.;</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="keywordtype">double</span> threshold_end=-6.;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> NTHRESHOLDS=20;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="keywordtype">double</span> threshold_step=(threshold_end-threshold_start)/(<span class="keywordtype">double</span>)NTHRESHOLDS;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="keywordtype">double</span> npass_v_thresh[NTHRESHOLDS]={0.};</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="keywordtype">double</span> denom_v_thresh[NTHRESHOLDS]={0.};</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="keywordtype">double</span> npass_h_thresh[NTHRESHOLDS]={0.};</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;<span class="keywordtype">double</span> denom_h_thresh[NTHRESHOLDS]={0.};</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;<span class="keywordtype">double</span> thresholds[NTHRESHOLDS];</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc,  <span class="keywordtype">char</span> **argv) {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  <span class="comment">//--------------------------------------------------------------</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;  <span class="comment">//  MC Anita</span></div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  <span class="comment">// 12/01/03</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;  <span class="comment">//--------------------------------------------------------------</span></div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  <span class="comment">//floating point exceptions </span></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;  <span class="comment">//</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;<span class="preprocessor"> #ifdef ICEMC_FEEXCEPT</span></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  feenableexcept(FE_INVALID | FE_DIVBYZERO); </div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  <span class="comment">// for comparing with peter</span></div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  <span class="keywordtype">double</span> sumsignal[5]={0.};</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  <span class="keywordtype">double</span> sumsignal_aftertaper[5]={0.};</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  <span class="keywordtype">string</span> stemp;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;  <a class="code" href="../../db/d2b/class_settings.html">Settings</a>* settings1 = <span class="keyword">new</span> <a class="code" href="../../db/d2b/class_settings.html#ab7169a6eefce79566dd07db3b1e5e967">Settings</a>();</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  <span class="keywordtype">string</span> input= ICEMC_SRC_DIR + <span class="stringliteral">&quot;/inputs.conf&quot;</span>;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  <span class="keywordtype">string</span> run_num;<span class="comment">//current run number as string</span></div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  <span class="keywordtype">int</span> run_no = 0;<span class="comment">//current run number as integer</span></div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  <span class="keywordflow">if</span>( (argc%3!=1)&amp;&amp;(argc%2!=1)) {</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Syntax for options: -i inputfile -o outputdir -r run_number\n&quot;</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  }</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  <span class="keywordtype">int</span> nnu_tmp=0;</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  <span class="keywordtype">double</span> exp_tmp=0;</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  <span class="keywordtype">double</span> trig_thresh=0.;</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  <span class="keywordtype">int</span> startNu=0;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  TString outputdir;</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  <span class="keywordtype">char</span> clswitch; <span class="comment">// command line switch</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  <span class="keywordtype">bool</span> useEventList=<span class="keyword">false</span>;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  ifstream eventListFile;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;  <span class="keywordtype">string</span> eventListName;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  </div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  <span class="keywordflow">if</span> (argc&gt;1) {</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    <span class="keywordflow">while</span> ((clswitch = getopt(argc, argv, <span class="stringliteral">&quot;t:i:o:r:n:e:x:l:&quot;</span>)) != EOF) {</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;      <span class="keywordflow">switch</span>(clswitch) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        nnu_tmp=atoi(optarg);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Changed number of simulated neutrinos to &quot;</span> &lt;&lt; nnu_tmp &lt;&lt; endl;</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;t&#39;</span>:</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        trig_thresh=atof(optarg);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        input=optarg;</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Changed input file to: &quot;</span> &lt;&lt; input &lt;&lt; endl;</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;o&#39;</span>:</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        outputdir=optarg;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Changed output directory to: &quot;</span> &lt;&lt; string(outputdir.Data()) &lt;&lt; endl;</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        stemp=<span class="stringliteral">&quot;mkdir -p &quot;</span> + string(outputdir.Data());</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        system(stemp.c_str());</div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;e&#39;</span>:</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        exp_tmp=atof(optarg);</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Changed neutrino energy exponent to &quot;</span> &lt;&lt; exp_tmp &lt;&lt; endl;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;x&#39;</span>:</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        startNu=atoi(optarg);</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Running icemc for just 1 event with eventNumber : &quot;</span> &lt;&lt; startNu &lt;&lt; endl;</div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;l&#39;</span>:</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    useEventList=<span class="keyword">true</span>;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    eventListName=optarg;</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Using event list from &quot;</span> &lt;&lt; eventListName &lt;&lt; endl;</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    eventListFile.open(eventListName.c_str());</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (!eventListFile.is_open()) {</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;This is not a valid filename &quot;</span> &lt;&lt; endl;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    }</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="keywordflow">break</span>;  </div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordflow">case</span> <span class="charliteral">&#39;r&#39;</span>:</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        run_num=optarg;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;        stringstream convert(run_num);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        convert&gt;&gt;run_no;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      } <span class="comment">// end switch</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    } <span class="comment">// end while</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;  } <span class="comment">// end if arg&gt;1</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;  settings1-&gt;SEED=settings1-&gt;SEED +run_no;</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;seed is &quot;</span> &lt;&lt; settings1-&gt;SEED &lt;&lt; endl;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/nu_position&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;  ofstream nu_out(stemp.c_str(),  ios::app); <span class="comment">//Positions,  direction of momentum,  and neutrino type for Ryan.</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/veff&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;  ofstream veff_out(stemp.c_str(),  ios::app);<span class="comment">//to output only energy and effective volume to veff.txt</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/distance&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  ofstream distanceout(stemp.c_str());</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/debug&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  fstream outfile(stemp.c_str(), ios::out);</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/forbrian&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  fstream forbrian(stemp.c_str(), ios::out);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/al_voltages_direct&quot;</span>+run_num+<span class="stringliteral">&quot;.dat&quot;</span>;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;  fstream al_voltages_direct(stemp.c_str(), ios::out); <span class="comment">//added djg ------provide anita-lite voltages and noise from MC for anita-lite analysis</span></div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/events&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  ofstream eventsthatpassfile(stemp.c_str());</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/numbers&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  ofstream fnumbers(stemp.c_str()); <span class="comment">// debugging</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/output&quot;</span>+run_num+<span class="stringliteral">&quot;.txt&quot;</span>;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  ofstream foutput(stemp.c_str(),  ios::app);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/slacviewangles&quot;</span>+run_num+<span class="stringliteral">&quot;.dat&quot;</span>;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  ofstream fslac_viewangles(stemp.c_str()); <span class="comment">// this outputs numbers that we need for analyzing slac data</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/slac_hitangles&quot;</span>+run_num+<span class="stringliteral">&quot;.dat&quot;</span>;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;  ofstream fslac_hitangles(stemp.c_str()); <span class="comment">// this outputs numbers that we need for analyzing slac data</span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;  <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1=<span class="keyword">new</span> <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a>(); <span class="comment">// instance of the balloon</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  Anita *anita1=<span class="keyword">new</span> Anita();<span class="comment">// right now this constructor gets banding info</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <a class="code" href="../../d6/d1a/class_secondaries.html">Secondaries</a> *sec1=<span class="keyword">new</span> <a class="code" href="../../d6/d1a/class_secondaries.html">Secondaries</a>();</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;  <a class="code" href="../../de/d7b/class_primaries.html">Primaries</a> *primary1=<span class="keyword">new</span> <a class="code" href="../../de/d7b/class_primaries.html">Primaries</a>();</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;  <a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1=<span class="keyword">new</span> <a class="code" href="../../dc/d20/class_signal.html">Signal</a>();</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  <a class="code" href="../../d2/d1f/class_ray.html">Ray</a> *ray1=<span class="keyword">new</span> <a class="code" href="../../d2/d1f/class_ray.html">Ray</a>(); <span class="comment">// create new instance of the ray class</span></div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;  <a class="code" href="../../d4/de2/class_counting.html">Counting</a> *count1=<span class="keyword">new</span> <a class="code" href="../../d4/de2/class_counting.html">Counting</a>();</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  <a class="code" href="../../d7/d39/class_global_trigger.html">GlobalTrigger</a> *globaltrig1;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="../../d6/dc1/class_taumodel.html">Taumodel</a> *taus1 = <span class="keyword">new</span> <a class="code" href="../../d6/dc1/class_taumodel.html">Taumodel</a>();</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;  <span class="comment">// input parameters</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  settings1-&gt;ReadInputs(input.c_str(),  foutput, NNU, RANDOMISEPOL);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;  settings1-&gt;ApplyInputs(anita1,  sec1,  sig1,  bn1,  ray1);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;  <span class="comment">// Signal needs to be initialize with Askaryan parametrisation info</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;  <span class="comment">// After the inputs are read</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  sig1-&gt;Initialize();</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;  </div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  settings1-&gt;SEED=settings1-&gt;SEED + run_no;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  setSeed(settings1-&gt;SEED);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  bn1-&gt;InitializeBalloon();</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;  anita1-&gt;Initialize(settings1, foutput, inu, outputdir);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;  <span class="keywordflow">if</span> (startNu&gt;0){</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    run_no = 0;</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    nnu_tmp = startNu+1;</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  }</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;  </div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <span class="keywordflow">if</span> (trig_thresh!=0)</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    anita1-&gt;powerthreshold[4]=trig_thresh;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;  <span class="keywordflow">if</span> (nnu_tmp!=0)</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    NNU=nnu_tmp;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;  <span class="keywordflow">if</span> (exp_tmp!=0)</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    settings1-&gt;EXPONENT=exp_tmp;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;  <a class="code" href="../../de/d30/class_source_model.html">SourceModel</a> *src_model = 0; </div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;  <span class="keywordflow">if</span> (!strcasecmp(settings1-&gt;SOURCE.c_str(),<span class="stringliteral">&quot;CUSTOM&quot;</span>)) </div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;  {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    src_model = <span class="keyword">new</span> <a class="code" href="../../de/d30/class_source_model.html">SourceModel</a>(<span class="stringliteral">&quot;custom&quot;</span>); </div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    src_model-&gt;<a class="code" href="../../de/d30/class_source_model.html#a9cd5fa7aa3b86acf76cc8da6e04ed5d6">addSource</a>( <span class="keyword">new</span> <a class="code" href="../../d8/d74/class_source.html">Source</a>(<span class="stringliteral">&quot;Custom Source&quot;</span>, (settings1-&gt;CUSTOM_RA)/15, settings1-&gt;CUSTOM_DEC, </div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                              <span class="keyword">new</span> <a class="code" href="../../d6/da5/class_constant_exponential_source_flux.html">ConstantExponentialSourceFlux</a>(settings1-&gt;CUSTOM_GAMMA, 1e-10,1e6))); </div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    </div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;  }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(strcasecmp(settings1-&gt;SOURCE.c_str(),<span class="stringliteral">&quot;NONE&quot;</span>))</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;  {</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    src_model = <a class="code" href="../../de/d30/class_source_model.html#a407af6645f51393454b6213db67ce097">SourceModel::getSourceModel</a>(settings1-&gt;SOURCE.c_str(),  </div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                              <a class="code" href="../../de/d07/struct_source_model_1_1_restriction.html">SourceModel::Restriction</a>( settings1-&gt;DEC_CUT, settings1-&gt;WHICH_SOURCES.c_str(), settings1-&gt;WHICH_SUBTYPE.c_str(), </div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                              SourceModel::Restriction::fromString(settings1-&gt;WHICH_START_TIME.c_str()),</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                              SourceModel::Restriction::fromString(settings1-&gt;WHICH_END_TIME.c_str()))); </div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  }</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      </div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;SOURCE_USE_EXPONENT &amp;&amp; settings1-&gt;EXPONENT &lt; 22) </div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;  {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    settings1-&gt;SOURCE_MIN_E=settings1-&gt;EXPONENT;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    settings1-&gt;SOURCE_MAX_E=settings1-&gt;EXPONENT;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <span class="keywordtype">double</span> src_min = TMath::Power(10,settings1-&gt;SOURCE_MIN_E-9);  <span class="comment">//since source model takes things in GeV</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordtype">double</span> src_max = TMath::Power(10,settings1-&gt;SOURCE_MAX_E-9);  <span class="comment">//since source model takes things in GeV</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;  <a class="code" href="../../d7/d9c/class_spectra.html">Spectra</a> *spectra1 = <span class="keyword">new</span> <a class="code" href="../../d7/d9c/class_spectra.html">Spectra</a>((<span class="keywordtype">int</span>)settings1-&gt;EXPONENT);</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *interaction1=<span class="keyword">new</span> <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a>(<span class="stringliteral">&quot;nu&quot;</span>, primary1, settings1, 0, count1);</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *int_banana=<span class="keyword">new</span> <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a>(<span class="stringliteral">&quot;banana&quot;</span>, primary1, settings1, 0, count1);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160; </div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <span class="keywordflow">if</span> (src_model) {</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    printf(<span class="stringliteral">&quot;Using Source Model %s\n&quot;</span>, src_model-&gt;getName());</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    printf(<span class="stringliteral">&quot;Setting up weights: %g %g %g %g\n&quot;</span>, bn1-&gt;min_time, bn1-&gt;max_time, src_min, src_max); </div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    src_model-&gt;<a class="code" href="../../de/d30/class_source_model.html#a54fab06569b09be7003bdff436994db3">setUpWeights</a>(bn1-&gt;min_time, bn1-&gt;max_time , src_min, src_max); </div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;  }</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;  </div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <a class="code" href="../../da/d10/class_roughness.html">Roughness</a> *rough1 = <span class="keyword">new</span> <a class="code" href="../../da/d10/class_roughness.html">Roughness</a>(settings1); <span class="comment">// create new instance of the roughness class</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;  rough1-&gt;SetRoughScale(settings1-&gt;ROUGHSIZE);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  Screen *panel1 = <span class="keyword">new</span> Screen(0);  <span class="comment">// create new instance of the screen class</span></div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="keywordflow">if</span>(!src_model &amp;&amp; spectra1-&gt;IsSpectrum())</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  {</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Using an energy spectrum&quot;</span> &lt;&lt; endl;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  }</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  </div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src_model) </div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  {</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    cout&lt;&lt; <span class="stringliteral">&quot;Source Model Bounds are 10^&quot;</span> &lt;&lt; settings1-&gt;SOURCE_MIN_E &lt;&lt; <span class="stringliteral">&quot;eV to 10^&quot;</span> &lt;&lt; settings1-&gt;SOURCE_MAX_E &lt;&lt; <span class="stringliteral">&quot;eV&quot;</span> &lt;&lt; endl; </div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!src_model &amp;&amp; spectra1-&gt;IsMonoenergetic())</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;    {</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Using a monoenergetic exponent of: &quot;</span> &lt;&lt; settings1-&gt;EXPONENT &lt;&lt; endl;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    }</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  std::cout &lt;&lt; <span class="stringliteral">&quot;----------------------&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// declare instance of trigger class.</span></div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  <span class="comment">// this constructor reads from files with info to parameterize the</span></div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="comment">// signal efficiency curves.</span></div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;  <span class="comment">// and reads in scalar vs. threshold scans</span></div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;  time_t raw_start_time = time(NULL);</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;  <span class="keyword">struct </span>tm * start_time = localtime(&amp;raw_start_time);</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Date and time at start of run are: &quot;</span> &lt;&lt; asctime (start_time) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;FORSECKEL)</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    SetupViewangles(sig1);<span class="comment">// set up viewing angles for testing against jaime&#39;s parameterizations</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;  <span class="comment">// for attenuation of neutrino in atmosphere</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  <span class="comment">// only important for black hole studies</span></div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  <span class="keywordtype">double</span> col1[900];</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  GetAir(col1);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;  <span class="keywordtype">double</span> myair = 0.;<span class="comment">//air column density, kg/m^2</span></div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="comment">// zeroing global variables.</span></div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  Tools::Zero(sum_frac, 3);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;  Tools::Zero(sum_frac_db, 3);</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  Tools::Zero(anita1-&gt;NRX_PHI, <a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>);</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>;i++) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    Tools::Zero(anita1-&gt;PHI_EACHLAYER[i], <a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;  }</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  Tools::Zero(anita1-&gt;PHI_OFFSET, Anita::NLAYERS_MAX);</div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;  Tools::Zero(anita1-&gt;THETA_ZENITH, Anita::NLAYERS_MAX);</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;  Tools::Zero(anita1-&gt;LAYER_VPOSITION, Anita::NLAYERS_MAX);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  Tools::Zero(anita1-&gt;RRX, Anita::NLAYERS_MAX);</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  <span class="comment">//added djg ////////////////////////////////////////////////////////</span></div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  al_voltages_direct&lt;&lt;<span class="stringliteral">&quot;antenna #&quot;</span>&lt;&lt;<span class="stringliteral">&quot;   &quot;</span>&lt;&lt;<span class="stringliteral">&quot;volts chan 1&quot;</span>&lt;&lt;<span class="stringliteral">&quot;   &quot;</span>&lt;&lt;<span class="stringliteral">&quot;volts chan 2&quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;<span class="stringliteral">&quot;volts chan 3&quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;<span class="stringliteral">&quot;volts chan 4&quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;<span class="stringliteral">&quot;noise chan 1&quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;<span class="stringliteral">&quot;noise chan 2&quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;<span class="stringliteral">&quot;noise chan 3&quot;</span>&lt;&lt;<span class="stringliteral">&quot;   &quot;</span>&lt;&lt;<span class="stringliteral">&quot;noise chan 4&quot;</span>&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;<span class="stringliteral">&quot;weight&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="comment">// ray tracing</span></div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordtype">double</span> viewangle=0;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordtype">double</span> viewangle_temp=0; <span class="comment">// angle of ray in ice relative to neutrino direction</span></div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;  <span class="keywordtype">double</span> viewangle_deg=0; <span class="comment">// viewing angle in degrees.</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordtype">double</span> cosviewangle=0; <span class="comment">// cosine of viewing angle</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;  <span class="keywordtype">double</span> offaxis=0; <span class="comment">// viewangle-changle,  for plotting</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordtype">double</span> nsigma_offaxis=0;<span class="comment">// offaxis,  relative to deltheta_had,  for plotting</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;  <span class="keywordtype">double</span> theta_threshold=0; <span class="comment">// maximum angle you can be away from the cerenkov angle and still have a chance of seeing the event.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  <span class="keywordtype">double</span> theta_threshold_deg=0; <span class="comment">// maximum angle you can be away from the cerenkov angle and still have a chance of seeing the event.</span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  <span class="keywordtype">double</span> nsigma_em_threshold=0; <span class="comment">//number of sigma away theta_threshold is.</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;  <span class="keywordtype">double</span> nsigma_had_threshold=0;<span class="comment">// just for plotting</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  <span class="keywordtype">double</span> slopeyangle=0; <span class="comment">// angle between nominal surface normal and the surface normal after slopeyness is applied</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="comment">//-------------------</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;  <span class="keywordtype">int</span> beyondhorizon = 0;  <span class="comment">//Switch tells if neutrino interacts beyond the balloon&#39;s horizon. (0: inside horizon,  1: outside horizon)</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;  <span class="comment">// frequency binning</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;  <span class="keywordtype">double</span> vmmhz1m_max=0; <span class="comment">// maximum V/m/MHz at 1m from Jaime (highest frequency)</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  <span class="keywordtype">double</span> vmmhz_lowfreq=0.; <span class="comment">// V/m/MHz after 1/r,  attenuation at the lowest freq.</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordtype">double</span> bestcase_atten=0;<span class="comment">// attenuation factor,  best case</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;  <span class="keywordtype">double</span> vmmhz1m_fresneledonce=0; <span class="comment">// above,  after fresnel factor applied for ice-air interface</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  <span class="keywordtype">double</span> vmmhz1m_fresneledtwice=0; <span class="comment">// above,  after fresnel factor applied for firn</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;  <span class="keywordtype">double</span> vmmhz[Anita::NFREQ];                        <span class="comment">//  V/m/MHz at balloon (after all steps)</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// given the angle you are off the Cerenkov cone,  the fraction of the observed e field that comes from the em shower</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  <span class="keywordtype">double</span> vmmhz_em[Anita::NFREQ];</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;  <span class="keywordtype">double</span> vmmhz_temp=1.;</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordtype">double</span> vmmhz_min_thatpasses=1000;</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordtype">double</span> vmmhz_min=0;   <span class="comment">// minimum of the above array</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;  <span class="keywordtype">double</span> vmmhz_max=0;                        <span class="comment">// maximum of the above array</span></div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;  <span class="keywordtype">double</span> deltheta_em[Anita::NFREQ], deltheta_had[Anita::NFREQ];     <span class="comment">// for ch angular distribution</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;  <span class="keywordtype">double</span> deltheta_em_max, deltheta_had_max;     <span class="comment">// maximum value of above array angular distribution</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;  <span class="keywordtype">double</span> deltheta_em_mid2, deltheta_had_mid2;     <span class="comment">// widths of cones for the mid2 band</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;  <span class="comment">// shower properties</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;  <span class="keywordtype">double</span> emfrac, hadfrac, sumfrac;               <span class="comment">// em and had fractions</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;  <span class="keywordtype">int</span> n_interactions=1;            <span class="comment">// count number of interactions for this event,  including secondaries.</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  <span class="keywordtype">double</span> emfrac_db, hadfrac_db;</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="keywordtype">int</span> nuflavorint2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;  <span class="keywordtype">double</span> costheta_nutraject2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a>;</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;  <span class="keywordtype">double</span> phi_nutraject2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a21e2b2f14f8a5990763a1af10aacdf83">phi_nutraject</a>;</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  <span class="keywordtype">double</span> altitude_int2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">altitude_int</a>;</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  <span class="keywordtype">int</span> currentint2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>;</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  <span class="keywordtype">double</span> d12=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3fe851ac8a75b2ab8485e9c15d465a09">d1</a>;</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <span class="keywordtype">double</span> d22=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>;</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  <span class="keywordtype">double</span> dtryingdirection2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>;</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  <span class="keywordtype">double</span> logchord2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ad6bd919d4c158047bd04f0bdeba675b5">logchord</a>;</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordtype">double</span> r_fromballoon2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[0];</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  <span class="keywordtype">double</span> chord_kgm2_bestcase2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">chord_kgm2_bestcase</a>;</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  <span class="keywordtype">double</span> chord_kgm2_ice2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a9d37bb0ab6d96f72391206583c91d7a7">chord_kgm2_ice</a>;</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  <span class="keywordtype">double</span> weight_bestcase2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a5348445748bde8ee1c550a99127be2b3">weight_bestcase</a>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  <span class="keywordtype">double</span> r_exit2bn2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8949fd35ed92144d9f9de770d778a59d">r_exit2bn</a>;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;  <span class="keywordtype">double</span> r_exit2bn_measured2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0be48e99fca7d0dfc99fdf4e01b386e3">r_exit2bn_measured</a>;</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  <span class="keywordtype">string</span> taudecay;                   <span class="comment">// tau decay type: e, m, h</span></div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="keywordtype">double</span> elast_y=0;                   <span class="comment">// inelasticity</span></div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="keywordtype">double</span> volts_rx_0=0;              <span class="comment">// voltage on an individual antenna,  lc polarization</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="keywordtype">double</span> volts_rx_1=0;              <span class="comment">// voltage on an individual antenna,  rc polarization</span></div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <span class="keywordtype">double</span> volts_rx_max=0; <span class="comment">// max voltage seen on an antenna - just for debugging purposes</span></div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <span class="keywordtype">double</span> volts_rx_ave=0; <span class="comment">// ave voltage seen on an antenna,  among hit antennas</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="keywordtype">double</span> volts_rx_sum=0; <span class="comment">// ave voltage seen on an antenna,  among hit antennas</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  <span class="keywordtype">double</span> volts_rx_max_highband; <span class="comment">// max voltage seen on an antenna - just for debugging purposes</span></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <span class="keywordtype">double</span> volts_rx_max_lowband; <span class="comment">// max voltage seen on an antenna - just for debugging purposes</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  <span class="keywordtype">double</span> volts_rx_rfcm_lab_e_all[48][512];</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;  <span class="keywordtype">double</span> volts_rx_rfcm_lab_h_all[48][512];</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;  <span class="comment">// variable declarations for functions GetEcompHcompEvector and GetEcompHcompkvector - oindree</span></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> e_component[Anita::NANTENNAS_MAX]={0}; <span class="comment">// E comp along polarization</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> h_component[Anita::NANTENNAS_MAX]={0}; <span class="comment">// H comp along polarization</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> n_component[Anita::NANTENNAS_MAX]={0}; <span class="comment">// normal comp along polarization</span></div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> e_component_kvector[Anita::NANTENNAS_MAX]={0}; <span class="comment">// component of e-field along the rx e-plane</span></div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> h_component_kvector[Anita::NANTENNAS_MAX]={0}; <span class="comment">// component of the e-field along the rx h-plane</span></div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  <span class="keyword">static</span> <span class="keywordtype">double</span> n_component_kvector[Anita::NANTENNAS_MAX]={0}; <span class="comment">// component of the e-field along the normal</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_eplane = const_z;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_hplane = -const_y;</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_normal = const_x;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;  <span class="keywordtype">double</span> chengji = 0;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> ant_normal; <span class="comment">//Vector normal to the face of the antenna</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  <span class="keywordtype">double</span> hitangle_e, hitangle_h;       <span class="comment">// angle the ray hits the antenna wrt e-plane, h-plane</span></div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  <span class="keywordtype">double</span> hitangle_e_all[Anita::NANTENNAS_MAX];         <span class="comment">// hit angles rel. to e plane stored for each antenna</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="keywordtype">double</span> hitangle_h_all[Anita::NANTENNAS_MAX];         <span class="comment">// hit angles rel. to h plane stored for each antenna</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  <span class="keywordtype">double</span> sigma = 0;                       <span class="comment">// for cross section</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordtype">double</span> len_int_kgm2=0;              <span class="comment">// interaction length in kg/m^2</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;  <span class="keywordtype">double</span> eventsfound_db=0; <span class="comment">// same,  for double bang</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;  <span class="keywordtype">double</span> eventsfound_nfb=0; <span class="comment">// for taus</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  <span class="comment">// positions in earth frame</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  <span class="keywordtype">double</span> horizcoord=0; <span class="comment">// x component of interaction position</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keywordtype">double</span> vertcoord=0; <span class="comment">// y component of interaction position</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  <span class="keywordtype">double</span> dist_int_bn_2d=0; <span class="comment">// 2-d (surface) distance between interaction and balloon</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="keywordtype">double</span> dist_int_bn_2d_chord=0; <span class="comment">//chord distance between interaction and balloon (between surface points)</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <span class="keywordtype">double</span> viewangle_eachboresight[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">// viewing angle for each antenna</span></div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordtype">double</span> cosalpha; <span class="comment">// angle between nu momentum and surface normal at earth entrance point</span></div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  <span class="keywordtype">double</span> mytheta; </div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordtype">double</span> cosbeta0; <span class="comment">// angle between nu momentum and surface normal at interaction point.</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  <span class="keywordtype">double</span> mybeta; </div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="keywordtype">double</span> nuexitlength=0; <span class="comment">// distance from interaction to where neutrino would leave</span></div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordtype">double</span> nuexitice=0;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="keywordtype">double</span> nuentrancelength=0; <span class="comment">// for taus</span></div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="keywordtype">double</span> taulength=0;  <span class="comment">// distance tau travels in ice before decaying</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <span class="keywordtype">double</span> icethickness=0; <span class="comment">// for taus</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordtype">double</span> theta_pol_measured; <span class="comment">// theta of the polarization as measured at the payload (for now we don&#39;t correct for the 10 degree cant)</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="keywordtype">double</span> ptaui=0;</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  <span class="keywordtype">double</span> ptauf =0;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  <span class="keywordtype">double</span> tauweight=0;</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="keywordtype">double</span> nutauweightsum=0;</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="keywordtype">double</span> tauweightsum=0;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="keywordtype">double</span> nutauweight=0;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="keywordtype">int</span> tautrigger=0;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="keywordtype">int</span> tauweighttrigger=0;</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="keywordtype">double</span> sample_x=0, sample_y = 0; </div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="keywordtype">bool</span> isDead;</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  </div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="keywordtype">double</span> sourceLon;</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="keywordtype">double</span> sourceAlt;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="keywordtype">double</span> sourceLat;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <span class="keywordtype">double</span> sourceMag;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="comment">//double payloadTheta;</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="comment">//double payloadPhi;</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_nutraject_ontheground; <span class="comment">//direction of the neutrino from the person standing on the ground just below the balloon.</span></div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_pol; <span class="comment">// direction of polarization</span></div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_pol_eachboresight[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">// direction of polarization of signal seen at each antenna</span></div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_pol_db; <span class="comment">// same,  double bangs</span></div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <span class="keywordtype">int</span> l3trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>];  <span class="comment">// 16 bit number which says which phi sectors pass L3 V-POL</span></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordtype">int</span> l3trignoise[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>];  <span class="comment">// 16 bit number which says which phi sectors pass L3 V-POL</span></div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;  <span class="comment">// For each trigger layer,  which &quot;clumps&quot; pass L2.  16 bit,  16 bit and 8 bit for layers 1 &amp; 2 and nadirs</span></div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  <span class="keywordtype">int</span> l2trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX];</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  <span class="comment">//For each trigger layer,  which antennas pass L1.  16 bit,  16 bit and 8 bit and layers 1,  2 and nadirs</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  <span class="keywordtype">int</span> l1trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX];</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  <span class="comment">// these are declared here so that they can be stuck into trees</span></div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordtype">int</span> loctrig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">//counting how many pass trigger requirement</span></div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  <span class="keywordtype">int</span> loctrig_nadironly[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">//counting how many pass trigger requirement</span></div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordtype">int</span> nchannels_triggered = 0; <span class="comment">// total number of channels triggered</span></div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  <span class="keywordtype">int</span> nchannels_perrx_triggered[48]; <span class="comment">// total number of channels triggered</span></div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// zeroing</span></div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a>=0;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  eventsfound=0.; <span class="comment">// sums weights for events that pass</span></div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  Tools::Zero(count1-&gt;npass, 2); <span class="comment">// sums events that pass,  without weights</span></div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;  Tools::Zero(sum, 3);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  eventsfound_db=0;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;  eventsfound_nfb=0;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  Tools::Zero(eventsfound_binned, NBINS);</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;  Tools::Zero(eventsfound_binned_e, NBINS);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;  Tools::Zero(eventsfound_binned_mu, NBINS);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;  Tools::Zero(eventsfound_binned_tau, NBINS);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;  Tools::Zero(eventsfound_nfb_binned, NBINS);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="comment">//we pick both the interaction point and its corresponding mirror point</span></div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;  <span class="comment">//for drawing the events on the events map</span></div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;  TH2F *ref_int_coord=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;ref_int_coord&quot;</span>,  <span class="stringliteral">&quot;&quot;</span>,  600,  -3000,  3000,  500,  -2500,  2500);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  ref_int_coord-&gt;SetMarkerSize(0.7);;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  ref_int_coord-&gt;SetMarkerStyle(30);</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  ref_int_coord-&gt;SetMarkerColor(kBlue);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  TH2F *dir_int_coord=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;dir_int_coord&quot;</span>,  <span class="stringliteral">&quot;&quot;</span>,  600,  -3000,  3000,  500,  -2500,  2500);</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  dir_int_coord-&gt;SetMarkerSize(0.7);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;  dir_int_coord-&gt;SetMarkerStyle(30);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;  TH1F *prob_eachphi_bn=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;prob_eachphi_bn&quot;</span>,  <span class="stringliteral">&quot;prob_eachphi_bn&quot;</span>,  100,  0.,  6.3);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  TH1F *prob_eachilon_bn=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;prob_eachilon_bn&quot;</span>,  <span class="stringliteral">&quot;prob_eachilon_bn&quot;</span>,  180,  0.,  180.);</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  TH2F *h6=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;theta_vs_hitangle_h&quot;</span>,  <span class="stringliteral">&quot;theta_vs_hitangle_h&quot;</span>,  100,  -3.14,  3.14,  100,  -1.1,  1.1);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  TH1F *h10=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;hitangle_e&quot;</span>,  <span class="stringliteral">&quot;hitangle_e&quot;</span>,  20,  -1.6,  1.6);</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  TH1F *hy=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;hy&quot;</span>,  <span class="stringliteral">&quot;hy&quot;</span>,  100,  0.,  1.);</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  TH1F *fraction_sec_muons = <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;fraction_sec_muons&quot;</span>,  <span class="stringliteral">&quot;fraction_sec_muons&quot;</span>,  100,  0.,  1.);</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  TH1F *fraction_sec_taus=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;fraction_sec_taus&quot;</span>,  <span class="stringliteral">&quot;fraction_sec_taus&quot;</span>,  100,  0.,  1.);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  TH1F *n_sec_muons= <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;n_sec_muons&quot;</span>,  <span class="stringliteral">&quot;n_sec_muons&quot;</span>,  100,  0.,  10.);</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;  TH1F *n_sec_taus= <span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;n_sec_taus&quot;</span>,  <span class="stringliteral">&quot;n_sec_taus&quot;</span>,  100,  0.,  10.);</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;  TH1F *sampleweights=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;sampleweights&quot;</span>,  <span class="stringliteral">&quot;sampleweights&quot;</span>,  100,  -5.,  0.); <span class="comment">// we sample weights for early events and save</span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  <span class="comment">//them in this histogram,</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="comment">//to determine where the cut should be.</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/icefinal&quot;</span>+run_num+<span class="stringliteral">&quot;.root&quot;</span>;</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  TFile *hfile = <span class="keyword">new</span> TFile(stemp.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>, <span class="stringliteral">&quot;ice&quot;</span>);</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  TTree *tree2 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h2000&quot;</span>, <span class="stringliteral">&quot;h2000&quot;</span>); <span class="comment">// tree2 filled for each event that is beyond the horizon.</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  tree2-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>, &amp;inu, <span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  tree2-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  tree2-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  tree2-&gt;Branch(<span class="stringliteral">&quot;scalefactor_distance&quot;</span>, &amp;scalefactor_distance, <span class="stringliteral">&quot;scalefactor_distance/D&quot;</span>);</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  tree2-&gt;Branch(<span class="stringliteral">&quot;scalefactor_attenuation&quot;</span>, &amp;scalefactor_attenuation, <span class="stringliteral">&quot;scalefactor_attenuation/D&quot;</span>);</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  TTree *tree3 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h3000&quot;</span>, <span class="stringliteral">&quot;h3000&quot;</span>); <span class="comment">// tree3 if signal is detectable.</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;deltheta_em_max&quot;</span>, &amp;deltheta_em_max, <span class="stringliteral">&quot;deltheta_em_max/D&quot;</span>);</div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;deltheta_had_max&quot;</span>, &amp;deltheta_had_max, <span class="stringliteral">&quot;deltheta_had_max/D&quot;</span>);</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;theta_threshold_deg&quot;</span>, &amp;theta_threshold_deg, <span class="stringliteral">&quot;theta_threshold_deg/D&quot;</span>);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;nsigma_em_threshold&quot;</span>, &amp;nsigma_em_threshold, <span class="stringliteral">&quot;nsigma_em_threshold/D&quot;</span>);</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;nsigma_had_threshold&quot;</span>, &amp;nsigma_had_threshold, <span class="stringliteral">&quot;nsigma_had_threshold/D&quot;</span>);</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;vmmhz_max&quot;</span>, &amp;vmmhz_max, <span class="stringliteral">&quot;vmmhz_max/D&quot;</span>);</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;vmmhz_min&quot;</span>, &amp;vmmhz_min, <span class="stringliteral">&quot;vmmhz_min/D&quot;</span>);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;dviewangle_deg&quot;</span>, &amp;dviewangle_deg, <span class="stringliteral">&quot;dviewangle_deg/D&quot;</span>);</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;viewangle_deg&quot;</span>, &amp;viewangle_deg, <span class="stringliteral">&quot;viewangle_deg/D&quot;</span>);</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;changle_deg&quot;</span>, &amp;changle_deg, <span class="stringliteral">&quot;changle_deg/D&quot;</span>);</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;cosviewangle&quot;</span>, &amp;cosviewangle, <span class="stringliteral">&quot;cosviewangle/D&quot;</span>);</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;  tree3-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  TTree *tree5 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h5000&quot;</span>, <span class="stringliteral">&quot;h5000&quot;</span>); <span class="comment">// tree5 filled for each nutau.</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_max&quot;</span>, &amp;vmmhz1m_max, <span class="stringliteral">&quot;vmmhz1m_max/D&quot;</span>);</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>, &amp;inu, <span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;nuexitlength&quot;</span>, &amp;nuexitlength, <span class="stringliteral">&quot;nuexitlength/D&quot;</span>);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;nuexitice&quot;</span>,  &amp;nuexitice,  <span class="stringliteral">&quot;nuexitice&quot;</span>);</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;vmmhz_max&quot;</span>, &amp;vmmhz_max, <span class="stringliteral">&quot;vmmhz_max&quot;</span>);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;maxtaper&quot;</span>, &amp;maxtaper, <span class="stringliteral">&quot;maxtaper&quot;</span>);</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>, &amp;inu, <span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;whichray&quot;</span>, &amp;whichray, <span class="stringliteral">&quot;whichray/I&quot;</span>);</div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;pnu&quot;</span>, &amp;pnu, <span class="stringliteral">&quot;pnu/D&quot;</span>);</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;costhetanu&quot;</span>, &amp;costhetanu, <span class="stringliteral">&quot;costhetanu/D&quot;</span>);</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;viewangle&quot;</span>, &amp;viewangle, <span class="stringliteral">&quot;viewangle/D&quot;</span>);</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;offaxis&quot;</span>, &amp;offaxis, <span class="stringliteral">&quot;offaxis/D&quot;</span>);</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;nsigma_offaxis&quot;</span>, &amp;nsigma_offaxis, <span class="stringliteral">&quot;nsigma_offaxis/D&quot;</span>);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;sumfrac&quot;</span>, &amp;sumfrac, <span class="stringliteral">&quot;sumfrac/D&quot;</span>);</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;weight1&quot;</span>, &amp;weight1, <span class="stringliteral">&quot;weight1/D&quot;</span>);</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;nearthlayers&quot;</span>, &amp;nearthlayers, <span class="stringliteral">&quot;nearthlayers/D&quot;</span>);</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;logchord&quot;</span>, &amp;logchord2, <span class="stringliteral">&quot;interaction1-&gt;logchord/D&quot;</span>);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;diff_3tries&quot;</span>, &amp;diff_3tries, <span class="stringliteral">&quot;diff_3tries/D&quot;</span>);</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;fresnel2&quot;</span>, &amp;fresnel2, <span class="stringliteral">&quot;fresnel2/D&quot;</span>);</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;costheta_inc&quot;</span>, &amp;costheta_inc, <span class="stringliteral">&quot;costheta_inc/D&quot;</span>);</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;costheta_exit&quot;</span>, &amp;costheta_exit, <span class="stringliteral">&quot;costheta_exit/D&quot;</span>);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;deltheta_em&quot;</span>, &amp;deltheta_em[0], <span class="stringliteral">&quot;deltheta_em/D&quot;</span>);</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;deltheta_had&quot;</span>, &amp;deltheta_had[0], <span class="stringliteral">&quot;deltheta_had/F&quot;</span>);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;r_fromballoon&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[0], <span class="stringliteral">&quot;r_fromballoon/F&quot;</span>);</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;theta_in&quot;</span>, &amp;theta_in, <span class="stringliteral">&quot;theta_in/D&quot;</span>);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  tree5-&gt;Branch(<span class="stringliteral">&quot;lat_in&quot;</span>, &amp;lat_in, <span class="stringliteral">&quot;lat_in/D&quot;</span>);</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  TTree *tree6 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h6000&quot;</span>, <span class="stringliteral">&quot;h6000&quot;</span>); <span class="comment">// tree6 filled for neutrinos that enter S of 60 deg S latitude.</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;volts_rx_0&quot;</span>, &amp;volts_rx_0, <span class="stringliteral">&quot;volts_rx_0/D&quot;</span>);</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;volts_rx_1&quot;</span>, &amp;volts_rx_1, <span class="stringliteral">&quot;volts_rx_1/D&quot;</span>);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;theta_in&quot;</span>, &amp;theta_in, <span class="stringliteral">&quot;theta_in/D&quot;</span>);</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;chord_kgm2_bestcase&quot;</span>, &amp;chord_kgm2_bestcase2, <span class="stringliteral">&quot;chord_kgm2_bestcase/D&quot;</span>);</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;chord_kgm2_ice&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a9d37bb0ab6d96f72391206583c91d7a7">chord_kgm2_ice</a>, <span class="stringliteral">&quot;chord_kgm2_ice/D&quot;</span>);</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;costheta_nutraject&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a>, <span class="stringliteral">&quot;costheta_nutraject/D&quot;</span>);</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;weight1&quot;</span>, &amp;weight1, <span class="stringliteral">&quot;weight1/D&quot;</span>);</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;weight_bestcase&quot;</span>, &amp;weight_bestcase2, <span class="stringliteral">&quot;weight_bestcase/D&quot;</span>);</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;whichray&quot;</span>, &amp;whichray, <span class="stringliteral">&quot;whichray/I&quot;</span>);</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;mybeta&quot;</span>, &amp;mybeta, <span class="stringliteral">&quot;mybeta/D&quot;</span>);</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;  tree6-&gt;Branch(<span class="stringliteral">&quot;longitude&quot;</span>, &amp;longitude_this, <span class="stringliteral">&quot;longitude/D&quot;</span>);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;  TTree *tree6b = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h6001&quot;</span>, <span class="stringliteral">&quot;h6001&quot;</span>); <span class="comment">// tree6b filled for the closest antenna to the interaction</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;  tree6b-&gt;Branch(<span class="stringliteral">&quot;bwslice_vnoise&quot;</span>, bwslice_vnoise_thislayer, <span class="stringliteral">&quot;bwslice_vnoise_thislayer[4]/D&quot;</span>);</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;  TTree *tree7 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h7000&quot;</span>, <span class="stringliteral">&quot;h7000&quot;</span>); <span class="comment">// tree6 filled just after flavor is set</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;current&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>, <span class="stringliteral">&quot;currentint/I&quot;</span>);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;nuflavor&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>, <span class="stringliteral">&quot;nuflavorint/I&quot;</span>);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;nunubar&quot;</span>, &amp;thisNuType, <span class="stringliteral">&quot;nunubar/I&quot;</span>);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;sumfrac&quot;</span>, &amp;sumfrac, <span class="stringliteral">&quot;sumfrac/D&quot;</span>);</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  tree7-&gt;Branch(<span class="stringliteral">&quot;slopeyangle&quot;</span>, &amp;slopeyangle, <span class="stringliteral">&quot;slopeyangle/D&quot;</span>);</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  TTree *jaimetree=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;jaimetree&quot;</span>, <span class="stringliteral">&quot;jaimetree&quot;</span>); <span class="comment">// signal as it is produced at the interaction</span></div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_max&quot;</span>, &amp;vmmhz1m_max, <span class="stringliteral">&quot;vmmhz1m_max/D&quot;</span>);</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;deltheta_em_max&quot;</span>, &amp;deltheta_em_max, <span class="stringliteral">&quot;deltheta_em_max/D&quot;</span>);</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;deltheta_had_max&quot;</span>, &amp;deltheta_had_max, <span class="stringliteral">&quot;deltheta_had_max/D&quot;</span>);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;sumfrac&quot;</span>, &amp;sumfrac, <span class="stringliteral">&quot;sumfrac/D&quot;</span>);</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  jaimetree-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_visible&quot;</span>, &amp;vmmhz1m_visible, <span class="stringliteral">&quot;vmmhz1m_visible/D&quot;</span>);</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  TTree *viewangletree=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;viewangletree&quot;</span>, <span class="stringliteral">&quot;viewangletree&quot;</span>); <span class="comment">// signal as it is produced at the interaction</span></div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;dviewangle_deg&quot;</span>, &amp;dviewangle_deg, <span class="stringliteral">&quot;dviewangle_deg/D&quot;</span>);</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;deltheta_em_max&quot;</span>, &amp;deltheta_em_max, <span class="stringliteral">&quot;deltheta_em_max/D&quot;</span>);</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;deltheta_had_max&quot;</span>, &amp;deltheta_had_max, <span class="stringliteral">&quot;deltheta_had_max/D&quot;</span>);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;theta_threshold_deg&quot;</span>, &amp;theta_threshold_deg, <span class="stringliteral">&quot;theta_threshold_deg/D&quot;</span>);</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;dnutries&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a>, <span class="stringliteral">&quot;dnutries/D&quot;</span>);</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;viewangle&quot;</span>, &amp;viewangle, <span class="stringliteral">&quot;viewangle/D&quot;</span>);</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  viewangletree-&gt;Branch(<span class="stringliteral">&quot;chord&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>, <span class="stringliteral">&quot;dnutries/D&quot;</span>);</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  TTree *neutrino_positiontree=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;neutrino_positiontree&quot;</span>, <span class="stringliteral">&quot;neutrino_positiontree&quot;</span>);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  neutrino_positiontree-&gt;Branch(<span class="stringliteral">&quot;nnu&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, <span class="stringliteral">&quot;nnu[3]/D&quot;</span>);</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  neutrino_positiontree-&gt;Branch(<span class="stringliteral">&quot;dtryingdirection&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>, <span class="stringliteral">&quot;dtryingdirection/D&quot;</span>);</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  neutrino_positiontree-&gt;Branch(<span class="stringliteral">&quot;bn1-&gt;dtryingposition&quot;</span>, &amp;bn1-&gt;dtryingposition, <span class="stringliteral">&quot;bn1-&gt;dtryingposition/D&quot;</span>);</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;  <span class="comment">//Filled just after Getchord,  where we find the neutrino&#39;s path through the Earth</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  TTree *nupathtree=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;nupathtree&quot;</span>, <span class="stringliteral">&quot;nupathtree&quot;</span>);</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;total_kgm2&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a46d7e538970790ac8d4eff1f9024af93">total_kgm2</a>, <span class="stringliteral">&quot;total_kgm2/D&quot;</span>);</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;chord&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>, <span class="stringliteral">&quot;chord/D&quot;</span>);</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;crust_entered&quot;</span>, &amp;interaction1-&gt;crust_entered, <span class="stringliteral">&quot;crust_entered/I&quot;</span>);</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;mantle_entered&quot;</span>, &amp;interaction1-&gt;mantle_entered, <span class="stringliteral">&quot;mantle_entered/I&quot;</span>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;core_entered&quot;</span>, &amp;interaction1-&gt;core_entered, <span class="stringliteral">&quot;core_entered/I&quot;</span>);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;mybeta&quot;</span>, &amp;mybeta, <span class="stringliteral">&quot;mybeta/D&quot;</span>);</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  nupathtree-&gt;Branch(<span class="stringliteral">&quot;costheta_nutraject&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a>, <span class="stringliteral">&quot;costheta_nutraject/D&quot;</span>);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  TTree *finaltree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;passing_events&quot;</span>, <span class="stringliteral">&quot;passing_events&quot;</span>); <span class="comment">// finaltree filled for all events that pass</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>, &amp;inu, <span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sample_x&quot;</span>, &amp;sample_x, <span class="stringliteral">&quot;sample_x/D&quot;</span>);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sample_y&quot;</span>, &amp;sample_y, <span class="stringliteral">&quot;sample_y/D&quot;</span>);</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz_min&quot;</span>, &amp;vmmhz_min, <span class="stringliteral">&quot;vmmhz_min/D&quot;</span>);</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz_max&quot;</span>, &amp;vmmhz_max, <span class="stringliteral">&quot;vmmhz_max/D&quot;</span>);</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;thresholdsAnt&quot;</span>, &amp;thresholdsAnt, <span class="stringliteral">&quot;thresholdsAnt[48][2][5]/D&quot;</span>);</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;thresholdsAntPass&quot;</span>, &amp;thresholdsAntPass, <span class="stringliteral">&quot;thresholdsAntPass[48][2][5]/D&quot;</span>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;deadTime&quot;</span>, &amp;anita1-&gt;deadTime, <span class="stringliteral">&quot;deadTime/D&quot;</span>);</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;horizcoord_bn&quot;</span>, &amp;bn1-&gt;horizcoord_bn, <span class="stringliteral">&quot;horizcoord_bn/D&quot;</span>);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vertcoord_bn&quot;</span>, &amp;bn1-&gt;vertcoord_bn, <span class="stringliteral">&quot;vertcoord_bn/D&quot;</span>);</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_bn&quot;</span>, &amp;r_bn_array, <span class="stringliteral">&quot;r_bn_array[3]/D&quot;</span>);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;n_bn&quot;</span>, &amp;n_bn_array, <span class="stringliteral">&quot;n_bn_array[3]/D&quot;</span>);</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;longitude_bn&quot;</span>, &amp;longitude_this, <span class="stringliteral">&quot;longitude_bn/D&quot;</span>);</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;heading_bn&quot;</span>, &amp;heading_this, <span class="stringliteral">&quot;heading_bn/D&quot;</span>);</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;gps_offset&quot;</span>, &amp;gps_offset, <span class="stringliteral">&quot;gps_offset/D&quot;</span>);</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;  <span class="comment">// this one is just weight due to earth absorption</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;weight1&quot;</span>, &amp;weight1, <span class="stringliteral">&quot;weight1/D&quot;</span>);</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;  <span class="comment">// this is the total weight - the one you want to use!</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>, &amp;weight, <span class="stringliteral">&quot;weight/D&quot;</span>);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;logweight&quot;</span>, &amp;logweight, <span class="stringliteral">&quot;logweight/D&quot;</span>);</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;posnu&quot;</span>, &amp;posnu_array, <span class="stringliteral">&quot;posnu_array[3]/D&quot;</span>);</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;costheta_nutraject&quot;</span>, &amp;costheta_nutraject2, <span class="stringliteral">&quot;costheta_nutraject/D&quot;</span>);</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;chord_kgm2_ice&quot;</span>,  &amp;chord_kgm2_ice2, <span class="stringliteral">&quot;chord_kgm2_ice/D&quot;</span>);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phi_nutraject&quot;</span>, &amp;phi_nutraject2, <span class="stringliteral">&quot;phi_nutraject/D&quot;</span>);</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;altitude_int&quot;</span>, &amp;altitude_int2, <span class="stringliteral">&quot;altitude_int/D&quot;</span>);</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nnu&quot;</span>, &amp;nnu_array, <span class="stringliteral">&quot;nnu_array[3]/D&quot;</span>);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;n_exit2bn&quot;</span>, &amp;n_exit2bn_array, <span class="stringliteral">&quot;n_exit2bn_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;n_exit_phi&quot;</span>, &amp;n_exit_phi, <span class="stringliteral">&quot;n_exit_phi/D&quot;</span>);</div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rfexit&quot;</span>, &amp;rfexit_array, <span class="stringliteral">&quot;rfexit_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;pnu&quot;</span>, &amp;pnu, <span class="stringliteral">&quot;pnu/D&quot;</span>);</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;elast_y&quot;</span>, &amp;elast_y, <span class="stringliteral">&quot;elast_y/D&quot;</span>);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sumfrac&quot;</span>, &amp;sumfrac, <span class="stringliteral">&quot;sumfrac/D&quot;</span>);</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nuflavor&quot;</span>, &amp;nuflavorint2, <span class="stringliteral">&quot;nuflavorint/I&quot;</span>);<span class="comment">//1=electron,  2=muon,  3=tau</span></div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;current&quot;</span>, &amp;currentint2, <span class="stringliteral">&quot;currentint/I&quot;</span>);<span class="comment">//0=charged current,  1=neutral current</span></div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;logchord&quot;</span>,  &amp;logchord2,  <span class="stringliteral">&quot;logchord/D&quot;</span>);</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nuexitice&quot;</span>,  &amp;nuexitice,  <span class="stringliteral">&quot;nuexitice/D&quot;</span>);</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;weight_bestcase&quot;</span>,  &amp;weight_bestcase2,  <span class="stringliteral">&quot;weight_bestcase/D&quot;</span>);</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;chord_kgm2_bestcase&quot;</span>,  &amp;chord_kgm2_bestcase2,  <span class="stringliteral">&quot;chord_kgm2_bestcase/D&quot;</span>);</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;dtryingdirection&quot;</span>,  &amp;dtryingdirection2,  <span class="stringliteral">&quot;dtryingdirection/D&quot;</span>);</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;l3trig&quot;</span>, &amp;l3trig, <span class="stringliteral">&quot;l3trig[2]/I&quot;</span>);</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;l2trig&quot;</span>, &amp;l2trig, <span class="stringliteral">&quot;l2trig[2][3]/I&quot;</span>);</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;l1trig&quot;</span>, &amp;l1trig, <span class="stringliteral">&quot;l1trig[2][3]/I&quot;</span>);</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phiTrigMask&quot;</span>, &amp;anita1-&gt;phiTrigMask, <span class="stringliteral">&quot;phiTrigMask/s&quot;</span>);</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phiTrigMaskH&quot;</span>, &amp;anita1-&gt;phiTrigMaskH, <span class="stringliteral">&quot;phiTrigMaskH/s&quot;</span>);</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;l1TrigMask&quot;</span>, &amp;anita1-&gt;l1TrigMask, <span class="stringliteral">&quot;l1TrigMask/s&quot;</span>);</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;l1TrigMaskH&quot;</span>, &amp;anita1-&gt;l1TrigMaskH, <span class="stringliteral">&quot;l1TrigMaskH/s&quot;</span>);</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna0&quot;</span>, &amp;max_antenna0, <span class="stringliteral">&quot;max_antenna0/I&quot;</span>);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna1&quot;</span>, &amp;max_antenna1, <span class="stringliteral">&quot;max_antenna1/I&quot;</span>);</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna2&quot;</span>, &amp;max_antenna2, <span class="stringliteral">&quot;max_antenna2/I&quot;</span>);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;viewangle&quot;</span>, &amp;viewangle, <span class="stringliteral">&quot;viewangle/D&quot;</span>);</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;offaxis&quot;</span>, &amp;offaxis, <span class="stringliteral">&quot;offaxis/D&quot;</span>);</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rx0_signal_eachband&quot;</span>, &amp;rx0_signal_eachband, <span class="stringliteral">&quot;rx0_signal_eachband[2][5]/D&quot;</span>);</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rx0_threshold_eachband&quot;</span>, &amp;rx0_threshold_eachband, <span class="stringliteral">&quot;rx0_threshold_eachband[2][5]/D&quot;</span>);</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rx0_noise_eachband&quot;</span>, &amp;rx0_noise_eachband, <span class="stringliteral">&quot;rx0_noise_eachband[2][5]/D&quot;</span>);</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rx0_passes_eachband&quot;</span>, &amp;rx0_passes_eachband, <span class="stringliteral">&quot;rx0_passes_eachband[2][5]/I&quot;</span>);</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;e_component&quot;</span>, &amp;e_component, <span class="stringliteral">&quot;e_component[48]/D&quot;</span>);</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;h_component&quot;</span>, &amp;h_component, <span class="stringliteral">&quot;h_component[48]/D&quot;</span>);</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;dist_int_bn_2d&quot;</span>, &amp;dist_int_bn_2d, <span class="stringliteral">&quot;dist_int_bn_2d/D&quot;</span>);</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;d1&quot;</span>, &amp;d12, <span class="stringliteral">&quot;d1/D&quot;</span>);</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;cosalpha&quot;</span>, &amp;cosalpha, <span class="stringliteral">&quot;cosalpha/D&quot;</span>);</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;mytheta&quot;</span>, &amp;mytheta, <span class="stringliteral">&quot;mytheta/D&quot;</span>);</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;cosbeta0&quot;</span>, &amp;cosbeta0, <span class="stringliteral">&quot;cosbeta0/D&quot;</span>);</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;mybeta&quot;</span>, &amp;mybeta, <span class="stringliteral">&quot;mybeta/D&quot;</span>);</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;d1&quot;</span>, &amp;d12, <span class="stringliteral">&quot;d1/D&quot;</span>);</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;d2&quot;</span>, &amp;d22, <span class="stringliteral">&quot;d2/D&quot;</span>);</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;  <span class="comment">//Begin block added by Stephen for verification plots</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;fresnel1&quot;</span>, &amp;fresnel1, <span class="stringliteral">&quot;fresnel1/D&quot;</span>);</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;fresnel2&quot;</span>, &amp;fresnel2, <span class="stringliteral">&quot;fresnel2/D&quot;</span>);</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;mag1&quot;</span>, &amp;mag1, <span class="stringliteral">&quot;mag1/D&quot;</span>);</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;mag2&quot;</span>, &amp;mag2, <span class="stringliteral">&quot;mag2/D&quot;</span>);</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;t_coeff_pokey&quot;</span>, &amp;t_coeff_pokey, <span class="stringliteral">&quot;t_coeff_pokey/D&quot;</span>);</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;t_coeff_slappy&quot;</span>, &amp;t_coeff_slappy, <span class="stringliteral">&quot;t_coeff_slappy/D&quot;</span>);</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;exponent&quot;</span>, &amp;settings1-&gt;EXPONENT, <span class="stringliteral">&quot;EXPONENT/D&quot;</span>);</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;hitangle_e_all&quot;</span>, &amp;hitangle_e_all, <span class="stringliteral">&quot;hitangle_e_all[48]/D&quot;</span>);</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;hitangle_h_all&quot;</span>, &amp;hitangle_h_all, <span class="stringliteral">&quot;hitangle_h_all[48]/D&quot;</span>);</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;</div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;e_comp_max1&quot;</span>, &amp;e_comp_max1, <span class="stringliteral">&quot;e_comp_max1/D&quot;</span>);</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;h_comp_max1&quot;</span>, &amp;h_comp_max1, <span class="stringliteral">&quot;h_comp_max1/D&quot;</span>);</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;e_comp_max2&quot;</span>, &amp;e_comp_max2, <span class="stringliteral">&quot;e_comp_max2/D&quot;</span>);</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;h_comp_max2&quot;</span>, &amp;h_comp_max2, <span class="stringliteral">&quot;h_comp_max2/D&quot;</span>);</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;e_comp_max3&quot;</span>, &amp;e_comp_max3, <span class="stringliteral">&quot;e_comp_max3/D&quot;</span>);</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;h_comp_max3&quot;</span>, &amp;h_comp_max3, <span class="stringliteral">&quot;h_comp_max3/D&quot;</span>);</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna_volts0&quot;</span>, &amp;max_antenna_volts0, <span class="stringliteral">&quot;max_antenna_volts0/D&quot;</span>);</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna_volts0_em&quot;</span>, &amp;max_antenna_volts0_em, <span class="stringliteral">&quot;max_antenna_volts0_em/D&quot;</span>);</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna_volts1&quot;</span>, &amp;max_antenna_volts1, <span class="stringliteral">&quot;max_antenna_volts1/D&quot;</span>);</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;max_antenna_volts2&quot;</span>, &amp;max_antenna_volts2, <span class="stringliteral">&quot;max_antenna_volts2/D&quot;</span>);</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;triggers&quot;</span>, &amp;nchannels_perrx_triggered, <span class="stringliteral">&quot;nchannels_perrx_triggered[48]/I&quot;</span>);</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nchannels_triggered&quot;</span>, &amp;nchannels_triggered, <span class="stringliteral">&quot;nchannels_triggered/I&quot;</span>);</div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_max&quot;</span>, &amp;volts_rx_max, <span class="stringliteral">&quot;volts_rx_max/D&quot;</span>);</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_ave&quot;</span>, &amp;volts_rx_ave, <span class="stringliteral">&quot;volts_rx_ave/D&quot;</span>);</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_sum&quot;</span>, &amp;volts_rx_sum, <span class="stringliteral">&quot;volts_rx_sum/D&quot;</span>);</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_max_highband&quot;</span>, &amp;volts_rx_max_highband, <span class="stringliteral">&quot;volts_rx_max_highband/D&quot;</span>);</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_max_lowband&quot;</span>, &amp;volts_rx_max_lowband, <span class="stringliteral">&quot;volts_rx_max_lowband/D&quot;</span>);</div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_pol_measured&quot;</span>, &amp;theta_pol_measured, <span class="stringliteral">&quot;theta_pol_measured/D&quot;</span>);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_rf_atbn&quot;</span>, &amp;theta_rf_atbn, <span class="stringliteral">&quot;theta_rf_atbn/D&quot;</span>);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_rf_atbn_measured&quot;</span>, &amp;theta_rf_atbn_measured, <span class="stringliteral">&quot;theta_rf_atbn_measured/D&quot;</span>);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_nnu_atbn&quot;</span>,&amp;theta_nnu_atbn,<span class="stringliteral">&quot;theta_nnu_atbn/D&quot;</span>); </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_nnu_rf_diff_atbn&quot;</span>,&amp;theta_nnu_rf_diff_atbn,<span class="stringliteral">&quot;theta_nnu_rf_diff_atbn/D&quot;</span>);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phi_nnu_atbn&quot;</span>,&amp;phi_nnu_atbn,<span class="stringliteral">&quot;phi_nnu_atbn/D&quot;</span>);</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phi_rf_atbn&quot;</span>,&amp;phi_rf_atbn,<span class="stringliteral">&quot;phi_rf_atbn/D&quot;</span>);</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;phi_nnu_rf_diff_atbn&quot;</span>,&amp;phi_nnu_rf_diff_atbn,<span class="stringliteral">&quot;phi_nnu_rf_diff_atbn/D&quot;</span>);  </div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;voltage&quot;</span>, &amp;voltagearray, <span class="stringliteral">&quot;voltagearray[48]/D&quot;</span>);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nlayers&quot;</span>, &amp;settings1-&gt;NLAYERS, <span class="stringliteral">&quot;settings1-&gt;NLAYERS/I&quot;</span>);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_max&quot;</span>, &amp;vmmhz1m_max, <span class="stringliteral">&quot;vmmhz1m_max/D&quot;</span>);</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz_lowfreq&quot;</span>, &amp;vmmhz_lowfreq, <span class="stringliteral">&quot;vmmhz_lowfreq/D&quot;</span>);</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;deltheta_em_max&quot;</span>, &amp;deltheta_em_max, <span class="stringliteral">&quot;deltheta_em_max/D&quot;</span>);</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;deltheta_had_max&quot;</span>, &amp;deltheta_had_max, <span class="stringliteral">&quot;deltheta_had_max/D&quot;</span>);</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_enterice&quot;</span>, &amp;r_enterice_array, <span class="stringliteral">&quot;r_enterice_array[3]/D&quot;</span>);</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;n_exit2bn_db&quot;</span>, &amp;n_exit2bn_db_array, <span class="stringliteral">&quot;n_exit2bn_db_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;rfexit_db&quot;</span>, &amp;rfexit_db_array, <span class="stringliteral">&quot;rfexit_db_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_in&quot;</span>, &amp;r_in_array, <span class="stringliteral">&quot;r_in_array[3]/D&quot;</span>);</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nsurf_rfexit&quot;</span>, &amp;nsurf_rfexit_array, <span class="stringliteral">&quot;nsurf_rfexit_array[3]/D&quot;</span>);</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nsurf_rfexit_db&quot;</span>, &amp;nsurf_rfexit_db_array, <span class="stringliteral">&quot;nsurf_rfexit_db_array[3]/D&quot;</span>);</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_fromballoon&quot;</span>, &amp;r_fromballoon2, <span class="stringliteral">&quot;r_fromballoon/D&quot;</span>);</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_fromballoon_db&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#aaee92091b12be7342bd83736ea8a2bf4">r_fromballoon_db</a>, <span class="stringliteral">&quot;r_fromballoon_db/D&quot;</span>);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nuexitlength&quot;</span>, &amp;nuexitlength, <span class="stringliteral">&quot;nuexitlength/D&quot;</span>);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nuentrancelength&quot;</span>, &amp;nuentrancelength, <span class="stringliteral">&quot;nuentrancelength/D&quot;</span>);</div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;taulength&quot;</span>, &amp;taulength, <span class="stringliteral">&quot;taulength/D&quot;</span>);</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;icethickness&quot;</span>, &amp;icethickness, <span class="stringliteral">&quot;icethickness/D&quot;</span>);</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nrf_iceside&quot;</span>, &amp;nrf_iceside_array, <span class="stringliteral">&quot;nrf_iceside_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;nrf_iceside_db&quot;</span>, &amp;nrf_iceside_db_array, <span class="stringliteral">&quot;nrf_iceside_db_array[5][3]/D&quot;</span>);</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;ant_normal0&quot;</span>, &amp;ant_max_normal0_array, <span class="stringliteral">&quot;ant_max_normal0_array[3]/D&quot;</span>);</div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;ant_normal1&quot;</span>, &amp;ant_max_normal1_array, <span class="stringliteral">&quot;ant_max_normal1_array[3]/D&quot;</span>);</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;ant_normal2&quot;</span>, &amp;ant_max_normal2_array, <span class="stringliteral">&quot;ant_max_normal2_array[3]/D&quot;</span>);</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_visible&quot;</span>, &amp;vmmhz1m_visible, <span class="stringliteral">&quot;vmmhz1m_visible/D&quot;</span>);</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;freq_bins&quot;</span>, &amp;freq_bins, <span class="stringliteral">&quot;freq_bins/I&quot;</span>);</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz&quot;</span>, &amp;vmmhz, <span class="stringliteral">&quot;vmmhz[freq_bins]/D&quot;</span>);</div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;</div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;dist_int_bn_2d_chord&quot;</span>, &amp;dist_int_bn_2d_chord, <span class="stringliteral">&quot;dist_int_bn_2d_chord/D&quot;</span>);</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;</div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;dviewangle_deg&quot;</span>, &amp;dviewangle_deg, <span class="stringliteral">&quot;dviewangle_deg/D&quot;</span>);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;theta_threshold_deg&quot;</span>, &amp;theta_threshold_deg, <span class="stringliteral">&quot;theta_threshold_deg/D&quot;</span>);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;total_kgm2&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a46d7e538970790ac8d4eff1f9024af93">total_kgm2</a>, <span class="stringliteral">&quot;total_kgm2/D&quot;</span>);</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;chord&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>, <span class="stringliteral">&quot;chord/D&quot;</span>);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;crust_entered&quot;</span>, &amp;interaction1-&gt;crust_entered, <span class="stringliteral">&quot;crust_entered/I&quot;</span>);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;mantle_entered&quot;</span>, &amp;interaction1-&gt;mantle_entered, <span class="stringliteral">&quot;mantle_entered/I&quot;</span>);</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;core_entered&quot;</span>, &amp;interaction1-&gt;core_entered, <span class="stringliteral">&quot;core_entered/I&quot;</span>);</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;n_pol&quot;</span>, &amp;n_pol_array, <span class="stringliteral">&quot;n_pol_array[3]/D&quot;</span>);</div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;vmmhz_min_thatpasses&quot;</span>, &amp;vmmhz_min_thatpasses, <span class="stringliteral">&quot;vmmhz_min_thatpasses/D&quot;</span>);</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;pieceofkm2sr&quot;</span>, &amp;pieceofkm2sr, <span class="stringliteral">&quot;pieceofkm2sr/D&quot;</span>);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;  <span class="comment">//finaltree-&gt;Branch(&quot;volts_original&quot;, &amp;volts_original, &quot;volts_original[10][20][2]/D&quot;);</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_exit2bn&quot;</span>, &amp;r_exit2bn2, <span class="stringliteral">&quot;r_exit2bn/D&quot;</span>);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;r_exit2bn_measured&quot;</span>, &amp;r_exit2bn_measured2, <span class="stringliteral">&quot;r_exit2bn_measured/D&quot;</span>);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;scalefactor_attenuation&quot;</span>, &amp;scalefactor_attenuation, <span class="stringliteral">&quot;scalefactor_attenuation/D&quot;</span>);</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;anita1-&gt;PHI_OFFSET&quot;</span>, &amp;anita1-&gt;PHI_OFFSET, <span class="stringliteral">&quot;anita1-&gt;PHI_OFFSET/D&quot;</span>);</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;igps&quot;</span>, &amp;bn1-&gt;igps, <span class="stringliteral">&quot;igyps/I&quot;</span>);</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_rfcm_lab_e_all&quot;</span>, &amp;volts_rx_rfcm_lab_e_all, <span class="stringliteral">&quot;volts_rx_rfcm_lab_e_all[48][512]/D&quot;</span>);</div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;volts_rx_rfcm_lab_h_all&quot;</span>, &amp;volts_rx_rfcm_lab_h_all, <span class="stringliteral">&quot;volts_rx_rfcm_lab_h_all[48][512]/D&quot;</span>);</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;ptaui&quot;</span>, &amp;ptaui, <span class="stringliteral">&quot;ptaui/D&quot;</span>);</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;ptauf&quot;</span>, &amp;ptauf, <span class="stringliteral">&quot;ptauf/D&quot;</span>);</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sourceLon&quot;</span>, &amp;sourceLon, <span class="stringliteral">&quot;sourceLon/D&quot;</span>);</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sourceLat&quot;</span>, &amp;sourceLat, <span class="stringliteral">&quot;sourceLat/D&quot;</span>);</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sourceAlt&quot;</span>, &amp;sourceAlt, <span class="stringliteral">&quot;sourceAlt/D&quot;</span>);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  finaltree-&gt;Branch(<span class="stringliteral">&quot;sourceMag&quot;</span>, &amp;sourceMag, <span class="stringliteral">&quot;sourceMag/D&quot;</span>);</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;  <span class="comment">//finaltree-&gt;Branch(&quot;payloadTheta&quot;, &amp;payloadTheta, &quot;payloadTheta/D&quot;);</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <span class="comment">//finaltree-&gt;Branch(&quot;payloadPhi&quot;, &amp;payloadPhi, &quot;payloadPhi/D&quot;);</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;  TTree *mytaus_tree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;mytaus&quot;</span>, <span class="stringliteral">&quot;mytaus&quot;</span>);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;  mytaus_tree-&gt;Branch(<span class="stringliteral">&quot;taus&quot;</span>,  &amp;TauPtr);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;  <span class="keywordtype">double</span> rms_rfcm_e;</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;  <span class="keywordtype">double</span> rms_rfcm_h;</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;  <span class="keywordtype">double</span> rms_lab_e;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;  <span class="keywordtype">double</span> rms_lab_h;</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;  <span class="keywordtype">double</span> avgfreq_rfcm[Anita::NFREQ];</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;  <span class="keywordtype">double</span> avgfreq_rfcm_lab[Anita::NFREQ];</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;  <span class="keywordtype">double</span> freq[Anita::NFREQ];</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;  TTree *summarytree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;summarytree&quot;</span>, <span class="stringliteral">&quot;summarytree&quot;</span>); <span class="comment">// finaltree filled for all events that pass</span></div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;NNU&quot;</span>, &amp;NNU, <span class="stringliteral">&quot;NNU/I&quot;</span>);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;EXPONENT&quot;</span>, &amp;settings1-&gt;EXPONENT, <span class="stringliteral">&quot;EXPONENT/D&quot;</span>);</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;eventsfound_beforetrigger&quot;</span>, &amp;eventsfound_beforetrigger, <span class="stringliteral">&quot;eventsfound_beforetrigger/D&quot;</span>);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;rms_rfcm_e&quot;</span>, &amp;rms_rfcm_e, <span class="stringliteral">&quot;rms_rfcm_e/D&quot;</span>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;rms_rfcm_h&quot;</span>, &amp;rms_rfcm_h, <span class="stringliteral">&quot;rms_rfcm_h/D&quot;</span>);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;rms_lab_e&quot;</span>, &amp;rms_lab_e, <span class="stringliteral">&quot;rms_lab_e/D&quot;</span>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;rms_lab_h&quot;</span>, &amp;rms_lab_h, <span class="stringliteral">&quot;rms_lab_h/D&quot;</span>);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;avgfreq_rfcm&quot;</span>, &amp;avgfreq_rfcm, <span class="stringliteral">&quot;avgfreq_rfcm[128]/D&quot;</span>);</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;avgfreq_rfcm_lab&quot;</span>, &amp;avgfreq_rfcm_lab, <span class="stringliteral">&quot;avgfreq_rfcm_lab[128]/D&quot;</span>);</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;  summarytree-&gt;Branch(<span class="stringliteral">&quot;freq&quot;</span>, &amp;freq, <span class="stringliteral">&quot;freq[128]/D&quot;</span>);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;  TTree *banana_tree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;banana_tree&quot;</span>, <span class="stringliteral">&quot;banana_tree&quot;</span>);  <span class="comment">//To record banana plot info - Stephen</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;  banana_tree-&gt;Branch(<span class="stringliteral">&quot;r_bn&quot;</span>, &amp;bn1-&gt;r_bn, <span class="stringliteral">&quot;r_bn[3]/D&quot;</span>);</div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  TTree *ytree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;ytree&quot;</span>, <span class="stringliteral">&quot;ytree&quot;</span>); <span class="comment">//To record y distributions</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  ytree-&gt;Branch(<span class="stringliteral">&quot;elast_y&quot;</span>, &amp;elast_y, <span class="stringliteral">&quot;elast_y/D&quot;</span>);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  <span class="keywordtype">double</span> icethck;</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  <span class="keywordtype">double</span> elev;</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;  <span class="keywordtype">double</span> lon_ground;</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;  <span class="keywordtype">double</span> lat_ground;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;  <span class="keywordtype">double</span> lon_ice;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;  <span class="keywordtype">double</span> lat_ice;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;  <span class="keywordtype">double</span> h20_depth;</div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;  <span class="keywordtype">double</span> lon_water;</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;  <span class="keywordtype">double</span> lat_water;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  TTree *icetree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;icetree&quot;</span>, <span class="stringliteral">&quot;icetree&quot;</span>);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;icethck&quot;</span>, &amp;icethck, <span class="stringliteral">&quot;icethck/D&quot;</span>);</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;lon_ice&quot;</span>, &amp;lon_ice, <span class="stringliteral">&quot;lon_ice/D&quot;</span>);</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;lat_ice&quot;</span>, &amp;lat_ice, <span class="stringliteral">&quot;lat_ice/D&quot;</span>);</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;lon_water&quot;</span>, &amp;lon_water, <span class="stringliteral">&quot;lon_water/D&quot;</span>);</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;lat_water&quot;</span>, &amp;lat_water, <span class="stringliteral">&quot;lat_water/D&quot;</span>);</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  icetree-&gt;Branch(<span class="stringliteral">&quot;h20_depth&quot;</span>, &amp;h20_depth, <span class="stringliteral">&quot;h20_depth/D&quot;</span>);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  TTree *groundtree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;groundtree&quot;</span>, <span class="stringliteral">&quot;groundtree&quot;</span>);</div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  groundtree-&gt;Branch(<span class="stringliteral">&quot;elev&quot;</span>, &amp;elev, <span class="stringliteral">&quot;elev/D&quot;</span>);</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;  groundtree-&gt;Branch(<span class="stringliteral">&quot;lon_ground&quot;</span>, &amp;lon_ground, <span class="stringliteral">&quot;lon_ground/D&quot;</span>);</div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;  groundtree-&gt;Branch(<span class="stringliteral">&quot;lat_ground&quot;</span>, &amp;lat_ground, <span class="stringliteral">&quot;lat_ground/D&quot;</span>);</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;  <span class="comment">//End block added by Stephen</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;  TTree *tree11 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h11000&quot;</span>, <span class="stringliteral">&quot;h11000&quot;</span>); <span class="comment">// tree11</span></div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig00&quot;</span>, &amp;loctrig[0][0], <span class="stringliteral">&quot;loctrig0/D&quot;</span>);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig10&quot;</span>, &amp;loctrig[1][0], <span class="stringliteral">&quot;loctrig0/D&quot;</span>);</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig20&quot;</span>, &amp;loctrig[2][0], <span class="stringliteral">&quot;loctrig0/D&quot;</span>);</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig_nadironly0&quot;</span>, &amp;loctrig_nadironly[0], <span class="stringliteral">&quot;loctrig_nadironly0/D&quot;</span>);</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig01&quot;</span>, &amp;loctrig[0][1], <span class="stringliteral">&quot;loctrig1/D&quot;</span>);</div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig11&quot;</span>, &amp;loctrig[1][1], <span class="stringliteral">&quot;loctrig1/D&quot;</span>);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig21&quot;</span>, &amp;loctrig[2][1], <span class="stringliteral">&quot;loctrig1/D&quot;</span>);</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;  tree11-&gt;Branch(<span class="stringliteral">&quot;loctrig_nadironly1&quot;</span>, &amp;loctrig_nadironly[1], <span class="stringliteral">&quot;loctrig0/D&quot;</span>);</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  TTree *tree16 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h16000&quot;</span>, <span class="stringliteral">&quot;h16000&quot;</span>);</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;pnu&quot;</span>, &amp;pnu, <span class="stringliteral">&quot;pnu/D&quot;</span>);</div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;ptau&quot;</span>, &amp;ptau, <span class="stringliteral">&quot;ptau/D&quot;</span>);</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;taulength&quot;</span>, &amp;taulength, <span class="stringliteral">&quot;taulength/D&quot;</span>);</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;weight1&quot;</span>, &amp;weight1, <span class="stringliteral">&quot;weight1/D&quot;</span>);</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>, &amp;emfrac, <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  tree16-&gt;Branch(<span class="stringliteral">&quot;nuentrancelength&quot;</span>, &amp;nuentrancelength, <span class="stringliteral">&quot;nuentrancelength/D&quot;</span>);</div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;  <span class="keywordtype">int</span> pdgcode;</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;  TTree *tree18 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h18000&quot;</span>, <span class="stringliteral">&quot;h18000&quot;</span>);</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;  tree18-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>,  &amp;emfrac,  <span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  tree18-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>, &amp;hadfrac, <span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;  tree18-&gt;Branch(<span class="stringliteral">&quot;pdgcode&quot;</span>, &amp;pdgcode, <span class="stringliteral">&quot;pdgcode/I&quot;</span>);</div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  TH1D *h1mybeta = <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;betaforall&quot;</span>, <span class="stringliteral">&quot;betaforall(deg)&quot;</span>, 180, -15, 15);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;  TH1D *h1mytheta= <span class="keyword">new</span> TH1D(<span class="stringliteral">&quot;mytheta&quot;</span>, <span class="stringliteral">&quot;mytheta(deg)&quot;</span>, 180, -90, 90);<span class="comment">//90-incidentangle when neutrinos enter the Earth.</span></div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  TH1F *hundogaintoheight_e=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;undogaintoheight_e&quot;</span>, <span class="stringliteral">&quot;undogaintoheight_e&quot;</span>, 100, 0., 1.);</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  TH1F *hundogaintoheight_h=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;undogaintoheight_h&quot;</span>, <span class="stringliteral">&quot;undogaintoheight_h&quot;</span>, 100, 0., 1.);</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  TH1F *rec_diff=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;rec_diff&quot;</span>, <span class="stringliteral">&quot;rec_diff&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  TH1F *recsum_diff=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;recsum_diff&quot;</span>, <span class="stringliteral">&quot;recsum_diff&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;  TH1F *rec_diff0=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;rec_diff0&quot;</span>, <span class="stringliteral">&quot;rec_diff0&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  TH1F *rec_diff1=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;rec_diff1&quot;</span>, <span class="stringliteral">&quot;rec_diff1&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  TH1F *rec_diff2=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;rec_diff2&quot;</span>, <span class="stringliteral">&quot;rec_diff2&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  TH1F *rec_diff3=<span class="keyword">new</span> TH1F(<span class="stringliteral">&quot;rec_diff3&quot;</span>, <span class="stringliteral">&quot;rec_diff3&quot;</span>, 100, -1., 1.);</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  TTree *vmmhz_tree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;vmmhz_tree&quot;</span>, <span class="stringliteral">&quot;vmmhz_tree&quot;</span>); <span class="comment">//To record frequency spread at point where it is first filled</span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  vmmhz_tree-&gt;Branch(<span class="stringliteral">&quot;freq_bins&quot;</span>, &amp;freq_bins, <span class="stringliteral">&quot;freq_bins/I&quot;</span>);</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  vmmhz_tree-&gt;Branch(<span class="stringliteral">&quot;vmmhz&quot;</span>, &amp;vmmhz, <span class="stringliteral">&quot;vmmhz[freq_bins]/D&quot;</span>);</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;  TTree *tree1 = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;h1000&quot;</span>, <span class="stringliteral">&quot;h1000&quot;</span>); <span class="comment">// tree1 filled for each neutrino</span></div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>, &amp;inu, <span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;diffexit&quot;</span>, &amp;diffexit, <span class="stringliteral">&quot;diffexit/D&quot;</span>);</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;diffrefr&quot;</span>, &amp;diffrefr, <span class="stringliteral">&quot;diffrefr/D&quot;</span>);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;horizcoord&quot;</span>, &amp;horizcoord, <span class="stringliteral">&quot;horizcoord/D&quot;</span>);</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;vertcoord&quot;</span>, &amp;vertcoord, <span class="stringliteral">&quot;vertcoord/D&quot;</span>);</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;costhetanu&quot;</span>, &amp;costhetanu, <span class="stringliteral">&quot;costhetanu/D&quot;</span>);</div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;vmmhz1m_max&quot;</span>, &amp;vmmhz1m_max, <span class="stringliteral">&quot;vmmhz1m_max/D&quot;</span>);</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;volume_thishorizon&quot;</span>, &amp;volume_thishorizon, <span class="stringliteral">&quot;volume_thishorizon/D&quot;</span>);</div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;realtime&quot;</span>, &amp;realtime_this, <span class="stringliteral">&quot;realtime/D&quot;</span>);</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;longitude&quot;</span>, &amp;longitude_this, <span class="stringliteral">&quot;longitude/D&quot;</span>);</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;latitude&quot;</span>, &amp;latitude_this, <span class="stringliteral">&quot;latitude/D&quot;</span>);</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;MAXHORIZON&quot;</span>, &amp;bn1-&gt;MAXHORIZON, <span class="stringliteral">&quot;MAXHORIZON/D&quot;</span>);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;igps&quot;</span>, &amp;bn1-&gt;igps, <span class="stringliteral">&quot;igps/I&quot;</span>);</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;passes_thisevent&quot;</span>, &amp;passes_thisevent, <span class="stringliteral">&quot;passes_thisevent/I&quot;</span>);</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;igps&quot;</span>, &amp;bn1-&gt;igps, <span class="stringliteral">&quot;igps/I&quot;</span>);</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>, &amp;weight, <span class="stringliteral">&quot;weight/D&quot;</span>);</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;r_exit2bn&quot;</span>, &amp;interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8949fd35ed92144d9f9de770d778a59d">r_exit2bn</a>, <span class="stringliteral">&quot;r_exit2bn/D&quot;</span>);</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  tree1-&gt;Branch(<span class="stringliteral">&quot;bn1-&gt;igps&quot;</span>, &amp;bn1-&gt;igps, <span class="stringliteral">&quot;bn1-&gt;igps/I&quot;</span>);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;</div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="comment">// set up balloontree</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;</div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;  TTree *balloontree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;balloon&quot;</span>, <span class="stringliteral">&quot;balloon&quot;</span>); <span class="comment">//filled for all events</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;heading&quot;</span>, &amp;bn1-&gt;heading, <span class="stringliteral">&quot;heading/D&quot;</span>);</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;pitch&quot;</span>, &amp;bn1-&gt;pitch, <span class="stringliteral">&quot;pitch/D&quot;</span>);</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;roll&quot;</span>, &amp;bn1-&gt;roll, <span class="stringliteral">&quot;roll/D&quot;</span>);</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;realTime_flightdata&quot;</span>, &amp;bn1-&gt;realTime_flightdata, <span class="stringliteral">&quot;realTime_flightdata/I&quot;</span>);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;latitude&quot;</span>, &amp;bn1-&gt;latitude, <span class="stringliteral">&quot;latitude/D&quot;</span>);</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;longitude&quot;</span>, &amp;bn1-&gt;longitude, <span class="stringliteral">&quot;longitude/D&quot;</span>);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;altitude&quot;</span>, &amp;bn1-&gt;altitude, <span class="stringliteral">&quot;altitude/D&quot;</span>);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;horizcoord_bn&quot;</span>, &amp;bn1-&gt;horizcoord_bn, <span class="stringliteral">&quot;horizcoord_bn/D&quot;</span>);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;  balloontree-&gt;Branch(<span class="stringliteral">&quot;vertcoord_bn&quot;</span>, &amp;bn1-&gt;vertcoord_bn, <span class="stringliteral">&quot;vertcoord_bn/D&quot;</span>);</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  <span class="comment">// these variables are for energy reconstruction studies</span></div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordtype">double</span> undogaintoheight_e=0;</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;  <span class="keywordtype">double</span> undogaintoheight_h=0;</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  <span class="keywordtype">double</span> undogaintoheight_e_array[4];</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;  <span class="keywordtype">double</span> undogaintoheight_h_array[4];</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;  <span class="keywordtype">double</span> nbins_array[4];</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;  <span class="keywordtype">double</span> rec_efield=0;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;  <span class="keywordtype">double</span> true_efield=0;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="keywordtype">double</span> rec_efield_array[4];</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;  <span class="keywordtype">double</span> true_efield_array[4];</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;  <span class="comment">// end energy reconstruction variables</span></div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="comment">//ofstream oindree_file;  </span></div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="comment">//oindree_file.open(&quot;oindree_file_taper.txt&quot;,std::ios_base::app);</span></div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica = <span class="keyword">new</span> <a class="code" href="../../de/d63/class_ice_model.html">IceModel</a>(settings1-&gt;ICE_MODEL + settings1-&gt;NOFZ*10, settings1-&gt;CONSTANTICETHICKNESS * 1000 + settings1-&gt;CONSTANTCRUST * 100 + settings1-&gt;FIXEDELEVATION * 10 + 0, settings1-&gt;WEIGHTABSORPTION);</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;area of the earth&#39;s surface covered by antarctic ice is &quot;</span> &lt;&lt; antarctica-&gt;ice_area &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;  </div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  ULong_t eventNumber;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordtype">string</span> outputAnitaFile =string(outputdir.Data())+<span class="stringliteral">&quot;/SimulatedAnitaEventFile&quot;</span>+run_num+<span class="stringliteral">&quot;.root&quot;</span>;</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  TFile *anitafileEvent = <span class="keyword">new</span> TFile(outputAnitaFile.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  TTree *eventTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;eventTree&quot;</span>, <span class="stringliteral">&quot;eventTree&quot;</span>);</div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  eventTree-&gt;Branch(<span class="stringliteral">&quot;event&quot;</span>,             &amp;realEvPtr           );</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  eventTree-&gt;Branch(<span class="stringliteral">&quot;run&quot;</span>,               &amp;run_no,   <span class="stringliteral">&quot;run/I&quot;</span>   );</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  eventTree-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>,            &amp;weight,   <span class="stringliteral">&quot;weight/D&quot;</span>);</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  outputAnitaFile =string(outputdir.Data())+<span class="stringliteral">&quot;/SimulatedAnitaHeadFile&quot;</span>+run_num+<span class="stringliteral">&quot;.root&quot;</span>;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;  TFile *anitafileHead = <span class="keyword">new</span> TFile(outputAnitaFile.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;  TTree *headTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;headTree&quot;</span>, <span class="stringliteral">&quot;headTree&quot;</span>);</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  headTree-&gt;Branch(<span class="stringliteral">&quot;header&quot;</span>,  &amp;rawHeaderPtr           );</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;  headTree-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>,  &amp;weight,      <span class="stringliteral">&quot;weight/D&quot;</span>);</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  outputAnitaFile =string(outputdir.Data())+<span class="stringliteral">&quot;/SimulatedAnitaGpsFile&quot;</span>+run_num+<span class="stringliteral">&quot;.root&quot;</span>;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  TFile *anitafileGps = <span class="keyword">new</span> TFile(outputAnitaFile.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;  TTree *adu5PatTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;adu5PatTree&quot;</span>, <span class="stringliteral">&quot;adu5PatTree&quot;</span>);</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  adu5PatTree-&gt;Branch(<span class="stringliteral">&quot;pat&quot;</span>,          &amp;Adu5PatPtr                   );</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  adu5PatTree-&gt;Branch(<span class="stringliteral">&quot;eventNumber&quot;</span>,  &amp;eventNumber,  <span class="stringliteral">&quot;eventNumber/L&quot;</span>);</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  adu5PatTree-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>,       &amp;weight,       <span class="stringliteral">&quot;weight/D&quot;</span>     );</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  </div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;  <span class="comment">// Set AnitaVersion so that the right payload geometry is used</span></div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;  AnitaVersion::set(settings1-&gt;ANITAVERSION);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  </div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  outputAnitaFile =string(outputdir.Data())+<span class="stringliteral">&quot;/SimulatedAnitaTruthFile&quot;</span>+run_num+<span class="stringliteral">&quot;.root&quot;</span>;</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;  TFile *anitafileTruth = <span class="keyword">new</span> TFile(outputAnitaFile.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  </div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  TString icemcgitversion( EnvironmentVariable::ICEMC_VERSION(outputdir)); </div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  printf(<span class="stringliteral">&quot;ICEMC GIT Repository Version: %s\n&quot;</span>, icemcgitversion.Data());</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> timenow = time(NULL);</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  TTree *configAnitaTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;configIcemcTree&quot;</span>, <span class="stringliteral">&quot;Config file and settings information&quot;</span>);</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  configAnitaTree-&gt;Branch(<span class="stringliteral">&quot;gitversion&quot;</span>,        &amp;icemcgitversion  );</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;  configAnitaTree-&gt;Branch(<span class="stringliteral">&quot;nnu&quot;</span>,               &amp;NNU              );</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;  configAnitaTree-&gt;Branch(<span class="stringliteral">&quot;startTime&quot;</span>,         &amp;timenow          );</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;  <span class="comment">// configAnitaTree-&gt;Branch(&quot;icemcSettings&quot;,     &amp;settings1        );</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  configAnitaTree-&gt;Fill();</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  TTree *triggerSettingsTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;triggerSettingsTree&quot;</span>, <span class="stringliteral">&quot;Trigger settings&quot;</span>);</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  triggerSettingsTree-&gt;Branch(<span class="stringliteral">&quot;dioderms&quot;</span>,  anita1-&gt;bwslice_dioderms_fullband_allchan,  <span class="stringliteral">&quot;dioderms[2][48][7]/D&quot;</span> );</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  triggerSettingsTree-&gt;Branch(<span class="stringliteral">&quot;diodemean&quot;</span>, anita1-&gt;bwslice_diodemean_fullband_allchan, <span class="stringliteral">&quot;diodemean[2][48][7]/D&quot;</span>);</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;  triggerSettingsTree-&gt;Fill();</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  </div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  TTree *summaryAnitaTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;summaryAnitaTree&quot;</span>, <span class="stringliteral">&quot;summaryAnitaTree&quot;</span>); <span class="comment">// finaltree filled for all events that pass</span></div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;EXPONENT&quot;</span>, &amp;settings1-&gt;EXPONENT, <span class="stringliteral">&quot;EXPONENT/D&quot;</span> );</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;SELECTION_MODE&quot;</span>, &amp;settings1-&gt;UNBIASED_SELECTION, <span class="stringliteral">&quot;SELECTION_MODE/I&quot;</span> );</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;totalnu_per_source&quot;</span>, &amp;NNU_per_source);</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;source_names&quot;</span>, &amp;source_names);</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_nu_per_source&quot;</span>, &amp;eventsfound_per_source);</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_prob_nu_per_source&quot;</span>, &amp;eventsfound_prob_per_source);</div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;total_nu&quot;</span>,      &amp;NNU,                 <span class="stringliteral">&quot;total_nu/I&quot;</span> );</div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;total_nue&quot;</span>,     &amp;count1-&gt;nnu_e,       <span class="stringliteral">&quot;total_nue/I&quot;</span> );</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;total_numu&quot;</span>,    &amp;count1-&gt;nnu_mu,      <span class="stringliteral">&quot;total_numu/I&quot;</span> );</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;total_nutau&quot;</span>,   &amp;count1-&gt;nnu_tau,     <span class="stringliteral">&quot;total_nutau/I&quot;</span> );</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;pass_nu&quot;</span>,       &amp;count1-&gt;npass[0],     <span class="stringliteral">&quot;pass_nu/I&quot;</span>    );</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_nu&quot;</span>,    &amp;eventsfound,          <span class="stringliteral">&quot;weighted_nu/D&quot;</span>    );</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_nue&quot;</span>,   &amp;sum[0],               <span class="stringliteral">&quot;weighted_nue/D&quot;</span>    );</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_numu&quot;</span>,  &amp;sum[1],               <span class="stringliteral">&quot;weighted_numu/D&quot;</span>    );</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_nutau&quot;</span>, &amp;sum[2],               <span class="stringliteral">&quot;weighted_nutau/D&quot;</span>    );</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_prob_nu&quot;</span>,    &amp;eventsfound_prob,          <span class="stringliteral">&quot;weighted_prob_nu/D&quot;</span>    );</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_prob_nue&quot;</span>,   &amp;sum_prob[0],               <span class="stringliteral">&quot;weighted_prob_nue/D&quot;</span>    );</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_prob_numu&quot;</span>,  &amp;sum_prob[1],               <span class="stringliteral">&quot;weighted_prob_numu/D&quot;</span>    );</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;weighted_prob_nutau&quot;</span>, &amp;sum_prob[2],               <span class="stringliteral">&quot;weighted_prob_nutau/D&quot;</span>    );</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;int_length&quot;</span>,      &amp;len_int_kgm2,         <span class="stringliteral">&quot;int_length/D&quot;</span>);</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;total_volume&quot;</span>,   &amp;antarctica-&gt;volume,    <span class="stringliteral">&quot;total_volume/D&quot;</span>);</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;rho_medium&quot;</span>,     &amp;sig1-&gt;RHOMEDIUM,       <span class="stringliteral">&quot;rho_medium/D&quot;</span>);</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;selection_box_half_length&quot;</span>,     &amp;settings1-&gt;UNBIASED_PS_MAX_DISTANCE_KM,       <span class="stringliteral">&quot;selection_box_half_length/D&quot;</span>);</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;  <span class="comment">// summaryAnitaTree-&gt;Branch(&quot;rho_h20&quot;,        &amp;(sig1-&gt;RHOH20),          &quot;rho_water/D&quot;);</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;  </div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;effVol_nu&quot;</span>,    &amp;km3sr,                  <span class="stringliteral">&quot;effVol_nu/D&quot;</span> );</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;  summaryAnitaTree-&gt;Branch(<span class="stringliteral">&quot;effArea_nu&quot;</span>,   &amp;km2sr,                  <span class="stringliteral">&quot;effArea_nu/D&quot;</span>);</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  </div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  TTree *truthAnitaTree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;truthAnitaTree&quot;</span>, <span class="stringliteral">&quot;Truth Anita Tree&quot;</span>);</div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;  truthAnitaTree-&gt;Branch(<span class="stringliteral">&quot;truth&quot;</span>,     &amp;truthEvPtr                   );</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;  <a class="code" href="../../d8/d3e/class_truth_anita_neutrino.html">TruthAnitaNeutrino</a> * truthNuPtr = settings1-&gt;SAVE_TRUTH_NU_TREE ? <span class="keyword">new</span> <a class="code" href="../../d8/d3e/class_truth_anita_neutrino.html">TruthAnitaNeutrino</a> : 0; </div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;  TTree* truthAnitaNuTree = settings1-&gt;SAVE_TRUTH_NU_TREE ? <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;truthAnitaNuTree&quot;</span>,<span class="stringliteral">&quot;Truth ANITA Neutrino Tree (all nus)&quot;</span>) : 0; </div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;SAVE_TRUTH_NU_TREE) </div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  {</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    truthAnitaNuTree-&gt;SetAutoFlush(10000); </div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    truthAnitaNuTree-&gt;Branch(<span class="stringliteral">&quot;truth_neutrino&quot;</span>,     &amp;truthNuPtr );</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;  }</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;  <a class="code" href="../../d8/db1/class_anita_geom_tool.html">AnitaGeomTool</a> *AnitaGeom1 = <a class="code" href="../../d8/db1/class_anita_geom_tool.html#a1082689d96e9b03316b7625a9de37b44">AnitaGeomTool::Instance</a>();</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;  </div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  <span class="comment">//end ROOT variable definitions</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment"></span></div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTCORRELATOR</span></div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> skyMapLat = 90;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;  TMarker *astroObject = <span class="keyword">new</span> TMarker();</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  <a class="code" href="../../d6/df2/class_sky_map.html">SkyMap</a> *skyMapOut = <span class="keyword">new</span> <a class="code" href="../../d6/df2/class_sky_map.html">SkyMap</a>(skyMapLat);</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;  <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3) {</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    settings1-&gt;CONSTANTCRUST = 1;  <span class="comment">//Set ice depths and elevations all the same</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    settings1-&gt;CONSTANTICETHICKNESS = 1;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    settings1-&gt;FIXEDELEVATION = 1;</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;  }</div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;antarctica-&gt;nRows_ice;i++) {</div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;antarctica-&gt;nCols_ice;j++) {</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;      antarctica-&gt;IceENtoLonLat(j, i, lon_ice, lat_ice);</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      icethck=antarctica-&gt;IceThickness(lon_ice, lat_ice);</div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      lon_water=lon_ice; <span class="comment">//redundant?</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;      lat_water=lat_ice; </div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;      h20_depth=antarctica-&gt;h_water_depth.GetBinContent(j+1,i+1);</div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;HIST) icetree-&gt;Fill();</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    }</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  }</div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;antarctica-&gt;nRows_ground;i++) {</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;antarctica-&gt;nCols_ground;j++) {</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;      antarctica-&gt;GroundENtoLonLat(j, i, lon_ground, lat_ground);</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;      elev=antarctica-&gt;SurfaceAboveGeoid(lon_ground, lat_ground);</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;HIST) groundtree-&gt;Fill();</div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    }</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;  }</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="comment">// fills arrays according to antenna specs</span></div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  anita1-&gt;GetBeamWidths(settings1); <span class="comment">// this is used if GAINS set to 0</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="comment">// Antenna measured gain vs. frequency</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  anita1-&gt;ReadGains(); <span class="comment">// this is used if GAINS set to 1</span></div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  anita1-&gt;Set_gain_angle(settings1, sig1-&gt;NMEDIUM_RECEIVER);</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">if</span>(settings1-&gt;WHICH == 2 || settings1-&gt;WHICH == 6) anita1-&gt;SetDiffraction(); <span class="comment">// for the upper ring</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;</div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;  TCanvas *cgains=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cgains&quot;</span>, <span class="stringliteral">&quot;cgains&quot;</span>, 880, 800);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;  TGraph *ggains=<span class="keyword">new</span> TGraph(anita1-&gt;NPOINTS_GAIN, anita1-&gt;frequency_forgain_measured, anita1-&gt;vvGaintoHeight);</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  ggains-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/gains.eps&quot;</span>;</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;  cgains-&gt;Print((TString)stemp);  </div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  </div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <span class="comment">// sets position of balloon and related quantities</span></div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  <span class="comment">// these are all passed as pointers</span></div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="comment">// theta,  phi,  altitude of balloon</span></div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <span class="comment">// position of balloon,  altitude and position of surface of earth (relative to the center of the earth) under balloon</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  bn1-&gt;SetDefaultBalloonPosition(antarctica);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;  anita1-&gt;SetNoise(settings1, bn1, antarctica);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="comment">//pathtree-&gt;Fill(); //Added by Stephen for verification of path</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="comment">// find the maximum distance the interaction could be from the balloon and still be within the horizon.</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;  antarctica-&gt;GetMAXHORIZON(bn1);</div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;  <span class="comment">// calculate the volume of ice seen by the balloon for all balloon positions</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;  antarctica-&gt;CreateHorizons(settings1, bn1, bn1-&gt;theta_bn, bn1-&gt;phi_bn, bn1-&gt;altitude_bn, foutput);</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Done with CreateHorizons.\n&quot;</span>;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;  <span class="comment">// sets neutrino energy</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;  <span class="keywordflow">if</span> (! src_model &amp;&amp;  spectra1-&gt;IsMonoenergetic() ){</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    pnu=pow(10., settings1-&gt;EXPONENT);</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">GetSigma</a>(pnu, sigma, len_int_kgm2, settings1, xsecParam_nutype, Interaction::ktotal);    <span class="comment">// get cross section and interaction length.</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;pnu,  sigma and len_int_kgm2 &quot;</span> &lt;&lt; pnu &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; sigma &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; len_int_kgm2 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  }</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WRITEPOSFILE==1) {</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    nu_out &lt;&lt; <span class="stringliteral">&quot;Neutrinos with energy &quot;</span> &lt;&lt; pnu &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>; <span class="comment">//Write header to file of neutrino positions</span></div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    nu_out &lt;&lt; <span class="stringliteral">&quot;nu #,  position of nu interaction,  depth of int.,  Direction of nu momentum,  Position of balloon,  nu flavour,  current type,  elasticity\n\n\n\n&quot;</span>;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  }</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;  <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3) { <span class="comment">//Force certain parameters if we&#39;re doing a banana plot</span></div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    NNU = settings1-&gt;horizontal_banana_points*settings1-&gt;vertical_banana_points; <span class="comment">//Total number of points to look at</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    anita1-&gt;maxthreshold = <a class="code" href="../../d3/d8e/class_interaction.html#a4eaba7bc8811556f27f23f8c1356599f">Interaction::banana_sigma</a>;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    settings1-&gt;SIGNAL_FLUCT = <a class="code" href="../../d3/d8e/class_interaction.html#a4d6cb6fc1548e0abada65e2f031eff4a">Interaction::banana_signal_fluct</a>;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    settings1-&gt;CONSTANTCRUST=1;  <span class="comment">//Set ice depths and elevations all the same</span></div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    settings1-&gt;CONSTANTICETHICKNESS=1;</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    settings1-&gt;FIXEDELEVATION=1;</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;    pnu=Interaction::pnu_banana;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    int_banana-&gt;surface_over_banana_nu=antarctica-&gt;Surface(int_banana-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#aa2dcd4c8539fa3ef312c54090682eb82">nu_banana</a>);</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    int_banana-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a1e6c2d93ac3db39b513394477c69aafb">nu_banana_surface</a>=(int_banana-&gt;surface_over_banana_nu) * (int_banana-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#aa2dcd4c8539fa3ef312c54090682eb82">nu_banana</a>);</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;  } <span class="comment">//Done setting parameters for banana plot</span></div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;reminder that I took out ChangeCoord.\n&quot;</span>;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;  <span class="comment">// builds payload based on read inputs</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;  anita1-&gt;GetPayload(settings1,  bn1);</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME == 3 || settings1-&gt;TRIGGERSCHEME == 4 || settings1-&gt;TRIGGERSCHEME==5) {</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <a class="code" href="../../d5/db2/class_vector.html">Vector</a> plusz(0., 0., 1.);</div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    bn1-&gt;PickBalloonPosition(plusz, antarctica, settings1, anita1);</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    anita1-&gt;calculate_all_offsets();</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordtype">double</span> angle_theta=16.;</div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;    <span class="keywordtype">double</span> angle_phi=0.;</div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    <a class="code" href="../../d5/db2/class_vector.html">Vector</a> x = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(cos(angle_theta * RADDEG) * cos((angle_phi+11.25) * RADDEG),</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                      cos(angle_theta * RADDEG) * sin((angle_phi+11.25) * RADDEG),</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                      sin(angle_theta * RADDEG));</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    anita1-&gt;GetArrivalTimes(x,bn1,settings1);</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;end of getarrivaltimes\n&quot;</span>;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  }</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="comment">// get positions of the anita payload during the slac test</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;SLAC)</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    bn1-&gt;GetSlacPositions(anita1);</div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;  <span class="keywordflow">switch</span> (settings1-&gt;WHICHRAYS){</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;  <span class="keywordflow">case</span> 1:</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    settings1-&gt;MINRAY=0;</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    settings1-&gt;MAXRAY=0;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;  <span class="keywordflow">case</span> 2:</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    settings1-&gt;MINRAY=0;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    settings1-&gt;MAXRAY=1;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;  <span class="keywordflow">case</span> 3:</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    settings1-&gt;MINRAY=1;</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    settings1-&gt;MAXRAY=1;</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  }</div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;  </div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;  time_t raw_loop_start_time = time(NULL);</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  cout&lt;&lt;<span class="stringliteral">&quot;Starting loop over events.  Time required for setup is &quot;</span>&lt;&lt;(int)((raw_loop_start_time - raw_start_time)/60)&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt; ((raw_loop_start_time - raw_start_time)%60)&lt;&lt;endl;</div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="comment">//CD TODO: Do something analogous for sources </span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;  TCanvas *ctest1 = <span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;ctest1&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 880, 800);</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;  <span class="comment">// Surely we only want this if there&#39;s a spectrum...</span></div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;  <span class="keywordflow">if</span> ( spectra1-&gt;IsSpectrum() ){</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;  spectra1-&gt;GetGEdNdEdAdt()-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  spectra1-&gt;GetGEdNdEdAdt()-&gt;GetHistogram()-&gt;SetMinimum(-0.2*spectra1-&gt;Getmaxflux());</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;  spectra1-&gt;GetSEdNdEdAdt()-&gt;SetLineColor(2);</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;  spectra1-&gt;GetSEdNdEdAdt()-&gt;Draw(<span class="stringliteral">&quot;l same&quot;</span>);</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/GetG_test1.pdf&quot;</span>;</div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  ctest1-&gt;Print((TString)stemp);</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;  }</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  </div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;  <span class="comment">// for averaging balloon altitude and distance from center of earth</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="comment">// for comparing with Peter</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;  <span class="keywordtype">double</span> average_altitude=0.;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;  <span class="keywordtype">double</span> average_rbn=0.;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="comment">//if using energy spectrum</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;  <span class="keywordflow">if</span> ( spectra1-&gt;IsSpectrum() ){</div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    TCanvas *ctemp = <span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;ctemp&quot;</span>);</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;    TFile *out = <span class="keyword">new</span> TFile(<span class="stringliteral">&quot;Temp.root&quot;</span>, <span class="stringliteral">&quot;recreate&quot;</span>);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;    TGraph *g1 = spectra1-&gt;GetGEdNdEdAdt();</div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;    g1-&gt;Draw(<span class="stringliteral">&quot;Al&quot;</span>);</div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;    ctemp-&gt;Print(<span class="stringliteral">&quot;Temp1.png&quot;</span>);</div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;    <span class="keywordtype">int</span> n = g1-&gt;GetN();</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    <span class="keywordtype">double</span> *x = g1-&gt;GetX();</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;    <span class="keywordtype">double</span> x2[20];</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;n;i++) x2[i] = TMath::Power(10., x[i]);</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    TGraph *g2 = <span class="keyword">new</span> TGraph(n, x2, g1-&gt;GetY());</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    g2-&gt;Draw(<span class="stringliteral">&quot;Al&quot;</span>);</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;    ctemp-&gt;SetLogy();</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    ctemp-&gt;SetLogx();</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    cout &lt;&lt; g2-&gt;Integral() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; g2-&gt;Integral(1, n) &lt;&lt; endl;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;    ctemp-&gt;Print(<span class="stringliteral">&quot;Temp2.png&quot;</span>);</div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;    g1-&gt;Write();</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;    g2-&gt;Write();</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    out-&gt;Close();</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;  }</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    </div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160; </div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  signal(SIGINT,  interrupt_signal_handler);     <span class="comment">// This function call allows icemc to gracefully abort and write files as usual rather than stopping abruptly.</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;  TString objName = <span class="stringliteral">&quot;noObject&quot;</span>;</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;  <span class="comment">// Setting gps offset for plotting direction wrt north</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==7){</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    gps_offset=atan2(-0.7042,0.71)*DEGRAD;</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(settings1-&gt;WHICH==8){</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    gps_offset=atan2(-0.7085,0.7056)*DEGRAD;</div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;    gps_offset=45;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;  } <span class="keywordflow">else</span> gps_offset=0;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;</div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;  <span class="keywordtype">int</span> antNum;    </div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;  </div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="comment">// begin looping over NNU neutrinos doing the things</span></div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordflow">for</span> (inu = startNu; inu &lt; NNU; inu++) {</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;    <span class="keywordflow">if</span> (NNU &gt;= 100) {</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;      <span class="keywordflow">if</span> (inu % (NNU / 100) == 0)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        cout &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot; neutrinos. &quot;</span> &lt;&lt; (double(inu)/double(NNU)) * 100 &lt;&lt; <span class="stringliteral">&quot;% complete.\n&quot;</span>;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    }</div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;      cout &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot; neutrinos.  &quot;</span> &lt;&lt; (double(inu) / double(NNU)) * 100 &lt;&lt; <span class="stringliteral">&quot;% complete.\n&quot;</span>;</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    eventNumber=(ULong_t)(run_no)*NNU+inu;</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <span class="keywordflow">if</span> (useEventList){</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;      </div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      <span class="keywordflow">if</span> (!eventListFile.eof()){</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    eventListFile &gt;&gt; eventNumber;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Looking at event number &quot;</span> &lt;&lt; eventNumber &lt;&lt; endl;</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keywordflow">break</span>;</div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;      }</div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;      </div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;      eventNumber=(ULong_t)(run_no)*NNU+inu;</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    }</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    setSeed(eventNumber);</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="comment">//reset screen parameters (even for no roughness) for the new event</span></div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    panel1-&gt;ResetParameters();</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    anita1-&gt;inu=inu;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    std::string nunum = Form(<span class="stringliteral">&quot;%d&quot;</span>,inu);    </div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordtype">double</span> time_weight = 1; <span class="comment">//this is the sum of all source time weights for the time</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;    <span class="keywordtype">double</span> src_time_weight = 1;  <span class="comment">//this is the time weight for the selected source </span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    <span class="keywordflow">for</span> (whichray = settings1-&gt;MINRAY; whichray &lt;= settings1-&gt;MAXRAY; whichray++) {</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;      anita1-&gt;passglobtrig[0]=0;</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;      anita1-&gt;passglobtrig[1]=0;</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;      passes_thisevent=0;</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      unmasked_thisevent=1;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      vmmhz_min_thatpasses=1000; <span class="comment">// initializing.  want to find the minumum voltage that passes a</span></div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <a class="code" href="../../d5/db2/class_vector.html">Vector</a> force_dir;</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;      <span class="keywordtype">double</span> RA = 0; </div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      <span class="keywordtype">double</span> dec = 0;</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordtype">int</span> which_source = -1; </div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;      <span class="keywordflow">if</span> (!src_model &amp;&amp;  spectra1-&gt;IsSpectrum() ){<span class="comment">//if using energy spectrum</span></div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="keywordflow">if</span>(settings1-&gt;USEDARTBOARD) pnu=spectra1-&gt;GetNuEnergy();</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">else</span> pnu=spectra1-&gt;GetCDFEnergy();</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      } <span class="comment">// end IsSpectrum</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;      <span class="comment">//Use placement new instead of deleting and recreating so that branch pointers don&#39;t go away</span></div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;      interaction1 = <span class="keyword">new</span> (interaction1) <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a>(<span class="stringliteral">&quot;nu&quot;</span>,  primary1,  settings1,  whichray,  count1);</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;      thisNuType = getRNG(RNG_INTERACTION)-&gt;Integer(2); </div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;      ierr=primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">GetSigma</a>(pnu, sigma, len_int_kgm2, settings1, thisNuType, Interaction::ktotal);  <span class="comment">// given neutrino momentum,  cross section and interaction length of neutrino.</span></div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;      <span class="keywordflow">if</span> (!src_model)  interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a> = primary1-&gt;GetCurrent(pnu,settings1,thisNuType); </div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;      <span class="comment">// ierr=0 if the energy is too low for the parameterization</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;      <span class="comment">// ierr=1 otherwise</span></div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      len_int=1.0/(sigma*sig1-&gt;RHOICE*(1./M_NUCL)*1000); <span class="comment">// in km (interaction length is in water equivalent)</span></div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;      n_interactions=1;</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;      count_pass=0;</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;      passestrigger=0;</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;      chanceinhell2=0;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;      sec1-&gt;secondbang=<span class="keyword">false</span>;</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;      count_total++;</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;      <span class="comment">// initializing the voltage seen by each polarization of each antenna</span></div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>=0;</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      bn1-&gt;dtryingposition=0;</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;Anita::NFREQ;i++) {</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        vmmhz[i] = 0.; <span class="comment">// the full signal with all factors accounted for (1/r,  atten. etc.)</span></div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        vmmhz_em[i]=0.; <span class="comment">// for keeping track of just the em component of the shower</span></div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      } <span class="comment">//Zero the vmmhz array - helpful for banana plots,  shouldn&#39;t affect anything else - Stephen</span></div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="keywordtype">int</span> got_a_good_position = 0;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;     </div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      <span class="keywordflow">do</span>  <span class="comment">// loop for forcing a good position with sources if that option is enabled</span></div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      {</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        <span class="comment">// Picks the balloon position and at the same time sets the masks and thresholds</span></div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        bn1-&gt;PickBalloonPosition(antarctica,  settings1,  inu,  anita1,  getRNG(RNG_BALLOON_POSITION)-&gt;Rndm());</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;          </div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;        <span class="comment">// find average balloon altitude and distance from center of earth for</span></div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;        <span class="comment">// making comparisons with Peter</span></div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;        average_altitude+=bn1-&gt;altitude_bn/(double)NNU;</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;        average_rbn+=bn1-&gt;r_bn.Mag()/(double)NNU;</div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        realtime_this=bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        longitude_this=bn1-&gt;longitude;</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        latitude_this=bn1-&gt;latitude;</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;        altitude_this=bn1-&gt;altitude;</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;        heading_this=bn1-&gt;heading;</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        </div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <span class="keywordflow">if</span> (src_model) </div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        {</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;          time_weight = src_model-&gt;getTimeWeight(realtime_this); </div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;          which_source = time_weight &gt; 0 ?  src_model-&gt;<a class="code" href="../../de/d30/class_source_model.html#ac929f195d499f167d11a94bdfd57d9e2">getDirectionAndEnergy</a>(&amp;force_dir, realtime_this, pnu, src_min, src_max) : -1;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;          <span class="keywordflow">if</span>(which_source &gt;= 0) {</div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;            got_a_good_position = 1;</div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            src_time_weight = src_model-&gt;getPerSourceTimeWeight(realtime_this, which_source); </div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;</div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;            <span class="keywordflow">if</span> (<span class="keywordtype">int</span>(NNU_per_source.size()) &lt; which_source+1) </div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            {</div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;              NNU_per_source.resize(which_source+1); </div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;              source_names.resize(which_source+1); </div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;              eventsfound_per_source.resize(which_source+1); </div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;              eventsfound_prob_per_source.resize(which_source+1); </div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            }</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            NNU_per_source[which_source]++; </div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;          </div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d8/d74/class_source.html">Source</a> * src = src_model-&gt;getSource(which_source); </div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            RA = src-&gt;getRA();</div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            dec= src-&gt;getDec()* TMath::RadToDeg(); <span class="comment">// Get it make in deg</span></div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;            objName = src-&gt;getName(); </div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;            <span class="keywordflow">if</span> (!source_names[which_source].size())</div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;            {</div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;              source_names[which_source] = objName.Data(); </div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            }</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;</div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            pnu*=1e9; <span class="comment">//GeV -&gt; eV</span></div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            ierr=primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">GetSigma</a>(pnu, sigma, len_int_kgm2, settings1, thisNuType, Interaction::ktotal);  <span class="comment">// given neutrino momentum,  cross section and interaction length of neutrino.</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;            interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a> = primary1-&gt;GetCurrent(pnu,settings1,thisNuType); </div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;            len_int=1.0/(sigma*sig1-&gt;RHOICE*(1./M_NUCL)*1000); <span class="comment">// in km (why interaction length in water?) //EH</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;          }</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;          </div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;pnu = &quot; &lt;&lt; pnu &lt;&lt; std::endl;</span></div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;RA = &quot; &lt;&lt; RA &lt;&lt; std::endl;</span></div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;dec = &quot; &lt;&lt; dec &lt;&lt; std::endl;</span></div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;          <span class="comment">//std::cout &lt;&lt; &quot;objName = &quot; &lt;&lt; objName &lt;&lt; std::endl;</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;        }</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;        {</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;          got_a_good_position = 1; </div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;HORIZON_OFFSET &gt; -999) </div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;          {</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;            <span class="keywordtype">double</span> horizon_angle = acos(bn1-&gt;r_bn_shadow.Mag()/bn1-&gt;r_bn.Mag()); </div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;            <span class="keywordtype">double</span> alt = -horizon_angle + TMath::DegToRad() * settings1-&gt;HORIZON_OFFSET; </div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;            <span class="keywordtype">double</span> Az = 0; <span class="comment">//for now always sough</span></div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;            <span class="keywordtype">double</span> lat = bn1-&gt;latitude*TMath::DegToRad(); </div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            <span class="keywordtype">double</span> sin_lat = sin(lat); </div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;            <span class="keywordtype">double</span> cos_lat = cos(lat); </div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            <span class="keywordtype">double</span> sindec = sin_lat *sin(alt) - cos_lat*cos(alt) *cos(Az); </div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;            <span class="keywordtype">double</span> cosdec = sqrt(1-sindec*sindec); </div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;            <span class="keywordtype">double</span> h = atan2(sin(Az),-sin_lat*cos(Az) + cos_lat*tan(alt));</div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;            force_dir = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(cos(h)*cosdec,sin(h)*cosdec,sindec);</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;          }</div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;        }</div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;</div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;      } <span class="keywordflow">while</span>(!got_a_good_position &amp;&amp; settings1-&gt;SOURCE_SKIP_WHEN_NONE) ; </div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;HIST &amp;&amp; !settings1-&gt;ONLYFINAL</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;          &amp;&amp; prob_eachphi_bn-&gt;GetEntries() &lt; settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        prob_eachphi_bn-&gt;Fill(bn1-&gt;phi_bn);</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        prob_eachilon_bn-&gt;Fill(bn1-&gt;r_bn.Lon());</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    balloontree-&gt;Fill();</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;      }</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3) { <span class="comment">// for banana plot</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        <span class="comment">//Set observation location</span></div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;        bn1-&gt;setObservationLocation(int_banana, inu, antarctica, settings1);</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;      } <span class="comment">//End else if (WHICHPATH==3) : Banana plot locations</span></div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      <span class="comment">// No sources were turned on, so we have no neutrino. So we should try again. </span></div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">if</span> (!got_a_good_position) </div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;      {</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;       <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setNoNu(bn1-&gt;r_bn.GetX(), bn1-&gt;r_bn.GetY(), bn1-&gt;r_bn.GetZ(), realtime_this);</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="comment">//        truthAnitaNuTree-&gt;Fill();  </span></div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        <span class="keywordflow">continue</span>; </div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;      }</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;      <span class="comment">// pick random point in ice.</span></div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;      <span class="comment">// also get initial guess shower exit position</span></div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;      <span class="comment">// unit vector from shower exit to balloon.</span></div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;      <span class="comment">// get both positions of interaction point and its mirror point.</span></div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;      <span class="comment">//-------------------------------------------------------</span></div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;      beyondhorizon = 0;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;</div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;      <span class="keywordflow">if</span>(taus1)</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;        <span class="keyword">delete</span> taus1;</div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      taus1 = <span class="keyword">new</span> <a class="code" href="../../d6/dc1/class_taumodel.html">Taumodel</a>();</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;</div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;      <span class="keywordtype">int</span> taumodes = settings1-&gt;taumodes;</div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;      tauweighttrigger=0;</div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3ef3decda6e004ad20f541949a948ae0">weight_nu</a>=0;</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>=0;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;      taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a>=0;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;      </div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;      <span class="keywordflow">if</span> (taumodes==1 &amp;&amp; interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nutau&quot;</span> &amp;&amp; interaction1-&gt;current()==<span class="stringliteral">&quot;cc&quot;</span>)</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        tautrigger=1;</div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        tautrigger=0;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;      bn1-&gt;PickDownwardInteractionPoint(interaction1,  anita1,  settings1,  antarctica,  ray1,  beyondhorizon, len_int_kgm2,  (src_model || settings1-&gt;HORIZON_OFFSET &gt; -999) ? &amp;force_dir : 0);</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;      <span class="keywordtype">bool</span> havent_set_frac = <span class="keyword">true</span>; </div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;      <span class="keywordtype">bool</span> havent_set_weights = <span class="keyword">true</span>; </div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;      <span class="keywordtype">bool</span> havent_set_dir = <span class="keyword">true</span>; </div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;UNBIASED_SELECTION &gt; 0 || src_model || settings1-&gt;HORIZON_OFFSET) <span class="comment">//in this case, we have already picked the direction</span></div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;      {</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        havent_set_dir = <span class="keyword">false</span>; </div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setDir(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetX(), interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetY(), interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetZ()); </div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      }</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;      <span class="comment">//FILL TruthAnitaNeutrino here (in case we don&#39;t get to fill it later) </span></div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;      <span class="keywordflow">if</span> (truthNuPtr) </div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;      {</div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        truthNuPtr-&gt;setPos(interaction1-&gt;posnu.GetX(), interaction1-&gt;posnu.GetY(), interaction1-&gt;posnu.GetZ(),</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;                           bn1-&gt;r_bn.GetX(), bn1-&gt;r_bn.GetY(), bn1-&gt;r_bn.GetZ(), realtime_this);</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        truthNuPtr-&gt;setNu(pnu,pdgcode); </div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;      }</div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;      </div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;<span class="preprocessor">#define DO_SKIP  { if (truthNuPtr) {truthNuPtr-&gt;setSkipped(true,havent_set_frac,havent_set_weights,havent_set_dir); truthAnitaNuTree-&gt;Fill();} continue; }</span></div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;<span class="preprocessor">#define DO_SKIP continue ;</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      <span class="comment">//BELOW HERE, WE NO LONGER HAVE EVERY EVENT</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;noway)</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;      {</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;        DO_SKIP</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;      }</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;      count1-&gt;noway[whichray]++;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;wheredoesitleave_err)</div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;      {</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;        DO_SKIP</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;      }</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;      count1-&gt;wheredoesitleave_err[whichray]++;</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;</div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;neverseesice)</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;      {</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;        DO_SKIP</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;      }</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;      count1-&gt;neverseesice[whichray]++;</div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;wheredoesitenterice_err)</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;      {</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        DO_SKIP</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;      }</div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;      count1-&gt;wheredoesitenterice_err[whichray]++;</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;</div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;toohigh)</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;      {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        DO_SKIP</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;      }</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      count1-&gt;toohigh[whichray]++;</div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;</div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;toolow)</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      {</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        DO_SKIP</div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      }</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;      count1-&gt;toolow[whichray]++;</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        interaction1=int_banana;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      <span class="keywordflow">if</span> (!interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ab558b148fa334b3b1522a68f6273b954">iceinteraction</a>)</div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      {</div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;        DO_SKIP</div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;      }</div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;      count1-&gt;iceinteraction[whichray]++;</div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;      <span class="keywordflow">if</span> (beyondhorizon) {</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        DO_SKIP</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;      }</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;      count1-&gt;inhorizon[whichray]++;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;      <span class="comment">// cerenkov angle depends on depth because index of refraction depends on depth.</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;      <span class="comment">//if(!settings1-&gt;ROUGHNESS){</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;FIRN) {</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;          sig1-&gt;SetNDepth(antarctica-&gt;GetN(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">altitude_int</a>));</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;          <span class="comment">//      changle = acos(1/N_DEPTH);</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;          changle_deg=sig1-&gt;changle*DEGRAD;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        }</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;      <span class="comment">//}</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;FORSECKEL==1)</div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        sig1-&gt;SetChangle(acos(1/sig1-&gt;NICE));</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;      <span class="comment">// x and y components of interaction in km.</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;      horizcoord=interaction1-&gt;posnu[0]/1000;</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;      vertcoord=interaction1-&gt;posnu[1]/1000;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;</div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;      ray1-&gt;GetSurfaceNormal(settings1, antarctica, interaction1-&gt;posnu, slopeyangle, 0);</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      <span class="comment">// *** warning **** for Snell&#39;s law,  I call the ray on the air-side</span></div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;      <span class="comment">// the incident angle and the ice-side ray the refracted</span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;      <span class="comment">// ray&#39;s angle of incidence (in the air) onto ice</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;      costheta_inc=ray1-&gt;n_exit2bn[0]*ray1-&gt;nsurf_rfexit;    <span class="comment">// just for plotting</span></div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;</div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;      <span class="comment">// just for plotting</span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;      costheta_exit=cos(ray1-&gt;rfexit[0].Theta()); <span class="comment">// just for plotting</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;      </div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;</div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;      <span class="keywordflow">if</span> (!ray1-&gt;TraceRay(settings1, anita1, 1, sig1-&gt;N_DEPTH)) {</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;        DO_SKIP</div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;      }</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;      <span class="comment">//       // use snell&#39;s law to get the first guess at the</span></div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      <span class="comment">//       // direction of the rf as it leaves ice surface.</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;      <span class="comment">//       // 0th guess was simply radially outward from interaction position</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;      <span class="comment">//       // this now takes into account balloon position and surface normal.</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;      ray1-&gt;GetRFExit(settings1, anita1, whichray, interaction1-&gt;posnu, interaction1-&gt;posnu_down, bn1-&gt;r_bn, bn1-&gt;r_boresights, 1, antarctica); <span class="comment">// fills ray1-&gt;n_exit2bn[1]</span></div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;      ray1-&gt;GetSurfaceNormal(settings1, antarctica, interaction1-&gt;posnu, slopeyangle, 1);</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;</div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      <span class="keywordflow">if</span> (!ray1-&gt;TraceRay(settings1, anita1, 2, sig1-&gt;N_DEPTH)) {; <span class="comment">// trace ray,  2nd iteration.</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;        DO_SKIP</div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;      }</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      </div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      <span class="comment">// fills ray1-&gt;n_exit2bn[2] ?</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;      ray1-&gt;GetRFExit(settings1, anita1, whichray, interaction1-&gt;posnu, interaction1-&gt;posnu_down, bn1-&gt;r_bn, bn1-&gt;r_boresights, 2, antarctica);</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;      ray1-&gt;GetSurfaceNormal(settings1, antarctica, interaction1-&gt;posnu, slopeyangle, 2);</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;</div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)  <span class="comment">// if this is for comparison with Peter,  print angles of incidence</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        ray1-&gt;PrintAnglesofIncidence();</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      <span class="comment">// intermediate counter</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;      count1-&gt;nraypointsup1[whichray]++;</div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;</div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;      sec1-&gt;GetTauDecay(interaction1-&gt;nuflavor(), interaction1-&gt;current(), taudecay,  emfrac_db,  hadfrac_db);</div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;</div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;      <span class="comment">// pick elasticity (for now is done for neutrinos only)</span></div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;      elast_y=primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#ab2b585fe7f1920bd1370fae3bfce2b46">pickY</a>(settings1, pnu, thisNuType, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>);</div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;CONSTANTY==1) { <span class="comment">// if we ask to make y a constant=0.2</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        elast_y=0.2;</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>=1; </div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>=Interaction::kcc; </div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;      }</div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;CONSTANTY==2) </div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;      {</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;SHOWERTYPE == 0) </div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;        {</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;          elast_y = 1; </div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>=1;</div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>=Interaction::kcc;</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;        }</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;          elast_y = 0; </div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>=1;</div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>=Interaction::kcc; </div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        }</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;      }</div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        elast_y = <a class="code" href="../../d3/d8e/class_interaction.html#a10499fde024b6ac93dfd9ec3b13dedcd">Interaction::banana_y</a>;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;        elast_y=1.;</div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;FORSECKEL==1) {</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;SHOWERTYPE==0) <span class="comment">// all hadronic shower</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;          elast_y=1.;</div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;SHOWERTYPE==1) <span class="comment">// all em shower</span></div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;          elast_y=0.;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;      } <span class="comment">//if (settings1-&gt;FORSECKEL)</span></div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;      <span class="keywordflow">if</span> (ytree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        ytree-&gt;Fill();</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160; </div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;      <span class="comment">//TAU STUFF. Pick whether it will stay as a neutrino or create tau</span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;      <span class="keywordflow">if</span> ( tautrigger == 1 ) {</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <span class="keywordflow">if</span> (  ( !settings1-&gt;UNBIASED_SELECTION ) &amp;&amp; ( !settings1-&gt;SLAC )  &amp;&amp; !src_model ) {</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;          err = GetDirection(settings1, interaction1, ray1-&gt;nrf_iceside[4], deltheta_em_max, deltheta_had_max, emfrac, hadfrac, vmmhz1m_max*bestcase_atten, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[whichray], ray1, sig1, interaction1-&gt;posnu, anita1, bn1, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, costhetanu, theta_threshold);</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;          <span class="comment">//cout&lt;&lt;&quot;UNBIASED_SELECTION IS &quot;&lt;&lt;settings1-&gt;UNBIASED_SELECTION&lt;&lt;&quot;\n&quot;;</span></div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        }</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src_model || settings1-&gt;HORIZON_OFFSET &gt; -999) </div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        {</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = force_dir; </div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a> = 1; <span class="comment">//ugh </span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;          costhetanu = cos(force_dir.Theta()); </div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;          theta_threshold = 1; </div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;          err = 1; </div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;        }</div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( settings1-&gt;SLAC ) {</div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;          <a class="code" href="../../d5/db2/class_vector.html">Vector</a> xaxis(1., 0., 0.);</div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;          <span class="comment">//nnu=(rfexit[0].Unit()).Rotate(-10.*RADDEG, interaction1-&gt;posnu.Cross(zaxis));</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = xaxis.RotateY(bn1-&gt;theta_bn-settings1-&gt;SLAC_HORIZDIST/EarthModel::R_EARTH);  <span class="comment">//direction of neutrino- for slac,  that&#39;s the direction of the beam</span></div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.RotateZ(bn1-&gt;phi_bn);</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;          costhetanu=cos(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Theta());</div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;          theta_threshold=1.; <span class="comment">// this is a bogus theta_threshold but it is only used for plotting anyway</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            fslac_viewangles &lt;&lt; bn1-&gt;sslacpositions[bn1-&gt;islacposition] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                viewangle_eachboresight[ilayer][ifold]=acos(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Dot(ray1-&gt;nrf_iceside_eachboresight[4][ilayer][ifold]));</div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                fslac_viewangles &lt;&lt; ilayer &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; ifold &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; (viewangle_eachboresight[ilayer][ifold]-sig1-&gt;changle)*DEGRAD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;              }<span class="comment">//end for ifold</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            }<span class="comment">//end for ilayer</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;          }<span class="comment">//end if boresights</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;          err = 1; <span class="comment">// everything is a-okay</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        }<span class="comment">// end else if slac</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">if</span> ( err == 0 )</div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;        {</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;          DO_SKIP<span class="comment">//bad stuff has happened.</span></div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        }</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;</div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;        <span class="keywordflow">if</span> (!settings1-&gt;UNBIASED_SELECTION) </div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;        {</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a> = antarctica-&gt;WhereDoesItEnter(interaction1-&gt;posnu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;</div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        }</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;        taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a77beee4028eb9de4a73625b780d0021f">GetTauWeight</a>(primary1,  settings1,  antarctica,  interaction1,  pnu,  1,  ptauf, interaction1-&gt;crust_entered);</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;</div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        <span class="comment">//the weight has already been calculated for unbiased selection</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;        <span class="keywordflow">if</span> (!settings1-&gt;UNBIASED_SELECTION) </div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        {</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;          antarctica-&gt;Getchord(<span class="keyword">false</span>, len_int_kgm2, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>,  interaction1-&gt;pathlength_inice, settings1-&gt;UNBIASED_SELECTION == 0, interaction1-&gt;posnu, inu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3ef3decda6e004ad20f541949a948ae0">weight_nu</a>, interaction1-&gt;nearthlayers, myair, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a46d7e538970790ac8d4eff1f9024af93">total_kgm2</a>, interaction1-&gt;crust_entered,  interaction1-&gt;mantle_entered, interaction1-&gt;core_entered);</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        }</div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;        nutauweight = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>;</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;        tauweight = taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a>;</div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        nutauweightsum +=nutauweight;</div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        tauweightsum +=tauweight;</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        <span class="keywordtype">double</span> xrndm=getRNG(RNG_XRNDM)-&gt;Rndm();</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;</div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <span class="keywordflow">if</span>(xrndm &lt;=taus1-&gt;weight_tau_prob/(taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a>+interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>)){</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;          pnu=ptauf;<span class="comment">//set the energy we are looking at to the final energy of the tau. cuts out alot of if-else statements</span></div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;          tauweighttrigger=1;<span class="comment">//From now on,  signifies a tau particle</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        }</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordflow">if</span>(TauPtr)</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;          <span class="keyword">delete</span> TauPtr;</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;        TauPtr = <span class="keyword">new</span> <a class="code" href="../../d6/dc1/class_taumodel.html">Taumodel</a>();</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        TauPtr-&gt;inu = inu;</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        TauPtr-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#abb4705d1231d64e1b0b83492197d8d91">ptauf</a> = ptauf;</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        TauPtr-&gt;weight_nu_prob = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        TauPtr-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a> = taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a>;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;    </div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">if</span> (mytaus_tree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;      mytaus_tree-&gt;Fill();</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;        <span class="comment">//delete TauPtr;</span></div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      }<span class="comment">//end tautrigger ==1</span></div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;      <span class="comment">// get fraction of shower that is electromagnetic.</span></div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;      <span class="comment">// pi^0&#39;s are counted as hadronic.</span></div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;      sec1-&gt;GetEMFrac(settings1, interaction1-&gt;nuflavor(), interaction1-&gt;current(), taudecay, elast_y, hy, pnu, inu,emfrac, hadfrac, n_interactions, tauweighttrigger);</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;      havent_set_frac = <span class="keyword">false</span>; </div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;      <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setFrac(hadfrac,emfrac); </div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;      <span class="keywordflow">if</span> (emfrac+hadfrac&gt;1.000001) {</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Warning:  &quot;</span> &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; emfrac+hadfrac &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;      }</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;      </div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;      <span class="comment">// for plotting</span></div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      sumfrac=emfrac+hadfrac;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;tree7 check&quot; &lt;&lt;interaction1-&gt;nuflavorint &lt;&lt; endl;</span></div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      <span class="keywordflow">if</span> (tree7-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;        tree7-&gt;Fill();</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;      vmmhz1m_visible = (emfrac+hadfrac)*vmmhz1m_max; <span class="comment">//Stephen - Record actual V/m/Mhz for display</span></div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;      <span class="comment">// plots for debugging.</span></div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;numu&quot;</span> &amp;&amp; bn1-&gt;WHICHPATH != 3 &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1 &amp;&amp; fraction_sec_muons-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        fraction_sec_muons-&gt;Fill(emfrac+hadfrac, weight);</div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;        n_sec_muons-&gt;Fill((<span class="keywordtype">double</span>)n_interactions);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;      }</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;      <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nutau&quot;</span> &amp;&amp; bn1-&gt;WHICHPATH != 3 &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1 &amp;&amp; fraction_sec_taus-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;        fraction_sec_taus-&gt;Fill(emfrac+hadfrac, weight);</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;        n_sec_taus-&gt;Fill((<span class="keywordtype">double</span>)n_interactions);</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      }</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="comment">// for double bangs</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus) {</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;        ptau=(1-elast_y)*pnu;</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;        emfrac=emfrac_db;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;        hadfrac=hadfrac_db;</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;      }</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;</div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;      <span class="comment">// Find the highest possible electric field emitted at this energy</span></div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;      <span class="comment">// (this corresponds to the electric field at the highest frequency</span></div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;      <span class="comment">// detectable by the antennas.</span></div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;      <span class="comment">// Also find the maximum width of Cerenkov cone (which is at lowest frequency)</span></div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;      <span class="comment">// These are used to find the maximum angular deviation from Cerenkov</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;      <span class="comment">// cone where signal is still detectable.</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;      <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus) {</div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        vmmhz1m_max=sig1-&gt;GetVmMHz1m(ptau, anita1-&gt;FREQ_HIGH);</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;        sig1-&gt;GetSpread(ptau, emfrac, hadfrac, anita1-&gt;FREQ_LOW, deltheta_em_max, deltheta_had_max);</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;      } <span class="comment">//if (secondbang &amp;&amp; interestedintaus)</span></div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;      <span class="keywordflow">else</span> {<span class="comment">// get peak signal at highest edge of frequency band because that is where it is highest</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        vmmhz1m_max=sig1-&gt;GetVmMHz1m(pnu, anita1-&gt;FREQ_HIGH);</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        sig1-&gt;GetSpread(pnu, emfrac, hadfrac, anita1-&gt;FREQ_LOW,</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                        deltheta_em_max, deltheta_had_max);</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;      } <span class="comment">//end else (not secondbang or not interested in taus)</span></div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;</div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      <span class="keywordflow">if</span> (jaimetree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;        jaimetree-&gt;Fill();</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;      <span class="comment">//  Using highest possible signal and minimum noise,</span></div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;      <span class="comment">// and accounting for distance from balloon,</span></div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="comment">// and best case attenutation,</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="comment">// reject if signal is undetectable.</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;</div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="keywordflow">if</span> (whichray==0) <span class="comment">// if we are looking at direct rays</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;        bestcase_atten=exp(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">altitude_int</a>/MAX_ATTENLENGTH); <span class="comment">// the attenuation is obtained from the altitude of the interaction (shortest path is if the signal went straight up)</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;      <span class="keywordflow">if</span> (whichray==1) <span class="comment">// if we are looking at reflected rays</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;        bestcase_atten=exp(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a6e9ad2ed02dd253db92aa8bd344f057e">altitude_int_mirror</a>/MAX_ATTENLENGTH);<span class="comment">//use the real path which seems from the mirror point.</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;</div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="comment">// let&#39;s keep this even in the roughness case, since it still represents an ceiling value</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/((hadfrac+emfrac)*vmmhz1m_max*bestcase_atten/interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[whichray]*heff_max*anita1-&gt;bwmin/1.E6)&gt;settings1-&gt;CHANCEINHELL_FACTOR &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        DO_SKIP <span class="comment">// by comparing highest possible signal to the lowest possible noise,  reject if there is just no way we could detect this event.</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="comment">// vmmhz1m_max=signal at highest frequency</span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        <span class="comment">// bestcase_atten=best case attenuation</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        <span class="comment">// r_fromballoon=distance from interaction to balloon</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <span class="comment">//heff_max=maximum effective height over the frequency range</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      }</div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;</div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      <span class="comment">// intermediate counter</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      count1-&gt;nnottoosmall[whichray]++;</div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;</div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="comment">// pick neutrino direction.</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;      <span class="comment">// This GetDirection() picks a neutrino direction such that its cerenkov cone</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="comment">// is close enough to the balloon line of sight that you have a chance in hell of seeing the signal.</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      <span class="keywordflow">if</span> (whichray==1) {</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;        chengji=ray1-&gt;nrf_iceside[4]*ray1-&gt;nrf_iceside[0];<span class="comment">//the projection of nrf_iceside[2] on the direction of radius direction of interaction1-&gt;posnu</span></div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        <span class="comment">//original nrf_iceside[4] is the upgoing direction of signals after being reflected.</span></div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;        <span class="comment">//now I get the corresponding downward direction of real signals in my case.</span></div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        <span class="comment">//The two vectors are symmetric to the tangent plane of the Earth at interaction point</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;        ray1-&gt;nrf_iceside[4] = ray1-&gt;nrf_iceside[4] - 2*chengji*ray1-&gt;nrf_iceside[0];</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;      } <span class="comment">//if whichray==1</span></div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;      <span class="keywordflow">if</span> ( tautrigger == 0 ) {<span class="comment">//did this for cc- taus already,  do again for all other particles</span></div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        <span class="keywordflow">if</span> (  ! src_model &amp;&amp; ( !settings1-&gt;UNBIASED_SELECTION ) &amp;&amp; ( !settings1-&gt;SLAC )  ) {</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;          err = GetDirection(settings1, interaction1, ray1-&gt;nrf_iceside[4], deltheta_em_max, deltheta_had_max, emfrac, hadfrac, vmmhz1m_max*bestcase_atten, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[whichray], ray1, sig1, interaction1-&gt;posnu, anita1, bn1, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, costhetanu, theta_threshold);</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;costhetanu is &quot; &lt;&lt; costhetanu &lt;&lt; endl; </span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;        }</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (src_model || settings1-&gt;HORIZON_OFFSET &gt; -999) </div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;        {</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = force_dir; </div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a> = 1; <span class="comment">//ugh </span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;          costhetanu = cos(force_dir.Theta()); </div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;          theta_threshold = 1; </div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;          err = 1; </div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;        }</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;SLAC) {</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;          <a class="code" href="../../d5/db2/class_vector.html">Vector</a> xaxis(1., 0., 0.);</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = xaxis.RotateY(bn1-&gt;theta_bn-settings1-&gt;SLAC_HORIZDIST/EarthModel::R_EARTH);  <span class="comment">//direction of neutrino- for slac,  that&#39;s the direction of the beam</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a> = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.RotateZ(bn1-&gt;phi_bn);</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;          costhetanu=cos(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Theta());</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;          theta_threshold=1.; <span class="comment">// this is a bogus theta_threshold but it is only used for plotting anyway</span></div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            fslac_viewangles &lt;&lt; bn1-&gt;sslacpositions[bn1-&gt;islacposition] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                viewangle_eachboresight[ilayer][ifold]=acos(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Dot(ray1-&gt;nrf_iceside_eachboresight[4][ilayer][ifold]));</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                fslac_viewangles &lt;&lt; ilayer &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; ifold &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; (viewangle_eachboresight[ilayer][ifold]-sig1-&gt;changle)*DEGRAD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;              }<span class="comment">//end ifold</span></div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;            }<span class="comment">//end ilayer</span></div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;          }<span class="comment">//end boresight</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;          err = 1; <span class="comment">// everything is a-okay</span></div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        }<span class="comment">//end else if slac</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;      }<span class="comment">//end tau trigger ==0</span></div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;</div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;</div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;      <span class="keywordflow">if</span> (havent_set_dir) </div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;      {</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setDir(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetX(), interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetY(), interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.GetZ()); </div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        havent_set_dir = <span class="keyword">false</span>; </div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      }</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;      <span class="comment">// gets angle between ray and neutrino direction</span></div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      viewangle = GetViewAngle(ray1-&gt;nrf_iceside[4], interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>);</div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;      <span class="keywordflow">if</span>(viewangle&gt;1.57 &amp;&amp; !settings1-&gt;SKIPCUTS) { <span class="comment">//discard the event if viewangle is greater than 90 degrees</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;        DO_SKIP</div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;      }</div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;      count1-&gt;nviewangle_lt_90[whichray]++; <span class="comment">// add to counter</span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;</div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;      <span class="keywordflow">if</span> (!Ray::WhereDoesItLeave(interaction1-&gt;posnu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, antarctica, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a6c8c85d125777b703ac5ac381606f994">nuexit</a>))</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;      {</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;       DO_SKIP <span class="comment">// doesn&#39;t give a real value from quadratic formula </span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;      }</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;      </div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;      GetBalloonLocation(interaction1, ray1, bn1, antarctica);</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;      </div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;      nuexitlength=interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a6c8c85d125777b703ac5ac381606f994">nuexit</a>);</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;      <span class="comment">// probability a tau would decay within this length at this</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;      <span class="comment">// energy</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;      nuexitice=interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d9fcec0d43f38c83f692ed19026fed8">nuexitice</a>);</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;      theta_threshold_deg=theta_threshold*DEGRAD;</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;      <span class="comment">// neutrino direction in frame where balloon is up,  0=east, 1=north, 2=up</span></div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;      n_nutraject_ontheground = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(bn1-&gt;n_east*interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>,  bn1-&gt;n_north*interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>,  bn1-&gt;n_bn*interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>);</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;      cosviewangle=cos(viewangle); <span class="comment">// cosine angle</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;      viewangle_deg=viewangle*DEGRAD; <span class="comment">// same angle but in degrees</span></div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      dviewangle_deg=(sig1-&gt;changle-viewangle)*DEGRAD; <span class="comment">// deviation from cerenkov angle</span></div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      <span class="keywordflow">if</span> (viewangletree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        viewangletree-&gt;Fill(); <span class="comment">// fills variables related to viewing angle</span></div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;      <span class="keywordflow">if</span> (neutrino_positiontree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        neutrino_positiontree-&gt;Fill(); <span class="comment">// fills variables related to neutrino position</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;      <span class="keywordflow">if</span> (whichray==1) {</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;        <span class="comment">//return it to the upgoing direction that is after being reflected</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        ray1-&gt;nrf_iceside[4] = ray1-&gt;nrf_iceside[4] + 2*chengji*ray1-&gt;nrf_iceside[0];</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;      }</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;      <span class="keywordflow">if</span> ( err == 0 ) {</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        count1-&gt;nbadfracs[whichray]++;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;        cout&lt;&lt;<span class="stringliteral">&quot;err==0,  so leaving.\n&quot;</span>;</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;        DO_SKIP</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;      }</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;      count1-&gt;ngoodfracs[whichray]++;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;</div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;      <span class="comment">// these variables are just for plotting</span></div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;      nsigma_em_threshold=theta_threshold/deltheta_em_max;</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;      nsigma_had_threshold=theta_threshold/deltheta_had_max;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      <span class="comment">// For each neutrino,  multiply the number of tries</span></div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="comment">// necessary to generate the appropriate direction,</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;      <span class="comment">// and the number of tries necessary to generate</span></div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;      <span class="comment">// an appropriate position,  and assume they are</span></div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;      <span class="comment">// independent.</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a>=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>*bn1-&gt;dtryingposition;</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;      <span class="comment">// for plotting aperture per ring radius from balloon</span></div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      index_distance=(int)(bn1-&gt;r_bn.SurfaceDistance(interaction1-&gt;posnu, bn1-&gt;surface_under_balloon) / (700000./(double)NBINS_DISTANCE));</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      <span class="comment">// where the neutrino enters the earth</span></div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      <span class="keywordflow">if</span> (tautrigger==0 &amp;&amp; !settings1-&gt;UNBIASED_SELECTION){<span class="comment">//did for cc-taus and unbaised selection already,  do for all other particles</span></div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;        interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a> = antarctica-&gt;WhereDoesItEnter(interaction1-&gt;posnu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>);</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;        antarctica-&gt;Getchord(<span class="keyword">false</span>, len_int_kgm2, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>, interaction1-&gt;pathlength_inice, settings1-&gt;UNBIASED_SELECTION  ==0,  interaction1-&gt;posnu, inu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>, </div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;            interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3ef3decda6e004ad20f541949a948ae0">weight_nu</a>, interaction1-&gt;nearthlayers, myair, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a46d7e538970790ac8d4eff1f9024af93">total_kgm2</a>, interaction1-&gt;crust_entered,  interaction1-&gt;mantle_entered, interaction1-&gt;core_entered);</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;interaction1-&gt;chord is &quot; &lt;&lt; interaction1-&gt;chord &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      }</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      <span class="comment">// total chord</span></div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      <span class="keywordtype">double</span> chord_kgm2_test=interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>)*sig1-&gt;RHOMEDIUM;</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      <span class="keywordtype">double</span> weight_test=0;  <span class="comment">// weight if the whole chord from interaction to earth entrance is ice.</span></div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;      <span class="comment">// take best case scenario chord length and find corresponding weight</span></div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;      IsAbsorbed(chord_kgm2_test, len_int_kgm2, weight_test);</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;      <span class="comment">// if the probably the neutrino gets absorbed is almost 1,  throw it out.</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;Cut on weights = &quot; &lt;&lt; settings1-&gt;CUTONWEIGHTS;</span></div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;      <span class="comment">//if ( bn1-&gt;WHICHPATH != 4 &amp;&amp; settings1-&gt;FORSECKEL != 1 &amp;&amp; !settings1-&gt;SKIPCUTS &amp;&amp; !settings1-&gt;SOURCE) {</span></div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;      <span class="keywordflow">if</span> ( bn1-&gt;WHICHPATH != 4 &amp;&amp; settings1-&gt;FORSECKEL != 1 &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;        <span class="keywordflow">if</span> (weight_test &lt; settings1-&gt;CUTONWEIGHTS) {</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;          DO_SKIP </div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        }</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;      }</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;      count_chanceofsurviving++;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;      <span class="comment">// theta of nu entrance point,  in earth frame</span></div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;      <span class="comment">// and latitude</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;      theta_in=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>.Theta();</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;      lat_in=-90+theta_in*DEGRAD;</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;      <span class="comment">// For studies which require the atmosphere</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;      myair=GetThisAirColumn(settings1,  interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, interaction1-&gt;posnu, col1, cosalpha, mytheta, cosbeta0, mybeta);</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;</div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      <span class="comment">// where the neutrino enters the ice</span></div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;      <span class="comment">// reject if it enters beyond the borders of the continent.</span></div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;      <span class="comment">// step size is 1/10 of interaction length</span></div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;FORSECKEL &amp;&amp; !settings1-&gt;UNBIASED_SELECTION) {</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        <span class="keywordflow">if</span> (!antarctica-&gt;WhereDoesItEnterIce(interaction1-&gt;posnu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, len_int_kgm2/sig1-&gt;RHOMEDIUM/10., interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>)) {</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;          <span class="comment">//r_enterice.Print();</span></div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;          <span class="keywordflow">if</span> (antarctica-&gt;OutsideAntarctica(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>)) {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Warning!  Neutrino enters beyond continent,  program is rejecting neutrino! inu = &quot;</span>&lt;&lt;inu&lt;&lt;endl;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;            <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;              cout&lt;&lt;<span class="stringliteral">&quot;Warning!  Neutrino enters beyond continent,  program is rejecting neutrino!&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;            DO_SKIP</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;          }<span class="comment">// end outside antarctica</span></div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        }<span class="comment">// end wheredoesitenterice</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;      }<span class="comment">// end if !settings forseckel &amp;&amp; unbiased</span></div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;      <span class="comment">// intermediate counter</span></div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;      count1-&gt;nentersice[whichray]++;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;      <span class="comment">// d1=earth entrance to rock-ice interface</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;      <span class="comment">// d2=rock-ice interface to position of neutrino interaction</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3fe851ac8a75b2ab8485e9c15d465a09">d1</a>=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>);</div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;posnu);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;      <span class="comment">// get a lower limit on the chord that the neutrino traverses,</span></div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;      <span class="comment">// so that later we can see if the signal is detectable in</span></div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;      <span class="comment">// the best case scenario.</span></div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;      <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus) {</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;Need to bring back GetFirstBang before you can simulate taus.\n&quot;</span>;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;I removed it because it required EarthModel and I wanted Secondaries to be a stand-alone class to use in the embedded simulation.\n&quot;</span>;</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        icethickness=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a6c8c85d125777b703ac5ac381606f994">nuexit</a>);</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;        interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">chord_kgm2_bestcase</a>=nuentrancelength*Tools::dMin(densities, 3);</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;      }</div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;        <span class="comment">// finds minimum chord (in kg/m^2) traversed by neutrino</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;        <span class="comment">// only keeping events with weight &gt; 10^-3</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;        <span class="comment">// periodically need to make sure this is still valid</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        <span class="comment">// chord_kgm2_bestcase=(d1+d2)*sig1-&gt;RHOMEDIUM;</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;        interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">chord_kgm2_bestcase</a>=(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3fe851ac8a75b2ab8485e9c15d465a09">d1</a>+interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>)*Tools::dMin(densities, 3);</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;      }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;      <span class="comment">// chord just through ice.</span></div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a9d37bb0ab6d96f72391206583c91d7a7">chord_kgm2_ice</a>=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>*sig1-&gt;RHOMEDIUM;</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;      <span class="keywordflow">if</span> (tree6-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;        tree6-&gt;Fill();</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;interaction1-&gt;chord_kgm2_bestcase = &quot; &lt;&lt; interaction1-&gt;chord_kgm2_bestcase &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;len_int_kgm2 = &quot; &lt;&lt; len_int_kgm2 &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;      <span class="comment">// take best case scenario chord length and find corresponding weight</span></div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;      IsAbsorbed(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">chord_kgm2_bestcase</a>, len_int_kgm2, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a5348445748bde8ee1c550a99127be2b3">weight_bestcase</a>);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;interaction1-&gt;weight_bestcase = &quot; &lt;&lt; interaction1-&gt;weight_bestcase &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;      <span class="comment">// if the probability that the neutrino gets absorbed is almost 1,  throw it out.</span></div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      <span class="comment">//if (bn1-&gt;WHICHPATH!=4 &amp;&amp; interaction1-&gt;weight_bestcase&lt;settings1-&gt;CUTONWEIGHTS &amp;&amp; !settings1-&gt;SKIPCUTS &amp;&amp; !settings1-&gt;FORSECKEL &amp;&amp; !settings1-&gt;SOURCE) {</span></div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH!=4 &amp;&amp; interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a5348445748bde8ee1c550a99127be2b3">weight_bestcase</a>&lt;settings1-&gt;CUTONWEIGHTS &amp;&amp; !settings1-&gt;SKIPCUTS &amp;&amp; !settings1-&gt;FORSECKEL) {</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Neutrino is getting absorbed and thrown out!&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;        DO_SKIP</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      }</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      <span class="comment">//intermediate counter</span></div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      count1-&gt;nabsorbed[whichray]++;</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;      <span class="comment">// intermediate counter</span></div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;      count1-&gt;nraywithincontinent1[whichray]++;</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;      <span class="comment">// now we have second guess for rf exit point,  which is</span></div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;      <span class="comment">// pretty close to the right answer.</span></div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;      <span class="comment">// now get our best case attenuation again,</span></div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      <span class="comment">// and see if we can reject the event.</span></div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;      <span class="keywordflow">if</span> (whichray==0)</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;        bestcase_atten=exp(-1*ray1-&gt;rfexit[1].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;posnu)/MAX_ATTENLENGTH);</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      <span class="keywordflow">if</span> (whichray==1)</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;        bestcase_atten=exp(-1*ray1-&gt;rfexit[1].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(interaction1-&gt;posnu_down)/MAX_ATTENLENGTH);<span class="comment">//use the real distance</span></div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;      <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/((hadfrac+emfrac)*vmmhz1m_max*bestcase_atten/interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[whichray]*heff_max*anita1-&gt;bwmin/1.E6)&gt;settings1-&gt;CHANCEINHELL_FACTOR &amp;&amp; !settings1-&gt;SKIPCUTS &amp;&amp; !settings1-&gt;FORSECKEL) {</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Event rejected.  Check.&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;        <span class="comment">//</span></div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;        DO_SKIP</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;      }</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;      count_chanceinhell0++;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;      <span class="comment">// intermediate counting</span></div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;      count1-&gt;nraypointsup2[whichray]++;</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;     </div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;      <span class="keywordtype">double</span> nbelowsurface;</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;      <span class="comment">// reject if it is totally internally reflected at the surface AND NOT CONSIDERING ROUGHNESS</span></div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;FIRN)</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;        nbelowsurface=NFIRN;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;        nbelowsurface=sig1-&gt;NICE;</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;      <span class="comment">// this is purely a sanity check.</span></div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      <span class="comment">// if everything is working,  events should pass with 100% efficiency</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS &amp;&amp; TIR(ray1-&gt;nsurf_rfexit, ray1-&gt;nrf_iceside[3], nbelowsurface, sig1-&gt;N_AIR)) {</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        DO_SKIP</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;      }</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;      count1-&gt;nnottir[whichray]++;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;</div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="comment">// this sets n_exit2bn[2] to the ray from the exit point to the balloon,</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      <span class="comment">// last iteration.  Now we&#39;re ready to do some calculations!!!!</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      ray1-&gt;GetRFExit(settings1, anita1, whichray, interaction1-&gt;posnu, interaction1-&gt;posnu_down, bn1-&gt;r_bn, bn1-&gt;r_boresights, 2, antarctica);</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      count1-&gt;nraywithincontinent2[whichray]++;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="comment">// for plotting- cos(theta) of neutrino direction standing on earth below balloon.</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a>=(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>*bn1-&gt;r_bn)/sqrt(bn1-&gt;r_bn*bn1-&gt;r_bn);</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;     </div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;      theta_nnu_atbn = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Angle(bn1-&gt;r_bn); <span class="comment">// polar angle of neutrino direction as seen at the balloon.  </span></div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;      theta_rf_atbn = ray1-&gt;n_exit2bn[2].Angle(bn1-&gt;r_bn); <span class="comment">// polar angle of the rf signal as seen at the balloon.</span></div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;      <span class="comment">// measured theta of the rf,  which is actual smeared by SIGMA_THETA,  whose default is 0.5 degrees.</span></div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;      theta_rf_atbn_measured = theta_rf_atbn+getRNG(RNG_THETA_RF_RESOLUTION)-&gt;Gaus()*anita1-&gt;SIGMA_THETA;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8949fd35ed92144d9f9de770d778a59d">r_exit2bn</a>=bn1-&gt;r_bn.Distance(ray1-&gt;rfexit[2]);</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0be48e99fca7d0dfc99fdf4e01b386e3">r_exit2bn_measured</a>=bn1-&gt;altitude_bn/cos(theta_rf_atbn_measured);</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;      theta_nnu_rf_diff_atbn = theta_nnu_atbn - theta_rf_atbn;</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;nnu : &quot; &lt;&lt; interaction1-&gt;nnu &lt;&lt; &quot; n_bn : &quot; &lt;&lt; bn1-&gt;n_bn &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;acos of costheta nutraject &quot; &lt;&lt; DEGRAD*acos(interaction1-&gt;costheta_nutraject) &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Oindree: theta nnu, rf, diff at bn &quot; &lt;&lt; DEGRAD * theta_nnu_atbn &lt;&lt; &quot; &quot; &lt;&lt; DEGRAD * theta_rf_atbn &lt;&lt; &quot; &quot; &lt;&lt; DEGRAD * theta_nnu_rf_diff_atbn &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;      </div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;      nnu_xy.SetX((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>[0]) - (bn1-&gt;r_bn[0])*((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;      nnu_xy.SetY((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>[1]) - (bn1-&gt;r_bn[1])*((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;      nnu_xy.SetZ((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>[2]) - (bn1-&gt;r_bn[2])*((interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;      rf_xy.SetX((ray1-&gt;n_exit2bn[2][0]) - (bn1-&gt;r_bn[0])*((ray1-&gt;n_exit2bn[2]*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;      rf_xy.SetY((ray1-&gt;n_exit2bn[2][1]) - (bn1-&gt;r_bn[1])*((ray1-&gt;n_exit2bn[2]*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;      rf_xy.SetZ((ray1-&gt;n_exit2bn[2][2]) - (bn1-&gt;r_bn[2])*((ray1-&gt;n_exit2bn[2]*bn1-&gt;r_bn)/(bn1-&gt;r_bn*bn1-&gt;r_bn)));</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      r_bn_xy.SetX(bn1-&gt;r_bn[0]);</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;      r_bn_xy.SetY(bn1-&gt;r_bn[1]);</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      phi_nnu_atbn = nnu_xy.Angle(r_bn_xy);</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      phi_rf_atbn = rf_xy.Angle(r_bn_xy);  </div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;      <span class="comment">//phi_nnu_rf_diff_atbn = nnu_xy.Angle(rf_xy);</span></div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160; </div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;phi diff between rf and nnu &quot; &lt;&lt; DEGRAD*phi_nnu_rf_diff_atbn &lt;&lt; &quot;\n&quot;;  </span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;</div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;      <span class="comment">//phi_nnu_rf_diff_atbn = acos(nnu_xy*rf_xy/((sqrt(nnu_xy*nnu_xy))*(sqrt(rf_xy*rf_xy)))); </span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;      </div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;phi diff between rf and nnu &quot; &lt;&lt; DEGRAD*phi_nnu_rf_diff_atbn &lt;&lt; &quot;\n&quot;;  </span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      phi_nnu_rf_diff_atbn = phi_nnu_atbn - phi_rf_atbn;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;      <span class="comment">//if (phi_nnu_rf_diff_atbn &lt; -180) phi_nnu_rf_diff_atbn += 360;</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      <span class="comment">//if (phi_nnu_rf_diff_atbn &gt; 180) phi_nnu_rf_diff_atbn -= 360;  </span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;      </div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Oindree: phi nnu, rf, diff at bn &quot; &lt;&lt; DEGRAD * phi_nnu_atbn &lt;&lt; &quot; &quot; &lt;&lt; DEGRAD * phi_rf_atbn &lt;&lt; &quot; &quot; &lt;&lt; DEGRAD * phi_nnu_rf_diff_atbn &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <span class="keywordflow">if</span>((settings1-&gt;WHICH == 2 || settings1-&gt;WHICH == 6) &amp;&amp; theta_rf_atbn &lt; 0.3790091) {</div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        DO_SKIP <span class="comment">// the deck will mess up the arrival times in the top ring</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;      }</div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      <span class="comment">// reject if the rf leaves the ice where there is water,  for example.</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;      <span class="keywordflow">if</span> (!antarctica-&gt;AcceptableRfexit(ray1-&gt;nsurf_rfexit, ray1-&gt;rfexit[2], ray1-&gt;n_exit2bn[2])){</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Should look at this. Not expecting to be here.&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        DO_SKIP </div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      }<span class="comment">//end if acceptableRFexit</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;      <span class="comment">// intermediate counting</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      count1-&gt;nacceptablerf[whichray]++;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      <span class="comment">// difference between exit points of 2nd and 3rd iterations.</span></div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;      diff_3tries=ray1-&gt;rfexit[1].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[2]);</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      <span class="keywordflow">if</span> (tree5-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1  &amp;&amp; bn1-&gt;WHICHPATH != 3)</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        tree5-&gt;Fill();</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <span class="comment">// reject if 2nd and 3rd tries</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="comment">// don&#39;t converge within 10m.</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;      <span class="keywordflow">if</span> (diff_3tries&gt;10) {</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;        DO_SKIP</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;      }</div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      count1-&gt;nconverges[whichray]++;</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;      <span class="comment">// Get Polarization vector.  See Jackson,  Cherenkov section.</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;      n_pol = GetPolarization(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, ray1-&gt;nrf_iceside[4]);</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;:(spec)  v_nu &quot;&lt;&lt;interaction1-&gt;nnu&lt;&lt;&quot; : 2IP &quot;&lt;&lt;ray1-&gt;nrf_iceside[4]&lt;&lt;&quot; : inc npol&quot;&lt;&lt;n_pol&lt;&lt; endl;</span></div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;  &quot;&lt;&lt;ray1-&gt;rfexit[2]&lt;&lt;endl;</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            n_pol_eachboresight[ilayer][ifold]=GetPolarization(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, ray1-&gt;nrf_iceside_eachboresight[4][ilayer][ifold]);</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;          } <span class="comment">// end looping over antennas in phi</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        } <span class="comment">// end looping over layers</span></div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;      } <span class="comment">// if we are calculating for all boresights</span></div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="comment">//if(!settings1-&gt;ROUGHNESS){</span></div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;FIRN){</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;          <span class="comment">// now rotate that polarization vector according to ray paths in firn and air.</span></div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;          <span class="comment">// fresnel factor at ice-firn interface</span></div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;          GetFresnel(rough1, settings1-&gt;ROUGHNESS, ray1-&gt;nsurf_rfexit, ray1-&gt;nrf_iceside[3], n_pol, ray1-&gt;nrf_iceside[4], vmmhz1m_max, emfrac, hadfrac, deltheta_em_max, deltheta_had_max, t_coeff_pokey, t_coeff_slappy, fresnel1, mag1);</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;Lentenin factor is &quot;</span> &lt;&lt; 1./mag1 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;          <span class="comment">//The gradual transition in the firn means that there is no fresnel factor,  only magnification</span></div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;          <span class="comment">// and the magnification factor is upside down compared to what it is</span></div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;          <span class="comment">// for the firn-air interface</span></div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;          vmmhz1m_fresneledonce = vmmhz1m_max/mag1;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;          <span class="comment">//  get fresnel factor at firn-air interface</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;          GetFresnel(rough1, settings1-&gt;ROUGHNESS, ray1-&gt;nsurf_rfexit, ray1-&gt;n_exit2bn[2], n_pol, ray1-&gt;nrf_iceside[3], vmmhz1m_fresneledonce, emfrac, hadfrac, deltheta_em_max, deltheta_had_max, t_coeff_pokey, t_coeff_slappy, fresnel2, mag2);</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;          <span class="comment">// use both fresnel and magnification factors at firn-air interface.  Notice that magnification factor is</span></div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;          <span class="comment">//upside-down compared to what it is in the firn.</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;          vmmhz1m_fresneledtwice=vmmhz1m_fresneledonce*fresnel2*mag2;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;</div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                GetFresnel(rough1, settings1-&gt;ROUGHNESS, ray1-&gt;nsurf_rfexit, ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold],</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                  n_pol_eachboresight[ilayer][ifold], ray1-&gt;nrf_iceside_eachboresight[3][ilayer][ifold],</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                  vmmhz1m_max, emfrac, hadfrac, deltheta_em_max, deltheta_had_max, t_coeff_pokey, t_coeff_slappy,</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;                  fresnel1_eachboresight[ilayer][ifold], mag1_eachboresight[ilayer][ifold]);</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;          <span class="comment">//    std::cout &lt;&lt; fresnel1_eachboresight[ilayer][ifold] &lt;&lt; std::endl;</span></div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;              } <span class="comment">// end looping over phi sectors</span></div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            } <span class="comment">// end looping over layers</span></div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;          } <span class="comment">// end if we are calculating for all boresights</span></div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;firn-air interface:  fresnel2,  mag2 are &quot;</span>&lt;&lt;fresnel2&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt; mag2 &lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        }<span class="comment">//end if firn</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;          sig1-&gt;GetSpread(pnu, emfrac, hadfrac, (anita1-&gt;bwslice_min[2]+anita1-&gt;bwslice_max[2])/2., deltheta_em_mid2, deltheta_had_mid2);</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;          GetFresnel(rough1, settings1-&gt;ROUGHNESS, ray1-&gt;nsurf_rfexit, ray1-&gt;n_exit2bn[2], n_pol, ray1-&gt;nrf_iceside[4], vmmhz1m_max, emfrac, hadfrac, deltheta_em_mid2, deltheta_had_mid2, t_coeff_pokey, t_coeff_slappy,  fresnel1, mag1);</div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;          vmmhz1m_fresneledtwice = vmmhz1m_max*fresnel1*mag1;  <span class="comment">//  only the ice-air interface</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;            <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;              <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                GetFresnel(rough1, settings1-&gt;ROUGHNESS, ray1-&gt;nsurf_rfexit, ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold], n_pol_eachboresight[ilayer][ifold], ray1-&gt;nrf_iceside_eachboresight[4][ilayer][ifold], vmmhz1m_max, emfrac, hadfrac, deltheta_em_max, deltheta_had_max, t_coeff_pokey, t_coeff_slappy, fresnel1_eachboresight[ilayer][ifold], mag1_eachboresight[ilayer][ifold]);</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;              } <span class="comment">// end looping over phi sectors</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            } <span class="comment">// end looping over layers</span></div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;          } <span class="comment">// end if we are calculating for all boresights</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        }<span class="comment">//end else firn</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot; -- here&quot;&lt;&lt;endl;      //}</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      <span class="comment">// OTHERWISE THERE IS ROUGHNESS SO DO MAGIC</span></div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;      <span class="keywordflow">if</span>(settings1-&gt;ROUGHNESS){<span class="comment">//else{</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        <span class="comment">//(vector) ray1-&gt;nsurf_rfexit:  surface normal at RFexit position</span></div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        <span class="comment">//(pos)        -&gt;rfexit[2]:     final iterated position of RF exit</span></div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        <span class="comment">//(vector)     -&gt;n_exit2bn[2]:  vector from RF exit position TO balloon</span></div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;        <span class="comment">//(pos)    bn1-&gt;r_bn:           position of balloon</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;        <span class="comment">//(vector) n_pol:               polarization vector</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;        <span class="comment">//(pos)    posnu:               position of neutrino interaction</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;        <span class="keywordtype">int</span> num_validscreenpoints = 0;</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;        <a class="code" href="../../d7/d3b/class_position.html">Position</a> pos_current;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_pos_current_to_balloon;</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;        <a class="code" href="../../d7/d3b/class_position.html">Position</a> pos_projectedImpactPoint;</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_localnormal;         <span class="comment">//normalized, normal vector at projected ground point</span></div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_nnu_to_impactPoint;  <span class="comment">//normalized</span></div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_inc_perp;            <span class="comment">//normalized, vector perp. to incident and surface normal (out-of-inc place)</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_inc_parl;            <span class="comment">//normalized, vector parl. to incident and surface normal (in-inc plane)</span></div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;        <span class="keywordtype">double</span> pol_perp_inc, pol_parl_inc;  <span class="comment">//component of incident polarization</span></div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_local_grnd_perp;     <span class="comment">//normalized, vector perp. to transmitted and surface normal (out-of-trans place)</span></div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_local_grnd_parl;     <span class="comment">//normalized, vector parl. to transmitted and surface normal (in-trans plane)</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;        <span class="keywordtype">double</span> pol_perp_trans, pol_parl_trans;  <span class="comment">//component of transmitted polarization</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_grndcomp2bln;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> vec_grndcomp2IP;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;        <span class="keywordtype">double</span> time_reference_specular, time_reference_local;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;        <span class="keywordtype">double</span> pathlength_local;        <span class="comment">// set for each screen point</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <span class="keywordtype">double</span> viewangle_local;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;        <span class="keywordtype">double</span> azimuth_local;           <span class="comment">// azimuthal angle between local surface normal and vector to balloon [radians]</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;        <span class="keywordtype">double</span> theta_local;             <span class="comment">// polar angle between local surface normal and vector to balloon [radians]</span></div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;        <span class="keywordtype">double</span> theta_0_local;                 <span class="comment">//angle between local surface normal and incident direction [radians]</span></div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;        <span class="keywordtype">double</span> tcoeff_perp_polperp, tcoeff_parl_polperp;  <span class="comment">//for perpendicular polarization (in-ground comp)</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        <span class="keywordtype">double</span> tcoeff_perp_polparl, tcoeff_parl_polparl;  <span class="comment">//for parallel polarization</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;        <span class="keywordtype">double</span> power_perp_polperp, power_parl_polperp;</div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;        <span class="keywordtype">double</span> power_perp_polparl, power_parl_polparl;</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        power_perp_polperp = power_parl_polperp = power_perp_polparl = power_parl_polparl = 0.;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <span class="keywordtype">double</span> fresnel_r, mag_r;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> npol_local_inc, npol_local_trans;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> temp_a;</div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;        <span class="keywordtype">double</span> Emag_local;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        <span class="keywordtype">double</span> taperfactor;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;: &quot;&lt;&lt;vmmhz1m_max&lt;&lt;endl;</span></div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;        <span class="comment">//double pathlength_specular = interaction1-&gt;posnu.Distance(ray1-&gt;rfexit[2]) + ray1-&gt;rfexit[2].Distance(bn1-&gt;r_bn);</span></div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;FIRN)</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;          time_reference_specular = (interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[2])*NFIRN / CLIGHT) + (ray1-&gt;rfexit[2].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn)/CLIGHT);</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;          time_reference_specular = (interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[2])*NICE / CLIGHT) + (ray1-&gt;rfexit[2].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn)/CLIGHT);</div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;        <span class="keywordtype">double</span> slopeyx, slopeyy, slopeyz, rtemp;</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> ntemp2;</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> xaxis = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(1.,0.,0.);</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> yaxis = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(0.,1.,0.);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> zaxis = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(0.,0.,1.);</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;</div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        <span class="keywordtype">double</span> basescreenedgelength = settings1-&gt;SCREENEDGELENGTH;</div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;        <span class="keywordtype">double</span> grd_stepsize = settings1-&gt;SCREENSTEPSIZE;</div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;        <span class="keywordtype">int</span> grd_nsteps;</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        <span class="keywordflow">if</span>(settings1-&gt;ROUGHSIZE&gt;0)</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;          grd_nsteps = int(basescreenedgelength/2. / grd_stepsize);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;          grd_nsteps = 0;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;        <span class="comment">//#########</span></div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        <span class="comment">//iterate points on the screen, get their position and project back to find ground impact</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="comment">//calculate incident and transmitted angles, look up power fraction, and add to running total</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="comment">//reset</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;        panel1-&gt;ResetParameters();</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;        panel1-&gt;SetNsamples( grd_nsteps );</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        panel1-&gt;SetEdgeLength( grd_stepsize );</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        panel1-&gt;SetCentralPoint( ray1-&gt;rfexit[2] );</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;        vec_localnormal = antarctica-&gt;GetSurfaceNormal(ray1-&gt;rfexit[2]).Unit();</div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;        panel1-&gt;SetNormal( vec_localnormal );</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;        panel1-&gt;SetCosineProjectionFactor( 1. );</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;        panel1-&gt;SetUnitY( (vec_localnormal.Cross(ray1-&gt;n_exit2bn[2])).Unit() );</div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        panel1-&gt;SetUnitX( (panel1-&gt;GetUnitY().Cross(vec_localnormal)).Unit() );</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;<span class="comment">//cerr&lt;&lt;panel1-&gt;GetCentralPoint()&lt;&lt;&quot;  &quot;&lt;&lt;  bn1-&gt;r_bn&lt;&lt;endl;</span></div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        <span class="comment">// loop over grid point on ground and see if it&#39;s valid</span></div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ii= -2*panel1-&gt;GetNsamples(); ii&lt; 2*panel1-&gt;GetNsamples()+1; ii++){</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj= -2*panel1-&gt;GetNsamples(); jj&lt; 2*panel1-&gt;GetNsamples()+1; jj++){</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;+++++++++++++&quot;&lt;&lt;endl;</span></div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;: &quot;&lt;&lt;ii&lt;&lt;&quot;  &quot;&lt;&lt;jj&lt;&lt;endl;</span></div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="comment">//cerr&lt;&lt;&quot;+ seed point: &quot;&lt;&lt;jj&lt;&lt;&quot; / &quot;&lt;&lt;panel1-&gt;GetNsamples()*panel1-&gt;GetNsamples()&lt;&lt;endl;</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;            Emag_local = vmmhz1m_max;</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;            taperfactor = fresnel_r = mag_r =  1.;</div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;            tcoeff_perp_polparl = tcoeff_parl_polparl = 0.;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;            tcoeff_perp_polperp = tcoeff_parl_polperp = 0.;</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;            pos_projectedImpactPoint = panel1-&gt;GetPosition(ii, jj);        <span class="comment">// this gets the new screen position</span></div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;            vec_pos_current_to_balloon = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>( bn1-&gt;r_bn[0] - pos_projectedImpactPoint[0], bn1-&gt;r_bn[1] - pos_projectedImpactPoint[1], bn1-&gt;r_bn[2] - pos_projectedImpactPoint[2] );</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;            <span class="comment">// local angles of transmission and incidence in their respective planes</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;            vec_localnormal = antarctica-&gt;GetSurfaceNormal(pos_projectedImpactPoint).Unit();</div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;SLOPEY) {</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                slopeyx=ray1-&gt;slopeyx;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;                slopeyy=ray1-&gt;slopeyy;</div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;                slopeyz=ray1-&gt;slopeyz;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;                ntemp2 = vec_localnormal + slopeyx*xaxis + slopeyy*yaxis + slopeyz*zaxis;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;                ntemp2 = ntemp2 / ntemp2.Mag();</div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;                rtemp= ntemp2 * vec_localnormal;</div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;                <span class="keywordflow">if</span> (rtemp&lt;=1) {</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;                  vec_localnormal = ntemp2;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;                }<span class="comment">//if</span></div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;            }<span class="comment">//end local slopeyness</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;  &quot;&lt;&lt;pos_projectedImpactPoint&lt;&lt;endl;</span></div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;            vec_nnu_to_impactPoint =  <a class="code" href="../../d5/db2/class_vector.html">Vector</a>( pos_projectedImpactPoint[0]-interaction1-&gt;posnu[0], pos_projectedImpactPoint[1]-interaction1-&gt;posnu[1], pos_projectedImpactPoint[2]-interaction1-&gt;posnu[2] ).Unit();</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            vec_grndcomp2IP = (vec_nnu_to_impactPoint - (vec_nnu_to_impactPoint.Dot(vec_localnormal)*vec_localnormal)).Unit();</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;            vec_grndcomp2bln = (vec_pos_current_to_balloon - (vec_pos_current_to_balloon.Dot(vec_localnormal)*vec_localnormal)).Unit();</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;            temp_a = vec_localnormal.Cross(vec_pos_current_to_balloon).Unit();</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;            azimuth_local = vec_grndcomp2IP.Angle(vec_grndcomp2bln); <span class="comment">//[rad]</span></div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            <span class="keywordflow">if</span>( temp_a.Dot(vec_nnu_to_impactPoint) &lt; 0 )</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;              azimuth_local *= -1.;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;            <span class="keywordflow">if</span>( panel1-&gt;GetCentralPoint().Distance(pos_projectedImpactPoint)&lt;0.75*grd_stepsize ){</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;              azimuth_local = 0.;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;            }</div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;:  &quot;&lt;&lt;jj&lt;&lt;&quot;  &quot;&lt;&lt;vec_grndcomp2IP&lt;&lt;&quot; : &quot;&lt;&lt;vec_grndcomp2bln&lt;&lt;&quot; : &quot;&lt;&lt;azimuth_local*180./PI&lt;&lt;endl;</span></div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;            theta_local = vec_localnormal.Angle( (<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a>)vec_pos_current_to_balloon ); <span class="comment">//[rad]</span></div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;            theta_0_local = vec_localnormal.Angle(vec_nnu_to_impactPoint); <span class="comment">//[rad]</span></div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;  &quot;&lt;&lt;ii&lt;&lt;&quot;  &quot;&lt;&lt;jj&lt;&lt;&quot;;  &quot;&lt;&lt;panel1-&gt;GetCentralPoint()&lt;&lt;&quot; : &quot;&lt;&lt;  pos_projectedImpactPoint&lt;&lt;&quot; : &quot;&lt;&lt;theta_local*180./PI&lt;&lt;&quot;  &quot;&lt;&lt;theta_0_local*180./PI&lt;&lt;&quot;  &quot;&lt;&lt; azimuth_local*180./PI&lt;&lt; endl;</span></div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;<span class="comment">//cerr&lt;&lt; panel1-&gt;GetCentralPoint() - pos_projectedImpactPoint&lt;&lt;endl;</span></div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;            <span class="keywordflow">if</span>( isnan(theta_local) | isnan(theta_0_local) | isnan(azimuth_local) ){</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;              <span class="keywordflow">continue</span>;  </div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;            }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;            viewangle_local = GetViewAngle(vec_nnu_to_impactPoint, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>);</div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;            <span class="comment">// at this point, only figure out if taper will kill the geometry, but don&#39;t actually apply the factor</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;            deltheta_em[0]=deltheta_em_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[0];</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;            deltheta_had[0]=deltheta_had_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[0];</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;            sig1-&gt;TaperVmMHz(viewangle_local, deltheta_em[0], deltheta_had[0], emfrac, hadfrac, taperfactor, vmmhz_em[0]);<span class="comment">// this applies the angular dependence.</span></div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;            <span class="keywordflow">if</span>(taperfactor==0)</div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;            {</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;              <span class="keywordflow">continue</span>; </div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;            }</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt; &quot;: past E=0&quot;&lt;&lt;endl;</span></div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;<span class="comment"></span>            <span class="comment">// Field Magnitude</span></div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="preprocessor">  #ifdef USE_HEALPIX</span></div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;FIRN)</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;              rough1-&gt;InterpolatePowerValue(power_perp_polperp, power_parl_polperp, power_perp_polparl, power_parl_polparl, theta_0_local*180./PI, theta_local*180./PI, azimuth_local *180./PI);</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;              rough1-&gt;InterpolatePowerValue(power_perp_polperp, power_parl_polperp, power_perp_polparl, power_parl_polparl, theta_0_local*180./PI, theta_local*180./PI, azimuth_local *180./PI);</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;<span class="preprocessor">  #endif</span></div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;P: &quot;&lt;&lt;power_perp&lt;&lt;&quot;  &quot;&lt;&lt;power_parl&lt;&lt;std::endl;</span></div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;            <span class="keywordflow">if</span>( (power_perp_polperp==0.)&amp;(power_parl_polperp==0.)&amp;(power_perp_polparl==0.)&amp;(power_parl_polparl==0.) ){</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;              <span class="keywordflow">continue</span>;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;            }</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;survived power cut&quot;&lt;&lt;endl;</span></div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;FIRN){</div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;              tcoeff_perp_polparl = sqrt(power_perp_polparl);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;              tcoeff_parl_polparl = sqrt(power_parl_polparl);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;              tcoeff_perp_polperp = sqrt(power_perp_polperp);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;              tcoeff_parl_polperp = sqrt(power_parl_polperp);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;            }</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;            <span class="keywordflow">else</span>{</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;              tcoeff_perp_polparl = sqrt(power_perp_polparl);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;              tcoeff_parl_polparl = sqrt(power_parl_polparl);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;              tcoeff_perp_polperp = sqrt(power_perp_polperp);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;              tcoeff_parl_polperp = sqrt(power_parl_polperp);<span class="comment">//*NFIRN*cos(theta_0_local)*cos(theta_local));</span></div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;            }</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;T: &quot;&lt;&lt;tcoeff_perp&lt;&lt;&quot;  &quot;&lt;&lt;tcoeff_parl&lt;&lt;std::endl;</span></div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;T (spec): &quot;&lt;&lt;t_coeff_slappy&lt;&lt;&quot;  &quot;&lt;&lt;t_coeff_pokey&lt;&lt;std::endl;</span></div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;            <span class="comment">//Emag_local *= sqrt((tcoeff_perp*tcoeff_perp + tcoeff_parl*tcoeff_parl)) * mag_r;// * (antennalength*antennalength/(vec_pos_current_to_balloon.Mag()*vec_pos_current_to_balloon.Mag()))/HP_64_binarea);</span></div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;E: &quot;&lt;&lt;Emag_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;            <span class="comment">// account for 1/r for 1)interaction point to impact point and 2)impact point to balloon, and attenuation in ice</span></div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;            pathlength_local = interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(pos_projectedImpactPoint) + pos_projectedImpactPoint.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn);</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;P: &quot;&lt;&lt;pathlength_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;            Emag_local /= pathlength_local ;</div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;E: &quot;&lt;&lt;Emag_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;            Attenuate(antarctica, settings1, Emag_local,  interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(pos_projectedImpactPoint),  interaction1-&gt;posnu);</div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;E: &quot;&lt;&lt;Emag_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;<span class="comment"></span>            <span class="comment">// Incident and Transmitted Polarizations</span></div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;            <span class="comment">// set incident polarization</span></div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;            npol_local_inc = GetPolarization(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, vec_nnu_to_impactPoint).Unit();</div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;            vec_inc_perp = (vec_localnormal.Cross(vec_nnu_to_impactPoint)).Unit();</div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;            vec_inc_parl = (vec_nnu_to_impactPoint.Cross(vec_inc_perp)).Unit();</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;            pol_perp_inc = npol_local_inc * vec_inc_perp;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;            pol_parl_inc = npol_local_inc * vec_inc_parl;</div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            pol_perp_trans = pol_perp_inc * tcoeff_perp_polperp + pol_perp_inc * tcoeff_perp_polparl;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;            pol_parl_trans = pol_parl_inc * tcoeff_parl_polparl + pol_parl_inc * tcoeff_parl_polperp;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;            vec_local_grnd_perp = (vec_localnormal.Cross(vec_pos_current_to_balloon)).Unit();</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;            vec_local_grnd_parl = (vec_pos_current_to_balloon.Cross(vec_local_grnd_perp)).Unit();</div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;            <span class="comment">// set transmitted polarization</span></div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;            npol_local_trans= (pol_perp_trans*vec_local_grnd_perp + pol_parl_trans*vec_local_grnd_parl).Unit();</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;<span class="comment">//cerr&lt;&lt;inu&lt;&lt;&quot;:  v_nu &quot;&lt;&lt;interaction1-&gt;nnu&lt;&lt;&quot; : 2IP &quot;&lt;&lt;vec_nnu_to_impactPoint&lt;&lt;&quot; : npol &quot;&lt;&lt;npol_local_trans&lt;&lt; endl;</span></div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;            <span class="comment">// check if transmitted polarization is undefined</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            <span class="keywordflow">if</span>( isnan(npol_local_trans[0]) ){</div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;              <span class="keywordflow">continue</span>;  </div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;            }</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;past pol cut&quot;&lt;&lt;endl;</span></div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            fresnel_r = sqrt( pow(vmmhz1m_max*pol_perp_trans,2) + pow(vmmhz1m_max*pol_parl_trans,2) ) / vmmhz1m_max;</div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;            mag_r = sqrt( tan(theta_0_local) / tan(theta_local) );</div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;            Emag_local *= fresnel_r * mag_r;</div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;E: &quot;&lt;&lt;Emag_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;FIRN)</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;              time_reference_local = (interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(pos_projectedImpactPoint)*NFIRN / CLIGHT) + (pos_projectedImpactPoint.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn)/CLIGHT);</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;              time_reference_local = (interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(pos_projectedImpactPoint)*NICE / CLIGHT) + (pos_projectedImpactPoint.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn)/CLIGHT);</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;            <span class="comment">// increment counter so we can track the size of the screen&#39;s vector arrays</span></div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;            num_validscreenpoints++;</div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;            <span class="comment">//add the contribution to the running total</span></div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;            panel1-&gt;AddVmmhz0(Emag_local);                <span class="comment">// pre-taper Efield</span></div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            panel1-&gt;AddVec2bln(vec_pos_current_to_balloon);</div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;            panel1-&gt;AddPol(npol_local_trans);</div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;            panel1-&gt;AddDelay( time_reference_specular - time_reference_local );</div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;            panel1-&gt;AddImpactPt(pos_projectedImpactPoint);</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;            panel1-&gt;AddViewangle(viewangle_local);</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;            panel1-&gt;AddIncidenceAngle(theta_0_local);</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;            panel1-&gt;AddTransmissionAngle(theta_local);</div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;            panel1-&gt;AddWeight( (panel1-&gt;GetEdgeLength() / panel1-&gt;GetNsamples()) * (panel1-&gt;GetEdgeLength() / panel1-&gt;GetNsamples()) );</div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;            panel1-&gt;AddFacetLength(panel1-&gt;GetEdgeLength() / panel1-&gt;GetNsamples());</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;            panel1-&gt;AddTparallel_polParallel(tcoeff_parl_polparl);</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;            panel1-&gt;AddTperpendicular_polParallel(tcoeff_perp_polparl);</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            panel1-&gt;AddTparallel_polPerpendicular(tcoeff_parl_polperp);</div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;            panel1-&gt;AddTperpendicular_polPerpendicular(tcoeff_perp_polperp);</div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  <span class="comment">//cerr&lt;&lt;pos_current&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  <span class="comment">//&lt;&lt;Emag_local&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;  <span class="comment">//&lt;&lt;npol_local_trans&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;  <span class="comment">//&lt;&lt;(pathlength_specular-pathlength_local) / CLIGHT&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;  <span class="comment">//&lt;&lt;pos_projectedImpactPoint&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;  <span class="comment">//&lt;&lt;viewangle_local&lt;&lt;std::endl;</span></div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;          }<span class="comment">// end for jj </span></div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;        }<span class="comment">// end for ii</span></div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;</div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;        panel1-&gt;SetNvalidPoints(num_validscreenpoints);</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;        <span class="comment">//now construct the Screen&#39;s vmmhz array for all points, so it gets passed to the trigger object later to make the waveforms</span></div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="comment">// here we get the array vmmhz by taking vmmhz1m_max (signal at lowest frequency bin) and vmmhz_max (signal at lowest frequency after applying 1/r factor and attenuation factor) and making an array across frequency bins by putting in frequency dependence.</span></div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;        <span class="keywordtype">double</span> validScreenSummedArea = 0.;</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;        <span class="keywordtype">double</span> vmmhz_local_array[Anita::NFREQ];</div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jj=0; jj&lt;panel1-&gt;GetNvalidPoints(); jj++){</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;          <span class="comment">// fill the frequency array vmmhz_local_array</span></div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;          sig1-&gt;GetVmMHz(panel1-&gt;GetVmmhz0(jj), vmmhz1m_max, pnu, anita1-&gt;freq, anita1-&gt;NOTCH_MIN, anita1-&gt;NOTCH_MAX, vmmhz_local_array, Anita::NFREQ);</div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;          <span class="comment">// apply the off-angle tapering</span></div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++) {</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;            deltheta_em[k]=deltheta_em_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[k];</div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;            deltheta_had[k]=deltheta_had_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[k];</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;            sig1-&gt;TaperVmMHz(panel1-&gt;GetViewangle(jj), deltheta_em[k], deltheta_had[k], emfrac, hadfrac, vmmhz_local_array[k], vmmhz_em[k]);<span class="comment">// this applies the angular dependence.</span></div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            panel1-&gt;AddVmmhz_freq(vmmhz_local_array[k]);</div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;          }</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;          validScreenSummedArea += panel1-&gt;GetWeight(jj);</div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;        }<span class="comment">//end jj over panel Nvalid points</span></div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;        panel1-&gt;SetWeightNorm(validScreenSummedArea);</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        vmmhz_max = 0.;</div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jj=0; jj&lt;panel1-&gt;GetNvalidPoints(); jj++){</div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          vmmhz_max = Tools::dMax(vmmhz_max, panel1-&gt;GetVmmhz_freq(jj*Anita::NFREQ));</div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;        }</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;      }<span class="comment">//end else roughness</span></div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      <span class="comment">// the screen is now finished</span></div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;<span class="comment"></span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      <span class="keywordflow">if</span>( settings1-&gt;ROUGHNESS &amp;&amp; !panel1-&gt;GetNvalidPoints() ){</div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;        DO_SKIP  </div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;      }</div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;      </div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;      <span class="comment">// reject if the event is undetectable.</span></div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;      <span class="comment">// THIS ONLY CHECKS IF ROUGHNESS == 0, WE WILL SKIP THIS IF THERE IS ROUGHNESS</span></div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;      <span class="comment">// if (!settings1-&gt;ROUGHNESS){</span></div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;      <span class="keywordflow">if</span>(settings1-&gt;CHANCEINHELL_FACTOR*vmmhz1m_fresneledtwice*heff_max*0.5*(anita1-&gt;bwmin/1.E6)&lt;anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10.&amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;          cout&lt;&lt;<span class="stringliteral">&quot;Event is undetectable.  Leaving loop.&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;</div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        DO_SKIP </div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;      }</div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;      count1-&gt;nchanceinhell_fresnel[whichray]++;</div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;      <span class="comment">// } //end if CHANCEINHELL factor and SKIPCUTS</span></div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;      </div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;      <span class="comment">// for plotting</span></div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;      diffexit=ray1-&gt;rfexit[0].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[1]);</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;      diffnorm=acos(ray1-&gt;nsurf_rfexit[0]*ray1-&gt;nsurf_rfexit[1]);</div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;      diffrefr=acos(ray1-&gt;nrf_iceside[4]*ray1-&gt;nrf_iceside[0]);</div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;</div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;      <span class="comment">// scale by 1/r once you&#39;ve found the 3rd iteration exit point</span></div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;      <span class="comment">// ALREADY DEALT WITH IN CASE OF ROUGHNESS</span></div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS) {</div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;Oindree: vmmhz1m_fresneledtwice &quot; &lt;&lt; vmmhz1m_fresneledtwice &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        <span class="comment">//oindree_file &lt;&lt; vmmhz1m_fresneledtwice &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        <span class="keywordflow">if</span> (whichray==0)</div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;          vmmhz_max=ScaleVmMHz(vmmhz1m_fresneledtwice, interaction1-&gt;posnu, bn1-&gt;r_bn, ray1-&gt;rfexit[2]);</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        <span class="keywordflow">if</span> (whichray==1)</div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;          vmmhz_max=ScaleVmMHz(vmmhz1m_fresneledtwice, interaction1-&gt;posnu_down, bn1-&gt;r_bn, ray1-&gt;rfexit[2]);<span class="comment">//use the mirror point</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;      }</div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;</div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Oindree: ray1-&gt;rfexit[2] &quot; &lt;&lt; ray1-&gt;rfexit[2] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;Oindree: bn1-&gt;r_bn &quot; &lt;&lt; bn1-&gt;r_bn &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;      <span class="comment">//oindree_file &lt;&lt; whichray &lt;&lt; &quot; &quot; &lt;&lt; vmmhz1m_fresneledtwice &lt;&lt; &quot; &quot; &lt;&lt; vmmhz_max &lt;&lt; &quot; &quot; &lt;&lt; interaction1-&gt;posnu[0] &lt;&lt; &quot; &quot; &lt;&lt; interaction1-&gt;posnu[1] &lt;&lt; &quot; &quot; &lt;&lt; interaction1-&gt;posnu[2] &lt;&lt; &quot; &quot; &lt;&lt; bn1-&gt;r_bn[0] &lt;&lt; &quot; &quot; &lt;&lt; bn1-&gt;r_bn[1] &lt;&lt; &quot; &quot; &lt;&lt; bn1-&gt;r_bn[2] &lt;&lt; &quot; &quot; &lt;&lt; ray1-&gt;rfexit[2][0] &lt;&lt; &quot; &quot; &lt;&lt; ray1-&gt;rfexit[2][1] &lt;&lt; &quot; &quot; &lt;&lt; ray1-&gt;rfexit[2][2] &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;      <span class="comment">// reject if the event is undetectable.</span></div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;CHANCEINHELL_FACTOR*vmmhz_max*heff_max*0.5*(anita1-&gt;bwmin/1.E6)&lt;anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10. &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Event is undetectable.  Leaving loop.&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;          <span class="comment">//</span></div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;          DO_SKIP </div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;        } <span class="comment">//if</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;      }</div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;      count1-&gt;nchanceinhell_1overr[whichray]++;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;</div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;      <span class="comment">// distance ray travels through ice.</span></div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS) {</div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;        <span class="keywordflow">if</span> (whichray==0) {</div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;          rflength=interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[2]);</div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;        }</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        <span class="keywordflow">if</span> (whichray==1) {</div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;          rflength=interaction1-&gt;posnu_down.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(ray1-&gt;rfexit[2]);<span class="comment">//use the real distance that singals pass</span></div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;        }</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;      }</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;</div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;        cout &lt;&lt; <span class="stringliteral">&quot;rflength is &quot;</span> &lt;&lt; rflength &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;      <span class="comment">// applying ice attenuation factor</span></div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS) {</div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <span class="keywordflow">if</span> (whichray==0)</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;          Attenuate(antarctica, settings1, vmmhz_max,  rflength,  interaction1-&gt;posnu);</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        <span class="keywordflow">if</span> (whichray==1)</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;          Attenuate_down(antarctica, settings1, vmmhz_max,  ray1-&gt;rfexit[2],  interaction1-&gt;posnu, interaction1-&gt;posnu_down);</div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;      }</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;      <span class="comment">//oindree_file &lt;&lt; vmmhz1m_fresneledtwice &lt;&lt; &quot; &quot; &lt;&lt; vmmhz_max &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;</div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;      <span class="comment">// roughness attenuation already dealt with</span></div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;      <span class="comment">// fill for just 1/10 of the events.</span></div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;      <span class="keywordflow">if</span> (tree2-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1 &amp;&amp; bn1-&gt;WHICHPATH != 3)</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;        tree2-&gt;Fill();</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;      <span class="comment">// intermediate counting</span></div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;      count_dbexitsice++;</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;      <span class="comment">// reject if the event is undetectable.</span></div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;CHANCEINHELL_FACTOR*vmmhz_max*heff_max*0.5*(anita1-&gt;bwmin/1.E6)&lt;anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10. &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3)</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Event is undetectable.  Leaving loop.&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;          <span class="comment">//</span></div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;          DO_SKIP; </div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        } <span class="comment">//if</span></div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;      }</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;      count1-&gt;nchanceinhell[whichray]++;</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;      </div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;      <span class="comment">// for plotting</span></div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;      <span class="keywordflow">if</span> (tree3-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1 &amp;&amp; bn1-&gt;WHICHPATH != 3)</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;        tree3-&gt;Fill();</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;      <span class="comment">// index for each antenna so you can use it to fill arrays</span></div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;      count_rx=0;</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;      <span class="comment">// keeps track of maximum voltage seen on either polarization of any antenna</span></div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;      volts_rx_max=0;</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;      <span class="comment">// Make a vector of V/m/MHz scaled by 1/r and attenuated.</span></div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;      <span class="comment">// Calculates Jaime&#39;s V/m/MHz at 1 m for each frequency</span></div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;      <span class="comment">// then multiplies by scale factor vmmhz_max/vmmhz1m_max</span></div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;      <span class="comment">// this will need to be improved once frequency-dependent</span></div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;      <span class="comment">// attenuation length is included.</span></div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;FORSECKEL==1)</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;          sig1-&gt;SetNDepth(sig1-&gt;NICE); <span class="comment">// for making array of signal vs. frequency,  viewangle</span></div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;        </div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;        sig1-&gt;GetVmMHz(vmmhz_max, vmmhz1m_max, pnu, anita1-&gt;freq, anita1-&gt;NOTCH_MIN, anita1-&gt;NOTCH_MAX, vmmhz, Anita::NFREQ); <span class="comment">// here we get the array vmmhz by taking vmmhz1m_max (signal at lowest frequency bin) and</span></div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;        <span class="comment">//   vmmhz_max (signal at lowest frequency after applying 1/r factor and attenuation factor)</span></div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;        <span class="comment">// and making an array across frequency bins by putting in frequency dependence.</span></div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;      }</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;        </div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;      <span class="comment">// For each frequency,  get the width of Cerenkov cone</span></div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;      <span class="comment">// and size of signal once position of viewing angle is taken into account</span></div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;      <span class="comment">// these variables are for energy reconstruction studies</span></div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        </div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;      undogaintoheight_e=0;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;      undogaintoheight_h=0;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;4;k++) {</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        undogaintoheight_e_array[k]=0.;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;        undogaintoheight_h_array[k]=0.;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;        nbins_array[k]=0;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;        true_efield_array[k]=0.;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;        rec_efield_array[k]=0.;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;      }</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;      rec_efield=0;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;      true_efield=0;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;      </div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;      </div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="comment">// don&#39;t loop over frequencies if the viewing angle is too far off</span></div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;        <span class="keywordtype">double</span> rtemp=Tools::dMin((viewangle-sig1-&gt;changle)/(deltheta_em_max), (viewangle-sig1-&gt;changle)/(deltheta_had_max));</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;        <span class="keywordflow">if</span> (rtemp&gt;Signal::VIEWANGLE_CUT &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;          <span class="comment">//delete interaction1;</span></div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;          DO_SKIP</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        }</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        count1-&gt;nviewanglecut[whichray]++;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        <span class="comment">//oindree_file &lt;&lt; Tools::dMax(vmmhz, Anita::NFREQ) &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++) {</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;          deltheta_em[k]=deltheta_em_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[k];</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;          deltheta_had[k]=deltheta_had_max*anita1-&gt;FREQ_LOW/anita1-&gt;freq[k];</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;FORSECKEL==1) {<span class="comment">// this is for making plots of the signal</span></div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iviewangle=0;iviewangle&lt;NVIEWANGLE;iviewangle++) {<span class="comment">// loop over viewing angles</span></div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;              <span class="comment">// remove the 1/r and attenuation factors that are contained in the ratio vmmhz1m_max/vmmhz_max</span></div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;              vmmhz_temp=vmmhz[k]*vmmhz1m_max/vmmhz_max;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;              viewangle_temp=viewangles[iviewangle]; <span class="comment">//grab the viewing angle from this array</span></div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;              <span class="comment">//apply the gaussian dependence away from the cerenkov angle.  vmmhz_temp is both an input and an output.</span></div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;              <span class="comment">//vmmhz_temp as an output is the signal with the angular dependence applied.</span></div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;              sig1-&gt;TaperVmMHz(viewangle_temp, deltheta_em[k], deltheta_had[k], emfrac, hadfrac, vmmhz_temp, djunk);</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;              forseckel[iviewangle][k]=vmmhz_temp;<span class="comment">// put this in an array which we will plot later.</span></div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            } <span class="comment">//for (loop over viewing angles)</span></div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;          } <span class="comment">//if (settings1-&gt;FORSECKEL==1)</span></div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;          <span class="comment">//if (k == (Anita::NFREQ - 1) ) {</span></div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;            <span class="comment">//oindree_file &lt;&lt; weight1 &lt;&lt; &quot; &quot; &lt;&lt; pnu &lt;&lt; &quot; &quot; &lt;&lt; viewangle &lt;&lt; &quot; &quot; &lt;&lt; deltheta_em[k] &lt;&lt; &quot; &quot; &lt;&lt; deltheta_had[k] &lt;&lt; &quot; &quot; &lt;&lt; emfrac &lt;&lt; &quot; &quot; &lt;&lt; hadfrac &lt;&lt; &quot; &quot; &lt;&lt; vmmhz[k] &lt;&lt; &quot; &quot; &lt;&lt; vmmhz_em[k] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;          <span class="comment">//}</span></div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160; </div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;          sig1-&gt;TaperVmMHz(viewangle, deltheta_em[k], deltheta_had[k], emfrac, hadfrac, vmmhz[k], vmmhz_em[k]);<span class="comment">// this applies the angular dependence.</span></div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;              <span class="comment">// viewangle is which viewing angle we are at</span></div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;              <span class="comment">// deltheta_em is the width of the em component at this frequency</span></div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;              <span class="comment">// deltheta_had is the width of the had component at this frequency</span></div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;              <span class="comment">// emfrac is the em fraction of the shower</span></div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;              <span class="comment">// hadfrac is the hadronic fraction of the shower</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;              <span class="comment">// vmmhz is the strength of the signal in V/m/MHz at this viewing angle</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;              <span class="comment">// vmmhz_em is the strength of the em component</span></div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;</div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;          vmmhz_lowfreq=vmmhz[0]; <span class="comment">// for plotting,  vmmhz at the lowest frequency</span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;</div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;          <span class="comment">// just want to see the maximum effect of viewing angle being off cerenkov cone</span></div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;          <span class="comment">// should be at highest frequency</span></div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;          <span class="comment">// just for plotting</span></div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;          maxtaper=-1000;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;          <span class="keywordflow">if</span> (sig1-&gt;logscalefactor_taper&gt;maxtaper)</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;            maxtaper=sig1-&gt;logscalefactor_taper;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;          <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nue&quot;</span>)        pdgcode = 12;</div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;numu&quot;</span>)  pdgcode = 14;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nutau&quot;</span>) pdgcode = 16;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;HIST==1 &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; bn1-&gt;WHICHPATH != 3 &amp;&amp; k==Anita::NFREQ/2 &amp;&amp; tree18-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            tree18-&gt;Fill();</div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;          }</div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;</div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH == 3)</div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;            interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a97f88ca0a1c9e906203aa5ce618221e0">banana_volts</a> += vmmhz[k]*(settings1-&gt;BW/(double)Anita::NFREQ/1.E6);</div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;       </div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        }<span class="comment">//end for (int k=0;k&lt;Anita::NFREQ;k++)</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;<span class="comment"></span></div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;        <span class="comment">//oindree_file &lt;&lt; Tools::dMax(vmmhz, Anita::NFREQ) &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3 &amp;&amp; interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a97f88ca0a1c9e906203aa5ce618221e0">banana_volts</a> != 0 &amp;&amp; settings1-&gt;HIST &amp;&amp; banana_tree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;          banana_tree-&gt;Fill();</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;          DO_SKIP</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        } <span class="comment">//This is all the data needed for the banana plot - we now have the final value of vmmhz[]</span></div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==3 &amp;&amp; interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a97f88ca0a1c9e906203aa5ce618221e0">banana_volts</a> == 0) {</div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;          DO_SKIP <span class="comment">//Exit the loop if there&#39;s no voltage here - no value at a point is the same as zero,  and this will save HD space</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        }</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="comment">// reject if it is undetectable now that we have accounted for viewing angle</span></div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;nviewanglecut &quot; &lt;&lt; (double)count1-&gt;nviewanglecut[0] &lt;&lt; &quot; nchanceinhell2 &quot; &lt;&lt; count1-&gt;nchanceinhell2[0] &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;        <span class="comment">//oindree_file &lt;&lt; (double)count1-&gt;nviewanglecut[0] &lt;&lt; &quot; &quot; &lt;&lt; count1-&gt;nchanceinhell2[0] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;         </div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;        <span class="comment">//oindree_file &lt;&lt; weight1 &lt;&lt; &quot; &quot; &lt;&lt; pnu &lt;&lt; &quot; &quot; &lt;&lt; (settings1-&gt;CHANCEINHELL_FACTOR*Tools::dMax(vmmhz, Anita::NFREQ)*heff_max*0.5*(anita1-&gt;bwmin/1.E6)) &lt;&lt; &quot; &quot; &lt;&lt; anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10. &lt;&lt; &quot; &quot; &lt;&lt; settings1-&gt;SKIPCUTS &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;        <span class="comment">//oindree_file &lt;&lt; weight1 &lt;&lt; &quot; &quot; &lt;&lt; pnu &lt;&lt; &quot; &quot; &lt;&lt; settings1-&gt;CHANCEINHELL_FACTOR &lt;&lt; &quot; &quot; &lt;&lt; Tools::dMax(vmmhz,Anita::NFREQ) &lt;&lt; &quot; &quot; &lt;&lt; 0.5*heff_max &lt;&lt; &quot; &quot; &lt;&lt; anita1-&gt;bwmin/1.E6 &lt;&lt; &quot;\n&quot;;  </span></div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;CHANCEINHELL_FACTOR*Tools::dMax(vmmhz, Anita::NFREQ)*heff_max*0.5*(anita1-&gt;bwmin/1.E6) &lt; anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10. &amp;&amp; !settings1-&gt;SKIPCUTS) {</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;        <span class="comment">//if (settings1-&gt;CHANCEINHELL_FACTOR*Tools::dMax(vmmhz, Anita::NFREQ)*heff_max*0.5*(anita1-&gt;bwmin/1.E6) &lt; anita1-&gt;maxthreshold*anita1-&gt;VNOISE[0]/10.) {</span></div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;          <span class="comment">//cout &lt;&lt; &quot;chance fail&quot; &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;          DO_SKIP</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;        }</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;      }<span class="comment">//end if roughness==0 before the Anita::NFREQ k loop, this isolates the TaperVmMHz()</span></div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;      </div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;      <span class="comment">// just for plotting</span></div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;      <span class="keywordflow">if</span>(!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        vmmhz_max=Tools::dMax(vmmhz, Anita::NFREQ);</div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;        vmmhz_min=Tools::dMin(vmmhz, Anita::NFREQ);</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;      }</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;      <span class="comment">// intermediate counting</span></div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;      count1-&gt;nchanceinhell2[whichray]++;</div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;      chanceinhell2=1;</div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;</div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;count chance &quot; &lt;&lt; count1-&gt;nchanceinhell2[whichray] &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;</div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;      isDead = <span class="keyword">false</span>;</div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;      <span class="comment">// Dead time</span></div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;USEDEADTIME){</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;              <span class="keywordflow">if</span> ( (getRNG(RNG_DEADTIME)-&gt;Uniform(1)&lt;anita1-&gt;deadTime) ){</div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;          isDead = <span class="keyword">true</span>;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;MINBIAS!=1) {</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;           DO_SKIP</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;          }</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;        }</div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;      }</div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;            </div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;      count1-&gt;ndeadtime[whichray]++;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;</div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;      Tools::Zero(sumsignal_aftertaper, 5);</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;      <span class="comment">// // Create a pointer to the SimulatedSignal</span></div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;      <span class="comment">// SimulatedSignal *simSignal = new SimulatedSignal();</span></div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;      <span class="comment">// // Define the SimSignal from vmmhz</span></div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;      <span class="comment">// simSignal-&gt;updateSimSignalFromVmmhz(Anita::NFREQ, anita1-&gt;freq, vmmhz);</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;      <span class="comment">// simSignal-&gt;addCW(250E6, 0, 0.01);</span></div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;      <span class="comment">// simSignal-&gt;getVmmhz(anita1, vmmhz);</span></div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;      <span class="comment">// delete simSignal;</span></div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;      <span class="comment">//if no-roughness case, add its parameters to the saved screen parameters so specular and roughness simulations use the same code in the waveform construction</span></div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;      <span class="keywordflow">if</span>(!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;        panel1-&gt;SetNvalidPoints(1);</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++) {</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;                <span class="comment">//cout &lt;&lt; anita1-&gt;freq[k] &lt;&lt; &quot; &quot; &lt;&lt; vmmhz[k] &lt;&lt; &quot; &quot; &lt;&lt; vmmhz2[k] &lt;&lt; &quot; &quot; &lt;&lt; vmmhz[k]/vmmhz2[k] &lt;&lt; endl;</span></div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;                panel1-&gt;AddVmmhz_freq(vmmhz[k]);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;        }</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        panel1-&gt;AddVmmhz0(vmmhz[0]);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;        panel1-&gt;AddVec2bln(ray1-&gt;n_exit2bn[2]);</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        panel1-&gt;AddPol(n_pol);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        panel1-&gt;AddDelay( 0. );</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;        panel1-&gt;AddImpactPt(ray1-&gt;rfexit[2]);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        panel1-&gt;AddViewangle(viewangle);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;        <span class="keywordflow">if</span>(settings1-&gt;FIRN){</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;          panel1-&gt;AddIncidenceAngle(ray1-&gt;nsurf_rfexit.Angle(ray1-&gt;nrf_iceside[3]));</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        }</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;        <span class="keywordflow">else</span>{</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;          panel1-&gt;AddIncidenceAngle(ray1-&gt;nsurf_rfexit.Angle(ray1-&gt;nrf_iceside[4]));</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;        }</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;        panel1-&gt;AddTransmissionAngle(ray1-&gt;nsurf_rfexit.Angle(ray1-&gt;n_exit2bn[2]));</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;        panel1-&gt;AddWeight( 1. );</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;        panel1-&gt;SetWeightNorm( 1. );</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;        panel1-&gt;AddFacetLength( 1. );</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        panel1-&gt;AddTparallel_polParallel(t_coeff_pokey);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;        panel1-&gt;AddTperpendicular_polPerpendicular(t_coeff_slappy);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        panel1-&gt;AddTparallel_polPerpendicular(0.);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        panel1-&gt;AddTperpendicular_polParallel(0.);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++) {</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;            IntegrateBands(anita1, k, panel1, anita1-&gt;freq, vmmhz1m_max/(vmmhz_max*1.E6), sumsignal_aftertaper);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;        }</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;      }</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;      </div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;      <span class="comment">// make a global trigger object (but don&#39;t touch the electric fences)</span></div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;      globaltrig1 = <span class="keyword">new</span> <a class="code" href="../../d7/d39/class_global_trigger.html">GlobalTrigger</a>(settings1, anita1);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;      Tools::Zero(anita1-&gt;arrival_times[0], Anita::NLAYERS_MAX*<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>);</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;      Tools::Zero(anita1-&gt;arrival_times[1], Anita::NLAYERS_MAX*<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;TRIGGEREFFSCAN){</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;        <span class="keywordflow">if</span>(settings1-&gt;BORESIGHTS)</div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;          anita1-&gt;GetArrivalTimesBoresights(ray1-&gt;n_exit2bn_eachboresight[2]);</div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;          anita1-&gt;GetArrivalTimes(ray1-&gt;n_exit2bn[2],bn1,settings1);</div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;      }</div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;      anita1-&gt;rx_minarrivaltime=Tools::WhichIsMin(anita1-&gt;arrival_times[0], settings1-&gt;NANTENNAS);</div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;</div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;      <span class="comment">//Zeroing</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;settings1-&gt;NANTENNAS;i++) {</div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;        voltagearray[i]=0;</div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;        discones_passing=0;</div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;      } <span class="comment">//Zero the trigger array</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;</div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;      max_antenna0=-1;</div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;      max_antenna1=-1;</div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;      max_antenna2=-1;</div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;      max_antenna_volts0 =0;</div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;      max_antenna_volts1 =0;</div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;      max_antenna_volts2 =0;</div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;      e_comp_max1 = 0;</div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;      h_comp_max1 = 0;</div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;      e_comp_max2 = 0;</div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;      h_comp_max2 = 0;</div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;      e_comp_max3 = 0;</div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;      h_comp_max3 = 0;</div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;      <span class="comment">//End zeroing</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;</div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;</div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;      <span class="comment">// start looping over antennnas.</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;      <span class="comment">// ilayer loops through vertical layers</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;</div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;SLAC)</div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;        fslac_hitangles &lt;&lt; bn1-&gt;sslacpositions[bn1-&gt;islacposition] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;</div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;      <span class="keywordflow">if</span> (RANDOMISEPOL) {</div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;        <span class="keywordtype">double</span> rotateangle=getRNG(RNG_RANDOMISE_POL)-&gt;Gaus(RANDOMISEPOL*RADDEG);</div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        n_pol=n_pol.Rotate(rotateangle, ray1-&gt;n_exit2bn[2]);</div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;      }</div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;</div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4) {</div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        Tools::Zero(sumsignal, 5);</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++)</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;          IntegrateBands(anita1, k, panel1, anita1-&gt;freq, bn1-&gt;r_bn.Distance(interaction1-&gt;posnu)/1.E6, sumsignal);</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;      }<span class="comment">//end if whichpath==4</span></div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;<a class="code" href="../../db/d2b/class_settings.html#aa0a4259f66f050661e715e9181fdaec1">CENTER</a>){</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        bn1-&gt;CenterPayload(hitangle_e);</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;      }</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;MAKEVERTICAL) {</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        n_pol=bn1-&gt;n_bn;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;        <span class="comment">// rotate n_exit2bn too</span></div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <span class="comment">// rotation axis n_bn crossed with n_exit2bn</span></div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rotationaxis=ray1-&gt;n_exit2bn[2].Cross(bn1-&gt;n_bn);</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;        <span class="keywordtype">double</span> rotateangle=PI/2.-ray1-&gt;n_exit2bn[2].Dot(bn1-&gt;n_bn);</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        ray1-&gt;n_exit2bn[2]=ray1-&gt;n_exit2bn[2].Rotate(rotateangle, rotationaxis);</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0; ilayer &lt; settings1-&gt;NLAYERS; ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;          <span class="comment">// ifold loops over phi</span></div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) {</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rotationaxis2=ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold].Cross(n_pol_eachboresight[ilayer][ifold]);</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <span class="keywordtype">double</span> rotateangle2=PI/2.-ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold].Dot(n_pol_eachboresight[ilayer][ifold]);</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold].Rotate(rotateangle2, rotationaxis2);</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;          } <span class="comment">// end loop over phi</span></div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;        } <span class="comment">// end loop over layers</span></div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;      }<span class="comment">//end if ray1-&gt;makevertical</span></div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;      globaltrig1-&gt;volts_rx_rfcm_trigger.assign(16,  vector &lt;vector &lt;double&gt; &gt;(3,  vector &lt;double&gt;(0)));</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;      anita1-&gt;rms_rfcm_e_single_event = 0;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;      <span class="keywordflow">if</span> (!settings1-&gt;BORESIGHTS) {</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;        bn1-&gt;GetEcompHcompkvector(n_eplane,  n_hplane,  n_normal,  ray1-&gt;n_exit2bn[2], e_component_kvector[0],  h_component_kvector[0],  n_component_kvector[0]);</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        bn1-&gt;GetEcompHcompEvector(settings1,  n_eplane,  n_hplane,  n_pol,  e_component[0],  h_component[0],  n_component[0]);</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;      }</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;      </div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0; ilayer &lt; settings1-&gt;NLAYERS; ilayer++) { <span class="comment">// loop over layers on the payload</span></div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifold=0;ifold&lt;anita1-&gt;NRX_PHI[ilayer];ifold++) { <span class="comment">// ifold loops over phi</span></div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;          </div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;          <a class="code" href="../../dd/d24/class_chan_trigger.html">ChanTrigger</a> *chantrig1 = <span class="keyword">new</span> <a class="code" href="../../dd/d24/class_chan_trigger.html">ChanTrigger</a>();</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a4fcd80f9a174f236b60a6606ac0599b2">InitializeEachBand</a>(anita1);</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;          bn1-&gt;GetAntennaOrientation(settings1,  anita1,  ilayer,  ifold, n_eplane,  n_hplane,  n_normal);</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160; </div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;BORESIGHTS){ <span class="comment">// i.e. if BORESIGHTS is true</span></div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;            bn1-&gt;GetEcompHcompkvector(n_eplane,  n_hplane,  n_normal,  ray1-&gt;n_exit2bn_eachboresight[2][ilayer][ifold],  e_component_kvector[count_rx],  h_component_kvector[count_rx],  n_component_kvector[count_rx]);</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;            bn1-&gt;GetEcompHcompEvector(settings1,  n_eplane,  n_hplane,  n_pol_eachboresight[ilayer][ifold], e_component[count_rx],  h_component[count_rx],  n_component[count_rx]);</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;SLAC) fslac_hitangles &lt;&lt; ilayer &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; ifold &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; hitangle_e &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; hitangle_h &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; e_component_kvector &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; h_component_kvector &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; fresnel1_eachboresight[ilayer][ifold] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; mag1_eachboresight[ilayer][ifold] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;          }</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count_rx &gt; 0)  </div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;          {</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;            e_component_kvector[count_rx] = e_component_kvector[0];</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;            h_component_kvector[count_rx] = h_component_kvector[0];</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;            n_component_kvector[count_rx] = n_component_kvector[0];</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            e_component[count_rx] = e_component[0];</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;            h_component[count_rx] = h_component[0];</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;            n_component[count_rx] = n_component[0];</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;          }</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;          bn1-&gt;GetHitAngles(e_component_kvector[count_rx], h_component_kvector[count_rx], n_component_kvector[count_rx], hitangle_e, hitangle_h);</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;          <span class="comment">// store hitangles for plotting</span></div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;          hitangle_h_all[count_rx]=hitangle_h;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;          hitangle_e_all[count_rx]=hitangle_e;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;          <span class="comment">// for debugging</span></div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;          <span class="keywordflow">if</span> (h6-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;            h6-&gt;Fill(hitangle_h, ray1-&gt;n_exit2bn[2]*bn1-&gt;n_bn);</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;          antNum = anita1-&gt;GetRxTriggerNumbering(ilayer, ifold);</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;          </div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a60667e48582a6a076e40226404f9c865">ApplyAntennaGain</a>(settings1, anita1, bn1, panel1, antNum, n_eplane, n_hplane, n_normal);</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a3bbedfa72e4d8b4001fcef036a6ed286">TriggerPath</a>(settings1, anita1, antNum, bn1);</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;          <span class="comment">//if(settings1-&gt;ROUGHNESS){</span></div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;<span class="comment">/*            if(vmmhz_max&gt;0.){</span></div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;<span class="comment">              std::string stemp=string(outputdir.Data())+&quot;/rough_signalwaveforms_&quot;+nunum+&quot;.dat&quot;;</span></div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;<span class="comment">              ofstream sigout(stemp.c_str(), ios::app);</span></div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;<span class="comment">              for (int iband=0;iband&lt;5;iband++) {</span></div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;<span class="comment">                if (anita1-&gt;bwslice_allowed[iband]!=1) continue; </span></div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;<span class="comment">                for (int k=0;k&lt;anita1-&gt;NFOUR/2;k++) {</span></div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;<span class="comment">                  sigout &lt;&lt; ilayer &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;<span class="comment">                  &lt;&lt; ifold &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;<span class="comment">                  &lt;&lt; iband &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;<span class="comment">                  &lt;&lt; k &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;<span class="comment">                  &lt;&lt; chantrig1-&gt;v_banding_rfcm_forfft[0][iband][k]&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;<span class="comment">                  &lt;&lt; chantrig1-&gt;v_banding_rfcm_forfft[1][iband][k]&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;<span class="comment">                  &lt;&lt; chantrig1-&gt;volts_rx_forfft[0][iband][k]&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;<span class="comment">                  &lt;&lt; chantrig1-&gt;volts_rx_forfft[1][iband][k]&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;<span class="comment">                  &lt;&lt; std::endl;</span></div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;<span class="comment">                }</span></div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;<span class="comment">              }</span></div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;<span class="comment">              sigout.close();</span></div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;<span class="comment">            }</span></div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;<span class="comment">          //}</span></div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a261ab5103931c402e8855a6f33922eb2">DigitizerPath</a>(settings1, anita1, antNum, bn1);</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a0e009613e4c8712b28075a00427b5fc6">TimeShiftAndSignalFluct</a>(settings1, anita1, ilayer, ifold, volts_rx_rfcm_lab_e_all,  volts_rx_rfcm_lab_h_all);</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#af874b19d040e267a525bc2777f57173b">saveTriggerWaveforms</a>(anita1, justSignal_trig[0][antNum], justSignal_trig[1][antNum], justNoise_trig[0][antNum], justNoise_trig[1][antNum]);</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#aa893bb77e40efd72317a10e4ed2a3880">saveDigitizerWaveforms</a>(anita1, justSignal_dig[0][antNum], justSignal_dig[1][antNum], justNoise_dig[0][antNum], justNoise_dig[1][antNum]);</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;          </div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;          Tools::Zero(sumsignal, 5);</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;          <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4 &amp;&amp; ilayer==anita1-&gt;GetLayer(anita1-&gt;rx_minarrivaltime) &amp;&amp; ifold==anita1-&gt;GetIfold(anita1-&gt;rx_minarrivaltime)) {</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibw=0;ibw&lt;5;ibw++) {</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;              cout &lt;&lt; <span class="stringliteral">&quot;Just after Taper,  sumsignal is &quot;</span> &lt;&lt; sumsignal_aftertaper[ibw] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;              cout &lt;&lt; <span class="stringliteral">&quot;Just after antennagain,  sumsignal is &quot;</span> &lt;&lt; sumsignal[ibw] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            }</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;          }</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;          <span class="comment">// for energy reconstruction studies</span></div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;          <span class="keywordflow">if</span> (count_rx==anita1-&gt;rx_minarrivaltime) {</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;            undogaintoheight_e/=(double)Anita::NFREQ;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            undogaintoheight_h/=(double)Anita::NFREQ;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;4;k++) {</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;              undogaintoheight_e_array[k]/=(double)nbins_array[k];</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;              undogaintoheight_h_array[k]/=(double)nbins_array[k];</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;            }</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;          }</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;SCALEDOWNLCPRX1)</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;            globaltrig1-&gt;volts[0][ilayer][0]=globaltrig1-&gt;volts[0][ilayer][0]/sqrt(2.);</div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;</div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;RCPRX2ZERO)</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;            globaltrig1-&gt;volts[1][ilayer][1]=0.;</div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;</div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;LCPRX2ZERO)</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;            globaltrig1-&gt;volts[0][ilayer][1]=0.;</div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;</div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;SIGNAL_FLUCT) {</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;WHICH==0) {</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;              globaltrig1-&gt;volts[ilayer][ifold][0]+=getRNG(RNG_SIGNAL_FLUCT)-&gt;Gaus(0., anita1-&gt;VNOISE_ANITALITE[ifold]);</div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;              globaltrig1-&gt;volts[ilayer][ifold][1]+=getRNG(RNG_SIGNAL_FLUCT)-&gt;Gaus(0., anita1-&gt;VNOISE_ANITALITE[ifold]);</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;            } <span class="comment">//else</span></div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;          } <span class="comment">//if adding noise</span></div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;          <span class="keywordflow">if</span> (count_rx==anita1-&gt;rx_minarrivaltime) {</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;            rec_efield=sqrt(pow(globaltrig1-&gt;volts_original[0][ilayer][ifold]/(undogaintoheight_e*0.5), 2)+pow(globaltrig1-&gt;volts_original[1][ilayer][ifold]/(undogaintoheight_h*0.5), 2));</div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibw=0;ibw&lt;4;ibw++) {</div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;              rec_efield_array[ibw]=sqrt(pow(chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a1b69fa7b30fb58d2722e8c562bc6c8b3">bwslice_volts_pole</a>[ibw]/(undogaintoheight_e_array[ibw]*0.5), 2)+pow(chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#aa07a42ea95e819ba929264fdc57d4eae">bwslice_volts_polh</a>[ibw]/(undogaintoheight_h_array[ibw]*0.5), 2));</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;              bwslice_vnoise_thislayer[ibw]=anita1-&gt;bwslice_vnoise[ilayer][ibw];<span class="comment">// this is just for filling into a tree</span></div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;            } <span class="comment">// end loop over bandwidth slices</span></div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        <span class="keywordflow">if</span> (tree6b-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;          tree6b-&gt;Fill();</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;          } <span class="comment">// end if this is the closest antenna</span></div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;</div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;          <span class="comment">//+++++//+++++//+++++//+++++//+++++//+++++//+++++</span></div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;</div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;          chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a41da01a1fec6244e8cf95b7681dcc74b">WhichBandsPass</a>(settings1, anita1, globaltrig1, bn1, ilayer, ifold,  viewangle-sig1-&gt;changle, emfrac, hadfrac, thresholdsAnt[antNum]);</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;</div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;          </div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;          <span class="keywordflow">if</span> (Anita::GetAntennaNumber(ilayer, ifold)==anita1-&gt;rx_minarrivaltime) {</div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iband=0;iband&lt;5;iband++) {</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;                rx0_signal_eachband[ipol][iband]=chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a334b852e6e1f8b281ca3c57884e355e8">signal_eachband</a>[ipol][iband];</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;                rx0_threshold_eachband[ipol][iband]=chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a03660c07c0e6950c408b6e38cb872f2c">threshold_eachband</a>[ipol][iband];</div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;                rx0_noise_eachband[ipol][iband]=chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#a4d35ee51b730176799cc49771bc6c5f9">noise_eachband</a>[ipol][iband];</div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;                rx0_passes_eachband[ipol][iband]=chantrig1-&gt;<a class="code" href="../../dd/d24/class_chan_trigger.html#af23b9d10e37018084f6531f1fe481ba1">passes_eachband</a>[ipol][iband];</div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;              }</div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;            }</div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;          }</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;          <span class="comment">//For verification plots: find antenna with max signal - added by Stephen</span></div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;          <span class="keywordflow">if</span> (ilayer == 0 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] &gt; max_antenna_volts0) {</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;            max_antenna0 = count_rx;</div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;            max_antenna_volts0 = globaltrig1-&gt;volts[0][ilayer][ifold];</div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;            max_antenna_volts0_em=globaltrig1-&gt;volts_em[0][ilayer][ifold];</div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;            ant_max_normal0 = ant_normal;</div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;            e_comp_max1 = e_component[count_rx];</div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;            h_comp_max1 = h_component[count_rx];</div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;          }</div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilayer == 0 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] == max_antenna_volts0 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] != 0){</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Equal voltage on two antennas!  Event : &quot;</span>&lt;&lt;inu&lt;&lt;endl;</div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;          }</div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilayer == 1 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] &gt; max_antenna_volts1) {</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;            max_antenna1 = count_rx;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            max_antenna_volts1 = globaltrig1-&gt;volts[0][ilayer][ifold];</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;            ant_max_normal1 = ant_normal;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;            e_comp_max2 = e_component[count_rx];</div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;            h_comp_max2 = h_component[count_rx];</div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;          }</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilayer == 1 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] == max_antenna_volts1 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] != 0){</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Equal voltage on two antennas!  Event : &quot;</span>&lt;&lt;inu&lt;&lt;endl;</div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;          }</div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilayer == 2 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] &gt; max_antenna_volts2) {</div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;            max_antenna2 = count_rx;</div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;            max_antenna_volts2 = globaltrig1-&gt;volts[0][ilayer][ifold];</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;            ant_max_normal2 = ant_normal;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;            e_comp_max3 = e_component[count_rx];</div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;            h_comp_max3 = h_component[count_rx];</div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;          }</div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;          <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ilayer == 2 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] == max_antenna_volts2 &amp;&amp; globaltrig1-&gt;volts[0][ilayer][ifold] != 0){</div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;            cout&lt;&lt;<span class="stringliteral">&quot;Equal voltage on two antennas!  Event : &quot;</span>&lt;&lt;inu&lt;&lt;endl;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;          }</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;          voltagearray[count_rx] = globaltrig1-&gt;volts[0][ilayer][ifold];</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;          <span class="comment">//End verification plot block</span></div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;</div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;          count_rx++; <span class="comment">// counting antennas that we loop through,  for indexing</span></div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;</div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;          <span class="keywordflow">if</span> (settings1-&gt;TRIGTYPE==0 &amp;&amp; ifold==1 &amp;&amp; count_pass&gt;=settings1-&gt;NFOLD) { <span class="comment">//added djg --line below fills &quot;direct&quot; voltage output file</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;            al_voltages_direct&lt;&lt;<span class="stringliteral">&quot;0 0 0&quot;</span>&lt;&lt;<span class="stringliteral">&quot;   &quot;</span>&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;globaltrig1-&gt;volts_original[1][0][0]&lt;&lt;<span class="stringliteral">&quot;    &quot;</span>&lt;&lt;(globaltrig1-&gt;volts_original[0][0][0]/sqrt(2.))&lt;&lt;<span class="stringliteral">&quot;     &quot;</span>&lt;&lt;globaltrig1-&gt;volts_original[1][0][1]&lt;&lt;<span class="stringliteral">&quot;     &quot;</span>&lt;&lt;globaltrig1-&gt;volts_original[0][0][1]&lt;&lt;<span class="stringliteral">&quot;      &quot;</span>&lt;&lt;anita1-&gt;VNOISE[0]&lt;&lt;<span class="stringliteral">&quot;     &quot;</span>&lt;&lt;anita1-&gt;VNOISE[0]&lt;&lt;<span class="stringliteral">&quot;     &quot;</span>&lt;&lt;anita1-&gt;VNOISE[0]&lt;&lt;<span class="stringliteral">&quot;     &quot;</span>&lt;&lt;anita1-&gt;VNOISE[0]&lt;&lt;<span class="stringliteral">&quot;  &quot;</span>&lt;&lt;weight&lt;&lt;endl;</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;          }</div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;          <span class="keyword">delete</span> chantrig1;</div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;        } <span class="comment">//loop through the phi-fold antennas</span></div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      }  <span class="comment">//loop through the layers of antennas</span></div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;      anita1-&gt;rms_rfcm_e_single_event = sqrt(anita1-&gt;rms_rfcm_e_single_event / (anita1-&gt;HALFNFOUR * settings1-&gt;NANTENNAS));</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;      <span class="keywordflow">if</span>(!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;DISCONES==1) {</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;          <span class="comment">// loop through discones</span></div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> idiscone=0;NDISCONES;idiscone++) {</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;            <a class="code" href="../../dd/d24/class_chan_trigger.html">ChanTrigger</a> *chantrig1=<span class="keyword">new</span> <a class="code" href="../../dd/d24/class_chan_trigger.html">ChanTrigger</a>();</div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;            volts_discone=0.;</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;            polarfactor_discone=n_pol.Dot(bn1-&gt;n_bn); <span class="comment">// beam pattern</span></div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;Anita::NFREQ;k++) {</div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;              <span class="keywordflow">if</span> (anita1-&gt;freq[k]&gt;=FREQ_LOW_DISCONES &amp;&amp; anita1-&gt;freq[k]&lt;=FREQ_HIGH_DISCONES) {</div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;                thislambda=CLIGHT/sig1-&gt;N_AIR/anita1-&gt;freq[k];</div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;                heff_discone= thislambda*sqrt(2*Zr*gain_dipole/Z0/4/PI*sig1-&gt;N_AIR);   <span class="comment">// effective height of dipole,  using formula from Ped&#39;s note</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;</div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;                volts_discone+=panel1-&gt;GetVmmhz_freq(k)*0.5*heff_discone*((settings1-&gt;BW/1E6)/(<span class="keywordtype">double</span>)Anita::NFREQ)*polarfactor_discone;</div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;              }</div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            }<span class="comment">// end for k loop</span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;            vnoise_discone=anita1-&gt;VNOISE[0]*sqrt(BW_DISCONES/settings1-&gt;BW_SEAVEYS);</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;            if (settings1-&gt;SIGNAL_FLUCT) {</div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;              volts_discone+=getRNG(RNG_SIGNAL_FLUCT)-&gt;Gaus(0., vnoise_discone); <span class="comment">// here I&#39;m using the noise seen by an antenna pointed with a 10 degree cant.  Should be different for a discone but we&#39;ll change it later.</span></div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;            }</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;            <span class="keywordflow">if</span> (fabs(volts_discone)/vnoise_discone&gt;anita1-&gt;maxthreshold)</div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;              discones_passing++;</div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;            <span class="keyword">delete</span> chantrig1;</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;          } <span class="comment">// end looping through discones</span></div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;        } <span class="comment">//end if settings discones==1</span></div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> irx=0;irx&lt;settings1-&gt;NANTENNAS;irx++) {</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;        nchannels_perrx_triggered[irx]=globaltrig1-&gt;nchannels_perrx_triggered[irx];</div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      }</div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;      nchannels_triggered=Tools::iSum(globaltrig1-&gt;nchannels_perrx_triggered, settings1-&gt;NANTENNAS); <span class="comment">// find total number of antennas that were triggered.</span></div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      volts_rx_ave=GetAverageVoltageFromAntennasHit(settings1, globaltrig1-&gt;nchannels_perrx_triggered, voltagearray, volts_rx_sum);</div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;      <span class="comment">// if it passes the trigger,  then go ahead and</span></div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      <span class="comment">// calculate the chord length,  etc.</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;      <span class="comment">// intermediate counter</span></div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;      <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus)</div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;        count_asktrigger_nfb++;  <span class="comment">// just for taus</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        count_asktrigger++;</div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      dist_int_bn_2d_chord = ray1-&gt;rfexit[0].<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(bn1-&gt;r_bn_shadow)/1000; <span class="comment">// for sensitivity vs. distance plot</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <span class="comment">//distance across the surface - Stephen</span></div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;      dist_int_bn_2d = ray1-&gt;rfexit[0].<a class="code" href="../../d7/d3b/class_position.html#a26be98275e12a418e9726669e03c61f8">SurfaceDistance</a>(bn1-&gt;r_bn_shadow, bn1-&gt;surface_under_balloon) / 1000;</div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;</div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;      <span class="comment">//redundant? </span></div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      </div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      <span class="comment">/*</span></div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;<span class="comment">      if (!settings1-&gt;UNBIASED_SELECTION) </span></div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;<span class="comment">      {</span></div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;<span class="comment">        if (!antarctica-&gt;Getchord(false, len_int_kgm2, interaction1-&gt;r_in,  interaction1-&gt;pathlength_inice, settings1-&gt;UNBIASED_SELECTION == 0, interaction1-&gt;posnu, inu, interaction1-&gt;chord, interaction1-&gt;weight_nu_prob, interaction1-&gt;weight_nu, interaction1-&gt;nearthlayers, myair, interaction1-&gt;total_kgm2, interaction1-&gt;crust_entered,  interaction1-&gt;mantle_entered, interaction1-&gt;core_entered))</span></div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;<span class="comment">        {</span></div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;<span class="comment">            interaction1-&gt;weight_nu_prob=-1; </span></div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;<span class="comment">        }</span></div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;<span class="comment">      }</span></div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;<span class="comment">      */</span> </div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;      <span class="keywordflow">if</span>(tauweighttrigger==1) {</div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;        weight1=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>; <span class="comment">//?????? this is probably not right... </span></div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;        weight_prob=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>+ taus1-&gt;<a class="code" href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">weight_tau_prob</a>;</div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;      }</div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;      </div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        weight1=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3ef3decda6e004ad20f541949a948ae0">weight_nu</a>;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        weight_prob=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a>;</div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;      }</div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;</div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;      <span class="comment">//if we are using the correct sampling mode, should need to time weight. </span></div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;      weight = weight1 / interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a> * settings1-&gt;SIGMA_FACTOR * time_weight;  <span class="comment">// total weight is the earth absorption factor</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;      weight_prob = weight_prob / interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a> * settings1-&gt;SIGMA_FACTOR * time_weight;  <span class="comment">// total weight is the earth absorption factor</span></div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;      <span class="comment">// divided by the factor accounting for the fact that we only chose our interaction point within the horizon of the balloon</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      <span class="comment">// then multiply by the cross section multiplier,  to account for the fact that we get more interactions when the cross section is higher</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;      <span class="comment">//if (weight &lt; settings1-&gt;CUTONWEIGHTS &amp;&amp; !settings1-&gt;SOURCE) {</span></div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;      <span class="comment">//oindree_file &lt;&lt; weight &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;      </div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;      </div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;      <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setWeights(weight, 1./interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a>, time_weight); </div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      havent_set_weights = <span class="keyword">false</span>; </div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;     </div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;      <span class="keywordflow">if</span> (weight &lt; settings1-&gt;CUTONWEIGHTS || weight_prob &lt; settings1-&gt;CUTONWEIGHTPROBS) {</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;        <span class="keyword">delete</span> globaltrig1;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;        DO_SKIP </div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;      }</div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;      eventsfound_beforetrigger+=weight;</div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;</div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;      <span class="comment">//       EVALUATE GLOBAL TRIGGER    //</span></div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;      <span class="comment">//          FOR VPOL AND HPOL       //</span></div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;<span class="comment"></span>      </div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;      <span class="keywordtype">int</span> thispasses[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>]={0,0};</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;      <span class="keywordtype">int</span> thispassesnoise[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>]={0,0};</div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;  </div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;      <span class="keywordflow">if</span> (!isDead){</div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;        <span class="comment">// calculate global trigger on noise only waveforms</span></div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        globaltrig1-&gt;<a class="code" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">PassesTrigger</a>(settings1, anita1, discones_passing, 2, l3trignoise, l2trig, l1trig, settings1-&gt;antennaclump, loctrig, loctrig_nadironly, inu,</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;                                   thispassesnoise, <span class="keyword">true</span>);</div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;        <span class="comment">// calculate global trigger on noise + signal waveforms</span></div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;        globaltrig1-&gt;<a class="code" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">PassesTrigger</a>(settings1, anita1, discones_passing, 2, l3trig, l2trig, l1trig, settings1-&gt;antennaclump, loctrig, loctrig_nadironly, inu,</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;                                    thispasses);</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;        <span class="comment">//        if ( (l3trignoise[0]&gt;0 &amp;&amp; l3trignoise[0]==l3trig[0]) || (l3trignoise[1]&gt;0 &amp;&amp; l3trignoise[1]==l3trig[1] ) ){</span></div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;        <span class="keywordflow">if</span> ( (l3trignoise[0]&gt;0 ) || (l3trignoise[1]&gt;0 ) ){</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;          cout &lt;&lt; <span class="stringliteral">&quot;A thermal noise fluctuation generated this trigger!&quot;</span> &lt;&lt; l3trignoise[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; l3trig[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; l3trignoise[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; l3trig[1] &lt;&lt; endl;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;          <span class="keyword">delete</span> globaltrig1;</div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;          DO_SKIP</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;        }</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      }</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;      </div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;2;i++) {</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;16;j++) {</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;anita1-&gt;HALFNFOUR;k++) {</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;            count1-&gt;nl1triggers[i][whichray]+=anita1-&gt;l1trig_anita3and4_inanita[i][j][k];</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;          }</div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;        }</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;      }</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;      <span class="comment">//       Require that it passes      //</span></div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      <span class="comment">//            global trigger         //</span></div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;<span class="comment"></span>      <span class="comment">// for Anita-lite,  Anita Hill, just L1 requirement on 2 antennas. This option is currently disabled</span></div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;      <span class="comment">// Save events that generate an RF trigger or that are part of the min bias sample</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      <span class="comment">// Minimum bias sample: save all events that we could see at the payload</span></div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;      <span class="comment">// Independentely from the fact that they generated an RF trigger</span></div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;</div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;      <span class="keywordflow">if</span> ( (thispasses[0]==1 &amp;&amp; anita1-&gt;pol_allowed[0]==1)</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;           || (thispasses[1]==1 &amp;&amp; anita1-&gt;pol_allowed[1]==1)</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;           || (settings1-&gt;TRIGTYPE==0 &amp;&amp; count_pass&gt;=settings1-&gt;NFOLD)</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;           || (settings1-&gt;MINBIAS==1)){</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;</div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;          cout &lt;&lt; <span class="stringliteral">&quot;This event passes.\n&quot;</span>;</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;        anita1-&gt;passglobtrig[0]=thispasses[0];</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        anita1-&gt;passglobtrig[1]=thispasses[1];</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;</div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        <span class="comment">//calculate the phi angle wrt +x axis of the ray from exit to balloon</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;        n_exit_phi = Tools::AbbyPhiCalc(ray1-&gt;n_exit2bn[2][0], ray1-&gt;n_exit2bn[2][1]);</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;n_exit_phi is &quot; &lt;&lt; n_exit_phi &lt;&lt; &quot;\n&quot;;  </span></div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;        <span class="comment">// keep track of events passing trigger</span></div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;        count1-&gt;npassestrigger[whichray]++;</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;        <span class="comment">// tags this event as passing</span></div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;        passestrigger=1;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;</div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;        <span class="comment">// for plotting</span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        <span class="keywordflow">if</span> (tree11-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;          tree11-&gt;Fill();</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;        <span class="comment">// for taus</span></div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;        <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus)</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;          count_passestrigger_nfb++;</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;</div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;        interaction1-&gt;crust_entered=0; <span class="comment">//These are switches that let us tell how far a given neutrino penetrated.  Clear them before entering Getchord.</span></div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;        interaction1-&gt;mantle_entered=0;</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        interaction1-&gt;core_entered=0;</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;</div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;        <span class="comment">// this gets the weight due to stopping in earth</span></div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;        <span class="comment">// returns 0 if chord&lt;1m</span></div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;        <span class="keywordflow">if</span> (tautrigger==1 || interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">weight_nu_prob</a> &gt;= 0) {</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;          <span class="comment">//cout &lt;&lt; &quot;passes chord.\n&quot;;</span></div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;          <span class="keywordflow">if</span> (nupathtree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;            nupathtree-&gt;Fill();</div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;</div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;          <span class="comment">// counts how many have a good chord length</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;          count_chordgoodlength++;</div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;          pieceofkm2sr=weight*antarctica-&gt;volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr/(double)NNU/len_int;</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;          <span class="keywordflow">if</span> (h10-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST)</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;            h10-&gt;Fill(hitangle_e_all[0], weight);</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;<span class="comment">//cerr &lt;&lt; inu&lt;&lt;&quot; passes. weight= &quot;&lt;&lt;weight&lt;&lt;&quot;    El.Angle= &quot;&lt;&lt;(antarctica-&gt;GetSurfaceNormal(bn1-&gt;r_bn).Cross(ray1-&gt;n_exit2bn[2])).Cross(antarctica-&gt;GetSurfaceNormal(bn1-&gt;r_bn)).Unit().Angle(ray1-&gt;n_exit2bn[2].Unit())*180./PI&lt;&lt;&quot;    Distance= &quot;&lt;&lt; bn1-&gt;r_bn.Distance(ray1-&gt;rfexit[2])&lt;&lt;&quot;   screenNpts=&quot;&lt;&lt;panel1-&gt;GetNvalidPoints()&lt;&lt; &quot;:  vmmhz[0] = &quot;&lt;&lt;panel1-&gt;GetVmmhz_freq(0)&lt;&lt;&quot; : trans pol &quot;&lt;&lt; panel1-&gt;GetPol(0)&lt;&lt;&quot; : IncAngle &quot;&lt;&lt;panel1-&gt;GetIncidenceAngle(0)*180./PI&lt;&lt; &quot; : TransAngle &quot;&lt;&lt;panel1-&gt;GetTransmissionAngle(0)*180./PI&lt;&lt;&quot; : Tslappy &quot;&lt;&lt;panel1-&gt;GetTperpendicular_polPerpendicular(0)&lt;&lt;&quot; : Tpokey &quot;&lt;&lt;panel1-&gt;GetTparallel_polParallel(0)&lt;&lt; endl;</span></div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;<span class="comment">//cerr&lt;&lt;bn1-&gt;r_bn.Lat()&lt;&lt;&quot;  &quot;&lt;&lt;-90.+bn1-&gt;r_bn.Lat()&lt;&lt;endl;</span></div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;<span class="comment">//cerr&lt;&lt;interaction1-&gt;posnu.Lon()&lt;&lt;&quot;  &quot;&lt;&lt;-90.+interaction1-&gt;posnu.Lat()&lt;&lt;endl;</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;<span class="comment">//cerr&lt;&lt;ray1-&gt;rfexit[2].Lon()&lt;&lt;&quot;  &quot;&lt;&lt;-90.+ray1-&gt;rfexit[2].Lat()&lt;&lt;endl;</span></div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;<span class="comment">//cerr&lt;&lt;ray1-&gt;rfexit[2].Distance(interaction1-&gt;posnu)&lt;&lt;endl;</span></div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;<span class="comment">//cerr&lt;&lt;interaction1-&gt;nnu.Angle(antarctica-&gt;GetSurfaceNormal(interaction1-&gt;posnu))&lt;&lt;endl;</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;<span class="comment">//cerr&lt;&lt;interaction1-&gt;nnu.Angle(ray1-&gt;n_exit2bn[2])&lt;&lt;endl;</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;<span class="comment">//cerr&lt;&lt;ray1-&gt;rfexit[2].Distance(bn1-&gt;r_bn)&lt;&lt;endl;</span></div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;<span class="comment">//cerr&lt;&lt;interaction1-&gt;posnu.Distance(bn1-&gt;r_bn)&lt;&lt;endl;</span></div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;          <span class="comment">// log of weight and chord for plotting</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;          logweight=log10(weight);</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;          interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ad6bd919d4c158047bd04f0bdeba675b5">logchord</a>=log10(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">chord</a>);</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;<span class="comment">//        cerr&lt;&lt;&quot;-&gt; We got a live one! &quot;&lt;&lt;nunum&lt;&lt;&quot;   Nscreenvalid: &quot;&lt;&lt;panel1-&gt;GetNvalidPoints()&lt;&lt;&quot;   weight: &quot;&lt;&lt;weight&lt;&lt;endl;</span></div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;          <span class="comment">// if neutrino travels more than one meter in ice</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;          <span class="keywordflow">if</span> (interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>&gt;1) {</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;            <span class="comment">// intermediate counter</span></div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;            count_d2goodlength++;</div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;</div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;            <span class="comment">// for taus</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;            <span class="comment">// add to tally of neutrinos found,  weighted.</span></div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;            <span class="keywordflow">if</span>(sec1-&gt;secondbang &amp;&amp; sec1-&gt;interestedintaus) {</div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;              eventsfound_nfb+=weight;</div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;              index_weights=(int)(((logweight-MIN_LOGWEIGHT)/(MAX_LOGWEIGHT-MIN_LOGWEIGHT))*(double)NBINS);</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;              eventsfound_nfb_binned[index_weights]++;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;              <span class="keywordflow">if</span> (tree16-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;                tree16-&gt;Fill();</div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;            }<span class="comment">//end if secondbang &amp; interestedintaus</span></div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;            <span class="keywordflow">else</span> {</div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;              allcuts[whichray]++;</div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;              allcuts_weighted[whichray]+=weight;</div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;              <span class="keywordflow">if</span> (thispasses[0] &amp;&amp; thispasses[1]) {</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;                allcuts_weighted_polarization[2]+=weight;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thispasses[0]){</div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                allcuts_weighted_polarization[0]+=weight;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;              } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (thispasses[1]){</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;                allcuts_weighted_polarization[1]+=weight;</div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;              }</div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;              anita1-&gt;weight_inanita=weight;</div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;</div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;              <span class="keywordflow">if</span> (h1mybeta-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1)</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;                h1mybeta -&gt; Fill(mybeta, weight); <span class="comment">//get the angle distribution of mybeta</span></div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;              eventsfound+=weight; <span class="comment">// counting events that pass,  weighted.</span></div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;              eventsfound_prob+=weight_prob; <span class="comment">// counting events that pass,  probabilities.</span></div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;              eventsfound_divided_by_lint+=weight/len_int; </div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;</div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;              <span class="keywordflow">if</span> (NNU_per_source.size())</div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;              {</div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;                eventsfound_per_source[which_source]+=weight*src_time_weight/time_weight; <span class="comment">// counting events that pass,  weighted.</span></div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;                eventsfound_prob_per_source[which_source]+=weight_prob*src_time_weight/time_weight; <span class="comment">// counting events that pass,  probabilities.</span></div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;              }</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;</div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;              <span class="keywordflow">if</span> (cosalpha&gt;0)</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;                eventsfound_belowhorizon+=weight;</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;              count1-&gt;npass[whichray]++;  <span class="comment">// counting events that pass,  unweighted.</span></div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;              <span class="comment">// for calculating errors on sensitivity</span></div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;              <span class="comment">// need to find how many events as a function of weight</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;              <span class="comment">// here,  we find how to index weight</span></div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;              <span class="keywordflow">if</span> (logweight&lt;MIN_LOGWEIGHT)  <span class="comment">// underflows,  set to 0th bin</span></div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;                index_weights=0;</div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;              <span class="keywordflow">else</span> <span class="keywordflow">if</span> (logweight&gt;MAX_LOGWEIGHT) <span class="comment">// overflows,  set to last bin</span></div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;                index_weights=NBINS-1;</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;              <span class="keywordflow">else</span> <span class="comment">// which index weight corresponds to.</span></div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;                index_weights=(int)(((logweight-MIN_LOGWEIGHT)/(MAX_LOGWEIGHT-MIN_LOGWEIGHT))*(double)NBINS);</div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;              <span class="comment">// count number of events that pass,  binned in weight</span></div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;              <span class="keywordflow">if</span> (index_weights&lt;NBINS)</div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;                eventsfound_binned[index_weights]++;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;</div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;              <span class="comment">// number of events in a ring at distance from balloon</span></div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;              <span class="keywordflow">if</span> (index_distance&lt;NBINS_DISTANCE)</div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;                eventsfound_binned_distance[index_distance]+= weight;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;              <span class="comment">// same,  now binned in weight,  for calculating errors</span></div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;              <span class="keywordflow">if</span> (index_distance&lt;NBINS_DISTANCE &amp;&amp; index_weights&lt;NBINS)</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;                eventsfound_binned_distance_forerror[index_distance][index_weights]++;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;              <span class="comment">// for debugging</span></div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;              <span class="keywordflow">if</span> (logweight&gt;-3)</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                eventsfound_weightgt01+=weight;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;              <span class="comment">// how many events just pass through crust,  for same purpose.</span></div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;              <span class="keywordflow">if</span> (nearthlayers==1)</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;                eventsfound_crust+=weight;</div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;</div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;              <span class="keywordflow">if</span> (h1mybeta-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; settings1-&gt;HIST==1) {</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;                h1mybeta -&gt; Fill(mybeta, weight);</div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;                h1mytheta -&gt; Fill(mytheta, weight);<span class="comment">//fill mytheta</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;              }</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;            }<span class="comment">//end else secondbang &amp; interestedintaus</span></div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;            <span class="comment">//for plotting events distribution map only</span></div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;            <span class="keywordflow">if</span>(weight&gt;0.0001){</div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;              <span class="keywordtype">double</span> int_lon, int_lat;</div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;              <span class="keywordtype">double</span> E,N;</div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;              <span class="comment">//here are the longitude and altitude which Amy defined</span></div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;              int_lon = interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a736146228c802ee9b3f0953349c4410a">Lon</a>(); <span class="comment">// what latitude,  longitude does interaction occur at</span></div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;              int_lat = interaction1-&gt;posnu.<a class="code" href="../../d7/d3b/class_position.html#a33b137a138fa73850401f9c95be7b9fa">Lat</a>();</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;              antarctica-&gt;LonLattoEN(int_lon, int_lat, E, N);</div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;              <span class="keywordflow">if</span>(whichray==0)<span class="comment">//direct</span></div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;                dir_int_coord-&gt;Fill(E, N);</div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;              <span class="keywordflow">if</span>(whichray==1)</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;                ref_int_coord-&gt;Fill(E, N);</div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;            }</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;            <span class="comment">// just for plotting.</span></div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;            offaxis=(double)fabs(viewangle-sig1-&gt;changle);</div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;            nsigma_offaxis=offaxis/deltheta_had_max;</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;            hundogaintoheight_e-&gt;Fill(undogaintoheight_e, weight);</div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;            hundogaintoheight_h-&gt;Fill(undogaintoheight_h, weight);</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;            rec_diff-&gt;Fill((rec_efield-true_efield)/true_efield, weight);</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;            rec_diff0-&gt;Fill((rec_efield_array[0]-true_efield_array[0])/true_efield_array[0], weight);</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            rec_diff1-&gt;Fill((rec_efield_array[1]-true_efield_array[1])/true_efield_array[1], weight);</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            rec_diff2-&gt;Fill((rec_efield_array[2]-true_efield_array[2])/true_efield_array[2], weight);</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;            rec_diff3-&gt;Fill((rec_efield_array[3]-true_efield_array[3])/true_efield_array[3], weight);</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;            recsum_diff-&gt;Fill((rec_efield_array[0]+rec_efield_array[1]+rec_efield_array[2]+rec_efield_array[3]-true_efield)/true_efield, weight);</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;            <span class="comment">// calc source lon, lat, alt</span></div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;            sourceLon = ray1-&gt;rfexit[2].<a class="code" href="../../d7/d3b/class_position.html#a736146228c802ee9b3f0953349c4410a">Lon</a>() - 180;</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;            sourceLat = ray1-&gt;rfexit[2].<a class="code" href="../../d7/d3b/class_position.html#a33b137a138fa73850401f9c95be7b9fa">Lat</a>() - 90;</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;            sourceAlt = antarctica-&gt;SurfaceAboveGeoid(sourceLon+180, sourceLat+90);</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;            </div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;            <span class="comment">//Now put data in Vectors and Positions into arrays for output to the ROOT file.</span></div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;HIST &amp;&amp; finaltree-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                nnu_array[i] = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>[i];</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                r_in_array[i] = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>[i];</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;                r_bn_array[i] = bn1-&gt;r_bn[i];</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;                n_bn_array[i] = bn1-&gt;n_bn[i];</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;                posnu_array[i] = interaction1-&gt;posnu[i];</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;                ant_max_normal0_array[i] = ant_max_normal0[i];</div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;                ant_max_normal1_array[i] = ant_max_normal1[i];</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;                ant_max_normal2_array[i] = ant_max_normal2[i];</div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;                n_pol_array[i] = n_pol[i];</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;                r_enterice_array[i] = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">r_enterice</a>[i];</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;                nsurf_rfexit_array[i] = ray1-&gt;nsurf_rfexit[i];</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;                nsurf_rfexit_db_array[i] = ray1-&gt;nsurf_rfexit_db[i];</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;              } <span class="comment">//end for (fill arrays)</span></div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++) {</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;                  nrf_iceside_array[j][i] = ray1-&gt;nrf_iceside[j][i];</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;                  nrf_iceside_db_array[j][i] = nrf_iceside_db[j][i];</div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;                  n_exit2bn_array[j][i] = ray1-&gt;n_exit2bn[j][i];</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;                  n_exit2bn_db_array[j][i] = n_exit2bn_db[j][i];</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;                  rfexit_array[j][i] = ray1-&gt;rfexit[j][i];</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;                  rfexit_db_array[j][i] = ray1-&gt;rfexit_db[j][i];</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;                } <span class="comment">//end for</span></div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;              } <span class="comment">//end for</span></div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;              <span class="keywordflow">if</span> (settings1-&gt;HIST &amp;&amp; vmmhz_tree-&gt;GetEntries()&lt;20) {</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;                vmmhz_tree-&gt;Fill();</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;              }</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;              nuflavorint2 = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">nuflavorint</a>;</div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;              costheta_nutraject2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a>;</div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;              phi_nutraject2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a21e2b2f14f8a5990763a1af10aacdf83">phi_nutraject</a>;</div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;              altitude_int2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">altitude_int</a>;</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;              currentint2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">currentint</a>;</div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;              d12=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a3fe851ac8a75b2ab8485e9c15d465a09">d1</a>;</div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;              d22=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">d2</a>;</div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;              dtryingdirection2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>;</div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;              logchord2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#ad6bd919d4c158047bd04f0bdeba675b5">logchord</a>;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;              r_fromballoon2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">r_fromballoon</a>[0];</div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;              chord_kgm2_bestcase2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">chord_kgm2_bestcase</a>;</div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;              chord_kgm2_ice2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a9d37bb0ab6d96f72391206583c91d7a7">chord_kgm2_ice</a>;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;              weight_bestcase2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a5348445748bde8ee1c550a99127be2b3">weight_bestcase</a>;</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;              r_exit2bn2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8949fd35ed92144d9f9de770d778a59d">r_exit2bn</a>;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;              r_exit2bn_measured2=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0be48e99fca7d0dfc99fdf4e01b386e3">r_exit2bn_measured</a>;</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;              sourceMag = ray1-&gt;rfexit[2].Mag();</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;              sample_x = antarctica-&gt;getSampleX();</div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;              sample_y = antarctica-&gt;getSampleY();</div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;              finaltree-&gt;Fill();</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;              count1-&gt;IncrementWeights_r_in(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">r_in</a>, weight);</div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;            } <span class="comment">//end if HIST &amp; HISTMAXENTRIES</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;            realEvPtr     = <span class="keyword">new</span> <a class="code" href="../../d9/d4a/class_useful_anita_event.html">UsefulAnitaEvent</a>();</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;            rawHeaderPtr  = <span class="keyword">new</span> <a class="code" href="../../d0/dc4/class_raw_anita_header.html">RawAnitaHeader</a>();</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;            Adu5PatPtr    = <span class="keyword">new</span> <a class="code" href="../../d2/dbf/class_adu5_pat.html">Adu5Pat</a>();</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a3879b506194eb2cefff3fa13d6b8c766">latitude</a>= bn1-&gt;latitude;</div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a881469fddb163b232c688b82924232bd">longitude</a>=bn1-&gt;longitude;</div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a299db954c0d3dc3f5d38e155cf5638f3">altitude</a>=bn1-&gt;altitude;</div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a4427ff546161494952d8843b98ba58c1">realTime</a>=bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a8aca444bcebad17c7645ec7d65afb7e4">heading</a> = bn1-&gt;heading;</div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#af99a5597edfa5c86c4c4afd7841582b9">pitch</a> = bn1-&gt;pitch;</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;            Adu5PatPtr-&gt;roll = bn1-&gt;roll;</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;            Adu5PatPtr-&gt;run = run_no;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;</div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;            memset(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#ae86589d99938983649c75844d9853de8">fNumPoints</a>, 0, <span class="keyword">sizeof</span>(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#ae86589d99938983649c75844d9853de8">fNumPoints</a>) );</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;            memset(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#af702281d452d17cca331c620e06ad317">fVolts</a>,     0, <span class="keyword">sizeof</span>(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#af702281d452d17cca331c620e06ad317">fVolts</a>)     );</div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;            memset(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#a14969bce1dc32ecc09f4d531c811b32b">fTimes</a>,     0, <span class="keyword">sizeof</span>(realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#a14969bce1dc32ecc09f4d531c811b32b">fTimes</a>)     );</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;</div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;            <span class="keywordtype">int</span> fNumPoints = 260;</div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ichan=0; ichan&lt;108; ichan++){</div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;              realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#ae86589d99938983649c75844d9853de8">fNumPoints</a>[ichan] = fNumPoints;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;</div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; fNumPoints; j++) {</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;                <span class="comment">// convert seconds to nanoseconds</span></div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;                realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#a14969bce1dc32ecc09f4d531c811b32b">fTimes</a>[ichan][j] = j * anita1-&gt;TIMESTEP * 1.0E9;</div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;              }</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;            }</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;                    realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#a62293da10033d624e2fe7b3f9e35ae41">fRFSpike</a> = 0;<span class="comment">// glitch does not likely happen in mc data.</span></div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant = 0; iant &lt; settings1-&gt;NANTENNAS; iant++){</div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;              <span class="comment">//int IceMCAnt = GetIceMCAntfromUsefulEventAnt(anita1,  AnitaGeom1,  iant);</span></div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;              <span class="keywordtype">int</span> IceMCAnt = GetIceMCAntfromUsefulEventAnt(settings1,  iant);</div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;              <span class="keywordtype">int</span> UsefulChanIndexH = AnitaGeom1-&gt;<a class="code" href="../../d8/db1/class_anita_geom_tool.html#af1a3c9c9884f3cb09f520ad2dad96ea3">getChanIndexFromAntPol</a>(iant,  <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d">AnitaPol::kHorizontal</a>);</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;              <span class="keywordtype">int</span> UsefulChanIndexV = AnitaGeom1-&gt;<a class="code" href="../../d8/db1/class_anita_geom_tool.html#af1a3c9c9884f3cb09f520ad2dad96ea3">getChanIndexFromAntPol</a>(iant,  <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a">AnitaPol::kVertical</a>);</div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;              <span class="comment">//              realEvPtr-&gt;fNumPoints[UsefulChanIndexV] = fNumPoints;</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;              <span class="comment">//              realEvPtr-&gt;fNumPoints[UsefulChanIndexH] = fNumPoints;</span></div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;              realEvPtr-&gt;<a class="code" href="../../d6/d74/class_raw_anita_event.html#a82b9c921a5b03e60eaf80fab14b9adf0">chanId</a>[UsefulChanIndexV] = UsefulChanIndexV;</div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;              realEvPtr-&gt;<a class="code" href="../../d6/d74/class_raw_anita_event.html#a82b9c921a5b03e60eaf80fab14b9adf0">chanId</a>[UsefulChanIndexH] = UsefulChanIndexH;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; fNumPoints; j++) {</div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;                <span class="comment">// convert seconds to nanoseconds</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;                <span class="comment">//                realEvPtr-&gt;fTimes[UsefulChanIndexV][j] = j * anita1-&gt;TIMESTEP * 1.0E9;</span></div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;                <span class="comment">//                realEvPtr-&gt;fTimes[UsefulChanIndexH][j] = j * anita1-&gt;TIMESTEP * 1.0E9;</span></div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;                <span class="comment">// convert volts to millivolts</span></div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;                realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#af702281d452d17cca331c620e06ad317">fVolts</a>[UsefulChanIndexH][j] =  volts_rx_rfcm_lab_h_all[IceMCAnt][j+128]*1000;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;                realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#ad45b6e5aa9f0e9b7b1b7ab6d2ff4ef1a">fCapacitorNum</a>[UsefulChanIndexH][j] = 0;</div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#af702281d452d17cca331c620e06ad317">fVolts</a>[UsefulChanIndexV][j] =  volts_rx_rfcm_lab_e_all[IceMCAnt][j+128]*1000;</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;                realEvPtr-&gt;<a class="code" href="../../d9/d4a/class_useful_anita_event.html#ad45b6e5aa9f0e9b7b1b7ab6d2ff4ef1a">fCapacitorNum</a>[UsefulChanIndexV][j] = 0;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;              }<span class="comment">//end int j</span></div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;            }<span class="comment">// end int iant</span></div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;</div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;            realEvPtr-&gt;<a class="code" href="../../d6/d74/class_raw_anita_event.html#afeca0dd476450527b870c012bfb4914e">eventNumber</a> = eventNumber;</div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;</div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#af363eb871304cc194b1e00172a0dfe71">eventNumber</a> = eventNumber;</div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#aea004b982a2265646970aca691e1d707">surfSlipFlag</a> = 0;</div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a3fdea3bec4f8682964033e048b0dddef">errorFlag</a> = 0;</div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;</div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;MINBIAS==1)</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;              rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a055774db95517a74290a7735576beeef">trigType</a> = 8; <span class="comment">// soft-trigger</span></div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;            <span class="keywordflow">else</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;              rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a055774db95517a74290a7735576beeef">trigType</a> = 1; <span class="comment">// RF trigger</span></div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;            </div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a56e3571b12bca1472a6b34f2db5e9a3b">run</a> = run_no;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;            <span class="comment">// put the vpol only as a placeholder - these are only used in Anita-2 anyway</span></div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a839763b5c6fd348fb0c492ee87088b68">upperL1TrigPattern</a> = l1trig[0][0];</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#af6439566d155c931907f0753968b5f09">lowerL1TrigPattern</a> = l1trig[0][1];</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a42809439d87cd10df266839871d2437b">nadirL1TrigPattern</a> = l1trig[0][2];</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a8a70ecfc9450638c1aa1af9dd9619b1d">upperL2TrigPattern</a> = l2trig[0][0];</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a870409dc8330ae256725e07c16ce3d1f">lowerL2TrigPattern</a> = l2trig[0][1];</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a683cf2a794dee50d13dc8099d1659229">nadirL2TrigPattern</a> = l2trig[0][2];</div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;</div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;WHICH&lt;9){</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;              rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#af2df2269147d5b08f68170d470dfb2f8">phiTrigMask</a>  = (short) anita1-&gt;phiTrigMask;</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;              rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a7a061cc7bf8cc7dac87259586cc4e1f2">l3TrigPattern</a> = (<span class="keywordtype">short</span>) l3trig[0];</div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;            }</div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#ac47047421e5d427609bcc92f8f8833e2">calibStatus</a> = 31;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#a057c7366e4ef9e485adc55860eedad2b">realTime</a> = bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;            rawHeaderPtr-&gt;<a class="code" href="../../d0/dc4/class_raw_anita_header.html#aff1b80a19465ac1784e336e0023573f6">triggerTime</a> = bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a3879b506194eb2cefff3fa13d6b8c766">latitude</a>= bn1-&gt;latitude;</div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a881469fddb163b232c688b82924232bd">longitude</a>=bn1-&gt;longitude;</div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a299db954c0d3dc3f5d38e155cf5638f3">altitude</a>=bn1-&gt;altitude;</div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a4427ff546161494952d8843b98ba58c1">realTime</a>=bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#a8aca444bcebad17c7645ec7d65afb7e4">heading</a> = bn1-&gt;heading;</div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;            Adu5PatPtr-&gt;<a class="code" href="../../d2/dbf/class_adu5_pat.html#af99a5597edfa5c86c4c4afd7841582b9">pitch</a> = bn1-&gt;pitch;</div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;            Adu5PatPtr-&gt;roll = bn1-&gt;roll;</div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;            Adu5PatPtr-&gt;run = run_no;</div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;&quot;</span> &lt;&lt; endl;</div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;            cout &lt;&lt; <span class="stringliteral">&quot;Neutrino (evNum = &quot;</span> &lt;&lt; eventNumber &lt;&lt; <span class="stringliteral">&quot;, weight = &quot;</span> &lt;&lt; weight &lt;&lt; <span class="stringliteral">&quot; weight_prob = &quot;</span> &lt;&lt; weight_prob &lt;&lt;<span class="stringliteral">&quot;) passed&quot;</span> &lt;&lt; endl;</div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;            </div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10) {</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;              rawHeaderPtr-&gt;setTrigPattern((<span class="keywordtype">short</span>) l3trig[0], <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a">AnitaPol::kVertical</a>);</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;              rawHeaderPtr-&gt;setTrigPattern((<span class="keywordtype">short</span>) l3trig[1], <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d">AnitaPol::kHorizontal</a>);</div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;              rawHeaderPtr-&gt;setMask( (<span class="keywordtype">short</span>) anita1-&gt;l1TrigMask,  (<span class="keywordtype">short</span>) anita1-&gt;phiTrigMask,  <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a">AnitaPol::kVertical</a>);</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;              rawHeaderPtr-&gt;setMask( (<span class="keywordtype">short</span>) anita1-&gt;l1TrigMaskH, (<span class="keywordtype">short</span>) anita1-&gt;phiTrigMaskH, <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d">AnitaPol::kHorizontal</a>);</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;            }</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;            truthEvPtr        = <span class="keyword">new</span> <a class="code" href="../../d7/dd8/class_truth_anita_event.html">TruthAnitaEvent</a>();</div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a3a12546b0d51a79bfda21a5241cf6a35">eventNumber</a>      = eventNumber;</div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a4cb34908e504793046832d7caa2a5136">realTime</a>         = bn1-&gt;realTime_flightdata;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a54781617ba9086e115ea859a4fbd86ff">run</a>              = run_no;</div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad8a6a235c9c5096e477f0ff2d808910d">nuMom</a>            = pnu;</div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aa9ad1b6f04a28622b497f28a5c351cdf">showerE</a> =        pnu * sumfrac; </div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a3998ba2289088aa557bd9c2f53b6e704">nu_pdg</a>           = pdgcode;</div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1f489ed5162c79e19f8b1ebd35fccbc0">e_component</a>, e_component, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1f489ed5162c79e19f8b1ebd35fccbc0">e_component</a>));</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad741e5ab6704918be298a67dfcca334b">h_component</a>, h_component, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad741e5ab6704918be298a67dfcca334b">h_component</a>));</div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a18bf3705078fec42385ee1b991f46e3a">n_component</a>, n_component, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a18bf3705078fec42385ee1b991f46e3a">n_component</a>));</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad2e5a5b9cb38835922e9d33494a12dd1">e_component_k</a> ,e_component_kvector, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad2e5a5b9cb38835922e9d33494a12dd1">e_component_k</a>));</div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0bf32be933c245b5caed0a6aea75aa37">h_component_k</a> ,h_component_kvector, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0bf32be933c245b5caed0a6aea75aa37">h_component_k</a>));</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;            memcpy(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0a236c05c12a25b9b44f82e96c1e2c3c">n_component_k</a> ,n_component_kvector, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0a236c05c12a25b9b44f82e96c1e2c3c">n_component_k</a>));</div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad6650c6860ed54bdd6e793ac2f9dfaa3">sourceLon</a>        = sourceLon;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ab85dcf36877be689e719314a3b67fd40">sourceLat</a>        = sourceLat;</div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a973d4cb23f66fe77791e69dacbdbe20f">sourceAlt</a>        = sourceAlt;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;            <span class="keywordflow">if</span>(src_model){cout &lt;&lt; <span class="stringliteral">&quot;It originated from &quot;</span> &lt;&lt; objName &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; RA*15 &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; dec &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;}</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;            </div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aa54a2e1fbf8a2599e89c4214a52b90a9">weight</a>           = weight;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ae0c154dd06c7d018e2e173958ecd0235">weight1</a>           = weight1;</div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a828298008e4097957f6d369213a9b7a5">weight_prob</a>           = weight_prob;</div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ac8ccc120179f7aa550ee7f3c420ee24e">phaseWeight</a>       = 1./interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">dnutries</a>;</div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a9512ab42e6813f432d99d2bd3a349926">timeWeight</a>       = time_weight;</div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ae18becdaec050172992d06c6184e9400">sourceTimeWeight</a>       = src_time_weight;</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a34c6bc016549c415cbb61390b0f084f0">l_int</a> = len_int; </div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;        truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a3dbd42be814f96e72a54b351e73bb5be">tuffIndex</a> = (short)anita1-&gt;tuffIndex;</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;        </div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;            <span class="comment">// for passed neutrinos:</span></div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;            </div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;#ifdef ANITA3_EVENTCORRELATOR</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;            <span class="keywordflow">if</span>(settings1-&gt;ALL_SKY_MAP)</div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;              {  </div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;                astroObject-&gt;SetX(RA);</div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;                astroObject-&gt;SetY(dec);</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;                astroObject-&gt;SetMarkerStyle(20);</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                astroObject-&gt;SetMarkerSize(1.5);</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                astroObject-&gt;SetMarkerColor(9);</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                skyMapOut-&gt;addMarker(astroObject);</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;              }</div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;<span class="preprocessor">#endif </span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;            </div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;</div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a62548fff9fb234fef763e5cf9a7e73b7">source_index</a> = which_source;</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;            truthEvPtr-&gt;RA = RA;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad25ff64b15ca1367b85912dafa8e1195">dec</a> = dec;</div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;</div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ab59217bc86a46ad7c512bcf4677ec90c">objName</a> =objName;</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;            <span class="comment">//</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;            </div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++){</div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a4a509e49df3c70d5aeb24125f2e96481">balloonPos</a>[i]  = bn1-&gt;r_bn[i];</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a26f272fa6d96cf9f2bca78b9d0662b63">balloonDir</a>[i]  = bn1-&gt;n_bn[i];</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#afe9ea8167426bdf6806a7aff3fa677b7">nuPos</a>[i]       = interaction1-&gt;posnu[i];</div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a217f992ab0e6ad1a6e3d4fcfe750cfa5">nuDir</a>[i]       = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>[i];</div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;            }</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++){</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++){</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;                truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a8c32df6f314497da84429bb5415ae804">rfExitNor</a>[i][j] = ray1-&gt;n_exit2bn[i][j];</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;                truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a7e5598f7f6f9f4ef1c86655ef221dffe">rfExitPos</a>[i][j] = ray1-&gt;rfexit[i][j];</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;              }</div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;            }</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;48;i++){</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ac84b5c53e71e67af1dcd64809d929f4d">hitangle_e</a>[i]  = hitangle_e_all[i];</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1dca83a359aa61b27d09ca2ae84016b6">hitangle_h</a>[i]  = hitangle_h_all[i];</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;            }</div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;            <span class="keywordflow">if</span>(!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NFREQ;i++)</div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;                truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a741da86656dc04af0e574080dd1fe26b">vmmhz</a>[i]       = panel1-&gt;GetVmmhz_freq(i);</div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;            }</div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;</div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;            </div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>,       0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>)       );</div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a30087999411644d07038e56f42f62dc4">fSignalAtTrigger</a>,   0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a30087999411644d07038e56f42f62dc4">fSignalAtTrigger</a>)   );</div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adb083b0a3dde75489ec96e442dcdc5d0">fNoiseAtTrigger</a>,    0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adb083b0a3dde75489ec96e442dcdc5d0">fNoiseAtTrigger</a>)    );</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>,     0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>)     );</div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a13bf498628c5c5cb7ef684d3a3c318f4">thresholds</a>,         0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a13bf498628c5c5cb7ef684d3a3c318f4">thresholds</a>)         );</div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;            memset(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aacac4af652e7684a8a6046106e9e6d34">fDiodeOutput</a>,       0, <span class="keyword">sizeof</span>(truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aacac4af652e7684a8a6046106e9e6d34">fDiodeOutput</a>)       );</div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;            </div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a8b818f0f6a987c38b9dd713dfecb9c92">maxSNRAtTriggerV</a>=0;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0e861e94107b3d9e1fda17e7d506708d">maxSNRAtTriggerH</a>=0;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ab3cb2b8d3f3883c99069ea35cc63b52a">maxSNRAtDigitizerV</a>=0;</div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;            truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adc79242f0c81308db3e97095b387f85f">maxSNRAtDigitizerH</a>=0;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant = 0; iant &lt; settings1-&gt;NANTENNAS; iant++){</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;              <span class="keywordtype">int</span> UsefulChanIndexH = AnitaGeom1-&gt;<a class="code" href="../../d8/db1/class_anita_geom_tool.html#af1a3c9c9884f3cb09f520ad2dad96ea3">getChanIndexFromAntPol</a>(iant,  <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d">AnitaPol::kHorizontal</a>);</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;              <span class="keywordtype">int</span> UsefulChanIndexV = AnitaGeom1-&gt;<a class="code" href="../../d8/db1/class_anita_geom_tool.html#af1a3c9c9884f3cb09f520ad2dad96ea3">getChanIndexFromAntPol</a>(iant,  <a class="code" href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a">AnitaPol::kVertical</a>);</div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;</div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexV] = Tools::calculateSNR(justSignal_trig[0][iant], justNoise_trig[0][iant]);</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexH] = Tools::calculateSNR(justSignal_trig[1][iant], justNoise_trig[1][iant]);</div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;              </div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;              <span class="keywordflow">if</span> (truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexV]&gt;truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a8b818f0f6a987c38b9dd713dfecb9c92">maxSNRAtTriggerV</a>) truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a8b818f0f6a987c38b9dd713dfecb9c92">maxSNRAtTriggerV</a>=truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexV];</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;              <span class="keywordflow">if</span> (truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexH]&gt;truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0e861e94107b3d9e1fda17e7d506708d">maxSNRAtTriggerH</a>) truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a0e861e94107b3d9e1fda17e7d506708d">maxSNRAtTriggerH</a>=truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">SNRAtTrigger</a>[UsefulChanIndexH];</div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexV] = Tools::calculateSNR(justSignal_dig[0][iant], justNoise_dig[0][iant]);</div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexH] = Tools::calculateSNR(justSignal_dig[1][iant], justNoise_dig[1][iant]);</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;              </div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;              <span class="keywordflow">if</span> (truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexV]&gt;truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ab3cb2b8d3f3883c99069ea35cc63b52a">maxSNRAtDigitizerV</a>) truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ab3cb2b8d3f3883c99069ea35cc63b52a">maxSNRAtDigitizerV</a>=truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexV];</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;              <span class="keywordflow">if</span> (truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexH]&gt;truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adc79242f0c81308db3e97095b387f85f">maxSNRAtDigitizerH</a>) truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adc79242f0c81308db3e97095b387f85f">maxSNRAtDigitizerH</a>=truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">SNRAtDigitizer</a>[UsefulChanIndexH];</div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;              </div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a13bf498628c5c5cb7ef684d3a3c318f4">thresholds</a>[UsefulChanIndexV] = thresholdsAnt[iant][0][4];</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;              truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a13bf498628c5c5cb7ef684d3a3c318f4">thresholds</a>[UsefulChanIndexH] = thresholdsAnt[iant][1][4];</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;              <span class="keywordtype">int</span> irx = iant;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;              <span class="keywordflow">if</span> (iant&lt;16){</div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;                <span class="keywordflow">if</span> (iant%2) irx = iant/2;</div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;                <span class="keywordflow">else</span>        irx = iant/2 + 1;</div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;              }</div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;              </div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;              <span class="keywordflow">if</span> (settings1-&gt;WRITE_WAVEFORMS) </div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;              {</div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; fNumPoints; j++) {</div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a393c669277342a5b141d7d95b9701585">fTimes</a>[UsefulChanIndexV][j]             = j * anita1-&gt;TIMESTEP * 1.0E9;</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a393c669277342a5b141d7d95b9701585">fTimes</a>[UsefulChanIndexH][j]             = j * anita1-&gt;TIMESTEP * 1.0E9;</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;                  </div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a30087999411644d07038e56f42f62dc4">fSignalAtTrigger</a>[UsefulChanIndexV][j]   = justSignal_trig[0][iant][j+128]*1000;</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a30087999411644d07038e56f42f62dc4">fSignalAtTrigger</a>[UsefulChanIndexH][j]   = justSignal_trig[1][iant][j+128]*1000;</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adb083b0a3dde75489ec96e442dcdc5d0">fNoiseAtTrigger</a>[UsefulChanIndexV][j]    = justNoise_trig[0][iant][j+128]*1000;</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#adb083b0a3dde75489ec96e442dcdc5d0">fNoiseAtTrigger</a>[UsefulChanIndexH][j]    = justNoise_trig[1][iant][j+128]*1000;</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a73dfe58f637f50c52fa55fbd3b876c8e">fSignalAtDigitizer</a>[UsefulChanIndexV][j] = justSignal_dig[0][iant][j+128]*1000;</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#a73dfe58f637f50c52fa55fbd3b876c8e">fSignalAtDigitizer</a>[UsefulChanIndexH][j] = justSignal_dig[1][iant][j+128]*1000;</div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad8003cc057b5e5ca4397943d4041d839">fNoiseAtDigitizer</a>[UsefulChanIndexV][j]  = justNoise_dig[0][iant][j+128]*1000;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#ad8003cc057b5e5ca4397943d4041d839">fNoiseAtDigitizer</a>[UsefulChanIndexH][j]  = justNoise_dig[1][iant][j+128]*1000;</div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;                  </div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aacac4af652e7684a8a6046106e9e6d34">fDiodeOutput</a>[UsefulChanIndexV][j]       = anita1-&gt;timedomain_output_allantennas[0][irx][j];</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;                  truthEvPtr-&gt;<a class="code" href="../../d7/dd8/class_truth_anita_event.html#aacac4af652e7684a8a6046106e9e6d34">fDiodeOutput</a>[UsefulChanIndexH][j]       = anita1-&gt;timedomain_output_allantennas[1][irx][j];</div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;                }<span class="comment">//end int j</span></div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;              }</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;              </div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;            }<span class="comment">// end int iant</span></div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;            </div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;            <span class="keywordflow">if</span> (truthNuPtr) truthNuPtr-&gt;setSkipped(<span class="keyword">false</span>); </div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;            </div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;<span class="comment">//            printf(&quot;objname: 0x%p %s\n&quot;, &amp;truthEvPtr-&gt;objName, truthEvPtr-&gt;objName.Data()); </span></div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;            <span class="keywordflow">if</span> (truthAnitaNuTree) truthAnitaNuTree-&gt;Fill();</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;            truthAnitaTree-&gt;Fill();</div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;            <span class="keyword">delete</span> truthEvPtr;</div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;</div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;            headTree-&gt;Fill();</div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;            eventTree-&gt;Fill();</div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;            adu5PatTree-&gt;Fill();</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;            <span class="keyword">delete</span> realEvPtr;</div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;            <span class="keyword">delete</span> rawHeaderPtr;</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;            <span class="keyword">delete</span> Adu5PatPtr;</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;            sum_weights+=weight;</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;            neutrinos_passing_all_cuts++;</div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;            times_crust_entered_det+=interaction1-&gt;crust_entered;  <span class="comment">//Increment counter for neutrino numbers in each earth layer - passing neutrinos</span></div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;            times_mantle_entered_det+=interaction1-&gt;mantle_entered;</div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;            times_core_entered_det+=interaction1-&gt;core_entered;</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;WRITEPOSFILE==1)</div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;              WriteNeutrinoInfo(interaction1-&gt;posnu, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>, bn1-&gt;r_bn, interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">altitude_int</a>, interaction1-&gt;nuflavor(), interaction1-&gt;current(), elast_y, nu_out);</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;            <span class="comment">// sample first 1000 events that pass to see the distribution of weights</span></div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;            <span class="keywordflow">if</span> (settings1-&gt;HIST &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; sampleweights-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;              <span class="keywordflow">if</span> (weight&gt;1.E-6)</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                sampleweights-&gt;Fill(log10(weight));</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;              <span class="keywordflow">else</span></div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;                sampleweights-&gt;Fill(-6.);</div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;              <span class="comment">// on the 1000th one,  see how low you should make the cut so that you catch 99% of the events (weighted)</span></div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;              <span class="keywordflow">if</span> (sampleweights-&gt;GetEntries()==1000) {</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;                <span class="keywordtype">double</span> sum_sampleintegral=0.;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;                <span class="keywordtype">double</span> sum_sample=0.;</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;                <span class="comment">// first calculate total integral of all the weights</span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=sampleweights-&gt;GetNbinsX();k&gt;=1;k--) {</div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;                  sum_sampleintegral+=sampleweights-&gt;GetBinContent(k)*pow(10., sampleweights-&gt;GetBinLowEdge(k));</div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;                }</div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;                <span class="comment">// treat the underflow bin specially</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;                sum_sampleintegral+=sampleweights-&gt;GetBinContent(0)*pow(10., sampleweights-&gt;GetBinLowEdge(1));</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;                <span class="comment">// now sum until you reach 99% of the integral.</span></div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=sampleweights-&gt;GetNbinsX();k&gt;=1;k--) {</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;                  sum_sample+=sampleweights-&gt;GetBinContent(k)*pow(10., sampleweights-&gt;GetBinLowEdge(k));</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;                  <span class="keywordflow">if</span> (sum_sample&gt;0.99*sum_sampleintegral) {</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;                    <span class="comment">// reset the cut value.</span></div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;                    <span class="comment">//settings1-&gt;CUTONWEIGHTS=pow(10., sampleweights-&gt;GetBinLowEdge(k));</span></div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;                    <span class="comment">//cout &lt;&lt; &quot;settings1-&gt;CUTONWEIGHTS is &quot; &lt;&lt; settings1-&gt;CUTONWEIGHTS &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;                    k=0;</div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;                  }</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;                }</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;              }</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;            }<span class="comment">//end if HIST &amp; ONLYFINAL &amp; sampleweights HISTMAXENTRIES</span></div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;            <span class="comment">//cout &lt;&lt; &quot;cut on weights = &quot; &lt;&lt; settings1-&gt;CUTONWEIGHTS &lt;&lt; endl;</span></div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;            </div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;            <span class="comment">// outputs to text file variables relevant to sky map.</span></div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;            forbrian &lt;&lt; interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">costheta_nutraject</a> &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; n_nutraject_ontheground.Phi() &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bn1-&gt;phi_bn &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; logweight &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;            <span class="comment">// incrementing by flavor</span></div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;            <span class="comment">// also bin in weight for error calculation.</span></div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;            <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nue&quot;</span>) {</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;              sum[0]+=weight;</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;              sum_prob[0]+=weight_prob;</div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;              eventsfound_binned_e[index_weights]++;</div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;            } <span class="comment">//if</span></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;            <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;numu&quot;</span>) {</div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;              sum[1]+=weight;</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;              sum_prob[1]+=weight_prob;</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;              eventsfound_binned_mu[index_weights]++;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;            } <span class="comment">//if</span></div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;            <span class="keywordflow">if</span>(!sec1-&gt;secondbang || !sec1-&gt;interestedintaus) {</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;              <span class="keywordflow">if</span> (interaction1-&gt;nuflavor()==<span class="stringliteral">&quot;nutau&quot;</span>) {</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;                sum[2]+=weight;</div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;                sum_prob[2]+=weight_prob;</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;                eventsfound_binned_tau[index_weights]++;</div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;              } <span class="comment">//if</span></div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;            } <span class="comment">//if</span></div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;          } <span class="comment">//end if interaction1-&gt;d2&gt;1</span></div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;        } <span class="comment">//end if tautrigger || GetChord</span></div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;          cout &lt;&lt; <span class="stringliteral">&quot;Chord is less than 1m.\n&quot;</span>;</div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;        } <span class="comment">//end else GetChord</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;HIST==1 &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; anita1-&gt;tglob-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES) {<span class="comment">// all events</span></div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;          <span class="comment">// cout &lt;&lt; &quot;Filling global trigger tree.  inu is &quot; &lt;&lt; inu &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;          anita1-&gt;tglob-&gt;Fill();</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;      anita1-&gt;tdata-&gt;Fill();</div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;      anita1-&gt;tgaryanderic-&gt;Fill();</div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;        }</div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;</div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;        passes_thisevent=1; <span class="comment">// flag this event as passing</span></div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;      } <span class="comment">// end if passing global trigger conditions</span></div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;        passes_thisevent=0; <span class="comment">// flag this event as not passing</span></div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;        <span class="comment">//hack so continue doesn&#39;t exit loop</span></div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;        <span class="keywordflow">do</span> </div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;        {</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;          DO_SKIP</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;        }<span class="keywordflow">while</span>(0); </div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;        </div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;        <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4)</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;          cout &lt;&lt; <span class="stringliteral">&quot;This event does not pass.\n&quot;</span>;</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;      }<span class="comment">// end else event does not pass trigger</span></div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;      <span class="comment">// WE GET HERE REGARDLESS OF WHETHER THE TRIGGER PASSES</span></div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;      <span class="comment">//</span></div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;<span class="comment"></span><span class="comment">/*</span></div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;<span class="comment">      Vector tempa = ray1-&gt;n_exit2bn[2].Unit() - antarctica-&gt;GetSurfaceNormal(bn1-&gt;r_bn).Dot(ray1-&gt;n_exit2bn[2].Unit()) * antarctica-&gt;GetSurfaceNormal(bn1-&gt;r_bn);</span></div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;<span class="comment">      Position posa = ray1-&gt;rfexit[2] + 300.*tempa;</span></div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;<span class="comment">      Vector tempb = interaction1-&gt;nnu.Unit() - antarctica-&gt;GetSurfaceNormal(interaction1-&gt;posnu).Dot(interaction1-&gt;nnu.Unit()) * antarctica-&gt;GetSurfaceNormal(interaction1-&gt;posnu);</span></div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;<span class="comment">      Position posb = interaction1-&gt;posnu + 300.*tempb;</span></div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;<span class="comment">      if(vmmhz_max&gt;0.){</span></div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;<span class="comment">        stemp=string(outputdir.Data())+&quot;/rough_evtweight_&quot;+nunum+&quot;.dat&quot;;</span></div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;<span class="comment">        ofstream evtwgtout(stemp.c_str());</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;<span class="comment">        evtwgtout &lt;&lt; weight &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;<span class="comment">                  &lt;&lt; thispasses[0] &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;<span class="comment">                  &lt;&lt; anita1-&gt;pol_allowed[0] &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;<span class="comment">                  &lt;&lt; thispasses[1] &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;<span class="comment">                  &lt;&lt; anita1-&gt;pol_allowed[1] &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;<span class="comment">                  &lt;&lt; ray1-&gt;rfexit[2].Lon()&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;<span class="comment">                  &lt;&lt; -90+ray1-&gt;rfexit[2].Lat()&lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;<span class="comment">                  &lt;&lt; posa.Lon() &lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;<span class="comment">                  &lt;&lt; -90+posa.Lat()&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;<span class="comment">                  &lt;&lt; interaction1-&gt;posnu.Lon() &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;<span class="comment">                  &lt;&lt; -90+interaction1-&gt;posnu.Lat() &lt;&lt; &quot;  &quot;</span></div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;<span class="comment">                  &lt;&lt; posb.Lon() &lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;<span class="comment">                  &lt;&lt;-90+posb.Lat()&lt;&lt;&quot;  &quot;</span></div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;<span class="comment">                  &lt;&lt;std::endl;</span></div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;<span class="comment">        evtwgtout.close();</span></div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;<span class="comment">      }*/</span></div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      <span class="keyword">delete</span> globaltrig1;</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      <span class="comment">// keeping track of intermediate counters,  incrementing by weight1.</span></div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      <span class="comment">// weight1 was not yet determined when integer counters were incremented.</span></div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="keywordflow">if</span> (chanceinhell2)</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;        count_chanceinhell2_w += weight;</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      <span class="keywordflow">if</span> (passestrigger)</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;        count_passestrigger_w += weight;</div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;</div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      volume_thishorizon=antarctica-&gt;volume_inhorizon[bn1-&gt;Getibnposition()]/1.E9;</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;HIST==1</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;          &amp;&amp; !settings1-&gt;ONLYFINAL</div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;          &amp;&amp; tree1-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;          &amp;&amp; bn1-&gt;WHICHPATH != 3){ <span class="comment">// all events</span></div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        tree1-&gt;Fill();</div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;      }<span class="comment">//end if</span></div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;    } <span class="comment">// end for WHICHRAY</span></div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;    <span class="comment">//looping over two types of rays - upgoing and downgoing.</span></div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;    <span class="keywordflow">if</span> (ABORT_EARLY){</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\n***********************************************************&quot;</span>;</div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\n* SIGINT received,  aborting loop over events early.&quot;</span>;</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\n* Stopped after event &quot;</span> &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; NNU;</div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\n* Any output which relied on NNU should be corrected for.&quot;</span>;</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;\n***********************************************************\n&quot;</span>;</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;\n***********************************************************&quot;</span>;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;\n* SIGINT received,  aborting loop over events early.&quot;</span>;</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;\n* Stopped after event &quot;</span> &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot; instead of &quot;</span> &lt;&lt; NNU;</div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;\n* Any output which relied on NNU should be corrected for.&quot;</span>;</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;\n***********************************************************\n&quot;</span>;</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;    }</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;</div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Oindree: nnu is &quot; &lt;&lt; interaction1-&gt;nnu &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;  }<span class="comment">//end NNU neutrino loop</span></div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;about to close tsignals tree.\n&quot;</span>;</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;  anita1-&gt;fsignals=anita1-&gt;tsignals-&gt;GetCurrentFile();</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;  anita1-&gt;fdata=anita1-&gt;tdata-&gt;GetCurrentFile();</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;  anita1-&gt;fdata=anita1-&gt;tgaryanderic-&gt;GetCurrentFile();</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;  anita1-&gt;fsignals-&gt;Write();</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;  anita1-&gt;fsignals-&gt;Close();</div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;  anita1-&gt;fdata=anita1-&gt;tglob-&gt;GetCurrentFile();</div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;  anita1-&gt;fdata-&gt;Write();</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;  anita1-&gt;fdata-&gt;Close();</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;EVENTSMAP){</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;    <span class="comment">//draw the S80-degree-latitude circle</span></div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;    TH2F *lat80deg=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;lat80deg&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, 600, -3000, 3000, 500, -2500, 2500);</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;    lat80deg-&gt;SetMarkerColor(kRed);</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;    <span class="keywordtype">double</span> E,N;</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">double</span> lon=0;lon&lt;360.;lon+=0.5){</div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;      <span class="keywordtype">double</span> lat=10.;</div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;      antarctica-&gt;LonLattoEN(lon, lat, E, N);</div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;      lat80deg-&gt;Fill(E, N);</div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    }<span class="comment">//end for lon loop</span></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;  }<span class="comment">// end if EVENTSMAP</span></div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;  <span class="keywordflow">if</span> (bn1-&gt;WHICHPATH==4) {<span class="comment">// this is for comparing with Peter</span></div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Earth radius at South Pole: &quot;</span> &lt;&lt; antarctica-&gt;Geoid(0.) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;    <a class="code" href="../../d7/d3b/class_position.html">Position</a> posnu_temp=<a class="code" href="../../d7/d3b/class_position.html">Position</a>(180., 0., 1.); <span class="comment">// points at the south pole</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Surface of ice at the South Pole: &quot;</span> &lt;&lt; antarctica-&gt;Surface(posnu_temp) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Average balloon altitude is &quot;</span> &lt;&lt; average_altitude &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Average distance from earth center is &quot;</span> &lt;&lt; average_rbn &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Average height of balloon above ice surface is &quot;</span> &lt;&lt; average_rbn-antarctica-&gt;Surface(bn1-&gt;r_bn) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;theta_zenith are &quot;</span> &lt;&lt; anita1-&gt;THETA_ZENITH[0]*DEGRAD &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; anita1-&gt;THETA_ZENITH[1]*DEGRAD &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; anita1-&gt;THETA_ZENITH[2]*DEGRAD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Index of refraction at this depth is &quot;</span> &lt;&lt; sig1-&gt;N_DEPTH &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Cerenkov angle is &quot;</span> &lt;&lt; sig1-&gt;changle*DEGRAD &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Nadir angle to surface exit point is &quot;</span> &lt;&lt; DEGRAD*bn1-&gt;r_bn.Angle(ray1-&gt;n_exit2bn[2]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Distance from rfexit to balloon is &quot;</span> &lt;&lt; (bn1-&gt;r_bn+ -1*ray1-&gt;rfexit[2]).Mag() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Payload zenith angle at event source is &quot;</span> &lt;&lt; DEGRAD*ray1-&gt;rfexit[2].Angle(ray1-&gt;n_exit2bn[2]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Angle of incidence just below surface is &quot;</span> &lt;&lt; DEGRAD*ray1-&gt;rfexit[2].Angle(ray1-&gt;nrf_iceside[4]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Angle between neutrino and surface normal is &quot;</span> &lt;&lt; DEGRAD*ray1-&gt;rfexit[0].Angle(interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>)-90. &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Angle of incidence below firn surface is &quot;</span> &lt;&lt; DEGRAD*ray1-&gt;rfexit[2].Angle(ray1-&gt;nrf_iceside[3]) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;  }</div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;about to Summarize.\n&quot;</span>;</div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;</div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;  anita1-&gt;rms_rfcm[0] = sqrt(anita1-&gt;rms_rfcm[0] / (<span class="keywordtype">double</span>)anita1-&gt;count_getnoisewaveforms)*1000.;</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;  anita1-&gt;rms_rfcm[1] = sqrt(anita1-&gt;rms_rfcm[1] / (<span class="keywordtype">double</span>)anita1-&gt;count_getnoisewaveforms)*1000.;</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;  anita1-&gt;rms_lab[0] = sqrt(anita1-&gt;rms_lab[0] / (<span class="keywordtype">double</span>)anita1-&gt;count_getnoisewaveforms)*1000.;</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;  anita1-&gt;rms_lab[1] = sqrt(anita1-&gt;rms_lab[1] / (<span class="keywordtype">double</span>)anita1-&gt;count_getnoisewaveforms)*1000.;</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;RMS noise in rfcm e-pol is &quot;</span> &lt;&lt; anita1-&gt;rms_rfcm[0] &lt;&lt; <span class="stringliteral">&quot; mV.\n&quot;</span>;</div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;RMS noise in rfcm h-pol is &quot;</span> &lt;&lt; anita1-&gt;rms_rfcm[1] &lt;&lt; <span class="stringliteral">&quot; mV.\n&quot;</span>;</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;RMS noise in lab e-pol is &quot;</span> &lt;&lt; anita1-&gt;rms_lab[0] &lt;&lt; <span class="stringliteral">&quot;mV.\n&quot;</span>;</div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;RMS noise in lab h-pol is &quot;</span> &lt;&lt; anita1-&gt;rms_lab[1] &lt;&lt; <span class="stringliteral">&quot;mV.\n&quot;</span>;</div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NFREQ;i++) {</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;    anita1-&gt;avgfreq_rfcm[i]/=(double)anita1-&gt;count_getnoisewaveforms;</div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;    anita1-&gt;avgfreq_rfcm_lab[i]/=(<span class="keywordtype">double</span>)anita1-&gt;count_getnoisewaveforms;</div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;  }</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;  rms_rfcm_e=anita1-&gt;rms_rfcm[0];</div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;  rms_rfcm_h=anita1-&gt;rms_rfcm[1];</div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;  rms_lab_e=anita1-&gt;rms_lab[0];</div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;  rms_lab_h=anita1-&gt;rms_lab[1];</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NFREQ;i++) {</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;    avgfreq_rfcm[i]=anita1-&gt;avgfreq_rfcm[i];</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;    avgfreq_rfcm_lab[i]=anita1-&gt;avgfreq_rfcm_lab[i];</div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    freq[i]=anita1-&gt;freq[i];</div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;  }</div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Filling summarytree.  rms_rfcm_e is &quot;</span> &lt;&lt; rms_rfcm_e &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;  summarytree-&gt;Fill();</div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;</div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;  <span class="comment">// Recalculate the cross section because for the final volume approximation we just use the neutrino CC cross section</span></div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;  primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">GetSigma</a>(pnu, sigma, len_int_kgm2, settings1, xsecParam_nutype, Interaction::ktotal);</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;  len_int=1.0/(sigma*sig1-&gt;RHOH20*(1./M_NUCL)*1000); </div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;  </div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;  <span class="comment">// makes the output file</span></div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;  Summarize(settings1, anita1, count1, spectra1, sig1, primary1, pnu, eventsfound, eventsfound_db, eventsfound_nfb, sigma, sum, antarctica-&gt;volume, antarctica-&gt;ice_area, km3sr, km3sr_e, km3sr_mu, km3sr_tau, foutput, distanceout, outputdir, bn1, src_model);</div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;</div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;  std::string spec_string = src_model ? settings1-&gt;SOURCE : std::to_string( settings1-&gt;EXPONENT); </div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;  veff_out &lt;&lt; spec_string &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; km3sr &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; km3sr_e &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; km3sr_mu &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; km3sr_tau &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; settings1-&gt;SIGMA_FACTOR &lt;&lt; endl;<span class="comment">//this is for my convenience</span></div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;  <span class="comment">// for each neutrino flavor,  fraction each contributes to sensitivity.</span></div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;  sum_frac[0]=sum[0]/eventsfound;</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;  sum_frac[1]=sum[1]/eventsfound;</div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;  sum_frac[2]=sum[2]/eventsfound;</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;  <span class="comment">// for taus.</span></div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;  sum_frac_db[0]=sum[0]/(eventsfound+eventsfound_db+eventsfound_nfb);</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;  sum_frac_db[1]=sum[1]/(eventsfound+eventsfound_db+eventsfound_nfb);</div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;  sum_frac_db[2]=(sum[2]+eventsfound_db+eventsfound_nfb)/(eventsfound+eventsfound_db+eventsfound_nfb);</div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;  <span class="comment">//if (tree17-&gt;GetEntries()&lt;settings1-&gt;HIST_MAX_ENTRIES &amp;&amp; !settings1-&gt;ONLYFINAL &amp;&amp; HIST==1)</span></div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;  <span class="comment">//tree17-&gt;Fill();</span></div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;</div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;  anitafileEvent-&gt;cd();</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;  eventTree-&gt;Write(<span class="stringliteral">&quot;eventTree&quot;</span>);</div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;  anitafileEvent-&gt;Close();</div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;  <span class="keyword">delete</span> anitafileEvent;</div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;</div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;  anitafileHead-&gt;cd();</div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;  headTree-&gt;Write(<span class="stringliteral">&quot;headTree&quot;</span>);</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;  anitafileHead-&gt;Close();</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;  <span class="keyword">delete</span> anitafileHead;</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;</div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;  anitafileGps-&gt;cd();</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;  adu5PatTree-&gt;Write(<span class="stringliteral">&quot;adu5PatTree&quot;</span>);</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160;  anitafileGps-&gt;Close();</div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;  <span class="keyword">delete</span> anitafileGps;</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;<span class="preprocessor">#ifdef ANITA3_EVENTREADER</span></div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;  anitafileTruth-&gt;cd();</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;  configAnitaTree-&gt;Write(<span class="stringliteral">&quot;configAnitaTree&quot;</span>);</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;  truthAnitaTree-&gt;Write(<span class="stringliteral">&quot;truthAnitaTree&quot;</span>);</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;  <span class="keywordflow">if</span> (truthAnitaNuTree) truthAnitaNuTree-&gt;Write();</div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;  triggerSettingsTree-&gt;Write(<span class="stringliteral">&quot;triggerSettingsTree&quot;</span>);</div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;  summaryAnitaTree-&gt;Fill();</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;  summaryAnitaTree-&gt;Write(<span class="stringliteral">&quot;summaryAnitaTree&quot;</span>);</div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;  anitafileTruth-&gt;Close();</div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;  <span class="keyword">delete</span> anitafileTruth;</div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;</div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;<span class="preprocessor">  #ifdef ANITA3_EVENTCORRELATOR</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;  <span class="keywordflow">if</span>(settings1-&gt;ALL_SKY_MAP)</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;    {  </div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;      TCanvas *skyMapC = <span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;skyMapC&quot;</span>, <span class="stringliteral">&quot;skyMapC&quot;</span>, 1000, 500);</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;      skyMapC-&gt;cd(1);</div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;      skyMapOut-&gt;Draw();</div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;      <span class="keywordtype">string</span> outputSkyMap =string(outputdir.Data())+<span class="stringliteral">&quot;/allSkyMap&quot;</span>+run_num+<span class="stringliteral">&quot;.png&quot;</span>;</div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;      skyMapC-&gt;SaveAs(outputSkyMap.c_str());</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;    }</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;<span class="preprocessor">  #endif </span></div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160; </div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;closing file.\n&quot;</span>;</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;  CloseTFile(hfile);</div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;  time_t raw_end_time = time(NULL);</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;  <span class="keyword">struct </span>tm * end_time = localtime(&amp;raw_end_time);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Date and time at end of run are: &quot;</span> &lt;&lt; asctime (end_time) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;  cout&lt;&lt;<span class="stringliteral">&quot;Total time elapsed is &quot;</span>&lt;&lt;(int)((raw_end_time - raw_start_time)/60)&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt; ((raw_end_time - raw_start_time)%60)&lt;&lt;endl;</div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;</div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;\nTotal time elapsed in run is &quot;</span> &lt;&lt;(int)((raw_end_time - raw_start_time)/60)&lt;&lt;<span class="stringliteral">&quot;:&quot;</span>&lt;&lt; ((raw_end_time - raw_start_time)%60)&lt;&lt;endl;</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;  <span class="keyword">delete</span> anita1;</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;} <span class="comment">//END MAIN PROGRAM</span></div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;</div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;</div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;</div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;</div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;</div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;<span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;<span class="comment">// ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</span></div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;<span class="comment">//  Auxiliary functions</span></div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;<span class="keywordtype">void</span> IntegrateBands(Anita *anita1, <span class="keywordtype">int</span> k, Screen *panel1, <span class="keywordtype">double</span> *freq, <span class="keywordtype">double</span> scalefactor, <span class="keywordtype">double</span> *sumsignal) {</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;    <span class="comment">// if this frequency is in this bandwidth slice</span></div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> jpt=0; jpt&lt;panel1-&gt;GetNvalidPoints(); jpt++){</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;      <span class="keywordflow">if</span> (anita1-&gt;bwslice_min[j]&lt;=freq[k] &amp;&amp; anita1-&gt;bwslice_max[j]&gt;freq[k])</div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;        sumsignal[j]+=panel1-&gt;GetVmmhz_freq(jpt*Anita::NFREQ + k)*(freq[k+1]-freq[k])*scalefactor;</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;    }</div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;  }</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;}</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;<span class="comment">//end IntegrateBands()</span></div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;</div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;<span class="keywordtype">void</span> Integrate(Anita *anita1, <span class="keywordtype">int</span> j, <span class="keywordtype">int</span> k, <span class="keywordtype">double</span> *vmmhz, <span class="keywordtype">double</span> *freq, <span class="keywordtype">double</span> scalefactor, <span class="keywordtype">double</span> sumsignal) {</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;  <span class="comment">// if this frequency is in this bandwidth slice</span></div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;  <span class="keywordflow">if</span> (anita1-&gt;bwslice_min[j]&lt;=freq[k] &amp;&amp; anita1-&gt;bwslice_max[j]&gt;freq[k])</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;    sumsignal+=vmmhz[k]*(freq[k+1]-freq[k])*scalefactor;</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;}</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;<span class="comment">//end Integrate()</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;</div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;</div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;<span class="keywordtype">void</span> WriteNeutrinoInfo(<a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;r_bn,  <span class="keywordtype">double</span> altitude_int,  <span class="keywordtype">string</span> nuflavor,  <span class="keywordtype">string</span> current,  <span class="keywordtype">double</span> elast_y,  ofstream &amp;nu_out) {</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;  nu_out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; posnu[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; posnu[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; posnu[2] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; altitude_int &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; nnu[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nnu[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nnu[2] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; r_bn[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; r_bn[1] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; r_bn[2] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; nuflavor &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; current &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; elast_y &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;}</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;<span class="comment">//end WriteNeutrinoInfo()</span></div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;<span class="keywordtype">void</span> Summarize(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  Anita* anita1,  <a class="code" href="../../d4/de2/class_counting.html">Counting</a> *count1, <a class="code" href="../../d7/d9c/class_spectra.html">Spectra</a> *spectra1, <a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1, <a class="code" href="../../de/d7b/class_primaries.html">Primaries</a> *primary1, <span class="keywordtype">double</span> pnu, <span class="keywordtype">double</span> eventsfound, <span class="keywordtype">double</span> eventsfound_db, <span class="keywordtype">double</span> eventsfound_nfb, <span class="keywordtype">double</span> sigma, <span class="keywordtype">double</span>* sum, <span class="keywordtype">double</span> volume, <span class="keywordtype">double</span> ice_area, <span class="keywordtype">double</span>&amp; km3sr, <span class="keywordtype">double</span>&amp; km3sr_e, <span class="keywordtype">double</span>&amp; km3sr_mu, <span class="keywordtype">double</span>&amp; km3sr_tau, ofstream &amp;foutput, ofstream &amp;distanceout, TString outputdir, <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> * bn1, <a class="code" href="../../de/d30/class_source_model.html">SourceModel</a> * src_model) {</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;  <span class="keywordtype">double</span> rate_v_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;  <span class="keywordtype">double</span> errorup_v_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;  <span class="keywordtype">double</span> errordown_v_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;  <span class="keywordtype">double</span> rate_h_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;  <span class="keywordtype">double</span> errorup_h_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;  <span class="keywordtype">double</span> errordown_h_thresh[NTHRESHOLDS];</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;  <span class="keywordtype">double</span> zeroes[NTHRESHOLDS];</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;  Tools::Zero(zeroes, NTHRESHOLDS);</div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;  <span class="comment">// plot result of threshold scan</span></div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NTHRESHOLDS;i++) {</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    rate_v_thresh[i]=npass_v_thresh[i]/denom_v_thresh[i];</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    <span class="comment">// cout &lt;&lt; &quot;i,  npass_v_thresh are &quot; &lt;&lt; i &lt;&lt; &quot;\t&quot; &lt;&lt; npass_v_thresh[i] &lt;&lt; &quot; &quot; &lt;&lt; denom_v_thresh[i] &lt;&lt; &quot; &quot; &lt;&lt; rate_v_thresh[i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    <span class="keywordflow">if</span> (npass_v_thresh[i]&lt;=20) {</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;      errorup_v_thresh[i]=poissonerror_plus[(int)npass_v_thresh[i]]/denom_v_thresh[i];</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;      errordown_v_thresh[i]=poissonerror_minus[(int)npass_v_thresh[i]]/denom_v_thresh[i];</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;      <span class="comment">// cout &lt;&lt; errorup_v_thresh[i] &lt;&lt; &quot; &quot; &lt;&lt; errordown_v_thresh[i] &lt;&lt; endl;</span></div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    }<span class="comment">//end if</span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){ <span class="comment">// Anita-3</span></div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;      rate_h_thresh[i]=npass_h_thresh[i]/denom_h_thresh[i];</div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;      <span class="keywordflow">if</span> (npass_h_thresh[i]&lt;=20) {</div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;        errorup_h_thresh[i]=poissonerror_plus[(int)npass_h_thresh[i]]/denom_h_thresh[i];</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;        errordown_h_thresh[i]=poissonerror_minus[(int)npass_h_thresh[i]]/denom_h_thresh[i];</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;      }<span class="comment">//end if</span></div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;    }<span class="comment">//end if WHICH==9</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;  }<span class="comment">//end for NTHRESHOLDS</span></div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;  <span class="keywordtype">string</span> stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/thresholds.root&quot;</span>;</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;  TFile *fthresholds=<span class="keyword">new</span> TFile(stemp.c_str(), <span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  TCanvas *cthresh=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cthresh&quot;</span>, <span class="stringliteral">&quot;cthresh&quot;</span>, 880, 800);</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;  cthresh-&gt;SetLogy();</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;  TGraph *gnpass=<span class="keyword">new</span> TGraph(NTHRESHOLDS, thresholds, npass_v_thresh);</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;  gnpass-&gt;SetName(<span class="stringliteral">&quot;npass&quot;</span>);</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;  TGraph *gdenom=<span class="keyword">new</span> TGraph(NTHRESHOLDS, thresholds, denom_v_thresh);</div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;  gdenom-&gt;SetName(<span class="stringliteral">&quot;denom&quot;</span>);</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;  TGraphAsymmErrors *g=<span class="keyword">new</span> TGraphAsymmErrors(NTHRESHOLDS, thresholds, rate_v_thresh, zeroes, zeroes, errorup_v_thresh, errordown_v_thresh);</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;  g-&gt;SetName(<span class="stringliteral">&quot;rate&quot;</span>);</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;  g-&gt;SetLineWidth(2);</div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;  g-&gt;SetMarkerStyle(21);</div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;  g-&gt;Draw(<span class="stringliteral">&quot;ape&quot;</span>);</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;  stemp = string(outputdir.Data())+<span class="stringliteral">&quot;/thresholds.eps&quot;</span>;</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;  cthresh-&gt;Print((TString)stemp);</div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;  g-&gt;Write();</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;  gdenom-&gt;Write();</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;  gnpass-&gt;Write();</div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){ <span class="comment">// Anita-3 or Anita-4</span></div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;    TGraph *gnpassH=<span class="keyword">new</span> TGraph(NTHRESHOLDS, thresholds, npass_h_thresh);</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    gnpassH-&gt;SetName(<span class="stringliteral">&quot;npassH&quot;</span>);</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    TGraph *gdenomH=<span class="keyword">new</span> TGraph(NTHRESHOLDS, thresholds, denom_h_thresh);</div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;    gdenomH-&gt;SetName(<span class="stringliteral">&quot;denomH&quot;</span>);</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    TGraphAsymmErrors *gH=<span class="keyword">new</span> TGraphAsymmErrors(NTHRESHOLDS, thresholds, rate_h_thresh, zeroes, zeroes, errorup_h_thresh, errordown_h_thresh);</div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;    gH-&gt;SetName(<span class="stringliteral">&quot;rate&quot;</span>);</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    gH-&gt;SetLineWidth(2);</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    gH-&gt;SetMarkerStyle(21);</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    gH-&gt;Draw(<span class="stringliteral">&quot;ape&quot;</span>);</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;    stemp = string(outputdir.Data())+<span class="stringliteral">&quot;/thresholds_HPOL.eps&quot;</span>;</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;    cthresh-&gt;Print((TString)stemp);</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;    gH-&gt;Write();</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;    gdenomH-&gt;Write();</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;    gnpassH-&gt;Write();</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;  }<span class="comment">//end if WHICH==9 or WHICH==10</span></div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;  fthresholds-&gt;Write();</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;  fthresholds-&gt;Close();</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;  <span class="comment">//  double ses;                          // single-event sensitivity</span></div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;  <span class="comment">// write out summary</span></div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Generated &quot;</span> &lt;&lt; NNU &lt;&lt; <span class="stringliteral">&quot; neutrinos with energy &quot;</span> &lt;&lt; pnu &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of unweighted direct,  reflected that pass is: &quot;</span> &lt;&lt; count1-&gt;npass[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;npass[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass is: &quot;</span> &lt;&lt; eventsfound &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass,  multiplied by prob. of interacting in the ice,  is: &quot;</span> &lt;&lt; eventsfound_prob &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass,  divided by lint  is: &quot;</span> &lt;&lt; eventsfound_divided_by_lint &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of weighted direct,  reflected that pass is: &quot;</span> &lt;&lt; allcuts_weighted[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; allcuts_weighted[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass (with weight&gt;0.001) is: &quot;</span> &lt;&lt; eventsfound_weightgt01 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that only traverse the crust is &quot;</span> &lt;&lt; eventsfound_crust &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; eventsfound_crust/eventsfound*100 &lt;&lt; <span class="stringliteral">&quot;%\n\n&quot;</span>;</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass only VPOL trigger is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[0] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass only HPOL trigger is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass both pol triggers is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[2] &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;  </div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass (with weight&gt;0.001) is: &quot;</span> &lt;&lt; eventsfound_weightgt01 &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass,  multiplied by prob. of interacting in the ice,  is: &quot;</span> &lt;&lt; eventsfound_prob &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass,  divided by lint  is: &quot;</span> &lt;&lt; eventsfound_divided_by_lint &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that only traverse the crust is &quot;</span> &lt;&lt; eventsfound_crust &lt;&lt; <span class="stringliteral">&quot; -&gt; &quot;</span> &lt;&lt; eventsfound_crust/eventsfound*100 &lt;&lt; <span class="stringliteral">&quot;%\n\n&quot;</span>;</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass only VPOL trigger is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[0] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass only HPOL trigger is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) neutrinos that pass both pol triggers is: &quot;</span> &lt;&lt; allcuts_weighted_polarization[2] &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Total number of thrown electron neutrinos is : &quot;</span> &lt;&lt; (double)count1-&gt;nnu_e   &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Total number of thrown muon neutrinos is :     &quot;</span> &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nnu_mu  &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Total number of thrown tau neutrinos is :      &quot;</span> &lt;&lt; (double)count1-&gt;nnu_tau &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) electron neutrinos that pass trigger is : &quot;</span> &lt;&lt; sum[0] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) muon neutrinos that pass trigger is     : &quot;</span> &lt;&lt; sum[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) tau neutrinos that pass trigger is      : &quot;</span> &lt;&lt; sum[2] &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;  </div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Total number of thrown electron neutrinos is : &quot;</span> &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nnu_e   &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Total number of thrown muon neutrinos is :     &quot;</span> &lt;&lt; (double)count1-&gt;nnu_mu  &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Total number of thrown tau neutrinos is :      &quot;</span> &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nnu_tau &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) electron neutrinos that pass trigger is : &quot;</span> &lt;&lt; sum[0] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) muon neutrinos that pass trigger is     : &quot;</span> &lt;&lt; sum[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Number of (weighted) tau neutrinos that pass trigger is      : &quot;</span> &lt;&lt; sum[2] &lt;&lt; <span class="stringliteral">&quot;\n\n&quot;</span>;</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Volume of ice is &quot;</span> &lt;&lt; volume &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Value of 4*pi*pi*r_earth*r_earth in km^2 &quot;</span> &lt;&lt; 4*PI*PI*(EarthModel::R_EARTH*EarthModel::R_EARTH/1.E6) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;</div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;  <span class="comment">// single event sensitivity for 150 MHz array per year</span></div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;  <span class="comment">//  everything is normalized to the active volume</span></div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;  <span class="comment">//  assume dF/dE propto E**-2</span></div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;  <span class="comment">//  assume 2pi sr or 4pi sr depending on whether below horizon is used</span></div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;  <span class="comment">//  assume 3.16e7 seconds/year</span></div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;  <span class="comment">//------------------------------------------------</span></div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;  <span class="comment">// ses=1/(A_eff * sr * t)</span></div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;  <span class="comment">//ses=1.0/(sigma*volume*RHOSALT*(1./M_NUCL)*3.16E7);  // 1 per year</span></div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;  <span class="keywordtype">double</span> nevents = 0;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;  <span class="comment">//double nweights=0;</span></div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;  <span class="keywordtype">double</span> nevents_db=0;</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;  <span class="keywordtype">double</span> nevents_nfb=0;</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;  nevents+=eventsfound;</div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;  nevents_db+=eventsfound_db;</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;  nevents_nfb+=eventsfound_nfb;</div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;  error_plus=0;</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;  error_e_plus=0;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;  error_mu_plus=0;</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;  error_tau_plus=0;</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;  error_minus=0;</div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;  error_e_minus=0;</div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;  error_mu_minus=0;</div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;  error_tau_minus=0;</div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;  error_nfb=0;</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;  error_km3sr_nfb=0;</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;  error_percent_increase_nfb=0;</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;</div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;  <span class="comment">// loop over bins in weights</span></div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NBINS;i++) {</div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;    <span class="keywordflow">if</span> (eventsfound_binned[i]&lt;=20) {</div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;      error_plus+=pow(poissonerror_plus[(<span class="keywordtype">int</span>)eventsfound_binned[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      error_e_plus+=pow(poissonerror_plus[(<span class="keywordtype">int</span>)eventsfound_binned_e[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;      error_mu_plus+=pow(poissonerror_plus[(<span class="keywordtype">int</span>)eventsfound_binned_mu[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;      error_tau_plus+=pow(poissonerror_plus[(<span class="keywordtype">int</span>)eventsfound_binned_tau[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;      error_minus+=pow(poissonerror_minus[(<span class="keywordtype">int</span>)eventsfound_binned[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;      error_e_minus+=pow(poissonerror_minus[(<span class="keywordtype">int</span>)eventsfound_binned_e[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;      error_mu_minus+=pow(poissonerror_minus[(<span class="keywordtype">int</span>)eventsfound_binned_mu[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;      error_tau_minus+=pow(poissonerror_minus[(<span class="keywordtype">int</span>)eventsfound_binned_tau[i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;      error_plus+=eventsfound_binned[i]*pow(pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;      error_e_plus+=eventsfound_binned_e[i]*pow(pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;      error_mu_plus+=eventsfound_binned_mu[i]*pow(pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;      error_tau_plus+=eventsfound_binned_tau[i]*pow(pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;      error_minus=error_plus;</div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;      error_e_minus=error_e_plus;</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      error_mu_minus=error_mu_plus;</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;      error_tau_minus=error_tau_plus;</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;</div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;    error_nfb+=eventsfound_nfb_binned[i]*pow(pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*4.+-5.), 2);</div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NBINS_DISTANCE;j++) {</div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;      <span class="keywordflow">if</span> (eventsfound_binned_distance_forerror[j][i]&lt;=20) {</div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;        error_distance_plus[j]+=pow(poissonerror_plus[(<span class="keywordtype">int</span>)eventsfound_binned_distance_forerror[j][i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;        error_distance_minus[j]+=pow(poissonerror_minus[(<span class="keywordtype">int</span>)eventsfound_binned_distance_forerror[j][i]]*pow(10., ((<span class="keywordtype">double</span>)i+0.5)/(<span class="keywordtype">double</span>)NBINS*(MAX_LOGWEIGHT-MIN_LOGWEIGHT)+MIN_LOGWEIGHT), 2);</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;      }<span class="comment">//end if forerror</span></div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;    }<span class="comment">//end for NBINS_DISTANCE</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;  }<span class="comment">//end for NBINS</span></div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;</div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;  error_plus=sqrt(error_plus);</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;  error_e_plus=sqrt(error_e_plus);</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;  error_mu_plus=sqrt(error_mu_plus);</div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;  error_tau_plus=sqrt(error_tau_plus);</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;  error_minus=sqrt(error_minus);</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;  error_e_minus=sqrt(error_e_minus);</div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;  error_mu_minus=sqrt(error_mu_minus);</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;  error_tau_minus=sqrt(error_tau_minus);</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;</div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;  error_nfb=sqrt(error_nfb);</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NBINS_DISTANCE;j++) {</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;    error_distance_plus[j]=sqrt(error_distance_plus[j]);</div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;    error_distance_minus[j]=sqrt(error_distance_minus[j]);</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;  }</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;  <span class="comment">// account for efficiency</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;  <span class="keywordflow">if</span> (NNU != 0 &amp;&amp; nevents!=0) {</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;    km3sr=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*nevents/(double)NNU/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;    km2sr = volume*pow(1.e-3,3)*eventsfound_divided_by_lint*sr/double(NNU)/settings1-&gt;SIGMA_FACTOR; </div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;</div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;    cout &lt;&lt; nevents &lt;&lt; <span class="stringliteral">&quot; events passed out of &quot;</span> &lt;&lt; NNU &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;</div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    error_plus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_plus/(double)NNU/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    error_minus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_minus/(double)NNU/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;</div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    percent_increase_db=km3sr_db/km3sr*100;</div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    percent_increase_nfb=km3sr_nfb/km3sr*100;</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    error_percent_increase_nfb=sqrt(pow(error_km3sr_nfb/km3sr_nfb, 2)+pow(error_plus/km3sr, 2))*percent_increase_nfb;</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    percent_increase_total=percent_increase_db+percent_increase_nfb;</div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    km3sr_e = (pow(1.e-3, 3))*volume*sr*(sum[0]/(<span class="keywordtype">double</span>)count1-&gt;nnu_e)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;    cout &lt;&lt; sum[0]/(<span class="keywordtype">double</span>)nevents*100. &lt;&lt; <span class="stringliteral">&quot;% are electron neutrinos\n&quot;</span>;</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    error_e_plus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_e_plus/(double)count1-&gt;nnu_e/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    error_e_minus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_e_minus/(double)count1-&gt;nnu_e/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    km3sr_mu = (pow(1.e-3, 3))*volume*sr*(sum[1]/(<span class="keywordtype">double</span>)count1-&gt;nnu_mu)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    cout &lt;&lt; sum[1]/(<span class="keywordtype">double</span>)nevents*100. &lt;&lt; <span class="stringliteral">&quot;% are muon neutrinos\n&quot;</span>;</div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;    error_mu_plus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_mu_plus/(double)count1-&gt;nnu_mu/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    error_mu_minus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_mu_minus/(double)count1-&gt;nnu_mu/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;    km3sr_tau = (pow(1.e-3, 3))*volume*sr*(sum[2]/(<span class="keywordtype">double</span>)count1-&gt;nnu_tau)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;    cout &lt;&lt; sum[2]/(<span class="keywordtype">double</span>)nevents*100. &lt;&lt; <span class="stringliteral">&quot;% are tau neutrinos\n&quot;</span>;</div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;</div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;    error_tau_plus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_tau_plus/(double)count1-&gt;nnu_tau/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;    error_tau_minus=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr*error_tau_minus/(double)count1-&gt;nnu_tau/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <span class="keywordtype">double</span> sum_km3sr=0;</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;    <span class="keywordtype">double</span> sum_km3sr_error_plus=0;</div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <span class="keywordtype">double</span> sum_km3sr_error_minus=0;</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;    for (<span class="keywordtype">int</span> i=0;i&lt;NBINS_DISTANCE;i++) {</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;      sum_km3sr+= (pow(1.e-3, 3))*volume*sr*eventsfound_binned_distance[i]*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20/(<span class="keywordtype">double</span>)NNU/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;      km3sr_distance[i]=sum_km3sr;</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;      sum_km3sr_error_plus+=pow(pow(1.E-3, 3)*volume*error_distance_plus[i]*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr/(<span class="keywordtype">double</span>)NNU, 2)/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;      error_distance_plus[i]=sqrt(sum_km3sr_error_plus);</div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;      sum_km3sr_error_minus+=pow(pow(1.E-3, 3)*volume*error_distance_minus[i]*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*sr/(<span class="keywordtype">double</span>)NNU, 2)/settings1-&gt;SIGMA_FACTOR;</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;      error_distance_minus[i]=sqrt(sum_km3sr_error_minus);</div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;      distanceout &lt;&lt; 700000./(double)NBINS_DISTANCE*(<span class="keywordtype">double</span>)i &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; km3sr_distance[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; error_distance_plus[i] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; error_distance_minus[i] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;    } <span class="comment">//for</span></div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;</div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle is \t\t\t\t&quot;</span> &lt;&lt; km3sr &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for electron neutrinos is \t&quot;</span> &lt;&lt; km3sr_e &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_e_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_e_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for muon neutrinos is \t&quot;</span> &lt;&lt; km3sr_mu &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_mu_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_mu_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for tau neutrinos is \t&quot;</span> &lt;&lt; km3sr_tau &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_tau_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_tau_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle is \t\t\t\t&quot;</span> &lt;&lt; km3sr &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for electron neutrinos is \t&quot;</span> &lt;&lt; km3sr_e &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_e_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_e_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for muon neutrinos is \t&quot;</span> &lt;&lt; km3sr_mu &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_mu_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_mu_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Total volume * solid angle for tau neutrinos is \t&quot;</span> &lt;&lt; km3sr_tau &lt;&lt; <span class="stringliteral">&quot; + &quot;</span> &lt;&lt; error_tau_plus &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; error_tau_minus &lt;&lt; <span class="stringliteral">&quot; km^3 str\n&quot;</span>;</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;    <span class="keywordflow">if</span> ( spectra1-&gt;IsMonoenergetic() )  {</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Cross section is &quot;</span> &lt;&lt; sigma &lt;&lt; <span class="stringliteral">&quot;m^2\n&quot;</span>;</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;      <span class="keywordtype">double</span> len_int=1.0/(sigma*sig1-&gt;RHOH20*(1./M_NUCL)*1000);</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Interaction length is &quot;</span> &lt;&lt; len_int &lt;&lt; <span class="stringliteral">&quot; km\n\n&quot;</span>;</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;Interaction length is &quot;</span> &lt;&lt; len_int &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;      <span class="keywordtype">double</span> mean_km2sr=km3sr/len_int;</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;Total area x steradians using km3sr/ CClen_int is \t\t\t\t&quot;</span> &lt;&lt; mean_km2sr &lt;&lt; <span class="stringliteral">&quot; km^2 str\n\n&quot;</span>;</div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;Total area x steradians using sum(dkm3sr/lint) is \t\t\t\t&quot;</span> &lt;&lt;km2sr &lt;&lt; <span class="stringliteral">&quot; km^2 str\n\n&quot;</span>;</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Total area x steradians is \t\t&quot;</span> &lt;&lt; km2sr &lt;&lt; <span class="stringliteral">&quot; km^2 str\n\n&quot;</span>;</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;      <span class="keywordtype">double</span> alt_km2sr=ice_area/(1.E6)*PI*eventsfound_prob/(<span class="keywordtype">double</span>)NNU;</div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;Total area x steradians using 4*PI*R_EARTH^2*eff. is \t&quot;</span> &lt;&lt; alt_km2sr &lt;&lt; <span class="stringliteral">&quot; km^2 str\n\n&quot;</span>;</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;      foutput &lt;&lt; <span class="stringliteral">&quot;These are not the same because we are not throwing all directions on all points of the surface.  Believe the first one as an approximation,  we are working on this for high cross sections.\n&quot;</span>;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;      <span class="comment">// ses=(pnu/1.E9)/(km2sr*3.16E7);</span></div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;    }<span class="comment">//end if IsMonoenergetic</span></div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;  }<span class="comment">//end if NNU!=0 and nevents!=0</span></div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;</div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;\t\t\t\t\t\t\tprobability of passing \t# events passing\n&quot;</span>;</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;No way this neutrino will see any ice \t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;noway[0]/(<span class="keywordtype">double</span>)count_total &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;    (double)count1-&gt;noway[1]/(<span class="keywordtype">double</span>)count_total &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;    count1-&gt;noway[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;noway[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Wheredoesitleave in PickUnbiased gives an error \t&quot;</span> &lt;&lt; (double)count1-&gt;wheredoesitleave_err[0]/(<span class="keywordtype">double</span>)count1-&gt;noway[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;    (double)count1-&gt;wheredoesitleave_err[1]/(<span class="keywordtype">double</span>)count1-&gt;noway[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;    count1-&gt;wheredoesitleave_err[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;wheredoesitleave_err[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;</div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;This neutrino direction never sees ice \t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;neverseesice[0]/(<span class="keywordtype">double</span>)count1-&gt;wheredoesitleave_err[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;    (double)count1-&gt;neverseesice[1]/(<span class="keywordtype">double</span>)count1-&gt;wheredoesitleave_err[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;    count1-&gt;neverseesice[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;neverseesice[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;</div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;WhereDoesItEnterIce in PickUnbiased gives an error \t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;wheredoesitenterice_err[0]/(<span class="keywordtype">double</span>)count1-&gt;neverseesice[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;    (double)count1-&gt;wheredoesitenterice_err[1]/(<span class="keywordtype">double</span>)count1-&gt;neverseesice[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;    count1-&gt;wheredoesitenterice_err[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;wheredoesitenterice_err[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;</div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Interaction point too high \t\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;toohigh[0]/(<span class="keywordtype">double</span>)count1-&gt;wheredoesitenterice_err[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;    (double)count1-&gt;toohigh[1]/(<span class="keywordtype">double</span>)count1-&gt;wheredoesitenterice_err[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;    count1-&gt;toohigh[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;toohigh[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;</div><div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Interaction point too low \t\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;toolow[0]/(<span class="keywordtype">double</span>)count1-&gt;toohigh[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;    (double)count1-&gt;toolow[1]/(<span class="keywordtype">double</span>)count1-&gt;toohigh[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;    count1-&gt;toolow[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;toolow[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;</div><div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;</div><div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;</div><div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;</div><div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;There is an interaction in ice \t\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;iceinteraction[0]/(<span class="keywordtype">double</span>)count1-&gt;toolow[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;    (double)count1-&gt;iceinteraction[1]/(<span class="keywordtype">double</span>)count1-&gt;toolow[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;    count1-&gt;iceinteraction[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;iceinteraction[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;</div><div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;In horizon \t\t\t\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;inhorizon[0]/(<span class="keywordtype">double</span>)count1-&gt;iceinteraction[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;    (double)count1-&gt;inhorizon[1]/(<span class="keywordtype">double</span>)count1-&gt;iceinteraction[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;    count1-&gt;inhorizon[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;inhorizon[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;</div><div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;</div><div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;</div><div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;From surface to balloon,  ray not intersected by earth \t&quot;</span> &lt;&lt; (double)count1-&gt;nraypointsup1[0]/(<span class="keywordtype">double</span>)count1-&gt;inhorizon[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;    (double)count1-&gt;nraypointsup1[1]/(<span class="keywordtype">double</span>)count1-&gt;inhorizon[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;    count1-&gt;nraypointsup1[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;nraypointsup1[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;</div><div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;After 1/r scaling and best case attenuation, \n\tMaximum signal is detectable\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;nnottoosmall[0]/(<span class="keywordtype">double</span>)count1-&gt;nraypointsup1[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;    (double)count1-&gt;nnottoosmall[1]/(<span class="keywordtype">double</span>)count1-&gt;nraypointsup1[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span></div><div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;          &lt;&lt; count1-&gt;nnottoosmall[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;nnottoosmall[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;</div><div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;</div><div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04743"></a><span class="lineno"> 4743</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Viewing angle lt 90 degrees\t\t\t&quot;</span> &lt;&lt; (double)count1-&gt;nviewangle_lt_90[0]/(<span class="keywordtype">double</span>)count1-&gt;nnottoosmall[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;    (double)count1-&gt;nviewangle_lt_90[1]/(<span class="keywordtype">double</span>)count1-&gt;nnottoosmall[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span></div><div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;          &lt;&lt; count1-&gt;nviewangle_lt_90[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;nviewangle_lt_90[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;</div><div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;</div><div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;Reality check:  EM and hadronic fractions both nonzero\t&quot;</span> &lt;&lt; (double)count1-&gt;ngoodfracs[0]/(<span class="keywordtype">double</span>)count1-&gt;nviewangle_lt_90[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;    (double)count1-&gt;ngoodfracs[1]/(<span class="keywordtype">double</span>)count1-&gt;nviewangle_lt_90[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span></div><div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;          &lt;&lt; count1-&gt;ngoodfracs[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;ngoodfracs[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;\tBoth EM and hadronic fractions are zero\t\t&quot;</span> &lt;&lt; (double)count1-&gt;nbadfracs[0]/(<span class="keywordtype">double</span>)count1-&gt;nviewangle_lt_90[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;    (double)count1-&gt;nbadfracs[1]/(<span class="keywordtype">double</span>)count1-&gt;nviewangle_lt_90[1] &lt;&lt; <span class="stringliteral">&quot;\t\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;    count1-&gt;nbadfracs[0] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; count1-&gt;nbadfracs[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;</div><div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;  foutput &lt;&lt; <span class="stringliteral">&quot;After finding neutrino direction,  \n\tchance of making through Earth\t\t\t&quot;</span> &lt;&lt; (double)count_chanceofsurviving/(<span class="keywordtype">double</span>)count1-&gt;ngoodfracs[0] &lt;&lt; &quot;\t\t\t&quot;;</div><div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;  foutput.precision(10);</div><div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;  foutput &lt;&lt; count_chanceofsurviving &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;  foutput &lt;&lt; &quot;Neutrino enters ice south of 60deg S latitude\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nentersice[0]/(<span class="keywordtype">double</span>)count_chanceofsurviving &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nentersice[1]/(<span class="keywordtype">double</span>)count_chanceofsurviving &lt;&lt;</div><div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;    &quot;\t\t&quot; &lt;&lt;</div><div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;    count1-&gt;nentersice[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nentersice[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;</div><div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;  foutput &lt;&lt; &quot;Neutrino reasonably likely <a class="code" href="../../d2/ded/classto.html">to</a> survive trip through Earth &quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nabsorbed[0]/(<span class="keywordtype">double</span>)count1-&gt;nentersice[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nabsorbed[1]/(<span class="keywordtype">double</span>)count1-&gt;nentersice[1] &lt;&lt; &quot;\t\t&quot;</div><div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;          &lt;&lt; count1-&gt;nabsorbed[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nabsorbed[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;  foutput &lt;&lt; &quot;<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> leaves the ice south of 60deg S latitude\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent1[0]/(<span class="keywordtype">double</span>)count1-&gt;nabsorbed[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent1[1]/(<span class="keywordtype">double</span>)count1-&gt;nabsorbed[1] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;    count1-&gt;nraywithincontinent1[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;    count1-&gt;nraywithincontinent1[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;</div><div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;  foutput &lt;&lt; &quot;After 1/r,  best guess ice attenuation,  \n\tmaximum signal is detectable\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count_chanceinhell0/(<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent1[0] &lt;&lt; &quot;\t\t\t&quot;;</div><div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;  foutput.precision(10);</div><div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;  foutput &lt;&lt;count_chanceinhell0 &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;</div><div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160;  foutput &lt;&lt; &quot;<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> is not totally internally reflected\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nnottir[0]/(<span class="keywordtype">double</span>)count_chanceinhell0 &lt;&lt;  &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04784"></a><span class="lineno"> 4784</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nnottir[1]/(<span class="keywordtype">double</span>)count_chanceinhell0 &lt;&lt;  &quot;\t\t&quot; &lt;&lt;</div><div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;    count1-&gt;nnottir[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nnottir[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;</div><div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;  foutput &lt;&lt; &quot;From surface <a class="code" href="../../d2/ded/classto.html">to</a> balloon,  ray not intersected by earth \t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nraypointsup2[0]/(<span class="keywordtype">double</span>)count1-&gt;nnottir[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nraypointsup2[1]/(<span class="keywordtype">double</span>)count1-&gt;nnottir[1] &lt;&lt;</div><div class="line"><a name="l04790"></a><span class="lineno"> 4790</span>&#160;    &quot;\t\t&quot;</div><div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;          &lt;&lt; count1-&gt;nraypointsup2[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nraypointsup2[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;</div><div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160;  foutput &lt;&lt; &quot;<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> leaves the ice south of 60deg S latitude\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent2[0]/(<span class="keywordtype">double</span>)count1-&gt;nraypointsup2[0] &lt;&lt;&quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04795"></a><span class="lineno"> 4795</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent2[0]/(<span class="keywordtype">double</span>)count1-&gt;nraypointsup2[1] &lt;&lt;</div><div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;    &quot;\t\t&quot; &lt;&lt; count1-&gt;nraywithincontinent2[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    count1-&gt;nraywithincontinent2[1]     &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;</div><div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;  foutput &lt;&lt; &quot;<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> leaves where there is ice\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nacceptablerf[0]/(<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent2[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nacceptablerf[1]/(<span class="keywordtype">double</span>)count1-&gt;nraywithincontinent2[1] &lt;&lt; &quot;\t\t&quot;</div><div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;          &lt;&lt; count1-&gt;nacceptablerf[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nacceptablerf[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;</div><div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;  foutput &lt;&lt; &quot;<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> tracing converges <a class="code" href="../../d2/ded/classto.html">to</a> within 10 m\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nconverges[0]/(<span class="keywordtype">double</span>)count1-&gt;nacceptablerf[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nconverges[1]/(<span class="keywordtype">double</span>)count1-&gt;nacceptablerf[1] &lt;&lt;</div><div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;    &quot;\t\t&quot; &lt;&lt; count1-&gt;nconverges[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nconverges[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;</div><div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;  foutput &lt;&lt; &quot;After fresnel coefficient,  \n\tmaximum signal is detectable\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_fresnel[0]/(<span class="keywordtype">double</span>)count1-&gt;nconverges[0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_fresnel[1]/(<span class="keywordtype">double</span>)count1-&gt;nconverges[1] &lt;&lt;</div><div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;    &quot;\t\t&quot; &lt;&lt;count1-&gt;nchanceinhell_fresnel[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nchanceinhell_fresnel[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;  foutput &lt;&lt; &quot;After 1/r,  \n\tmaximum signal is detectable\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_1overr[0]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_fresnel[0] &lt;&lt; &quot;\t&quot; &lt;&lt;  (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_1overr[1]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_fresnel[1] &lt;&lt; &quot;\t\t&quot; &lt;&lt;count1-&gt;nchanceinhell_1overr[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nchanceinhell_1overr[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;</div><div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;  foutput &lt;&lt; &quot;After ice attenuation,  \n\tmaximum signal is detectable\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell[0]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_1overr[0] &lt;&lt; &quot;\t&quot; &lt;&lt;</div><div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;    (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell[1]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell_1overr[1] &lt;&lt; &quot;\t&quot; &lt;&lt;count1-&gt;nchanceinhell[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;nchanceinhell[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;</div><div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;  foutput &lt;&lt; &quot;After viewing angle cut, \t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nviewanglecut[0]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell[0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nviewanglecut[1]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell[1] &lt;&lt; &quot;\t\t&quot; &lt;&lt; count1-&gt;nviewanglecut[0] &lt;&lt; &quot; &quot; &lt;&lt; count1-&gt;nviewanglecut[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;</div><div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;  foutput &lt;&lt; &quot;After factoring in off-Cerenkov cone tapering, \n\tMaximum signal is detectable\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell2[0]/(<span class="keywordtype">double</span>)count1-&gt;nviewanglecut[0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nchanceinhell2[1]/(<span class="keywordtype">double</span>)count1-&gt;nviewanglecut[1] &lt;&lt; &quot;\t\t&quot; &lt;&lt; count1-&gt;nchanceinhell2[0] &lt;&lt; &quot; &quot; &lt;&lt; count1-&gt;nchanceinhell2[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;</div><div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;  foutput &lt;&lt; &quot;Survive dead time \t\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;ndeadtime[0]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell2[0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;ndeadtime[1]/(<span class="keywordtype">double</span>)count1-&gt;nchanceinhell2[1] &lt;&lt; &quot;\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;ndeadtime[0] &lt;&lt; &quot; &quot; &lt;&lt; count1-&gt;ndeadtime[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;  </div><div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;  foutput &lt;&lt; &quot;Passes trigger\t\t\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npassestrigger[0]/(<span class="keywordtype">double</span>)count1-&gt;ndeadtime[0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npassestrigger[1]/(<span class="keywordtype">double</span>)count1-&gt;ndeadtime[1] &lt;&lt; &quot;\t\t&quot; &lt;&lt; count1-&gt;npassestrigger[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;npassestrigger[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;  foutput &lt;&lt; &quot;Number of l1 triggers\t\t\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nl1triggers[0][0] &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;nl1triggers[1][0] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;</div><div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;  foutput &lt;&lt; &quot;Chord is good length\t\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count_chordgoodlength/(<span class="keywordtype">double</span>)count1-&gt;npassestrigger[0] &lt;&lt; &quot;\t\t\t&quot;;</div><div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;  foutput.precision(10);</div><div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;  foutput &lt;&lt;count_chordgoodlength &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;  foutput &lt;&lt; &quot;Neutrino&#39;s path in ice more than 1m \t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count_d2goodlength/(<span class="keywordtype">double</span>)count_chordgoodlength &lt;&lt; &quot;\t\t\t&quot;;</div><div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;  foutput.precision(10);</div><div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;  foutput &lt;&lt; count_d2goodlength &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;  foutput.precision(4);</div><div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;  foutput &lt;&lt; &quot;Events that pass all cuts\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npass[0]/(<span class="keywordtype">double</span>)count_d2goodlength &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npass[1]/(<span class="keywordtype">double</span>)count_d2goodlength &lt;&lt; &quot;\t\t&quot;;</div><div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160;  foutput.precision(10);</div><div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;  foutput &lt;&lt;count1-&gt;npass[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;npass[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;</div><div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;  cout &lt;&lt; &quot;Events that pass all cuts\t\t\t\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npass[0]/(<span class="keywordtype">double</span>)count_d2goodlength &lt;&lt; &quot;\t&quot; &lt;&lt; (<span class="keywordtype">double</span>)count1-&gt;npass[1]/(<span class="keywordtype">double</span>)count_d2goodlength &lt;&lt; &quot;\t\t&quot;;</div><div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;  cout &lt;&lt;count1-&gt;npass[0] &lt;&lt; &quot;\t&quot; &lt;&lt; count1-&gt;npass[1] &lt;&lt; &quot;\n&quot;;</div><div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;</div><div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;</div><div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;  if (src_model) </div><div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;  {</div><div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;</div><div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;    TString str; str.Form(<span class="stringliteral">&quot;%s/source_times.txt&quot;</span>, outputdir.Data()); </div><div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160;    FILE * f = fopen(str.Data(),<span class="stringliteral">&quot;w&quot;</span>); </div><div class="line"><a name="l04851"></a><span class="lineno"> 4851</span>&#160;    std::vector&lt;double&gt; times; </div><div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;    src_model-&gt;computeFluxTimeChanges(&amp;times); </div><div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; times.size(); i++) </div><div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;    {</div><div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;      fprintf(f,<span class="stringliteral">&quot;%f\n&quot;</span>, times[i]); </div><div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;    }</div><div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;    fclose(f); </div><div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;  }</div><div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;</div><div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;  <span class="comment">//  if (EXPONENT&lt;=10||EXPONENT&gt;100) {</span></div><div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;  <span class="keywordflow">if</span> ( src_model || spectra1-&gt;IsSpectrum() ) {</div><div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;    <span class="keywordtype">double</span> sum_events=0.;</div><div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;    <span class="keywordtype">double</span> thisenergy=0.;</div><div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;    <span class="keywordtype">double</span> thislen_int_kgm2=0.;</div><div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;    <span class="comment">// double *energy=spectra1-&gt;GetEnergyArray();</span></div><div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;    <span class="comment">// double *EdNdEdAdt=spectra1-&gt;GetEdNdEdAdt();</span></div><div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;</div><div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160;    <span class="comment">// for models which don&#39;t have even spaced energy bin,</span></div><div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;    <span class="keywordtype">double</span> even_E;</div><div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;    <span class="keywordtype">int</span> N_even_E = 12;</div><div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;    <span class="keywordtype">double</span> integral=0;</div><div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160;    <span class="keywordtype">double</span> min_energy = src_model ? settings1-&gt;SOURCE_MIN_E : spectra1-&gt;Getenergy()[0];</div><div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    <span class="keywordtype">double</span> max_energy = src_model ? settings1-&gt;SOURCE_MAX_E : spectra1-&gt;Getenergy()[spectra1-&gt;GetE_bin()-1];</div><div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;    even_E = ( max_energy - min_energy  ) / ( (<span class="keywordtype">double</span>) N_even_E );</div><div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;</div><div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160;    TH1 * src_flux = 0; </div><div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;    <span class="keywordflow">if</span> (src_model) </div><div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;    {</div><div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;      src_flux = src_model-&gt;estimateFlux(bn1-&gt;min_time,bn1-&gt;max_time, TMath::Power(10,min_energy-9), TMath::Power(10,max_energy-9), 2*N_even_E, 10000); </div><div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;<span class="comment">//      TFile fsrcflux(&quot;fsrcflux.root&quot;,&quot;RECREATE&quot;); </span></div><div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;<span class="comment">//      src_flux-&gt;Write(); </span></div><div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;    }</div><div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;  </div><div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160;  </div><div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;N_even_E;i++) {</div><div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;      thisenergy=pow(10., (min_energy+((<span class="keywordtype">double</span>)i)*even_E));</div><div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;      primary1-&gt;<a class="code" href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">GetSigma</a>(thisenergy, sigma, thislen_int_kgm2, settings1, xsecParam_nutype, Interaction::ktotal);</div><div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;    </div><div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;      <span class="comment">// are the units of this in log (eV) ???!????!??</span></div><div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;      <span class="keywordtype">double</span> EdNdEdAdt = src_model ? 1e9*src_flux-&gt;Interpolate(thisenergy*1e-9) : spectra1-&gt;GetEdNdEdAdt(log10(thisenergy));</div><div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;</div><div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;      <span class="comment">// EdNdEdAdt is in #/cm^2/s</span></div><div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;      <span class="comment">// need to be multiplied by 1e4 to change 1/cm2 to 1/m^2</span></div><div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;      <span class="comment">// can also be written dN/d(lnE)dAdt</span></div><div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;      <span class="comment">// = dN*log(10)/d(log E)dAdt</span></div><div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;      <span class="comment">// the bin spacing is 0.5</span></div><div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;      <span class="comment">// so # events ~ dN*log(10)*0.5/d(log E)dAdt</span></div><div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;      sum_events+=even_E*log(10.)*( EdNdEdAdt*1e4 )/(thislen_int_kgm2/sig1-&gt;RHOH20);</div><div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;      integral+=even_E*log(10.)*(EdNdEdAdt);</div><div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;thisenergy,  EdNdEdAdt is &quot;</span> &lt;&lt; thisenergy &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt;  EdNdEdAdt &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;      <span class="comment">//foutput &lt;&lt; &quot;interaction length is &quot; &lt;&lt; thislen_int_kgm2/RHOH20 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;    }<span class="comment">//end for N_even_E</span></div><div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;     <span class="comment">// for (int i=0;i&lt;12;i++) {</span></div><div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;     <span class="comment">//   thisenergy=pow(10., (spectra1-&gt;Getenergy())[0]+((double)i)*0.5);</span></div><div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;     <span class="comment">//   primary1-&gt;GetSigma(thisenergy, sigma, thislen_int_kgm2, settings1, xsecParam_nutype, xsecParam_nuint);</span></div><div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;     <span class="comment">//   // EdNdEdAdt is in #/cm^2/s</span></div><div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;     <span class="comment">//   // can also be written dN/d(lnE)dAdt</span></div><div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;     <span class="comment">//   // = dN*log(10)/d(log E)dAdt</span></div><div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;     <span class="comment">//   // the bin spacing is 0.5</span></div><div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;     <span class="comment">//   // so # events ~ dN*log(10)*0.5/d(log E)dAdt</span></div><div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;     <span class="comment">//   sum_events+=0.5*log(10.)*(spectra1-&gt;GetEdNdEdAdt())[i]/(thislen_int_kgm2/sig1-&gt;RHOH20);</span></div><div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;     <span class="comment">//   cout &lt;&lt; &quot;thisenergy,  EdNdEdAdt is &quot; &lt;&lt; thisenergy &lt;&lt; &quot; &quot; &lt;&lt; spectra1-&gt;EdNdEdAdt[i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;     <span class="comment">//   //foutput &lt;&lt; &quot;interaction length is &quot; &lt;&lt; thislen_int_kgm2/RHOH20 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;     <span class="comment">// } //end for i</span></div><div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;    <span class="comment">//km3sr=volume*pow(1.E-3, 3)*sig1-&gt;RHOMEDIUM/RHOH20*sr*nevents/(double)NNU;</span></div><div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;SUM EVENTS IS &quot;</span> &lt;&lt; sum_events &lt;&lt; endl;</div><div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;INTEGRAL : &quot;</span> &lt;&lt; integral &lt;&lt; endl;</div><div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;    sum_events*=volume*anita1-&gt;LIVETIME*sig1-&gt;RHOMEDIUM/sig1-&gt;RHOH20*nevents/(double)NNU*sr;</div><div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;    <span class="comment">// sum_events*=anita1-&gt;LIVETIME*km3sr*1e9;</span></div><div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;volume,  LIVETIME,  sig1-&gt;RHOMEDIUM,  RHOH20,  nevents,  NNU,  sr are &quot;</span> &lt;&lt; volume &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; anita1-&gt;LIVETIME &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; sig1-&gt;RHOMEDIUM &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; sig1-&gt;RHOH20 &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; nevents &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; NNU &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; sr &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Total events observed is &quot;</span> &lt;&lt; sum_events &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;  } <span class="comment">//end if IsSpectrum</span></div><div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160;</div><div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;}</div><div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;<span class="comment">//end Summarize()</span></div><div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;</div><div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;</div><div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;<span class="keywordtype">double</span> GetAirDistance(<span class="keywordtype">double</span> altitude_bn, <span class="keywordtype">double</span> beta) { <span class="comment">// given beta=angle wrt horizontal that the ray hits the balloon,  calculate distance that the ray traveled in air,  including curvature of earth</span></div><div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;  <span class="keywordflow">return</span> EarthModel::R_EARTH*acos((altitude_bn+EarthModel::R_EARTH)/EarthModel::R_EARTH*(1-sin(beta)*sin(beta))+1/EarthModel::R_EARTH*sin(beta)*sqrt((altitude_bn+EarthModel::R_EARTH)*(altitude_bn+EarthModel::R_EARTH)*sin(beta)*sin(beta)-2*EarthModel::R_EARTH*altitude_bn-altitude_bn*altitude_bn));</div><div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;}</div><div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;<span class="comment">//end GetAirDistance()</span></div><div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;</div><div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;</div><div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;<span class="keywordtype">double</span> GetAverageVoltageFromAntennasHit(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, <span class="keywordtype">int</span> *nchannels_perrx_triggered, <span class="keywordtype">double</span> *voltagearray, <span class="keywordtype">double</span>&amp; volts_rx_sum) {</div><div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;  <span class="keywordtype">double</span> sum=0;</div><div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;  <span class="keywordtype">int</span> count_hitantennas=0;</div><div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;settings1-&gt;NANTENNAS;i++) {</div><div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160;    <span class="keywordflow">if</span> (nchannels_perrx_triggered[i]&gt;=3) {</div><div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;      sum+=voltagearray[i];</div><div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;      count_hitantennas++;</div><div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;  } <span class="comment">//for</span></div><div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;  volts_rx_sum = sum;</div><div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160;  sum = sum/(double)count_hitantennas;</div><div class="line"><a name="l04945"></a><span class="lineno"> 4945</span>&#160;  <span class="keywordflow">return</span> sum;</div><div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;}</div><div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;<span class="comment">//end GetAverageVoltageFromAntennasHit()</span></div><div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;</div><div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;</div><div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;<a class="code" href="../../d5/db2/class_vector.html">Vector</a> GetPolarization(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside) {</div><div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;  <span class="comment">// Want to find a unit vector in the same plane as nnu and n_refr,</span></div><div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;  <span class="comment">// but perpendicular to n_refr,  pointing away from nnu.</span></div><div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;</div><div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;  <span class="comment">// cross nnu with n_refr to get the direction of the B field.</span></div><div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_bfield = nnu.Cross(nrf2_iceside);</div><div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;  <span class="comment">// cross b-field with nrf2_iceside to get the polarization vector.</span></div><div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> n_pol = n_bfield.Cross(nrf2_iceside);</div><div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;  n_pol = n_pol.Unit();</div><div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;  <span class="comment">// check and make sure E-field is pointing in the right direction.</span></div><div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;  <span class="keywordflow">if</span> (nnu*nrf2_iceside&gt;0 &amp;&amp; n_pol*nnu&gt;0){</div><div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;error in GetPolarization.  Event is &quot;</span> &lt;&lt; inu &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;  }</div><div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;  <span class="keywordflow">return</span> n_pol;</div><div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;}</div><div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;<span class="comment">//end GetPolarization()</span></div><div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;</div><div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;</div><div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;<span class="keywordtype">void</span> CloseTFile(TFile *hfile) {</div><div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;  hfile-&gt;cd();</div><div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;  hfile-&gt;Write();</div><div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;  hfile-&gt;Close();</div><div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;}</div><div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;<span class="comment">//end CloseTFile()</span></div><div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;</div><div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;</div><div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;<span class="keywordtype">double</span> IsItDoubleBang(<span class="keywordtype">double</span> exitlength, <span class="keywordtype">double</span> plepton) {</div><div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;  <span class="keywordtype">double</span> gamma=plepton/MTAU;</div><div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;  <span class="keywordflow">return</span> 1-exp(-1*exitlength/(TAUDECAY_TIME*CLIGHT*gamma));</div><div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;}</div><div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;<span class="comment">//end IsItDoubleBang()</span></div><div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;</div><div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;</div><div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;<span class="keywordtype">int</span> WhereIsSecondBang(<span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu, <span class="keywordtype">double</span> nuexitlength, <span class="keywordtype">double</span> pnu, <a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica1, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;r_bn, <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu2, <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit_db, <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2bn_db) {</div><div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;  <span class="keywordtype">double</span> rnd1=0;</div><div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;  <span class="keywordtype">double</span> rnd2=2;</div><div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;  <span class="keywordtype">double</span> gamma=pnu/MTAU;</div><div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;</div><div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;  <span class="keywordflow">if</span> (exp(-1*nuexitlength/(TAUDECAY_TIME*CLIGHT*gamma))&gt;0.999){</div><div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;    rnd1=getRNG(RNG_SECOND_BANG)-&gt;Rndm()*nuexitlength;</div><div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;  }</div><div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;    <span class="keywordflow">while</span> (rnd2&gt;1-exp(-1*rnd1/(TAUDECAY_TIME*CLIGHT*gamma))) {</div><div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;      rnd1=getRNG(RNG_SECOND_BANG)-&gt;Rndm()*nuexitlength;</div><div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;      rnd2=getRNG(RNG_SECOND_BANG)-&gt;Rndm();</div><div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;    } <span class="comment">//while</span></div><div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;  } <span class="comment">//else</span></div><div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;  posnu2 = posnu + rnd1*nnu;</div><div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;  rfexit_db = antarctica1-&gt;Surface(posnu2)*posnu2.Unit();</div><div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;</div><div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;  <span class="comment">// unit vector pointing to antenna from exit point.</span></div><div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;  n_exit2bn_db = (r_bn - rfexit_db) / r_bn.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(rfexit_db);</div><div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;</div><div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;  <span class="keywordtype">double</span> cosangle=(n_exit2bn_db * posnu2) / posnu2.Mag();</div><div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;  <span class="keywordflow">if</span> (cosangle&lt;0){</div><div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;  }</div><div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;}</div><div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;<span class="comment">//end WhereIsSecondBang()</span></div><div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;</div><div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;</div><div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;<span class="comment">//the following is  a new function only for reflected case.</span></div><div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;<span class="keywordtype">void</span> Attenuate_down(<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica1, <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, <span class="keywordtype">double</span>&amp; vmmhz_max, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit2, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu_down) {</div><div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160;  <span class="keywordtype">double</span> ATTENLENGTH=700;</div><div class="line"><a name="l05015"></a><span class="lineno"> 5015</span>&#160;  <span class="keywordflow">if</span>(!settings1-&gt;VARIABLE_ATTEN){</div><div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;    ATTENLENGTH=antarctica1-&gt;EffectiveAttenuationLength(settings1, posnu, 1);</div><div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;  }</div><div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;</div><div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;  <span class="keywordtype">int</span> position_in_iceshelves=antarctica1-&gt;IceOnWater(posnu);</div><div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160;  <span class="keywordtype">int</span> position_in_rossexcept=antarctica1-&gt;RossExcept(posnu);</div><div class="line"><a name="l05021"></a><span class="lineno"> 5021</span>&#160;  <span class="comment">// int position_in_ross = antarctica-&gt;RossIceShelf(posnu);</span></div><div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;  <span class="comment">// int position_in_ronne = antarctica-&gt;RonneIceShelf(posnu);</span></div><div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;  <span class="keywordtype">double</span> dtemp=posnu_down.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(rfexit2)/ATTENLENGTH;</div><div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;</div><div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;  <span class="keywordflow">if</span> (dtemp&lt;20) {</div><div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;    <span class="comment">// if(position_in_ross || position_in_ronne) {</span></div><div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;    <span class="keywordflow">if</span>(position_in_iceshelves &amp;&amp; (!position_in_rossexcept)){</div><div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;      <span class="comment">// scalefactor_attenuation=0.310227766*exp(-dtemp);</span></div><div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;      <span class="comment">// vmmhz_max=vmmhz_max*exp(-dtemp)*0.310227766;//10% of power reflected</span></div><div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;      scalefactor_attenuation=0.71*exp(-dtemp);</div><div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;      vmmhz_max=vmmhz_max*0.71*exp(-dtemp);<span class="comment">//50% of power reflected. -3dB</span></div><div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;    } <span class="comment">//end if</span></div><div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(position_in_rossexcept){</div><div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;      scalefactor_attenuation=0.1*exp(-dtemp);</div><div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;      vmmhz_max=0.1*vmmhz_max*exp(-dtemp);<span class="comment">//1% of power reflected. -20dB</span></div><div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;    }<span class="comment">//end else if</span></div><div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;      scalefactor_attenuation=sqrt(0.001)*exp(-dtemp);</div><div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;      vmmhz_max=sqrt(0.001)*vmmhz_max*exp(-dtemp);<span class="comment">//0.1% of power reflected.-30dB</span></div><div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;  } <span class="comment">//if</span></div><div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;    scalefactor_attenuation=0;</div><div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;    vmmhz_max=0;</div><div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;  } <span class="comment">//else</span></div><div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;}</div><div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;<span class="comment">//end Attenuate_down()</span></div><div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;</div><div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;</div><div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;<span class="keywordtype">void</span> Attenuate(<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica1, <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, <span class="keywordtype">double</span>&amp; vmmhz_max,  <span class="keywordtype">double</span> rflength, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu) {</div><div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;  <span class="keywordtype">double</span> ATTENLENGTH=700;  <span class="comment">// constant attenuation length for now.</span></div><div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;  <span class="keywordflow">if</span> (!settings1-&gt;VARIABLE_ATTEN){</div><div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;    ATTENLENGTH = antarctica1-&gt;EffectiveAttenuationLength(settings1, posnu, 0);</div><div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;  }</div><div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;</div><div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;  <span class="keywordtype">double</span> dtemp=(rflength/ATTENLENGTH);</div><div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;  <span class="keywordflow">if</span>(!settings1-&gt;ROUGHNESS){</div><div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;    <span class="keywordflow">if</span> (dtemp&lt;20) {</div><div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;      scalefactor_attenuation=exp(-dtemp);</div><div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;      vmmhz_max=vmmhz_max*exp(-dtemp);</div><div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;      scalefactor_attenuation=0;</div><div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;      vmmhz_max=0;</div><div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;  }</div><div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;  <span class="keywordflow">else</span>{       <span class="comment">// use a larger allowable value in case of roughness</span></div><div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;    <span class="keywordflow">if</span> (dtemp&lt;10000) {</div><div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;      scalefactor_attenuation=exp(-dtemp);</div><div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;      vmmhz_max=vmmhz_max*exp(-dtemp);</div><div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;      scalefactor_attenuation=0;</div><div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;      vmmhz_max=0;</div><div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;  }</div><div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;}</div><div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;<span class="comment">//end Attenuate()</span></div><div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;</div><div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;</div><div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;<span class="keywordtype">void</span> IsAbsorbed(<span class="keywordtype">double</span> chord_kgm2, <span class="keywordtype">double</span> len_int_kgm2, <span class="keywordtype">double</span> &amp;weight1) {</div><div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;  <span class="comment">// see if neutrino is absorbed</span></div><div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;  <span class="comment">//  weighting works,  but not to much purpose since nu&#39;s always</span></div><div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;  <span class="comment">//   interact at these energies.</span></div><div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160;  <span class="keywordtype">double</span> rtemp;</div><div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;</div><div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;  rtemp=chord_kgm2/len_int_kgm2;</div><div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160;  <span class="keywordflow">if</span> (rtemp&lt;=20)</div><div class="line"><a name="l05089"></a><span class="lineno"> 5089</span>&#160;    weight1=exp(-rtemp);</div><div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    weight1=0;</div><div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;}</div><div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;<span class="comment">//end IsAbsorbed()</span></div><div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;</div><div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160;</div><div class="line"><a name="l05096"></a><span class="lineno"> 5096</span>&#160;<span class="keywordtype">void</span> GetSmearedIncidentAngle(<a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;specular, <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf_iceside, <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2bn, <span class="keywordtype">double</span> SMEARINCIDENTANGLE){</div><div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;  <span class="comment">//  void GetSmearedIncidentAngle(Vector &amp;specular, Vector &amp;nsurf_rfexit, Vector &amp;nrf_iceside, Vector &amp;n_exit2bn, double SMEARINCIDENTANGLE, double theta_inc_smeared) {</span></div><div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;  <span class="comment">// Smear the incident angle for roughness studies</span></div><div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;  specular+=nrf_iceside; <span class="comment">// specular is the ray that we got from Snell&#39;s law</span></div><div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> parallel_to_surface; <span class="comment">// find vector parallel to surface to rotate the vector around</span></div><div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;  parallel_to_surface+=n_exit2bn; <span class="comment">// want to cross specular with n_exit2bn</span></div><div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160;  parallel_to_surface.Cross(specular);</div><div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;  nrf_iceside.Rotate(SMEARINCIDENTANGLE*(2*getRNG(RNG_SMEARED_INCIDENT_ANGLE)-&gt;Rndm()-1.), parallel_to_surface); <span class="comment">// smear the incident ray</span></div><div class="line"><a name="l05104"></a><span class="lineno"> 5104</span>&#160;  <span class="comment">//   theta_inc_smeared=acos(nrf_iceside.Dot(nsurf_rfexit));</span></div><div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;}</div><div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;<span class="comment">//end GetSmearedIncidentAngle()</span></div><div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;</div><div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;</div><div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160;<span class="keywordtype">int</span> GetRayIceSide(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_exit2rx,  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nsurf_rfexit, <span class="keywordtype">double</span> nexit,  <span class="keywordtype">double</span> nenter,  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside) {</div><div class="line"><a name="l05110"></a><span class="lineno"> 5110</span>&#160;  <span class="comment">// this function performs snell&#39;s law in three dimensions</span></div><div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;  <span class="keywordtype">double</span> costh=0;</div><div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;  <span class="keywordtype">double</span> NRATIO=nexit/nenter;</div><div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;  costh=(n_exit2rx*nsurf_rfexit)/(n_exit2rx.Mag() * nsurf_rfexit.Mag()); <span class="comment">// cos(theta) of the transmission angle</span></div><div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;</div><div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;  <span class="keywordflow">if</span> (costh&lt;0) {</div><div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;returning 0.  inu is &quot; &lt;&lt; inu &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05118"></a><span class="lineno"> 5118</span>&#160;  }</div><div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;  <span class="keywordtype">double</span> sinth=sqrt(1 - costh*costh);</div><div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;  <span class="keywordtype">double</span> factor=NRATIO*costh-sqrt(1-(NRATIO*sinth*NRATIO*sinth));</div><div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;  nrf2_iceside = -factor*nsurf_rfexit + NRATIO*n_exit2rx;</div><div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;  nrf2_iceside = nrf2_iceside.Unit(); <span class="comment">// normalize</span></div><div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;}</div><div class="line"><a name="l05125"></a><span class="lineno"> 5125</span>&#160;<span class="comment">//end GetRayIceSide()</span></div><div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;</div><div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;</div><div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;<span class="keywordtype">int</span> GetDirection(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, <a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *interaction1, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;refr,  <span class="keywordtype">double</span> deltheta_em,  <span class="keywordtype">double</span> deltheta_had, <span class="keywordtype">double</span> emfrac,  <span class="keywordtype">double</span> hadfrac,  <span class="keywordtype">double</span> vmmhz1m_max,  <span class="keywordtype">double</span> r_fromballoon,  <a class="code" href="../../d2/d1f/class_ray.html">Ray</a> *ray1,  <a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> posnu,  Anita *anita1,  <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1, <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu,  <span class="keywordtype">double</span>&amp; costhetanu,  <span class="keywordtype">double</span>&amp; theta_threshold) {</div><div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;</div><div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;  <span class="comment">// in the specular (settings1-&gt;ROUGHNESS = 0) this function sets the neutrino direction according to a selection routine based on veiweing within the Cerenkov cone</span></div><div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;</div><div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;  <span class="comment">// in the roughness case we just want to pick a random allowable direction, so let&#39;s keep the original sampled neutrino direction from back in IceModel::PickUnbiased() inside Ray::PickRoughnessInteractionPoint()</span></div><div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;</div><div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;  <span class="comment">//if (!settings1-&gt;ROUGHNESS){ // no roughness, use the original routine</span></div><div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;    <span class="keywordtype">int</span> dont_count=0;</div><div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160;    <span class="keywordtype">double</span> theta_test=0;</div><div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="keywordtype">double</span> vmmhz1m_test=0;</div><div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;    <span class="keywordtype">double</span> costhetanu1 = 0;</div><div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160;    <span class="keywordtype">double</span> costhetanu2 = 0;</div><div class="line"><a name="l05140"></a><span class="lineno"> 5140</span>&#160;</div><div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;    <span class="keywordflow">if</span> (bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a81c68a6d332881cf4759a4bcca7dc48c">WHICHPATH</a>==3) { <span class="comment">//To make a banana plot,  force neutrino direction</span></div><div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;      nnu = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#abb9f55c7153603ca5d2c8151bcd02fa7">nnu_banana</a>;</div><div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;      theta_threshold = 0; <span class="comment">//not used for anything in banana plots</span></div><div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;    } <span class="comment">//if (make banana plot)</span></div><div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;  </div><div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;</div><div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;SKIPCUTS || !settings1-&gt;USEDIRECTIONWEIGHTS) { <span class="comment">// this is a setting that allows all neutrino angles,  no restriction.  Makes the code slower.</span></div><div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;      costhetanu2=1.;</div><div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;      costhetanu1=-1.;</div><div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;      theta_threshold=1;</div><div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160;    } <span class="comment">//end if (settings1-&gt;SKIPCUTS || !USEWEIGHTS)</span></div><div class="line"><a name="l05153"></a><span class="lineno"> 5153</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;      <span class="keywordflow">if</span> (emfrac&lt;=1.E-10 &amp;&amp; deltheta_had &gt;1.E-10) {</div><div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;        <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(hadfrac*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)*sin(sig1-&gt;changle)&gt;1)</div><div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;          <span class="comment">//if (Tools::dMax(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(hadfrac*vmmhz1m_max*heff_max*bw/1.E6)*sin(sig1-&gt;changle)&gt;1)</span></div><div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;          theta_threshold=-1;</div><div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;          <span class="comment">//theta_threshold=sqrt(-1*deltheta_had*deltheta_had*log(Tools::dMax(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(hadfrac*vmmhz1m_max*heff_max*bw/1.E6)*sin(sig1-&gt;changle))/ALOG2);</span></div><div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;          theta_threshold=sqrt(-1*deltheta_had*deltheta_had*log(anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(hadfrac*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)*sin(sig1-&gt;changle))/ALOG2);</div><div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;          averaging_thetas1+=theta_threshold;</div><div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        } <span class="comment">//else</span></div><div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;        count_inthisloop1++;</div><div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;      } <span class="comment">//if</span></div><div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;</div><div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;      <span class="keywordflow">if</span> (emfrac&gt;1.E-10 &amp;&amp; deltheta_had &lt;=1.E-10) {</div><div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;        dont_count++;</div><div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;        <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(emfrac*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)*sin(sig1-&gt;changle)&gt;1)</div><div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;          <span class="comment">//if (Tools::dMax(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(emfrac*vmmhz1m_max*heff_max*bw/1.E6)*sin(sig1-&gt;changle)&gt;1)</span></div><div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;          theta_threshold=-1;</div><div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;          <span class="comment">//theta_threshold=sqrt(-1*deltheta_em*deltheta_em*log(Tools::dMax(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(emfrac*vmmhz1m_max*heff_max*bw/1.E6)*sin(sig1-&gt;changle))/0.5);</span></div><div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;          theta_threshold=sqrt(-1*deltheta_em*deltheta_em*log(anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(emfrac*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)*sin(sig1-&gt;changle))/0.5);</div><div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;          averaging_thetas2+=theta_threshold;</div><div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;        } <span class="comment">//else</span></div><div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        count_inthisloop2++;</div><div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;      } <span class="comment">//if</span></div><div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;</div><div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;</div><div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;      <span class="comment">//start big code block of ifs/elses</span></div><div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;      <span class="keywordflow">if</span> (emfrac&gt;1.E-10 &amp;&amp; deltheta_had&gt;1.E-10) {</div><div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;        <span class="comment">// if the electromagnetic and hadronic components of the shower are both non-negligible</span></div><div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;        <span class="comment">// then theta_threshold cannot be determined analytically so we step away from the cerenkov angle in steps equal to 1/2 * deltheta_em</span></div><div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;        <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/((hadfrac+emfrac)*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.) {</div><div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;          <span class="comment">//if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/((hadfrac+emfrac)*vmmhz1m_max*heff_max*bw/1.E6)&gt;1.) {</span></div><div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;          theta_threshold=-1.; <span class="comment">// if it&#39;s not detectable at all</span></div><div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;        }</div><div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        <span class="keywordflow">else</span> { <span class="comment">// otherwise,  start stepping.</span></div><div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;          theta_test=deltheta_em; <span class="comment">// this is the angle we start stepping at</span></div><div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;          vmmhz1m_test=vmmhz1m_max; <span class="comment">// this will be the magnitude of the signal at theta_test away from the cerenkov cone.</span></div><div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;          <span class="comment">// find the magnitude of the signal at theta_test away from the cerenkov cone.</span></div><div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;          sig1-&gt;TaperVmMHz(sig1-&gt;changle+theta_test, deltheta_em, deltheta_had, emfrac, hadfrac, vmmhz1m_test, djunk);</div><div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;          <span class="comment">//  if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(vmmhz1m_test*heff_max*bw/1.E6)&gt;1.) { // is this electric field already too low to have a chance of passing the trigger threshold?</span></div><div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;          <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(vmmhz1m_test/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.) { <span class="comment">// is this electric field already too low to have a chance of passing the trigger threshold?</span></div><div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;            theta_threshold=theta_test; <span class="comment">// then that is the maximum angular deviation</span></div><div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;          }</div><div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;          <span class="keywordflow">else</span> { <span class="comment">// otherwise increment by the step size and check again.</span></div><div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;            theta_test=1.5*deltheta_em;</div><div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;            vmmhz1m_test=vmmhz1m_max;</div><div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;            sig1-&gt;TaperVmMHz(sig1-&gt;changle+theta_test, deltheta_em, deltheta_had, emfrac, hadfrac, vmmhz1m_test, djunk);</div><div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;</div><div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;            <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(vmmhz1m_test/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.) {</div><div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;              <span class="comment">//if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(vmmhz1m_test*heff_max*bw/1.E6)&gt;1.) {</span></div><div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;              theta_threshold=theta_test;</div><div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;            }</div><div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;            <span class="keywordflow">else</span> { <span class="comment">// otherwise increment by the step size and check again.</span></div><div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;              theta_test=2*deltheta_em;</div><div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;              vmmhz1m_test=vmmhz1m_max;</div><div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;              sig1-&gt;TaperVmMHz(sig1-&gt;changle+theta_test, deltheta_em, deltheta_had, emfrac, hadfrac, vmmhz1m_test, djunk);</div><div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160;              <span class="comment">//if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(vmmhz1m_test*heff_max*bw/1.E6)&gt;1.)</span></div><div class="line"><a name="l05211"></a><span class="lineno"> 5211</span>&#160;              <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(vmmhz1m_test/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.)</div><div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;                theta_threshold=theta_test;</div><div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;              <span class="keywordflow">else</span> { <span class="comment">// otherwise increment by the step size and check again.</span></div><div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;                theta_test=3*deltheta_em;</div><div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;                vmmhz1m_test=vmmhz1m_max;</div><div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;                sig1-&gt;TaperVmMHz(sig1-&gt;changle+theta_test, deltheta_em, deltheta_had, emfrac, hadfrac, vmmhz1m_test, djunk);</div><div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;                <span class="comment">//if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(vmmhz1m_test*heff_max*bw/1.E6)&gt;1.)</span></div><div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;</div><div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;                <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(vmmhz1m_test/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.)</div><div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;                  theta_threshold=theta_test;</div><div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;                <span class="keywordflow">else</span> { <span class="comment">// otherwise,  set is the the width of the hadronic component (much wider than the electromagnetic component)</span></div><div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;                  theta_test=deltheta_had;</div><div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;                  vmmhz1m_test=vmmhz1m_max;</div><div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;                  sig1-&gt;TaperVmMHz(sig1-&gt;changle+theta_test, deltheta_em, deltheta_had, emfrac, hadfrac, vmmhz1m_test, djunk);</div><div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;                  <span class="comment">// if at the hadronic width,  you&#39;re below the threshold</span></div><div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;                  <span class="keywordflow">if</span> (anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(vmmhz1m_test/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)&gt;1.)</div><div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;                    <span class="comment">//if (Tools::dMin(VNOISE, settings1-&gt;NLAYERS)*anita1-&gt;maxthreshold/(vmmhz1m_test*heff_max*bw/1.E6)&gt;1.) // if at the hadronic width,  you&#39;re below the threshold</span></div><div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160;                    theta_threshold=theta_test; <span class="comment">// set theta_threshold</span></div><div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;                  <span class="keywordflow">else</span> { <span class="comment">// otherwise,  find theta_threshold considering the hadronic component alone.  This is conservative-- an electromagnetic component would only make it narrower.</span></div><div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;                    theta_threshold=sqrt(-1*deltheta_had*deltheta_had*log(anita1-&gt;VNOISE[0]/10.*anita1-&gt;maxthreshold/(hadfrac*vmmhz1m_max/r_fromballoon*heff_max*anita1-&gt;bwmin/1.E6)*sin(sig1-&gt;changle))/0.5);</div><div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;                  } <span class="comment">// else: not below threshold at deltheta_had</span></div><div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;                } <span class="comment">// else: not below threshold at 3*deltheta_em</span></div><div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160;</div><div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;              } <span class="comment">// else: not below threshold at 2.5*deltheta_em</span></div><div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;            } <span class="comment">// else: not below threshold at 2.0*deltheta_em</span></div><div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;</div><div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;          } <span class="comment">// else: not below threshold at 1.5*deltheta_em</span></div><div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;</div><div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;        } <span class="comment">// not below threshold at 1.0*deltheta_em</span></div><div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;        count_inthisloop3++;</div><div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160;        averaging_thetas3+=theta_threshold;</div><div class="line"><a name="l05242"></a><span class="lineno"> 5242</span>&#160;</div><div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;      } <span class="comment">// end if both the em and hadronic components are non-negligible.</span></div><div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;      <span class="comment">//end big code block of ifs/elses</span></div><div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;</div><div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;      theta_threshold*=settings1-&gt;THETA_TH_FACTOR; <span class="comment">// multiply theta_threshold by scale factor if requested,  for testing purposes.</span></div><div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;      <span class="keywordflow">if</span> (theta_threshold&gt;0) { <span class="comment">// we only pick the angle between 0 and pi so set the upper and lower limits accordingly.</span></div><div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;        <span class="keywordflow">if</span> (sig1-&gt;changle-theta_threshold&lt;0 &amp;&amp; sig1-&gt;changle+theta_threshold&gt; PI) {</div><div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;          costhetanu2=1.;</div><div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;          costhetanu1=-1.;</div><div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;        } <span class="comment">//if</span></div><div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sig1-&gt;changle-theta_threshold&gt;0 &amp;&amp; sig1-&gt;changle+theta_threshold&gt; PI) {</div><div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;          costhetanu2=cos(sig1-&gt;changle-theta_threshold);</div><div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;          costhetanu1=-1.;</div><div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;        } <span class="comment">//else if</span></div><div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sig1-&gt;changle-theta_threshold&lt;0 &amp;&amp; sig1-&gt;changle+theta_threshold&lt; PI) {</div><div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;          costhetanu2=1.;</div><div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;          costhetanu1=cos(sig1-&gt;changle+theta_threshold);</div><div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;        } <span class="comment">//else if</span></div><div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (sig1-&gt;changle-theta_threshold&gt;0 &amp;&amp; sig1-&gt;changle+theta_threshold&lt; PI) {</div><div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;          costhetanu2=cos(sig1-&gt;changle-theta_threshold);</div><div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;          costhetanu1=cos(sig1-&gt;changle+theta_threshold);</div><div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;        } <span class="comment">//else if</span></div><div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;      } <span class="comment">// end if theta_threshold&gt;0</span></div><div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;</div><div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;</div><div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;    } <span class="comment">// if SKIP_CUTS !=0</span></div><div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;</div><div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;    <span class="keywordflow">if</span> (theta_threshold&gt;0) {</div><div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;      <span class="comment">// pick the neutrino direction,  in a coordinate system where the z axis lies along the cerenkov cone.</span></div><div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;      costhetanu=costhetanu1+getRNG(RNG_DIRECTION)-&gt;Rndm()*(costhetanu2-costhetanu1);</div><div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160;</div><div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;      <span class="keywordtype">double</span> phinu=TWOPI*getRNG(RNG_DIRECTION)-&gt;Rndm(); <span class="comment">// pick the phi of the neutrino direction,  in the same coordinate system.</span></div><div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;      <span class="keywordtype">double</span> sinthetanu=sqrt(1-costhetanu*costhetanu);</div><div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;      <span class="comment">// 3-vector of neutrino direction,  at that same coordinate system.</span></div><div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;      nnu = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(sinthetanu*cos(phinu), sinthetanu*sin(phinu), costhetanu);</div><div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;      nnu = nnu.ChangeCoord(refr); <span class="comment">// rotate so it&#39;s in our normal coordinate system.</span></div><div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;      <span class="comment">// now the ray is aligned along the cerenkov cone and</span></div><div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;      <span class="comment">// the neutrino is rotated by that same angle</span></div><div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;</div><div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;      <span class="comment">//dtryingdirection+=4*PI/(2.*theta_threshold*sin(sig1-&gt;changle)*2*PI);</span></div><div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;      interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">dtryingdirection</a>=1/((costhetanu2-costhetanu1)/2.);</div><div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160;      <span class="keywordflow">if</span> (bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a81c68a6d332881cf4759a4bcca7dc48c">WHICHPATH</a>==4) {</div><div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;        <span class="comment">//double angle=(PI/2.-sig1-&gt;changle)-ray1-&gt;rfexit[0].Angle(ray1-&gt;nrf_iceside[4])+1.*RADDEG;</span></div><div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;        <span class="keywordtype">double</span> angle=(PI/2.-sig1-&gt;changle)-ray1-&gt;rfexit[0].Angle(ray1-&gt;nrf_iceside[4]);      <span class="comment">// this will put the viewing angle at the cerenkov angle</span></div><div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;        <span class="keywordtype">double</span> thetaposnu=posnu.Theta();</div><div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        <span class="comment">//double phiposnu=posnu.Phi();</span></div><div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;        costhetanu=cos(PI/2+(thetaposnu-angle));</div><div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;        sinthetanu=sqrt(1-costhetanu*costhetanu);</div><div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;        <span class="comment">//phinu=0.95993;</span></div><div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160;        phinu=-1.339; <span class="comment">// this is the phi where it&#39;s coming *from.*</span></div><div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;        <span class="comment">// we want the neutrino to be headed north</span></div><div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;        nnu = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-1.*sinthetanu*cos(phinu), -1.*sinthetanu*sin(phinu), -1.*costhetanu);<span class="comment">// 3-vector of neutrino direction,  at that same coordinate system.</span></div><div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;      }</div><div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;    } <span class="comment">//end if theta_threshold</span></div><div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (theta_threshold==-1.) {</div><div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;theta_threshold is &quot;</span> &lt;&lt; theta_threshold &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;    }</div><div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (emfrac&lt;=1.E-10 &amp;&amp; deltheta_had &lt;= 1.E-10) {</div><div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Error:  emfrac, hadfrac are (1st place)&quot;</span> &lt;&lt; emfrac &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; hadfrac &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;      <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;    } <span class="comment">//else if</span></div><div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;</div><div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;  <span class="comment">//} // end NO ROUGHNESS</span></div><div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;</div><div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;  <span class="comment">// treat the roughness case</span></div><div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;  <span class="comment">/*else if(settings1-&gt;ROUGHNESS){</span></div><div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160;<span class="comment">    //copy SKIPCUTS and USEDIRECTIONWEIGHTS from earlier in this function</span></div><div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;<span class="comment">    double costhetanu2=1.;</span></div><div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;<span class="comment">    double costhetanu1=-1.;</span></div><div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;<span class="comment">    double costhetanu=costhetanu1+gRandom-&gt;Rndm()*(costhetanu2-costhetanu1);</span></div><div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;<span class="comment">    double phinu=TWOPI*gRandom-&gt;Rndm(); // pick the phi of the neutrino direction,  in the same coordinate system.</span></div><div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;<span class="comment">    double sinthetanu=sqrt(1-costhetanu*costhetanu);</span></div><div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160;<span class="comment">    // 3-vector of neutrino direction,  at that same coordinate system.</span></div><div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;<span class="comment">    nnu = Vector(sinthetanu*cos(phinu), sinthetanu*sin(phinu), costhetanu);</span></div><div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;<span class="comment">    nnu = nnu.ChangeCoord(refr); // rotate so it&#39;s in our normal coordinate system.</span></div><div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;<span class="comment">    // now the ray is aligned along the cerenkov cone and</span></div><div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;<span class="comment">    // the neutrino is rotated by that same angle</span></div><div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;<span class="comment">    //dtryingdirection+=4*PI/(2.*theta_threshold*sin(sig1-&gt;changle)*2*PI);</span></div><div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;<span class="comment">    interaction1-&gt;dtryingdirection=1/((costhetanu2-costhetanu1)/2.);</span></div><div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;<span class="comment">  }</span></div><div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;<span class="comment"></span></div><div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;<span class="comment">  else{ //something bad happened</span></div><div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;<span class="comment">    cout&lt;&lt;&quot;Something bad happened in GetDirection.&quot;&lt;&lt;endl;</span></div><div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;<span class="comment">    return 1;</span></div><div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;<span class="comment">  }*/</span></div><div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;}</div><div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;<span class="comment">//end GetDirection()</span></div><div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;</div><div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;</div><div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;<span class="keywordtype">double</span> ScaleVmMHz(<span class="keywordtype">double</span> vmmhz1m_max, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;posnu1, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;r_bn, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html">Position</a> &amp;rfexit) {</div><div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;</div><div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;  <span class="comment">//ofstream oindree_file;  </span></div><div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160;  <span class="comment">//oindree_file.open(&quot;oindree_file.txt&quot;,std::ios_base::app);</span></div><div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;</div><div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;  <span class="keywordtype">double</span> dtemp1 = r_bn.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(rfexit); </div><div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;</div><div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;  <span class="keywordtype">double</span> dtemp2 = rfexit.<a class="code" href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Distance</a>(posnu1);</div><div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;</div><div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;  <span class="comment">//double dtemp = r_bn.Distance(rfexit) + rfexit.Distance(posnu1);</span></div><div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160;</div><div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;  <span class="keywordtype">double</span> dtemp = dtemp1 + dtemp2;</div><div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160; </div><div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160;  vmmhz1m_max= vmmhz1m_max/dtemp;</div><div class="line"><a name="l05350"></a><span class="lineno"> 5350</span>&#160;</div><div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;  scalefactor_distance=1/dtemp;</div><div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;  </div><div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;Oindree: dtemp1 is &quot; &lt;&lt; dtemp1 &lt;&lt; &quot; dtemp2 is &quot; &lt;&lt; dtemp2 &lt;&lt; &quot; dtemp is &quot; &lt;&lt; dtemp &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;  <span class="comment">//oindree_file &lt;&lt; dtemp1 &lt;&lt; &quot; &quot; &lt;&lt; dtemp2 &lt;&lt; &quot; &quot; &lt;&lt; vmmhz1m_max &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;</div><div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160;  <span class="keywordflow">return</span> vmmhz1m_max;</div><div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;</div><div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160;}</div><div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;<span class="comment">//end ScaleVmMHz()</span></div><div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;</div><div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;</div><div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;<span class="keywordtype">void</span> SetupViewangles(<a class="code" href="../../dc/d20/class_signal.html">Signal</a> *sig1) {</div><div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160;  <span class="keywordtype">double</span> viewangle_max=90.*RADDEG;</div><div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;  <span class="keywordtype">double</span> viewangle_min=30.*RADDEG;</div><div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NVIEWANGLE-2;i++) {</div><div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;    viewangles[i]=viewangle_max-(viewangle_max-viewangle_min)/(<span class="keywordtype">double</span>)(NVIEWANGLE-2)*(<span class="keywordtype">double</span>)i;</div><div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;  }</div><div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160;  viewangles[NVIEWANGLE-2]=acos(1/sig1-&gt;N_DEPTH);</div><div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;  viewangles[NVIEWANGLE-1]=90.*RADDEG;</div><div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;}</div><div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;<span class="comment">//end SetupViewAngles()</span></div><div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;</div><div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;</div><div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;<span class="keywordtype">double</span> GetThisAirColumn(<a class="code" href="../../db/d2b/class_settings.html">Settings</a>* settings1,  <a class="code" href="../../d7/d3b/class_position.html">Position</a> r_in, <a class="code" href="../../d5/db2/class_vector.html">Vector</a> nnu, <a class="code" href="../../d7/d3b/class_position.html">Position</a> posnu,  <span class="keywordtype">double</span> *col1,  <span class="keywordtype">double</span>&amp; cosalpha, <span class="keywordtype">double</span>&amp; mytheta, <span class="keywordtype">double</span>&amp; cosbeta0, <span class="keywordtype">double</span>&amp; mybeta) {</div><div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;  <span class="keywordtype">double</span> myair=0; <span class="comment">// this is the output</span></div><div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;  <span class="comment">// it is the column of air in kg/m^2</span></div><div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;  cosalpha=(r_in * nnu) / r_in.Mag(); <span class="comment">// cosangle that the neutrino enters the earth wrt surface normal at its entrry point</span></div><div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;  mytheta=(double)(acos(cosalpha)*DEGRAD)-90.; <span class="comment">// turn this into an angle</span></div><div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160;</div><div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;  <span class="comment">//------------------added on Dec 8------------------------</span></div><div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;ATMOSPHERE) {</div><div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160;    <span class="keywordtype">int</span> index11=int(mytheta*10.); <span class="comment">// which index this theta corresponds to</span></div><div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;    <span class="keywordtype">int</span> index12=index11+1;</div><div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;    <span class="comment">// find column of air at this theta</span></div><div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;    myair=(col1[index11]+(col1[index12]-col1[index11])*(mytheta*10.-<span class="keywordtype">double</span>(index11)))*10.;<span class="comment">//unit is kg/m^2</span></div><div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;  }</div><div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160;    myair=0.;<span class="comment">//don&#39;t include effect of atmosphere</span></div><div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;</div><div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;  <span class="comment">//cout&lt;&lt;&quot;mytheta=&quot;&lt;&lt;mytheta&lt;&lt;&quot;; myair=&quot;&lt;&lt;myair&lt;&lt;endl;</span></div><div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;  <span class="comment">//------------------added on Dec 8------------------------</span></div><div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160;  cosbeta0= (posnu * nnu) / posnu.Mag(); <span class="comment">// cos angle of neutrino wrt person standing over the interaction point</span></div><div class="line"><a name="l05393"></a><span class="lineno"> 5393</span>&#160;  mybeta=(double)(acos(cosbeta0)*DEGRAD)-90.; <span class="comment">// turn that into a theta</span></div><div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;  <span class="keywordflow">return</span> myair;</div><div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;}</div><div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;<span class="comment">//end GetThisAirColumn()</span></div><div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;</div><div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;</div><div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;<span class="keywordtype">void</span> GetAir(<span class="keywordtype">double</span> *col1) {</div><div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;  <span class="keywordtype">double</span> nothing;</div><div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;  ifstream air1(ICEMC_SRC_DIR+<span class="stringliteral">&quot;/data/atmosphere.dat&quot;</span>); <span class="comment">// length of chord in air vs. theta (deg)</span></div><div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160;  <span class="comment">//where theta is respect to &quot;up&quot;</span></div><div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;  <span class="comment">// binned in 0.1 degrees</span></div><div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii=0;iii&lt;900;iii++) {</div><div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    air1&gt;&gt;nothing&gt;&gt;col1[iii];</div><div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160;  } <span class="comment">// read in chord lengths</span></div><div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;}</div><div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;<span class="comment">//end GetAir()</span></div><div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160;</div><div class="line"><a name="l05410"></a><span class="lineno"> 5410</span>&#160;</div><div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;<span class="keywordtype">int</span> TIR(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;n_surf, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside,  <span class="keywordtype">double</span> N_IN, <span class="keywordtype">double</span> N_OUT) {</div><div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;  <span class="keywordtype">double</span> test=sin(nrf2_iceside.Angle(n_surf))*N_IN/N_OUT;</div><div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;  <span class="keywordflow">if</span>(test&gt;=1)</div><div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;</div><div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;}</div><div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;<span class="comment">//end TIR()</span></div><div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160;</div><div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;</div><div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;<span class="keywordtype">double</span> GetViewAngle(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nrf2_iceside, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;nnu) {</div><div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;  <span class="comment">// get viewing angle of shower</span></div><div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;nnu inside GetViewAngle : &quot; &lt;&lt; nnu &lt;&lt; &quot; nrf2_iceside &quot; &lt;&lt; nrf2_iceside &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160;  <span class="keywordtype">double</span> dtemp = nrf2_iceside*nnu;</div><div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;  <span class="keywordflow">if</span> (dtemp&gt;=1 &amp;&amp; dtemp&lt;1.02)</div><div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;    dtemp=0.999999;</div><div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;  <span class="keywordflow">if</span> (dtemp&lt;=-1 &amp;&amp; dtemp&gt;-1.02)</div><div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;    dtemp=-0.9999999;</div><div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;</div><div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;return &quot; &lt;&lt; acos(dtemp) &lt;&lt; &quot;\n&quot;; </span></div><div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;</div><div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;  <span class="keywordflow">return</span> acos(dtemp);</div><div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;}</div><div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;<span class="comment">//end ())etViewAngle</span></div><div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;</div><div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;</div><div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;TStyle* RootStyle() {</div><div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160;  TStyle *RootStyle = <span class="keyword">new</span> TStyle(<span class="stringliteral">&quot;Root-Style&quot;</span>, <span class="stringliteral">&quot;The Perfect Style for Plots ;-)&quot;</span>);</div><div class="line"><a name="l05441"></a><span class="lineno"> 5441</span>&#160;</div><div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;<span class="preprocessor">#ifdef __CINT__</span></div><div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;  TStyle *GloStyle;</div><div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;  GloStyle = gStyle;                  <span class="comment">// save the global style reference</span></div><div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;  gStyle = RootStyle;</div><div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l05447"></a><span class="lineno"> 5447</span>&#160;  <span class="comment">// otherwise you need to call TROOT::SetStyle(&quot;Root-Style&quot;)</span></div><div class="line"><a name="l05448"></a><span class="lineno"> 5448</span>&#160;</div><div class="line"><a name="l05449"></a><span class="lineno"> 5449</span>&#160;  <span class="comment">// Paper size</span></div><div class="line"><a name="l05450"></a><span class="lineno"> 5450</span>&#160;  RootStyle-&gt;SetPaperSize(TStyle::kUSLetter);</div><div class="line"><a name="l05451"></a><span class="lineno"> 5451</span>&#160;</div><div class="line"><a name="l05452"></a><span class="lineno"> 5452</span>&#160;  <span class="comment">// Canvas</span></div><div class="line"><a name="l05453"></a><span class="lineno"> 5453</span>&#160;  RootStyle-&gt;SetCanvasColor     (0);</div><div class="line"><a name="l05454"></a><span class="lineno"> 5454</span>&#160;  RootStyle-&gt;SetCanvasBorderSize(10);</div><div class="line"><a name="l05455"></a><span class="lineno"> 5455</span>&#160;  RootStyle-&gt;SetCanvasBorderMode(0);</div><div class="line"><a name="l05456"></a><span class="lineno"> 5456</span>&#160;  RootStyle-&gt;SetCanvasDefH      (600);</div><div class="line"><a name="l05457"></a><span class="lineno"> 5457</span>&#160;  RootStyle-&gt;SetCanvasDefW      (600);</div><div class="line"><a name="l05458"></a><span class="lineno"> 5458</span>&#160;  RootStyle-&gt;SetCanvasDefX      (10);</div><div class="line"><a name="l05459"></a><span class="lineno"> 5459</span>&#160;  RootStyle-&gt;SetCanvasDefY      (10);</div><div class="line"><a name="l05460"></a><span class="lineno"> 5460</span>&#160;</div><div class="line"><a name="l05461"></a><span class="lineno"> 5461</span>&#160;  <span class="comment">// Pads</span></div><div class="line"><a name="l05462"></a><span class="lineno"> 5462</span>&#160;  RootStyle-&gt;SetPadColor       (0);</div><div class="line"><a name="l05463"></a><span class="lineno"> 5463</span>&#160;  RootStyle-&gt;SetPadBorderSize  (10);</div><div class="line"><a name="l05464"></a><span class="lineno"> 5464</span>&#160;  RootStyle-&gt;SetPadBorderMode  (0);</div><div class="line"><a name="l05465"></a><span class="lineno"> 5465</span>&#160;  <span class="comment">//  RootStyle-&gt;SetPadBottomMargin(0.13);</span></div><div class="line"><a name="l05466"></a><span class="lineno"> 5466</span>&#160;  RootStyle-&gt;SetPadBottomMargin(0.16);</div><div class="line"><a name="l05467"></a><span class="lineno"> 5467</span>&#160;  RootStyle-&gt;SetPadTopMargin   (0.08);</div><div class="line"><a name="l05468"></a><span class="lineno"> 5468</span>&#160;  RootStyle-&gt;SetPadLeftMargin  (0.18);</div><div class="line"><a name="l05469"></a><span class="lineno"> 5469</span>&#160;  RootStyle-&gt;SetPadRightMargin (0.05);</div><div class="line"><a name="l05470"></a><span class="lineno"> 5470</span>&#160;  RootStyle-&gt;SetPadGridX       (0);</div><div class="line"><a name="l05471"></a><span class="lineno"> 5471</span>&#160;  RootStyle-&gt;SetPadGridY       (0);</div><div class="line"><a name="l05472"></a><span class="lineno"> 5472</span>&#160;  RootStyle-&gt;SetPadTickX       (1);</div><div class="line"><a name="l05473"></a><span class="lineno"> 5473</span>&#160;  RootStyle-&gt;SetPadTickY       (1);</div><div class="line"><a name="l05474"></a><span class="lineno"> 5474</span>&#160;</div><div class="line"><a name="l05475"></a><span class="lineno"> 5475</span>&#160;  <span class="comment">// Frames</span></div><div class="line"><a name="l05476"></a><span class="lineno"> 5476</span>&#160;  RootStyle-&gt;SetFrameFillStyle ( 0);</div><div class="line"><a name="l05477"></a><span class="lineno"> 5477</span>&#160;  RootStyle-&gt;SetFrameFillColor ( 0);</div><div class="line"><a name="l05478"></a><span class="lineno"> 5478</span>&#160;  RootStyle-&gt;SetFrameLineColor ( 1);</div><div class="line"><a name="l05479"></a><span class="lineno"> 5479</span>&#160;  RootStyle-&gt;SetFrameLineStyle ( 0);</div><div class="line"><a name="l05480"></a><span class="lineno"> 5480</span>&#160;  RootStyle-&gt;SetFrameLineWidth ( 2);</div><div class="line"><a name="l05481"></a><span class="lineno"> 5481</span>&#160;  RootStyle-&gt;SetFrameBorderSize(10);</div><div class="line"><a name="l05482"></a><span class="lineno"> 5482</span>&#160;  RootStyle-&gt;SetFrameBorderMode( 0);</div><div class="line"><a name="l05483"></a><span class="lineno"> 5483</span>&#160;</div><div class="line"><a name="l05484"></a><span class="lineno"> 5484</span>&#160;</div><div class="line"><a name="l05485"></a><span class="lineno"> 5485</span>&#160;  <span class="comment">// Histograms</span></div><div class="line"><a name="l05486"></a><span class="lineno"> 5486</span>&#160;  RootStyle-&gt;SetHistFillColor(0);</div><div class="line"><a name="l05487"></a><span class="lineno"> 5487</span>&#160;  RootStyle-&gt;SetHistFillStyle(1);</div><div class="line"><a name="l05488"></a><span class="lineno"> 5488</span>&#160;  RootStyle-&gt;SetHistLineColor(1);</div><div class="line"><a name="l05489"></a><span class="lineno"> 5489</span>&#160;  RootStyle-&gt;SetHistLineStyle(0);</div><div class="line"><a name="l05490"></a><span class="lineno"> 5490</span>&#160;  RootStyle-&gt;SetHistLineWidth(2);</div><div class="line"><a name="l05491"></a><span class="lineno"> 5491</span>&#160;</div><div class="line"><a name="l05492"></a><span class="lineno"> 5492</span>&#160;  <span class="comment">// Functions</span></div><div class="line"><a name="l05493"></a><span class="lineno"> 5493</span>&#160;  RootStyle-&gt;SetFuncColor(1);</div><div class="line"><a name="l05494"></a><span class="lineno"> 5494</span>&#160;  RootStyle-&gt;SetFuncStyle(0);</div><div class="line"><a name="l05495"></a><span class="lineno"> 5495</span>&#160;  RootStyle-&gt;SetFuncWidth(1);</div><div class="line"><a name="l05496"></a><span class="lineno"> 5496</span>&#160;</div><div class="line"><a name="l05497"></a><span class="lineno"> 5497</span>&#160;  <span class="comment">//Legends</span></div><div class="line"><a name="l05498"></a><span class="lineno"> 5498</span>&#160;  RootStyle-&gt;SetStatBorderSize(2);</div><div class="line"><a name="l05499"></a><span class="lineno"> 5499</span>&#160;  RootStyle-&gt;SetStatFont      (42);</div><div class="line"><a name="l05500"></a><span class="lineno"> 5500</span>&#160;  <span class="comment">//  RootStyle-&gt;SetOptStat       (111111);</span></div><div class="line"><a name="l05501"></a><span class="lineno"> 5501</span>&#160;  RootStyle-&gt;SetOptStat       (0);</div><div class="line"><a name="l05502"></a><span class="lineno"> 5502</span>&#160;  RootStyle-&gt;SetStatColor     (0);</div><div class="line"><a name="l05503"></a><span class="lineno"> 5503</span>&#160;  RootStyle-&gt;SetStatX         (0.93);</div><div class="line"><a name="l05504"></a><span class="lineno"> 5504</span>&#160;  RootStyle-&gt;SetStatY         (0.90);</div><div class="line"><a name="l05505"></a><span class="lineno"> 5505</span>&#160;  RootStyle-&gt;SetStatFontSize  (0.07);</div><div class="line"><a name="l05506"></a><span class="lineno"> 5506</span>&#160;  <span class="comment">//  RootStyle-&gt;SetStatW         (0.2);</span></div><div class="line"><a name="l05507"></a><span class="lineno"> 5507</span>&#160;  <span class="comment">//  RootStyle-&gt;SetStatH         (0.15);</span></div><div class="line"><a name="l05508"></a><span class="lineno"> 5508</span>&#160;</div><div class="line"><a name="l05509"></a><span class="lineno"> 5509</span>&#160;  <span class="comment">// Labels,  Ticks,  and Titles</span></div><div class="line"><a name="l05510"></a><span class="lineno"> 5510</span>&#160;  RootStyle-&gt;SetTickLength ( 0.015, <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05511"></a><span class="lineno"> 5511</span>&#160;  RootStyle-&gt;SetTitleSize  ( 0.10, <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05512"></a><span class="lineno"> 5512</span>&#160;  RootStyle-&gt;SetTitleOffset( 1.20, <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05513"></a><span class="lineno"> 5513</span>&#160;  RootStyle-&gt;SetTitleBorderSize(0);</div><div class="line"><a name="l05514"></a><span class="lineno"> 5514</span>&#160;  <span class="comment">//  RootStyle-&gt;SetTitleFontSize((double)3.);</span></div><div class="line"><a name="l05515"></a><span class="lineno"> 5515</span>&#160;  RootStyle-&gt;SetLabelOffset( 0.015, <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05516"></a><span class="lineno"> 5516</span>&#160;  RootStyle-&gt;SetLabelSize  ( 0.050, <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05517"></a><span class="lineno"> 5517</span>&#160;  RootStyle-&gt;SetLabelFont  ( 42   , <span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l05518"></a><span class="lineno"> 5518</span>&#160;  RootStyle-&gt;SetTickLength ( 0.015, <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05519"></a><span class="lineno"> 5519</span>&#160;  RootStyle-&gt;SetTitleSize  ( 0.10, <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05520"></a><span class="lineno"> 5520</span>&#160;  RootStyle-&gt;SetTitleOffset( 0.600, <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05521"></a><span class="lineno"> 5521</span>&#160;  RootStyle-&gt;SetLabelOffset( 0.015, <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05522"></a><span class="lineno"> 5522</span>&#160;  RootStyle-&gt;SetLabelSize  ( 0.050, <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05523"></a><span class="lineno"> 5523</span>&#160;  RootStyle-&gt;SetLabelFont  ( 42   , <span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l05524"></a><span class="lineno"> 5524</span>&#160;  RootStyle-&gt;SetTitleFont  (42, <span class="stringliteral">&quot;XY&quot;</span>);</div><div class="line"><a name="l05525"></a><span class="lineno"> 5525</span>&#160;  RootStyle-&gt;SetTitleColor  (1);</div><div class="line"><a name="l05526"></a><span class="lineno"> 5526</span>&#160;</div><div class="line"><a name="l05527"></a><span class="lineno"> 5527</span>&#160;  <span class="comment">// Options</span></div><div class="line"><a name="l05528"></a><span class="lineno"> 5528</span>&#160;  RootStyle-&gt;SetOptFit     (0);</div><div class="line"><a name="l05529"></a><span class="lineno"> 5529</span>&#160;  RootStyle-&gt;SetMarkerStyle(20);</div><div class="line"><a name="l05530"></a><span class="lineno"> 5530</span>&#160;  RootStyle-&gt;SetMarkerSize(0.4);</div><div class="line"><a name="l05531"></a><span class="lineno"> 5531</span>&#160;</div><div class="line"><a name="l05532"></a><span class="lineno"> 5532</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;&gt;&gt; Style initialized with the Root Style!&quot; &lt;&lt; endl;</span></div><div class="line"><a name="l05533"></a><span class="lineno"> 5533</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;&gt;&gt; &quot; &lt;&lt; modified &lt;&lt; endl &lt;&lt; endl;</span></div><div class="line"><a name="l05534"></a><span class="lineno"> 5534</span>&#160;  <span class="keywordflow">return</span> RootStyle;</div><div class="line"><a name="l05535"></a><span class="lineno"> 5535</span>&#160;}</div><div class="line"><a name="l05536"></a><span class="lineno"> 5536</span>&#160;<span class="comment">//end RootStyle()</span></div><div class="line"><a name="l05537"></a><span class="lineno"> 5537</span>&#160;</div><div class="line"><a name="l05538"></a><span class="lineno"> 5538</span>&#160;</div><div class="line"><a name="l05539"></a><span class="lineno"> 5539</span>&#160;<span class="keywordtype">void</span> GetFresnel(<a class="code" href="../../da/d10/class_roughness.html">Roughness</a> *rough1, <span class="keywordtype">int</span> ROUGHNESS_SETTING, <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;surface_normal, </div><div class="line"><a name="l05540"></a><span class="lineno"> 5540</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;air_rf, </div><div class="line"><a name="l05541"></a><span class="lineno"> 5541</span>&#160;                <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;pol, </div><div class="line"><a name="l05542"></a><span class="lineno"> 5542</span>&#160;                <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> &amp;firn_rf, </div><div class="line"><a name="l05543"></a><span class="lineno"> 5543</span>&#160;                <span class="keywordtype">double</span> efield, </div><div class="line"><a name="l05544"></a><span class="lineno"> 5544</span>&#160;                <span class="keywordtype">double</span> emfrac, <span class="keywordtype">double</span> hadfrac, <span class="keywordtype">double</span> deltheta_em_max, <span class="keywordtype">double</span> deltheta_had_max, </div><div class="line"><a name="l05545"></a><span class="lineno"> 5545</span>&#160;                <span class="keywordtype">double</span> &amp;t_coeff_pokey, <span class="keywordtype">double</span> &amp;t_coeff_slappy,</div><div class="line"><a name="l05546"></a><span class="lineno"> 5546</span>&#160;                <span class="keywordtype">double</span> &amp;fresnel,</div><div class="line"><a name="l05547"></a><span class="lineno"> 5547</span>&#160;                <span class="keywordtype">double</span> &amp;mag) {</div><div class="line"><a name="l05548"></a><span class="lineno"> 5548</span>&#160;</div><div class="line"><a name="l05549"></a><span class="lineno"> 5549</span>&#160;  <span class="comment">// find angle of incidence and angle of transmission</span></div><div class="line"><a name="l05550"></a><span class="lineno"> 5550</span>&#160;  <span class="keywordtype">double</span> incident_angle = surface_normal.Angle(firn_rf);</div><div class="line"><a name="l05551"></a><span class="lineno"> 5551</span>&#160;  <span class="keywordtype">double</span> transmitted_angle = surface_normal.Angle(air_rf);</div><div class="line"><a name="l05552"></a><span class="lineno"> 5552</span>&#160;</div><div class="line"><a name="l05553"></a><span class="lineno"> 5553</span>&#160;  <span class="comment">//  double t_coeff_pokey, t_coeff_slappy;</span></div><div class="line"><a name="l05554"></a><span class="lineno"> 5554</span>&#160;</div><div class="line"><a name="l05555"></a><span class="lineno"> 5555</span>&#160;  <span class="comment">// this is perp the surface normal and transmitted ray,  parallel to surface</span></div><div class="line"><a name="l05556"></a><span class="lineno"> 5556</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> perp = air_rf.Cross(surface_normal).Unit();</div><div class="line"><a name="l05557"></a><span class="lineno"> 5557</span>&#160;  <span class="comment">// this is in the bending plane</span></div><div class="line"><a name="l05558"></a><span class="lineno"> 5558</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> air_parallel = perp.Cross(air_rf).Unit();</div><div class="line"><a name="l05559"></a><span class="lineno"> 5559</span>&#160;  <span class="comment">// this is in the bending plane</span></div><div class="line"><a name="l05560"></a><span class="lineno"> 5560</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> firn_parallel = perp.Cross(firn_rf).Unit();</div><div class="line"><a name="l05561"></a><span class="lineno"> 5561</span>&#160;</div><div class="line"><a name="l05562"></a><span class="lineno"> 5562</span>&#160;  <span class="comment">// component of polarization (in the air) perp to surface normal</span></div><div class="line"><a name="l05563"></a><span class="lineno"> 5563</span>&#160;  <span class="keywordtype">double</span> pol_perp_firn = pol*perp; <span class="comment">// this is the slappy component in the firn</span></div><div class="line"><a name="l05564"></a><span class="lineno"> 5564</span>&#160;  <span class="keywordtype">double</span> pol_parallel_firn = pol*firn_parallel; <span class="comment">// this is the pokey component in the firn</span></div><div class="line"><a name="l05565"></a><span class="lineno"> 5565</span>&#160;  <span class="keywordtype">double</span> pol_perp_air=0, pol_parallel_air=0;</div><div class="line"><a name="l05566"></a><span class="lineno"> 5566</span>&#160;</div><div class="line"><a name="l05567"></a><span class="lineno"> 5567</span>&#160;  <span class="keywordtype">double</span> r_coeff_pokey =  tan(incident_angle - transmitted_angle) / tan(incident_angle + transmitted_angle);</div><div class="line"><a name="l05568"></a><span class="lineno"> 5568</span>&#160;  t_coeff_pokey = sqrt((1. - r_coeff_pokey*r_coeff_pokey));</div><div class="line"><a name="l05569"></a><span class="lineno"> 5569</span>&#160;  pol_parallel_air = t_coeff_pokey * pol_parallel_firn; <span class="comment">// find pokey component in the air</span></div><div class="line"><a name="l05570"></a><span class="lineno"> 5570</span>&#160;</div><div class="line"><a name="l05571"></a><span class="lineno"> 5571</span>&#160;  <span class="keywordtype">double</span> r_coeff_slappy = sin(incident_angle - transmitted_angle) / sin(incident_angle + transmitted_angle);</div><div class="line"><a name="l05572"></a><span class="lineno"> 5572</span>&#160;  t_coeff_slappy = sqrt((1. - r_coeff_slappy*r_coeff_slappy));</div><div class="line"><a name="l05573"></a><span class="lineno"> 5573</span>&#160;  pol_perp_air = t_coeff_slappy * pol_perp_firn; <span class="comment">// find slappy component in the firn</span></div><div class="line"><a name="l05574"></a><span class="lineno"> 5574</span>&#160;</div><div class="line"><a name="l05575"></a><span class="lineno"> 5575</span>&#160;  mag=sqrt( tan(incident_angle) / tan(transmitted_angle) );</div><div class="line"><a name="l05576"></a><span class="lineno"> 5576</span>&#160;</div><div class="line"><a name="l05577"></a><span class="lineno"> 5577</span>&#160;  fresnel = sqrt( pow(efield * pol_perp_air, 2) + pow(efield * pol_parallel_air, 2)) / efield;</div><div class="line"><a name="l05578"></a><span class="lineno"> 5578</span>&#160;</div><div class="line"><a name="l05579"></a><span class="lineno"> 5579</span>&#160;  pol = (pol_perp_air * perp + pol_parallel_air * air_parallel).Unit();</div><div class="line"><a name="l05580"></a><span class="lineno"> 5580</span>&#160;<span class="comment">//cerr&lt;&lt;&quot;(spec): inc &quot;&lt;&lt;incident_angle*180./PI&lt;&lt;&quot; : trans &quot;&lt;&lt;transmitted_angle*180./PI&lt;&lt;&quot; : tpokey &quot;&lt;&lt;t_coeff_pokey&lt;&lt;&quot; : tslappy &quot;&lt;&lt;t_coeff_slappy&lt;&lt; endl;</span></div><div class="line"><a name="l05581"></a><span class="lineno"> 5581</span>&#160;}</div><div class="line"><a name="l05582"></a><span class="lineno"> 5582</span>&#160;<span class="comment">//end GetFresnel()</span></div><div class="line"><a name="l05583"></a><span class="lineno"> 5583</span>&#160;</div><div class="line"><a name="l05584"></a><span class="lineno"> 5584</span>&#160;</div><div class="line"><a name="l05585"></a><span class="lineno"> 5585</span>&#160;<span class="keywordtype">void</span> GetBalloonLocation(<a class="code" href="../../d3/d8e/class_interaction.html">Interaction</a> *interaction1,<a class="code" href="../../d2/d1f/class_ray.html">Ray</a> *ray1,<a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1,<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica) {</div><div class="line"><a name="l05586"></a><span class="lineno"> 5586</span>&#160;  <span class="comment">// brian enter function to calculate balloon position on your map.</span></div><div class="line"><a name="l05587"></a><span class="lineno"> 5587</span>&#160;  <span class="comment">// use interaction1-&gt;posnu // location of neutrino interaction</span></div><div class="line"><a name="l05588"></a><span class="lineno"> 5588</span>&#160;  <span class="comment">// coordinate system:  +z=&quot;up&quot; at the south pole</span></div><div class="line"><a name="l05589"></a><span class="lineno"> 5589</span>&#160;  <span class="comment">// bn1-&gt;r_bn</span></div><div class="line"><a name="l05590"></a><span class="lineno"> 5590</span>&#160;  <span class="comment">// nnu</span></div><div class="line"><a name="l05591"></a><span class="lineno"> 5591</span>&#160;  <span class="comment">// ray1-&gt;nsurf_rfexit</span></div><div class="line"><a name="l05592"></a><span class="lineno"> 5592</span>&#160;    </div><div class="line"><a name="l05593"></a><span class="lineno"> 5593</span>&#160;    </div><div class="line"><a name="l05594"></a><span class="lineno"> 5594</span>&#160;  <span class="comment">// brian enter function to calculate balloon position on your map.</span></div><div class="line"><a name="l05595"></a><span class="lineno"> 5595</span>&#160;  <span class="comment">// use interaction1-&gt;posnu // location of neutrino interaction</span></div><div class="line"><a name="l05596"></a><span class="lineno"> 5596</span>&#160;  <span class="comment">// coordinate system:  +z=&quot;up&quot; at the south pole</span></div><div class="line"><a name="l05597"></a><span class="lineno"> 5597</span>&#160;  <span class="comment">// bn1-&gt;r_bn</span></div><div class="line"><a name="l05598"></a><span class="lineno"> 5598</span>&#160;  <span class="comment">// nnu</span></div><div class="line"><a name="l05599"></a><span class="lineno"> 5599</span>&#160;    </div><div class="line"><a name="l05600"></a><span class="lineno"> 5600</span>&#160;    </div><div class="line"><a name="l05601"></a><span class="lineno"> 5601</span>&#160;  <span class="comment">// balloonvector = balloonvector - nuvector;//change origin to the nuetrino interaction point</span></div><div class="line"><a name="l05602"></a><span class="lineno"> 5602</span>&#160;    </div><div class="line"><a name="l05603"></a><span class="lineno"> 5603</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> nuvector = interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>;</div><div class="line"><a name="l05604"></a><span class="lineno"> 5604</span>&#160;  <span class="comment">// double interactiondepth = nuvector[2];//NOT CORRECT! need depth BELOW the ice. this is height above center of earth.</span></div><div class="line"><a name="l05605"></a><span class="lineno"> 5605</span>&#160;    </div><div class="line"><a name="l05606"></a><span class="lineno"> 5606</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> zcoordvector = ray1-&gt;nsurf_rfexit;</div><div class="line"><a name="l05607"></a><span class="lineno"> 5607</span>&#160;  zcoordvector=zcoordvector.Unit();</div><div class="line"><a name="l05608"></a><span class="lineno"> 5608</span>&#160;    </div><div class="line"><a name="l05609"></a><span class="lineno"> 5609</span>&#160;  <span class="comment">// double thetainc =acos(zcoordvector.Dot(nuvector))*180/PI;</span></div><div class="line"><a name="l05610"></a><span class="lineno"> 5610</span>&#160;  <span class="comment">//nsurf_rfexit is z direction for new coordinate system. Need to make sure the n-vector is in x-z plane.</span></div><div class="line"><a name="l05611"></a><span class="lineno"> 5611</span>&#160;    </div><div class="line"><a name="l05612"></a><span class="lineno"> 5612</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> xcoordvector = nuvector-(zcoordvector.Dot(nuvector))*zcoordvector;<span class="comment">//xcoordvector is such that nnu lies in the x-z plane</span></div><div class="line"><a name="l05613"></a><span class="lineno"> 5613</span>&#160;  xcoordvector = xcoordvector.Unit();</div><div class="line"><a name="l05614"></a><span class="lineno"> 5614</span>&#160;    </div><div class="line"><a name="l05615"></a><span class="lineno"> 5615</span>&#160;  <span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> ycoordvector = zcoordvector.Cross(xcoordvector);<span class="comment">//Need this for ChangeCoord. </span></div><div class="line"><a name="l05616"></a><span class="lineno"> 5616</span>&#160;    </div><div class="line"><a name="l05617"></a><span class="lineno"> 5617</span>&#160;    </div><div class="line"><a name="l05618"></a><span class="lineno"> 5618</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> origin_brian_tmp;</div><div class="line"><a name="l05619"></a><span class="lineno"> 5619</span>&#160;  <span class="keywordflow">if</span> (interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>.Dot(zcoordvector)&gt;0) <span class="comment">// up  going</span></div><div class="line"><a name="l05620"></a><span class="lineno"> 5620</span>&#160;    origin_brian_tmp=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a6c8c85d125777b703ac5ac381606f994">nuexit</a>; <span class="comment">// the origin is the neutrino exit point </span></div><div class="line"><a name="l05621"></a><span class="lineno"> 5621</span>&#160;  <span class="keywordflow">else</span> {     </div><div class="line"><a name="l05622"></a><span class="lineno"> 5622</span>&#160;    <a class="code" href="../../d5/db2/class_vector.html">Vector</a> nnu_flipped=interaction1-&gt;<a class="code" href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">nnu</a>;</div><div class="line"><a name="l05623"></a><span class="lineno"> 5623</span>&#160;    nnu_flipped=nnu_flipped-2.*nnu_flipped.Dot(zcoordvector)*zcoordvector; <span class="comment">// take it&#39;s upgoing reflection from surface</span></div><div class="line"><a name="l05624"></a><span class="lineno"> 5624</span>&#160;      </div><div class="line"><a name="l05625"></a><span class="lineno"> 5625</span>&#160;    <a class="code" href="../../d7/d3b/class_position.html">Position</a> nuexit_flipped;</div><div class="line"><a name="l05626"></a><span class="lineno"> 5626</span>&#160;    <span class="keywordflow">if</span> (Ray::WhereDoesItLeave(interaction1-&gt;posnu,nnu_flipped,antarctica,nuexit_flipped))</div><div class="line"><a name="l05627"></a><span class="lineno"> 5627</span>&#160;      origin_brian_tmp=nuexit_flipped;</div><div class="line"><a name="l05628"></a><span class="lineno"> 5628</span>&#160;  }<span class="comment">// end else</span></div><div class="line"><a name="l05629"></a><span class="lineno"> 5629</span>&#160;</div><div class="line"><a name="l05630"></a><span class="lineno"> 5630</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> r_bn_tmp=bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a69f284427712f451a4c1c3756f168093">r_bn</a>-origin_brian_tmp;</div><div class="line"><a name="l05631"></a><span class="lineno"> 5631</span>&#160;  r_bn_tmp=r_bn_tmp.ChangeCoord(xcoordvector,ycoordvector);<span class="comment">//change coordinates</span></div><div class="line"><a name="l05632"></a><span class="lineno"> 5632</span>&#160;    </div><div class="line"><a name="l05633"></a><span class="lineno"> 5633</span>&#160;  <span class="comment">// double balloondist =r_bn_tmp.Mag();//this is above center of earth, if i understand correctly. Need above the surface of the earth. </span></div><div class="line"><a name="l05634"></a><span class="lineno"> 5634</span>&#160;  <span class="keywordtype">double</span> balloonphi = r_bn_tmp.Phi(); <span class="comment">//phi position of the balloon</span></div><div class="line"><a name="l05635"></a><span class="lineno"> 5635</span>&#160;  <span class="keywordflow">if</span> (balloonphi&gt;PI)</div><div class="line"><a name="l05636"></a><span class="lineno"> 5636</span>&#160;    balloonphi=balloonphi-2*PI;</div><div class="line"><a name="l05637"></a><span class="lineno"> 5637</span>&#160;</div><div class="line"><a name="l05638"></a><span class="lineno"> 5638</span>&#160;  <span class="keywordtype">double</span> balloontheta = r_bn_tmp.Theta();<span class="comment">// costheta position of the baloon</span></div><div class="line"><a name="l05639"></a><span class="lineno"> 5639</span>&#160;  <span class="comment">// get this by dotting ray1-&gt;nsurf_rfexit with nnu?     </span></div><div class="line"><a name="l05640"></a><span class="lineno"> 5640</span>&#160;  <span class="comment">// double thetainc = acos(interaction1-&gt;nnu[2])*180/PI; //nnu is unit vector; cos(thetainc) = z/r</span></div><div class="line"><a name="l05641"></a><span class="lineno"> 5641</span>&#160;  balloontheta = PI-balloontheta;<span class="comment">//walter.cc uses a pos z as down. this corrects for that.</span></div><div class="line"><a name="l05642"></a><span class="lineno"> 5642</span>&#160;    </div><div class="line"><a name="l05643"></a><span class="lineno"> 5643</span>&#160;  <span class="comment">// define a coordinate system with ray1-&gt;nsurf_rfexit defining +z</span></div><div class="line"><a name="l05644"></a><span class="lineno"> 5644</span>&#160;  <span class="comment">// nnu direction defines the x-z plane</span></div><div class="line"><a name="l05645"></a><span class="lineno"> 5645</span>&#160;  <span class="comment">// find balloon position in that coordinate system</span></div><div class="line"><a name="l05646"></a><span class="lineno"> 5646</span>&#160;  <span class="comment">//to get the values from walter.cc we need : E_shower, correlation length, rms height and the em_frac and had_frac. the last</span></div><div class="line"><a name="l05647"></a><span class="lineno"> 5647</span>&#160;  <span class="comment">// two are so we can multiply the number from sky maps by the correct frac and then add the em and hadronic portion together</span></div><div class="line"><a name="l05648"></a><span class="lineno"> 5648</span>&#160;  <span class="comment">// to get the total.</span></div><div class="line"><a name="l05649"></a><span class="lineno"> 5649</span>&#160;}</div><div class="line"><a name="l05650"></a><span class="lineno"> 5650</span>&#160;</div><div class="line"><a name="l05651"></a><span class="lineno"> 5651</span>&#160;</div><div class="line"><a name="l05652"></a><span class="lineno"> 5652</span>&#160;<span class="keywordtype">void</span> interrupt_signal_handler(<span class="keywordtype">int</span> sig){</div><div class="line"><a name="l05653"></a><span class="lineno"> 5653</span>&#160;  signal(sig,  SIG_IGN);</div><div class="line"><a name="l05654"></a><span class="lineno"> 5654</span>&#160;  ABORT_EARLY = <span class="keyword">true</span>;</div><div class="line"><a name="l05655"></a><span class="lineno"> 5655</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l05656"></a><span class="lineno"> 5656</span>&#160;}</div><div class="line"><a name="l05657"></a><span class="lineno"> 5657</span>&#160;<span class="comment">//end interrupt_signal_handler()</span></div><div class="line"><a name="l05658"></a><span class="lineno"> 5658</span>&#160;</div><div class="line"><a name="l05659"></a><span class="lineno"> 5659</span>&#160;</div><div class="line"><a name="l05660"></a><span class="lineno"> 5660</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l05661"></a><span class="lineno"> 5661</span>&#160;<span class="comment">//int GetIceMCAntfromUsefulEventAnt(Anita *anita1,  AnitaGeomTool *AnitaGeom1,  int UsefulEventAnt){</span></div><div class="line"><a name="l05662"></a><span class="lineno"> 5662</span>&#160;<span class="keywordtype">int</span> GetIceMCAntfromUsefulEventAnt(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,  <span class="keywordtype">int</span> UsefulEventAnt){</div><div class="line"><a name="l05663"></a><span class="lineno"> 5663</span>&#160;  <span class="comment">//int layer_temp = IceMCLayerPosition[UsefulEventIndex][0];</span></div><div class="line"><a name="l05664"></a><span class="lineno"> 5664</span>&#160;  <span class="comment">//int position_temp = IceMCLayerPosition[UsefulEventIndex][1];</span></div><div class="line"><a name="l05665"></a><span class="lineno"> 5665</span>&#160;  <span class="comment">//int IceMCIndex = anita1-&gt;GetRx(layer_temp,  position_temp);</span></div><div class="line"><a name="l05666"></a><span class="lineno"> 5666</span>&#160;  <span class="keywordtype">int</span> IceMCAnt = UsefulEventAnt;</div><div class="line"><a name="l05667"></a><span class="lineno"> 5667</span>&#160;  <span class="keywordflow">if</span> ((settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10) &amp;&amp; UsefulEventAnt&lt;16) {</div><div class="line"><a name="l05668"></a><span class="lineno"> 5668</span>&#160;    IceMCAnt = (UsefulEventAnt%2==0)*UsefulEventAnt/2 + (UsefulEventAnt%2==1)*(UsefulEventAnt/2+8);</div><div class="line"><a name="l05669"></a><span class="lineno"> 5669</span>&#160;  }</div><div class="line"><a name="l05670"></a><span class="lineno"> 5670</span>&#160;</div><div class="line"><a name="l05671"></a><span class="lineno"> 5671</span>&#160;  <span class="keywordflow">return</span> IceMCAnt;</div><div class="line"><a name="l05672"></a><span class="lineno"> 5672</span>&#160;}</div><div class="line"><a name="l05673"></a><span class="lineno"> 5673</span>&#160;<span class="comment">//end GetIceMCAntfromUsefulEventAnt()</span></div><div class="line"><a name="l05674"></a><span class="lineno"> 5674</span>&#160;</div><div class="line"><a name="l05675"></a><span class="lineno"> 5675</span>&#160;</div><div class="line"><a name="l05676"></a><span class="lineno"> 5676</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="class_raw_anita_event_html_afeca0dd476450527b870c012bfb4914e"><div class="ttname"><a href="../../d6/d74/class_raw_anita_event.html#afeca0dd476450527b870c012bfb4914e">RawAnitaEvent::eventNumber</a></div><div class="ttdeci">UInt_t eventNumber</div><div class="ttdoc">Event number from software. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d66/_raw_anita_event_8h_source.html#l00033">RawAnitaEvent.h:33</a></div></div>
<div class="ttc" id="class_interaction_html_a5348445748bde8ee1c550a99127be2b3"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a5348445748bde8ee1c550a99127be2b3">Interaction::weight_bestcase</a></div><div class="ttdeci">double weight_bestcase</div><div class="ttdoc">what weight1 would be if whole earth had density of crust - for quick and dirty calculation of best c...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00200">Primaries.h:200</a></div></div>
<div class="ttc" id="class_source_model_html_ac929f195d499f167d11a94bdfd57d9e2"><div class="ttname"><a href="../../de/d30/class_source_model.html#ac929f195d499f167d11a94bdfd57d9e2">SourceModel::getDirectionAndEnergy</a></div><div class="ttdeci">int getDirectionAndEnergy(Vector *nudir, double t, double &amp;nuE, double minE=1e9, double maxE=1e12)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2c/source_8cc_source.html#l00568">source.cc:568</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a870409dc8330ae256725e07c16ce3d1f"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a870409dc8330ae256725e07c16ce3d1f">RawAnitaHeader::lowerL2TrigPattern</a></div><div class="ttdeci">UShort_t lowerL2TrigPattern</div><div class="ttdoc">Bit mask for lower ring l2 cluster triggers. eg. if the bit 1 (the lowest bit) is active it means the...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00170">RawAnitaHeader.h:170</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_aea004b982a2265646970aca691e1d707"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#aea004b982a2265646970aca691e1d707">RawAnitaHeader::surfSlipFlag</a></div><div class="ttdeci">UChar_t surfSlipFlag</div><div class="ttdoc">Sync Slip between SURF 2-9 and SURF 1. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00095">RawAnitaHeader.h:95</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a0bf32be933c245b5caed0a6aea75aa37"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a0bf32be933c245b5caed0a6aea75aa37">TruthAnitaEvent::h_component_k</a></div><div class="ttdeci">Double_t h_component_k[48]</div><div class="ttdoc">Component of the e-field along the rx h-plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00050">TruthAnitaEvent.h:50</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a7e5598f7f6f9f4ef1c86655ef221dffe"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a7e5598f7f6f9f4ef1c86655ef221dffe">TruthAnitaEvent::rfExitPos</a></div><div class="ttdeci">Double_t rfExitPos[5][3]</div><div class="ttdoc">Position where the RF exits the ice- 5 iterations, 3 dimensions each. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00043">TruthAnitaEvent.h:43</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad8003cc057b5e5ca4397943d4041d839"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad8003cc057b5e5ca4397943d4041d839">TruthAnitaEvent::fNoiseAtDigitizer</a></div><div class="ttdeci">Double_t fNoiseAtDigitizer[12 *9][260]</div><div class="ttdoc">Array of noise at digitizer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00082">TruthAnitaEvent.h:82</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a3fdea3bec4f8682964033e048b0dddef"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a3fdea3bec4f8682964033e048b0dddef">RawAnitaHeader::errorFlag</a></div><div class="ttdeci">UChar_t errorFlag</div><div class="ttdoc">Error Flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00094">RawAnitaHeader.h:94</a></div></div>
<div class="ttc" id="class_truth_anita_neutrino_html"><div class="ttname"><a href="../../d8/d3e/class_truth_anita_neutrino.html">TruthAnitaNeutrino</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00103">TruthAnitaEvent.h:103</a></div></div>
<div class="ttc" id="class_balloon_html_a81c68a6d332881cf4759a4bcca7dc48c"><div class="ttname"><a href="../../d2/d24/class_balloon.html#a81c68a6d332881cf4759a4bcca7dc48c">Balloon::WHICHPATH</a></div><div class="ttdeci">int WHICHPATH</div><div class="ttdoc">0=fixed balloon position,1=randomized,2=ANITA-lite GPS data,3=banana plot </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00057">balloon.hh:57</a></div></div>
<div class="ttc" id="class_source_html"><div class="ttname"><a href="../../d8/d74/class_source.html">Source</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4e/source_8hh_source.html#l00111">source.hh:111</a></div></div>
<div class="ttc" id="class_global_trigger_html_ad9a6e5103964af4c4e78f934304def57"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">GlobalTrigger::PassesTrigger</a></div><div class="ttdeci">void PassesTrigger(Settings *settings1, Anita *anita1, int discones_passing, int mode, int *l3trig, int l2trig[Anita::NPOL][Anita::NTRIGGERLAYERS_MAX], int l1trig[Anita::NPOL][Anita::NTRIGGERLAYERS_MAX], int antennaclump, int loctrig[Anita::NPOL][Anita::NLAYERS_MAX][Anita::NPHI_MAX], int loctrig_nadironly[Anita::NPOL][Anita::NPHI_MAX], int inu, int *thispasses, bool noiseOnly=false)</div><div class="ttdoc">Evaluate the full trigger simulation for a given payload configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l00211">GlobalTrigger.cc:211</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_aa54a2e1fbf8a2599e89c4214a52b90a9"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#aa54a2e1fbf8a2599e89c4214a52b90a9">TruthAnitaEvent::weight</a></div><div class="ttdeci">Double_t weight</div><div class="ttdoc">Weight assigned by icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00062">TruthAnitaEvent.h:62</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a3998ba2289088aa557bd9c2f53b6e704"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a3998ba2289088aa557bd9c2f53b6e704">TruthAnitaEvent::nu_pdg</a></div><div class="ttdeci">Int_t nu_pdg</div><div class="ttdoc">Neutrino PDG code. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00044">TruthAnitaEvent.h:44</a></div></div>
<div class="ttc" id="class_balloon_html_a69f284427712f451a4c1c3756f168093"><div class="ttname"><a href="../../d2/d24/class_balloon.html#a69f284427712f451a4c1c3756f168093">Balloon::r_bn</a></div><div class="ttdeci">Position r_bn</div><div class="ttdoc">position of balloon </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00066">balloon.hh:66</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ab85dcf36877be689e719314a3b67fd40"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ab85dcf36877be689e719314a3b67fd40">TruthAnitaEvent::sourceLat</a></div><div class="ttdeci">Double_t sourceLat</div><div class="ttdoc">RF position when leaving the ice: Latitude (using icemc model) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00060">TruthAnitaEvent.h:60</a></div></div>
<div class="ttc" id="class_interaction_html_a0a54dadd449944c93560cbfb42eb433e"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a0a54dadd449944c93560cbfb42eb433e">Interaction::currentint</a></div><div class="ttdeci">int currentint</div><div class="ttdoc">Ditto - Stephen. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00225">Primaries.h:225</a></div></div>
<div class="ttc" id="class_useful_anita_event_html_af702281d452d17cca331c620e06ad317"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html#af702281d452d17cca331c620e06ad317">UsefulAnitaEvent::fVolts</a></div><div class="ttdeci">double fVolts[12 *9][260]</div><div class="ttdoc">Array of unwrapped (unless kNoCalib) voltages for each channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00079">UsefulAnitaEvent.h:79</a></div></div>
<div class="ttc" id="class_adu5_pat_html_af99a5597edfa5c86c4c4afd7841582b9"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#af99a5597edfa5c86c4c4afd7841582b9">Adu5Pat::pitch</a></div><div class="ttdeci">Float_t pitch</div><div class="ttdoc">in degrees </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00046">Adu5Pat.h:46</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_aa9ad1b6f04a28622b497f28a5c351cdf"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#aa9ad1b6f04a28622b497f28a5c351cdf">TruthAnitaEvent::showerE</a></div><div class="ttdeci">Double_t showerE</div><div class="ttdoc">Shower energy. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00041">TruthAnitaEvent.h:41</a></div></div>
<div class="ttc" id="class_interaction_html_a15b1f5258dcfc709bfc401f293e5d12a"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a15b1f5258dcfc709bfc401f293e5d12a">Interaction::r_fromballoon</a></div><div class="ttdeci">double r_fromballoon[2]</div><div class="ttdoc">distance from interaction to balloon for each ray </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00251">Primaries.h:251</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a9512ab42e6813f432d99d2bd3a349926"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a9512ab42e6813f432d99d2bd3a349926">TruthAnitaEvent::timeWeight</a></div><div class="ttdeci">Double_t timeWeight</div><div class="ttdoc">Relative Time weight assigned by icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00066">TruthAnitaEvent.h:66</a></div></div>
<div class="ttc" id="class_interaction_html_a9d37bb0ab6d96f72391206583c91d7a7"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a9d37bb0ab6d96f72391206583c91d7a7">Interaction::chord_kgm2_ice</a></div><div class="ttdeci">double chord_kgm2_ice</div><div class="ttdoc">from ice entrance to interaction point </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00202">Primaries.h:202</a></div></div>
<div class="ttc" id="class_global_trigger_html"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html">GlobalTrigger</a></div><div class="ttdoc">Global Trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/ded/_global_trigger_8h_source.html#l00012">GlobalTrigger.h:12</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a4fcd80f9a174f236b60a6606ac0599b2"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a4fcd80f9a174f236b60a6606ac0599b2">ChanTrigger::InitializeEachBand</a></div><div class="ttdeci">void InitializeEachBand(Anita *anita1)</div><div class="ttdoc">Initialize trigger bands. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l00711">ChanTrigger.cc:711</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a839763b5c6fd348fb0c492ee87088b68"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a839763b5c6fd348fb0c492ee87088b68">RawAnitaHeader::upperL1TrigPattern</a></div><div class="ttdeci">UShort_t upperL1TrigPattern</div><div class="ttdoc">Bit mask for upper ring l1 antenna triggers. eg. if the bit 1 (the lowest bit) is active it means the...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00167">RawAnitaHeader.h:167</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a7a061cc7bf8cc7dac87259586cc4e1f2"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a7a061cc7bf8cc7dac87259586cc4e1f2">RawAnitaHeader::l3TrigPattern</a></div><div class="ttdeci">UShort_t l3TrigPattern</div><div class="ttdoc">Bit mask for l3 global triggers. eg. if the bit 1 (the lowest bit) is active it means that phi sector...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00171">RawAnitaHeader.h:171</a></div></div>
<div class="ttc" id="class_adu5_pat_html"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html">Adu5Pat</a></div><div class="ttdoc">Adu5Pat  The ADU5 Position and Attitude Data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00026">Adu5Pat.h:26</a></div></div>
<div class="ttc" id="class_position_html_a68bbe0fdc40d3d380f633a88735f212e"><div class="ttname"><a href="../../d7/d3b/class_position.html#a68bbe0fdc40d3d380f633a88735f212e">Position::Distance</a></div><div class="ttdeci">double Distance(const Position &amp;second) const </div><div class="ttdoc">Returns chord distance (direct distance between two vectors) </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd0/position_8cc_source.html#l00037">position.cc:37</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a3bbedfa72e4d8b4001fcef036a6ed286"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a3bbedfa72e4d8b4001fcef036a6ed286">ChanTrigger::TriggerPath</a></div><div class="ttdeci">void TriggerPath(Settings *settings1, Anita *anita1, int ant, Balloon *bn1)</div><div class="ttdoc">Apply trigger path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l00871">ChanTrigger.cc:871</a></div></div>
<div class="ttc" id="class_anita_html_a1c7ef28c5f83fa1e858a7d7bb64d666a"><div class="ttname"><a href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a></div><div class="ttdeci">static const int NPOL</div><div class="ttdoc">number of polarizations </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00051">anita.hh:51</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a0a236c05c12a25b9b44f82e96c1e2c3c"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a0a236c05c12a25b9b44f82e96c1e2c3c">TruthAnitaEvent::n_component_k</a></div><div class="ttdeci">Double_t n_component_k[48]</div><div class="ttdoc">Component of the e-field along the normal. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00051">TruthAnitaEvent.h:51</a></div></div>
<div class="ttc" id="class_primaries_html_a743e64abe3aae1f642ed43324a529359"><div class="ttname"><a href="../../de/d7b/class_primaries.html#a743e64abe3aae1f642ed43324a529359">Primaries::GetSigma</a></div><div class="ttdeci">int GetSigma(double pnu, double &amp;sigma, double &amp;len_int_kgm2, Settings *settings1, int nu_nubar, int currentint)</div><div class="ttdoc">Neutrino-nucleon cross-sections using model chosen. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/_primaries_8cc_source.html#l00170">Primaries.cc:170</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_aacac4af652e7684a8a6046106e9e6d34"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#aacac4af652e7684a8a6046106e9e6d34">TruthAnitaEvent::fDiodeOutput</a></div><div class="ttdeci">Double_t fDiodeOutput[12 *9][260]</div><div class="ttdoc">Array of tunnel diode output. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00083">TruthAnitaEvent.h:83</a></div></div>
<div class="ttc" id="class_interaction_html_abb9f55c7153603ca5d2c8151bcd02fa7"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#abb9f55c7153603ca5d2c8151bcd02fa7">Interaction::nnu_banana</a></div><div class="ttdeci">Vector nnu_banana</div><div class="ttdoc">Forced neutrino direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00237">Primaries.h:237</a></div></div>
<div class="ttc" id="class_interaction_html_a1e6c2d93ac3db39b513394477c69aafb"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a1e6c2d93ac3db39b513394477c69aafb">Interaction::nu_banana_surface</a></div><div class="ttdeci">Position nu_banana_surface</div><div class="ttdoc">The location of the surface above the forced neutrino interaction point. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00240">Primaries.h:240</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_ac47047421e5d427609bcc92f8f8833e2"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#ac47047421e5d427609bcc92f8f8833e2">RawAnitaHeader::calibStatus</a></div><div class="ttdeci">UShort_t calibStatus</div><div class="ttdoc">Calib/Relay Status. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00081">RawAnitaHeader.h:81</a></div></div>
<div class="ttc" id="class_adu5_pat_html_a3879b506194eb2cefff3fa13d6b8c766"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#a3879b506194eb2cefff3fa13d6b8c766">Adu5Pat::latitude</a></div><div class="ttdeci">Float_t latitude</div><div class="ttdoc">In degrees. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00042">Adu5Pat.h:42</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a60667e48582a6a076e40226404f9c865"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a60667e48582a6a076e40226404f9c865">ChanTrigger::ApplyAntennaGain</a></div><div class="ttdeci">void ApplyAntennaGain(Settings *settings1, Anita *anita1, Balloon *bn1, Screen *panel1, int ant, Vector &amp;n_eplane, Vector &amp;n_hplane, Vector &amp;n_normal)</div><div class="ttdoc">Apply the antenna gain. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l00743">ChanTrigger.cc:743</a></div></div>
<div class="ttc" id="class_source_model_html"><div class="ttname"><a href="../../de/d30/class_source_model.html">SourceModel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4e/source_8hh_source.html#l00027">source.hh:27</a></div></div>
<div class="ttc" id="class_interaction_html_ae113f12bad5376ce78ce631cfdb36709"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#ae113f12bad5376ce78ce631cfdb36709">Interaction::chord</a></div><div class="ttdeci">double chord</div><div class="ttdoc">chord in m from earth entrance to rock-ice boundary </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00198">Primaries.h:198</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a62548fff9fb234fef763e5cf9a7e73b7"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a62548fff9fb234fef763e5cf9a7e73b7">TruthAnitaEvent::source_index</a></div><div class="ttdeci">Int_t source_index</div><div class="ttdoc">Name of the source. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00074">TruthAnitaEvent.h:74</a></div></div>
<div class="ttc" id="namespacestd_html"><div class="ttname"><a href="../../d8/dcc/namespacestd.html">std</a></div><div class="ttdoc">STL namespace. </div></div>
<div class="ttc" id="class_taumodel_html_a67245de8d0174d96918a11e08a677a17"><div class="ttname"><a href="../../d6/dc1/class_taumodel.html#a67245de8d0174d96918a11e08a677a17">Taumodel::weight_tau_prob</a></div><div class="ttdeci">double weight_tau_prob</div><div class="ttdoc">Weight for tau neutrino to interact, create a tau, tau survives and decays in the ice...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd9/_taumodel_8hh_source.html#l00072">Taumodel.hh:72</a></div></div>
<div class="ttc" id="class_anita_geom_tool_html_af1a3c9c9884f3cb09f520ad2dad96ea3"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html#af1a3c9c9884f3cb09f520ad2dad96ea3">AnitaGeomTool::getChanIndexFromAntPol</a></div><div class="ttdeci">static Int_t getChanIndexFromAntPol(Int_t ant, AnitaPol::AnitaPol_t pol)</div><div class="ttdoc">Convert ant-pol to logical index. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/_anita_geom_tool_8cxx_source.html#l00623">AnitaGeomTool.cxx:623</a></div></div>
<div class="ttc" id="class_interaction_html_a8949fd35ed92144d9f9de770d778a59d"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a8949fd35ed92144d9f9de770d778a59d">Interaction::r_exit2bn</a></div><div class="ttdeci">double r_exit2bn</div><div class="ttdoc">exit to balloon </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00254">Primaries.h:254</a></div></div>
<div class="ttc" id="class_signal_html"><div class="ttname"><a href="../../dc/d20/class_signal.html">Signal</a></div><div class="ttdoc">Radiation from interaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/da9/signal_8hh_source.html#l00013">signal.hh:13</a></div></div>
<div class="ttc" id="class_interaction_html_af5bbe3a02b91cd9460fba6cd1a222e22"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#af5bbe3a02b91cd9460fba6cd1a222e22">Interaction::dnutries</a></div><div class="ttdeci">double dnutries</div><div class="ttdoc">product of dtryingdirection and dtryingposition </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00244">Primaries.h:244</a></div></div>
<div class="ttc" id="class_useful_anita_event_html_a14969bce1dc32ecc09f4d531c811b32b"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html#a14969bce1dc32ecc09f4d531c811b32b">UsefulAnitaEvent::fTimes</a></div><div class="ttdeci">double fTimes[12 *9][260]</div><div class="ttdoc">Array of unwrapped (unless kNoCalib) times for each channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00080">UsefulAnitaEvent.h:80</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad6650c6860ed54bdd6e793ac2f9dfaa3"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad6650c6860ed54bdd6e793ac2f9dfaa3">TruthAnitaEvent::sourceLon</a></div><div class="ttdeci">Double_t sourceLon</div><div class="ttdoc">RF position when leaving the ice: Longitude (using icemc model) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00059">TruthAnitaEvent.h:59</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a973d4cb23f66fe77791e69dacbdbe20f"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a973d4cb23f66fe77791e69dacbdbe20f">TruthAnitaEvent::sourceAlt</a></div><div class="ttdeci">Double_t sourceAlt</div><div class="ttdoc">RF position when leaving the ice: Altitude (using icemc model) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00061">TruthAnitaEvent.h:61</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a0e009613e4c8712b28075a00427b5fc6"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a0e009613e4c8712b28075a00427b5fc6">ChanTrigger::TimeShiftAndSignalFluct</a></div><div class="ttdeci">void TimeShiftAndSignalFluct(Settings *settings1, Anita *anita1, int ilayer, int ifold, double volts_rx_rfcm_lab_e_all[48][512], double volts_rx_rfcm_lab_h_all[48][512])</div><div class="ttdoc">Time shift and fluctuate signal. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l01146">ChanTrigger.cc:1146</a></div></div>
<div class="ttc" id="class_adu5_pat_html_a881469fddb163b232c688b82924232bd"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#a881469fddb163b232c688b82924232bd">Adu5Pat::longitude</a></div><div class="ttdeci">Float_t longitude</div><div class="ttdoc">In degrees. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00043">Adu5Pat.h:43</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a13bf498628c5c5cb7ef684d3a3c318f4"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a13bf498628c5c5cb7ef684d3a3c318f4">TruthAnitaEvent::thresholds</a></div><div class="ttdeci">Double_t thresholds[12 *9]</div><div class="ttdoc">Channel thresholds used in icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00090">TruthAnitaEvent.h:90</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ae18becdaec050172992d06c6184e9400"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ae18becdaec050172992d06c6184e9400">TruthAnitaEvent::sourceTimeWeight</a></div><div class="ttdeci">Double_t sourceTimeWeight</div><div class="ttdoc">Relative Time weight for the given source assigned by icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00067">TruthAnitaEvent.h:67</a></div></div>
<div class="ttc" id="class_adu5_pat_html_a4427ff546161494952d8843b98ba58c1"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#a4427ff546161494952d8843b98ba58c1">Adu5Pat::realTime</a></div><div class="ttdeci">UInt_t realTime</div><div class="ttdoc">Time from the GPS unit. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00037">Adu5Pat.h:37</a></div></div>
<div class="ttc" id="namespace_environment_variable_html_a064f876067320b15e34beb8c29c8ffdc"><div class="ttname"><a href="../../d4/d7f/namespace_environment_variable.html#a064f876067320b15e34beb8c29c8ffdc">EnvironmentVariable::ICEMC_SRC_DIR</a></div><div class="ttdeci">const char * ICEMC_SRC_DIR()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd9/_environment_variable_8cc_source.html#l00056">EnvironmentVariable.cc:56</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a18bf3705078fec42385ee1b991f46e3a"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a18bf3705078fec42385ee1b991f46e3a">TruthAnitaEvent::n_component</a></div><div class="ttdeci">Double_t n_component[48]</div><div class="ttdoc">Normal comp along polarization. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00048">TruthAnitaEvent.h:48</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a4a509e49df3c70d5aeb24125f2e96481"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a4a509e49df3c70d5aeb24125f2e96481">TruthAnitaEvent::balloonPos</a></div><div class="ttdeci">Double_t balloonPos[3]</div><div class="ttdoc">Balloon position. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00036">TruthAnitaEvent.h:36</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a683cf2a794dee50d13dc8099d1659229"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a683cf2a794dee50d13dc8099d1659229">RawAnitaHeader::nadirL2TrigPattern</a></div><div class="ttdeci">UChar_t nadirL2TrigPattern</div><div class="ttdoc">8-bit trigger mask for L2 nadir triggers. Nadir L2 triggers are for the even phi sectors and are just...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00175">RawAnitaHeader.h:175</a></div></div>
<div class="ttc" id="class_interaction_html_a442362e66d0fe0fe0bc6f1d8807aa4e5"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a442362e66d0fe0fe0bc6f1d8807aa4e5">Interaction::dtryingdirection</a></div><div class="ttdeci">double dtryingdirection</div><div class="ttdoc">weighting factor: how many equivalent tries each neutrino counts for after having reduced angular pha...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00243">Primaries.h:243</a></div></div>
<div class="ttc" id="class_constant_exponential_source_flux_html"><div class="ttname"><a href="../../d6/da5/class_constant_exponential_source_flux.html">ConstantExponentialSourceFlux</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4e/source_8hh_source.html#l00132">source.hh:132</a></div></div>
<div class="ttc" id="class_chan_trigger_html_af874b19d040e267a525bc2777f57173b"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#af874b19d040e267a525bc2777f57173b">ChanTrigger::saveTriggerWaveforms</a></div><div class="ttdeci">void saveTriggerWaveforms(Anita *anita1, double sig0[48], double sig1[48], double noise0[48], double noise1[48])</div><div class="ttdoc">Save signal and noise waveforms at trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l01943">ChanTrigger.cc:1943</a></div></div>
<div class="ttc" id="class_interaction_html_a397f6320e7f80f45a9e17b2f6b2dacf6"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a397f6320e7f80f45a9e17b2f6b2dacf6">Interaction::costheta_nutraject</a></div><div class="ttdeci">double costheta_nutraject</div><div class="ttdoc">theta of nnu with earth center to balloon as z axis </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00188">Primaries.h:188</a></div></div>
<div class="ttc" id="class_interaction_html_a3ef3decda6e004ad20f541949a948ae0"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a3ef3decda6e004ad20f541949a948ae0">Interaction::weight_nu</a></div><div class="ttdeci">double weight_nu</div><div class="ttdoc">Weight for neutrino that survives to posnu. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00191">Primaries.h:191</a></div></div>
<div class="ttc" id="class_interaction_html_a4eaba7bc8811556f27f23f8c1356599f"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a4eaba7bc8811556f27f23f8c1356599f">Interaction::banana_sigma</a></div><div class="ttdeci">static constexpr double banana_sigma</div><div class="ttdoc">NSIGMA in the case of a banana plot. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00218">Primaries.h:218</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a4d35ee51b730176799cc49771bc6c5f9"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a4d35ee51b730176799cc49771bc6c5f9">ChanTrigger::noise_eachband</a></div><div class="ttdeci">double noise_eachband[2][Anita::NBANDS_MAX]</div><div class="ttdoc">Noise in each band. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00441">ChanTrigger.h:441</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a741da86656dc04af0e574080dd1fe26b"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a741da86656dc04af0e574080dd1fe26b">TruthAnitaEvent::vmmhz</a></div><div class="ttdeci">Double_t vmmhz[128]</div><div class="ttdoc">V/m/MHz at balloon (128 frequency bins) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00055">TruthAnitaEvent.h:55</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a34c6bc016549c415cbb61390b0f084f0"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a34c6bc016549c415cbb61390b0f084f0">TruthAnitaEvent::l_int</a></div><div class="ttdeci">Double_t l_int</div><div class="ttdoc">Interaction length. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00069">TruthAnitaEvent.h:69</a></div></div>
<div class="ttc" id="class_raw_anita_header_html"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html">RawAnitaHeader</a></div><div class="ttdoc">RawAnitaHeader  The Raw ANITA Event Header. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00022">RawAnitaHeader.h:22</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a5b56fdb4b43abd8493e688491d1387b1"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a5b56fdb4b43abd8493e688491d1387b1">TruthAnitaEvent::SNRAtDigitizer</a></div><div class="ttdeci">Double_t SNRAtDigitizer[12 *9]</div><div class="ttdoc">Array of SNR at digitizer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00087">TruthAnitaEvent.h:87</a></div></div>
<div class="ttc" id="class_position_html_a33b137a138fa73850401f9c95be7b9fa"><div class="ttname"><a href="../../d7/d3b/class_position.html#a33b137a138fa73850401f9c95be7b9fa">Position::Lat</a></div><div class="ttdeci">double Lat() const </div><div class="ttdoc">Returns latitude, where the +z direction is at 0 latitude. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd0/position_8cc_source.html#l00047">position.cc:47</a></div></div>
<div class="ttc" id="class_chan_trigger_html"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html">ChanTrigger</a></div><div class="ttdoc">Class that handles the channel trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00018">ChanTrigger.h:18</a></div></div>
<div class="ttc" id="class_settings_html"><div class="ttname"><a href="../../db/d2b/class_settings.html">Settings</a></div><div class="ttdoc">Reads in and stores input settings for the run. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4a/_settings_8h_source.html#l00037">Settings.h:37</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a30087999411644d07038e56f42f62dc4"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a30087999411644d07038e56f42f62dc4">TruthAnitaEvent::fSignalAtTrigger</a></div><div class="ttdeci">Double_t fSignalAtTrigger[12 *9][260]</div><div class="ttdoc">Array of signal at trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00079">TruthAnitaEvent.h:79</a></div></div>
<div class="ttc" id="class_roughness_html"><div class="ttname"><a href="../../da/d10/class_roughness.html">Roughness</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dfc/roughness_8hh_source.html#l00030">roughness.hh:30</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a56e3571b12bca1472a6b34f2db5e9a3b"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a56e3571b12bca1472a6b34f2db5e9a3b">RawAnitaHeader::run</a></div><div class="ttdeci">Int_t run</div><div class="ttdoc">Run number, assigned on ground. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00045">RawAnitaHeader.h:45</a></div></div>
<div class="ttc" id="class_primaries_html"><div class="ttname"><a href="../../de/d7b/class_primaries.html">Primaries</a></div><div class="ttdoc">Functions you need to generate a primary interaction including cross sections and picking charged cur...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00083">Primaries.h:83</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ab59217bc86a46ad7c512bcf4677ec90c"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ab59217bc86a46ad7c512bcf4677ec90c">TruthAnitaEvent::objName</a></div><div class="ttdeci">TString objName</div><div class="ttdoc">Declination of source. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00073">TruthAnitaEvent.h:73</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a8b818f0f6a987c38b9dd713dfecb9c92"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a8b818f0f6a987c38b9dd713dfecb9c92">TruthAnitaEvent::maxSNRAtTriggerV</a></div><div class="ttdeci">Double_t maxSNRAtTriggerV</div><div class="ttdoc">Max SNR at trigger V-POL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00085">TruthAnitaEvent.h:85</a></div></div>
<div class="ttc" id="class_settings_html_aa0a4259f66f050661e715e9181fdaec1"><div class="ttname"><a href="../../db/d2b/class_settings.html#aa0a4259f66f050661e715e9181fdaec1">Settings::CENTER</a></div><div class="ttdeci">int CENTER</div><div class="ttdoc">whether or not to center one phi sector of the payload on the incoming signal (for making signal effi...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4a/_settings_8h_source.html#l00107">Settings.h:107</a></div></div>
<div class="ttc" id="class_position_html"><div class="ttname"><a href="../../d7/d3b/class_position.html">Position</a></div><div class="ttdoc">This class is a 3-vector that represents a position on the Earth&amp;#39;s surface. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d18/position_8hh_source.html#l00026">position.hh:26</a></div></div>
<div class="ttc" id="class_secondaries_html"><div class="ttname"><a href="../../d6/d1a/class_secondaries.html">Secondaries</a></div><div class="ttdoc">Secondary interactions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/d99/secondaries_8hh_source.html#l00028">secondaries.hh:28</a></div></div>
<div class="ttc" id="class_chan_trigger_html_aa893bb77e40efd72317a10e4ed2a3880"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#aa893bb77e40efd72317a10e4ed2a3880">ChanTrigger::saveDigitizerWaveforms</a></div><div class="ttdeci">void saveDigitizerWaveforms(Anita *anita1, double sig0[48], double sig1[48], double noise0[48], double noise1[48])</div><div class="ttdoc">Save signal and noise waveforms at digitizer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l01953">ChanTrigger.cc:1953</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a3dbd42be814f96e72a54b351e73bb5be"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a3dbd42be814f96e72a54b351e73bb5be">TruthAnitaEvent::tuffIndex</a></div><div class="ttdeci">Short_t tuffIndex</div><div class="ttdoc">TUFF configuration index. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00091">TruthAnitaEvent.h:91</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad25ff64b15ca1367b85912dafa8e1195"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad25ff64b15ca1367b85912dafa8e1195">TruthAnitaEvent::dec</a></div><div class="ttdeci">Double_t dec</div><div class="ttdoc">Right ascension of source. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00072">TruthAnitaEvent.h:72</a></div></div>
<div class="ttc" id="class_interaction_html_ad6bd919d4c158047bd04f0bdeba675b5"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#ad6bd919d4c158047bd04f0bdeba675b5">Interaction::logchord</a></div><div class="ttdeci">double logchord</div><div class="ttdoc">log_10 of chord length earth entrance to where it enters ice </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00199">Primaries.h:199</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad741e5ab6704918be298a67dfcca334b"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad741e5ab6704918be298a67dfcca334b">TruthAnitaEvent::h_component</a></div><div class="ttdeci">Double_t h_component[48]</div><div class="ttdoc">H comp along polarization. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00047">TruthAnitaEvent.h:47</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a4cb34908e504793046832d7caa2a5136"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a4cb34908e504793046832d7caa2a5136">TruthAnitaEvent::realTime</a></div><div class="ttdeci">UInt_t realTime</div><div class="ttdoc">unixTime of readout </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00033">TruthAnitaEvent.h:33</a></div></div>
<div class="ttc" id="class_interaction_html"><div class="ttname"><a href="../../d3/d8e/class_interaction.html">Interaction</a></div><div class="ttdoc">Stores everything about a particular neutrino interaction. Interaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00135">Primaries.h:135</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a8c32df6f314497da84429bb5415ae804"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a8c32df6f314497da84429bb5415ae804">TruthAnitaEvent::rfExitNor</a></div><div class="ttdeci">Double_t rfExitNor[5][3]</div><div class="ttdoc">Normal vector in direction of exit point to balloon - 5 iterations. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00042">TruthAnitaEvent.h:42</a></div></div>
<div class="ttc" id="class_useful_anita_event_html"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html">UsefulAnitaEvent</a></div><div class="ttdoc">UsefulAnitaEvent  The Calibrated Useful Anita Event object. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00031">UsefulAnitaEvent.h:31</a></div></div>
<div class="ttc" id="class_primaries_html_ab2b585fe7f1920bd1370fae3bfce2b46"><div class="ttname"><a href="../../de/d7b/class_primaries.html#ab2b585fe7f1920bd1370fae3bfce2b46">Primaries::pickY</a></div><div class="ttdeci">double pickY(Settings *settings1, double pnu, int nu_nubar, int currentint)</div><div class="ttdoc">pick inelasticity y according to chosen model </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd4/_primaries_8cc_source.html#l00141">Primaries.cc:141</a></div></div>
<div class="ttc" id="class_taumodel_html_a77beee4028eb9de4a73625b780d0021f"><div class="ttname"><a href="../../d6/dc1/class_taumodel.html#a77beee4028eb9de4a73625b780d0021f">Taumodel::GetTauWeight</a></div><div class="ttdeci">double GetTauWeight(Primaries *primary1, Settings *settings1, IceModel *antarctica1, Interaction *interaction1, double pnu, int nu_nubar, double &amp;ptauf, int &amp;crust_entered)</div><div class="ttdoc">GetTauWeight is the function that will calculate the probability that a tau neutrino will interact al...</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d10/_taumodel_8cc_source.html#l00082">Taumodel.cc:82</a></div></div>
<div class="ttc" id="class_position_html_a26be98275e12a418e9726669e03c61f8"><div class="ttname"><a href="../../d7/d3b/class_position.html#a26be98275e12a418e9726669e03c61f8">Position::SurfaceDistance</a></div><div class="ttdeci">double SurfaceDistance(const Position &amp;second, double local_surface) const </div><div class="ttdoc">Returns &quot;surface distance&quot; between two positions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd0/position_8cc_source.html#l00043">position.cc:43</a></div></div>
<div class="ttc" id="class_adu5_pat_html_a299db954c0d3dc3f5d38e155cf5638f3"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#a299db954c0d3dc3f5d38e155cf5638f3">Adu5Pat::altitude</a></div><div class="ttdeci">Float_t altitude</div><div class="ttdoc">In metres. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00044">Adu5Pat.h:44</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_af2df2269147d5b08f68170d470dfb2f8"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#af2df2269147d5b08f68170d470dfb2f8">RawAnitaHeader::phiTrigMask</a></div><div class="ttdeci">UShort_t phiTrigMask</div><div class="ttdoc">16-bit phi mask (from TURF) </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00108">RawAnitaHeader.h:108</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a1dca83a359aa61b27d09ca2ae84016b6"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a1dca83a359aa61b27d09ca2ae84016b6">TruthAnitaEvent::hitangle_h</a></div><div class="ttdeci">Double_t hitangle_h[48]</div><div class="ttdoc">Hit angles rel. to h plane stored for each antenna. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00054">TruthAnitaEvent.h:54</a></div></div>
<div class="ttc" id="struct_source_model_1_1_restriction_html"><div class="ttname"><a href="../../de/d07/struct_source_model_1_1_restriction.html">SourceModel::Restriction</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4e/source_8hh_source.html#l00044">source.hh:44</a></div></div>
<div class="ttc" id="class_interaction_html_a46d7e538970790ac8d4eff1f9024af93"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a46d7e538970790ac8d4eff1f9024af93">Interaction::total_kgm2</a></div><div class="ttdeci">double total_kgm2</div><div class="ttdoc">number of earth layers traversed </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00206">Primaries.h:206</a></div></div>
<div class="ttc" id="class_source_model_html_a407af6645f51393454b6213db67ce097"><div class="ttname"><a href="../../de/d30/class_source_model.html#a407af6645f51393454b6213db67ce097">SourceModel::getSourceModel</a></div><div class="ttdeci">static SourceModel * getSourceModel(const char *key, Restriction r=Restriction())</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2c/source_8cc_source.html#l00099">source.cc:99</a></div></div>
<div class="ttc" id="class_interaction_html_a6e9ad2ed02dd253db92aa8bd344f057e"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a6e9ad2ed02dd253db92aa8bd344f057e">Interaction::altitude_int_mirror</a></div><div class="ttdeci">double altitude_int_mirror</div><div class="ttdoc">depth of the mirror point of interaction. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00249">Primaries.h:249</a></div></div>
<div class="ttc" id="class_spectra_html"><div class="ttname"><a href="../../d7/d9c/class_spectra.html">Spectra</a></div><div class="ttdoc">Neutrino spectra. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d08/_spectra_8h_source.html#l00012">Spectra.h:12</a></div></div>
<div class="ttc" id="class_interaction_html_a0be48e99fca7d0dfc99fdf4e01b386e3"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a0be48e99fca7d0dfc99fdf4e01b386e3">Interaction::r_exit2bn_measured</a></div><div class="ttdeci">double r_exit2bn_measured</div><div class="ttdoc">exit to balloon deduced from measured theta </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00255">Primaries.h:255</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a73dfe58f637f50c52fa55fbd3b876c8e"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a73dfe58f637f50c52fa55fbd3b876c8e">TruthAnitaEvent::fSignalAtDigitizer</a></div><div class="ttdeci">Double_t fSignalAtDigitizer[12 *9][260]</div><div class="ttdoc">Array of signal at digitizer. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00081">TruthAnitaEvent.h:81</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a261ab5103931c402e8855a6f33922eb2"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a261ab5103931c402e8855a6f33922eb2">ChanTrigger::DigitizerPath</a></div><div class="ttdeci">void DigitizerPath(Settings *settings1, Anita *anita1, int ant, Balloon *bn1)</div><div class="ttdoc">Apply digitizer path. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l01005">ChanTrigger.cc:1005</a></div></div>
<div class="ttc" id="class_interaction_html_a534911cc25fe08c47012241327171f45"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a534911cc25fe08c47012241327171f45">Interaction::nuflavorint</a></div><div class="ttdeci">int nuflavorint</div><div class="ttdoc">Added by Stephen for output purposes. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00224">Primaries.h:224</a></div></div>
<div class="ttc" id="class_raw_anita_event_html_a82b9c921a5b03e60eaf80fab14b9adf0"><div class="ttname"><a href="../../d6/d74/class_raw_anita_event.html#a82b9c921a5b03e60eaf80fab14b9adf0">RawAnitaEvent::chanId</a></div><div class="ttdeci">UChar_t chanId[12 *9]</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d66/_raw_anita_event_8h_source.html#l00039">RawAnitaEvent.h:39</a></div></div>
<div class="ttc" id="classto_html"><div class="ttname"><a href="../../d2/ded/classto.html">to</a></div></div>
<div class="ttc" id="class_interaction_html_a8e3ba9835075f10bf3b1aa136a828434"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a8e3ba9835075f10bf3b1aa136a828434">Interaction::r_in</a></div><div class="ttdeci">Position r_in</div><div class="ttdoc">position where neutrino enters the earth </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00194">Primaries.h:194</a></div></div>
<div class="ttc" id="class_interaction_html_a21e2b2f14f8a5990763a1af10aacdf83"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a21e2b2f14f8a5990763a1af10aacdf83">Interaction::phi_nutraject</a></div><div class="ttdeci">double phi_nutraject</div><div class="ttdoc">phi of nnu with earth center to balloon as z axis </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00189">Primaries.h:189</a></div></div>
<div class="ttc" id="class_truth_anita_event_html"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html">TruthAnitaEvent</a></div><div class="ttdoc">TruthAnitaEvent  The Truth ANITA Event. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00026">TruthAnitaEvent.h:26</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a1f489ed5162c79e19f8b1ebd35fccbc0"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a1f489ed5162c79e19f8b1ebd35fccbc0">TruthAnitaEvent::e_component</a></div><div class="ttdeci">Double_t e_component[48]</div><div class="ttdoc">E comp along polarization. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00046">TruthAnitaEvent.h:46</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a03660c07c0e6950c408b6e38cb872f2c"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a03660c07c0e6950c408b6e38cb872f2c">ChanTrigger::threshold_eachband</a></div><div class="ttdeci">double threshold_eachband[2][Anita::NBANDS_MAX]</div><div class="ttdoc">Threshold in each band. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00440">ChanTrigger.h:440</a></div></div>
<div class="ttc" id="class_earth_model_html"><div class="ttname"><a href="../../d1/d3b/class_earth_model.html">EarthModel</a></div><div class="ttdoc">Shape of the earth, ice thicknesses, profiles of earth layers, densities, neutrino absorption...</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d26/earthmodel_8hh_source.html#l00040">earthmodel.hh:40</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ae0c154dd06c7d018e2e173958ecd0235"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ae0c154dd06c7d018e2e173958ecd0235">TruthAnitaEvent::weight1</a></div><div class="ttdeci">Double_t weight1</div><div class="ttdoc">Absorption weight assigned by icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00064">TruthAnitaEvent.h:64</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a828298008e4097957f6d369213a9b7a5"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a828298008e4097957f6d369213a9b7a5">TruthAnitaEvent::weight_prob</a></div><div class="ttdeci">Double_t weight_prob</div><div class="ttdoc">weight including probability of interacting! </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00063">TruthAnitaEvent.h:63</a></div></div>
<div class="ttc" id="class_anita_html_a6bc753f453f91e30ed38f3cc4c30fbc3"><div class="ttname"><a href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a></div><div class="ttdeci">static const int NLAYERS_MAX</div><div class="ttdoc">max number of layers (in smex design, it&amp;#39;s 4) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00059">anita.hh:59</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_af6439566d155c931907f0753968b5f09"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#af6439566d155c931907f0753968b5f09">RawAnitaHeader::lowerL1TrigPattern</a></div><div class="ttdeci">UShort_t lowerL1TrigPattern</div><div class="ttdoc">Bit mask for lower ring l1 antenna triggers. eg. if the bit 1 (the lowest bit) is active it means the...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00168">RawAnitaHeader.h:168</a></div></div>
<div class="ttc" id="class_useful_anita_event_html_ad45b6e5aa9f0e9b7b1b7ab6d2ff4ef1a"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html#ad45b6e5aa9f0e9b7b1b7ab6d2ff4ef1a">UsefulAnitaEvent::fCapacitorNum</a></div><div class="ttdeci">int fCapacitorNum[12 *9][260]</div><div class="ttdoc">Array of capacitor numbers. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00081">UsefulAnitaEvent.h:81</a></div></div>
<div class="ttc" id="class_interaction_html_a0df23bdc40b2d92b95b0d6029f374edc"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a0df23bdc40b2d92b95b0d6029f374edc">Interaction::altitude_int</a></div><div class="ttdeci">double altitude_int</div><div class="ttdoc">depth of interaction </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00248">Primaries.h:248</a></div></div>
<div class="ttc" id="class_source_model_html_a9cd5fa7aa3b86acf76cc8da6e04ed5d6"><div class="ttname"><a href="../../de/d30/class_source_model.html#a9cd5fa7aa3b86acf76cc8da6e04ed5d6">SourceModel::addSource</a></div><div class="ttdeci">void addSource(Source *source)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d4e/source_8hh_source.html#l00065">source.hh:65</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_af363eb871304cc194b1e00172a0dfe71"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#af363eb871304cc194b1e00172a0dfe71">RawAnitaHeader::eventNumber</a></div><div class="ttdeci">UInt_t eventNumber</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00051">RawAnitaHeader.h:51</a></div></div>
<div class="ttc" id="class_interaction_html_abcc316da4319289b2c4517df75c002e4"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#abcc316da4319289b2c4517df75c002e4">Interaction::weight_nu_prob</a></div><div class="ttdeci">double weight_nu_prob</div><div class="ttdoc">Weight for neutrino that survives to posnu and interacts in the ice. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00192">Primaries.h:192</a></div></div>
<div class="ttc" id="class_chan_trigger_html_af23b9d10e37018084f6531f1fe481ba1"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#af23b9d10e37018084f6531f1fe481ba1">ChanTrigger::passes_eachband</a></div><div class="ttdeci">int passes_eachband[2][Anita::NBANDS_MAX]</div><div class="ttdoc">Whether the signal passes or not each band. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00442">ChanTrigger.h:442</a></div></div>
<div class="ttc" id="class_interaction_html_a97f88ca0a1c9e906203aa5ce618221e0"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a97f88ca0a1c9e906203aa5ce618221e0">Interaction::banana_volts</a></div><div class="ttdeci">double banana_volts</div><div class="ttdoc">Total voltage measured at a spot on the sky. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00216">Primaries.h:216</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_adb083b0a3dde75489ec96e442dcdc5d0"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#adb083b0a3dde75489ec96e442dcdc5d0">TruthAnitaEvent::fNoiseAtTrigger</a></div><div class="ttdeci">Double_t fNoiseAtTrigger[12 *9][260]</div><div class="ttdoc">Array of noise at trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00080">TruthAnitaEvent.h:80</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a217f992ab0e6ad1a6e3d4fcfe750cfa5"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a217f992ab0e6ad1a6e3d4fcfe750cfa5">TruthAnitaEvent::nuDir</a></div><div class="ttdeci">Double_t nuDir[3]</div><div class="ttdoc">Neutrino direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00039">TruthAnitaEvent.h:39</a></div></div>
<div class="ttc" id="class_interaction_html_a541b9ad149a82d659546c81c86aa94a2"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a541b9ad149a82d659546c81c86aa94a2">Interaction::chord_kgm2_bestcase</a></div><div class="ttdeci">double chord_kgm2_bestcase</div><div class="ttdoc">the chord the neutrino would traverse if it all was crust density </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00201">Primaries.h:201</a></div></div>
<div class="ttc" id="class_interaction_html_a10499fde024b6ac93dfd9ec3b13dedcd"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a10499fde024b6ac93dfd9ec3b13dedcd">Interaction::banana_y</a></div><div class="ttdeci">static constexpr double banana_y</div><div class="ttdoc">Elasticity. 0.2 is an average number. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00213">Primaries.h:213</a></div></div>
<div class="ttc" id="class_interaction_html_ab558b148fa334b3b1522a68f6273b954"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#ab558b148fa334b3b1522a68f6273b954">Interaction::iceinteraction</a></div><div class="ttdeci">int iceinteraction</div><div class="ttdoc">whether or not there is an interaction in the ice </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00256">Primaries.h:256</a></div></div>
<div class="ttc" id="class_chan_trigger_html_aa07a42ea95e819ba929264fdc57d4eae"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#aa07a42ea95e819ba929264fdc57d4eae">ChanTrigger::bwslice_volts_polh</a></div><div class="ttdeci">double bwslice_volts_polh[5]</div><div class="ttdoc">Sum voltage for each slice in bandwidth for the h polarization. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00426">ChanTrigger.h:426</a></div></div>
<div class="ttc" id="class_taumodel_html"><div class="ttname"><a href="../../d6/dc1/class_taumodel.html">Taumodel</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd9/_taumodel_8hh_source.html#l00029">Taumodel.hh:29</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a41da01a1fec6244e8cf95b7681dcc74b"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a41da01a1fec6244e8cf95b7681dcc74b">ChanTrigger::WhichBandsPass</a></div><div class="ttdeci">void WhichBandsPass(Settings *settings1, Anita *anita1, GlobalTrigger *globaltrig1, Balloon *bn1, int ilayer, int ifold, double dangle, double emfrac, double hadfrac, double thresholds[2][5])</div><div class="ttdoc">Which bands passes the trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l00054">ChanTrigger.cc:54</a></div></div>
<div class="ttc" id="namespace_anita_pol_html_af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a"><div class="ttname"><a href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ab0265e0d23894d3ebafa94a767fad35a">AnitaPol::kVertical</a></div><div class="ttdoc">Vertical Polarisation. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df8/_anita_conventions_8h_source.html#l00198">AnitaConventions.h:198</a></div></div>
<div class="ttc" id="class_settings_html_ab7169a6eefce79566dd07db3b1e5e967"><div class="ttname"><a href="../../db/d2b/class_settings.html#ab7169a6eefce79566dd07db3b1e5e967">Settings::Settings</a></div><div class="ttdeci">Settings()</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d9a/_settings_8cc_source.html#l00043">Settings.cc:43</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad2e5a5b9cb38835922e9d33494a12dd1"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad2e5a5b9cb38835922e9d33494a12dd1">TruthAnitaEvent::e_component_k</a></div><div class="ttdeci">Double_t e_component_k[48]</div><div class="ttdoc">Component of e-field along the rx e-plane. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00049">TruthAnitaEvent.h:49</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ab3cb2b8d3f3883c99069ea35cc63b52a"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ab3cb2b8d3f3883c99069ea35cc63b52a">TruthAnitaEvent::maxSNRAtDigitizerV</a></div><div class="ttdeci">Double_t maxSNRAtDigitizerV</div><div class="ttdoc">Max SNR at digitizer V-POL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00088">TruthAnitaEvent.h:88</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ad8a6a235c9c5096e477f0ff2d808910d"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ad8a6a235c9c5096e477f0ff2d808910d">TruthAnitaEvent::nuMom</a></div><div class="ttdeci">Double_t nuMom</div><div class="ttdoc">Neutrino momentum. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00040">TruthAnitaEvent.h:40</a></div></div>
<div class="ttc" id="class_useful_anita_event_html_ae86589d99938983649c75844d9853de8"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html#ae86589d99938983649c75844d9853de8">UsefulAnitaEvent::fNumPoints</a></div><div class="ttdeci">int fNumPoints[12 *9]</div><div class="ttdoc">Number of poins per channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00078">UsefulAnitaEvent.h:78</a></div></div>
<div class="ttc" id="class_useful_anita_event_html_a62293da10033d624e2fe7b3f9e35ae41"><div class="ttname"><a href="../../d9/d4a/class_useful_anita_event.html#a62293da10033d624e2fe7b3f9e35ae41">UsefulAnitaEvent::fRFSpike</a></div><div class="ttdeci">Int_t fRFSpike</div><div class="ttdoc">Flag raised if the ADC value is too large or small in RF. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/dca/_useful_anita_event_8h_source.html#l00087">UsefulAnitaEvent.h:87</a></div></div>
<div class="ttc" id="class_balloon_html"><div class="ttname"><a href="../../d2/d24/class_balloon.html">Balloon</a></div><div class="ttdoc">Handles everything related to balloon positions, payload orientation over the course of a flight...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00030">balloon.hh:30</a></div></div>
<div class="ttc" id="class_interaction_html_a8d9fcec0d43f38c83f692ed19026fed8"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a8d9fcec0d43f38c83f692ed19026fed8">Interaction::nuexitice</a></div><div class="ttdeci">Position nuexitice</div><div class="ttdoc">place where neutrino would have left the ice </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00197">Primaries.h:197</a></div></div>
<div class="ttc" id="class_interaction_html_a6c8c85d125777b703ac5ac381606f994"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a6c8c85d125777b703ac5ac381606f994">Interaction::nuexit</a></div><div class="ttdeci">Position nuexit</div><div class="ttdoc">place where neutrino would have left the earth </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00196">Primaries.h:196</a></div></div>
<div class="ttc" id="class_vector_html"><div class="ttname"><a href="../../d5/db2/class_vector.html">Vector</a></div><div class="ttdoc">This class represents a three-vector. Operators are overloaded to provide for the familiar operations...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d61/vector_8hh_source.html#l00027">vector.hh:27</a></div></div>
<div class="ttc" id="class_interaction_html_aa2dcd4c8539fa3ef312c54090682eb82"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#aa2dcd4c8539fa3ef312c54090682eb82">Interaction::nu_banana</a></div><div class="ttdeci">Position nu_banana</div><div class="ttdoc">The forced interaction point of the neutrino for the banana plots. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00239">Primaries.h:239</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a8a70ecfc9450638c1aa1af9dd9619b1d"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a8a70ecfc9450638c1aa1af9dd9619b1d">RawAnitaHeader::upperL2TrigPattern</a></div><div class="ttdeci">UShort_t upperL2TrigPattern</div><div class="ttdoc">Bit mask for upper ring l2 cluster triggers. eg. if the bit 1 (the lowest bit) is active it means the...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00169">RawAnitaHeader.h:169</a></div></div>
<div class="ttc" id="class_sky_map_html"><div class="ttname"><a href="../../d6/df2/class_sky_map.html">SkyMap</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dba/_sky_map_8h_source.html#l00021">SkyMap.h:21</a></div></div>
<div class="ttc" id="class_anita_html_af367aa78f54d08086f0f9c283ee3105e"><div class="ttname"><a href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a></div><div class="ttdeci">static const int NPHI_MAX</div><div class="ttdoc">max number of antennas around in phi (in smex, 16) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00061">anita.hh:61</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a1b69fa7b30fb58d2722e8c562bc6c8b3"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a1b69fa7b30fb58d2722e8c562bc6c8b3">ChanTrigger::bwslice_volts_pole</a></div><div class="ttdeci">double bwslice_volts_pole[5]</div><div class="ttdoc">Sum voltage for each slice in bandwidth for the e polarization. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00424">ChanTrigger.h:424</a></div></div>
<div class="ttc" id="namespace_anita_pol_html_af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d"><div class="ttname"><a href="../../d4/df7/namespace_anita_pol.html#af98f5337ced6b7416f396f5ae76a14d7ad43edda04c9c2e92af2204d77cf0278d">AnitaPol::kHorizontal</a></div><div class="ttdoc">Horizontal Polarisation. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/df8/_anita_conventions_8h_source.html#l00197">AnitaConventions.h:197</a></div></div>
<div class="ttc" id="class_taumodel_html_abb4705d1231d64e1b0b83492197d8d91"><div class="ttname"><a href="../../d6/dc1/class_taumodel.html#abb4705d1231d64e1b0b83492197d8d91">Taumodel::ptauf</a></div><div class="ttdeci">double ptauf</div><div class="ttdoc">Final energy of the tau. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/dd9/_taumodel_8hh_source.html#l00071">Taumodel.hh:71</a></div></div>
<div class="ttc" id="class_adu5_pat_html_a8aca444bcebad17c7645ec7d65afb7e4"><div class="ttname"><a href="../../d2/dbf/class_adu5_pat.html#a8aca444bcebad17c7645ec7d65afb7e4">Adu5Pat::heading</a></div><div class="ttdeci">Float_t heading</div><div class="ttdoc">0 is facing north, 180 is facing south </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d8e/_adu5_pat_8h_source.html#l00045">Adu5Pat.h:45</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a0e861e94107b3d9e1fda17e7d506708d"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a0e861e94107b3d9e1fda17e7d506708d">TruthAnitaEvent::maxSNRAtTriggerH</a></div><div class="ttdeci">Double_t maxSNRAtTriggerH</div><div class="ttdoc">Max SNR at trigger H-POL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00086">TruthAnitaEvent.h:86</a></div></div>
<div class="ttc" id="class_counting_html"><div class="ttname"><a href="../../d4/de2/class_counting.html">Counting</a></div><div class="ttdoc">Handles event counting as cuts are made. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/d84/counting_8hh_source.html#l00010">counting.hh:10</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a057c7366e4ef9e485adc55860eedad2b"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a057c7366e4ef9e485adc55860eedad2b">RawAnitaHeader::realTime</a></div><div class="ttdeci">UInt_t realTime</div><div class="ttdoc">unixTime of readout </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00046">RawAnitaHeader.h:46</a></div></div>
<div class="ttc" id="class_r_x_html"><div class="ttname"><a href="../../df/d22/class_r_x.html">RX</a></div><div class="ttdef"><b>Definition:</b> <a href="../../df/d57/rx_8hpp_source.html#l00023">rx.hpp:23</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a42809439d87cd10df266839871d2437b"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a42809439d87cd10df266839871d2437b">RawAnitaHeader::nadirL1TrigPattern</a></div><div class="ttdeci">UChar_t nadirL1TrigPattern</div><div class="ttdoc">8-bit trigger mask for L1 nadir triggers. Here bit 1 is antenna 33 (phi 1), bit 2 is antenna 34 (phi ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00174">RawAnitaHeader.h:174</a></div></div>
<div class="ttc" id="class_interaction_html_ae70c9fff1c297aba4e57ae2c835fa4dc"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#ae70c9fff1c297aba4e57ae2c835fa4dc">Interaction::d2</a></div><div class="ttdeci">double d2</div><div class="ttdoc">ice-rock boundary to interaction point in m </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00204">Primaries.h:204</a></div></div>
<div class="ttc" id="class_anita_geom_tool_html_a1082689d96e9b03316b7625a9de37b44"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html#a1082689d96e9b03316b7625a9de37b44">AnitaGeomTool::Instance</a></div><div class="ttdeci">static AnitaGeomTool * Instance(int anita_version=0)</div><div class="ttdoc">Instance generator. If version_number == 0, uses AnitaVersion::get();. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/_anita_geom_tool_8cxx_source.html#l00431">AnitaGeomTool.cxx:431</a></div></div>
<div class="ttc" id="class_anita_geom_tool_html"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html">AnitaGeomTool</a></div><div class="ttdoc">AnitaGeomTool  The ANITA Geometry Tool. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de8/_anita_geom_tool_8h_source.html#l00048">AnitaGeomTool.h:48</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a3a12546b0d51a79bfda21a5241cf6a35"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a3a12546b0d51a79bfda21a5241cf6a35">TruthAnitaEvent::eventNumber</a></div><div class="ttdeci">UInt_t eventNumber</div><div class="ttdoc">Software event number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00034">TruthAnitaEvent.h:34</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a334b852e6e1f8b281ca3c57884e355e8"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a334b852e6e1f8b281ca3c57884e355e8">ChanTrigger::signal_eachband</a></div><div class="ttdeci">double signal_eachband[2][Anita::NBANDS_MAX]</div><div class="ttdoc">Signal in each band. </div><div class="ttdef"><b>Definition:</b> <a href="../../da/dee/_chan_trigger_8h_source.html#l00439">ChanTrigger.h:439</a></div></div>
<div class="ttc" id="class_interaction_html_aaee92091b12be7342bd83736ea8a2bf4"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#aaee92091b12be7342bd83736ea8a2bf4">Interaction::r_fromballoon_db</a></div><div class="ttdeci">double r_fromballoon_db</div><div class="ttdoc">same, for double bangs </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00253">Primaries.h:253</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_afe9ea8167426bdf6806a7aff3fa677b7"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#afe9ea8167426bdf6806a7aff3fa677b7">TruthAnitaEvent::nuPos</a></div><div class="ttdeci">Double_t nuPos[3]</div><div class="ttdoc">Neutrino position. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00038">TruthAnitaEvent.h:38</a></div></div>
<div class="ttc" id="class_ray_html"><div class="ttname"><a href="../../d2/d1f/class_ray.html">Ray</a></div><div class="ttdoc">Ray tracing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/da4/ray_8hh_source.html#l00020">ray.hh:20</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a393c669277342a5b141d7d95b9701585"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a393c669277342a5b141d7d95b9701585">TruthAnitaEvent::fTimes</a></div><div class="ttdeci">Double_t fTimes[12 *9][260]</div><div class="ttdoc">Array of unwrapped (unless kNoCalib) times for each channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00078">TruthAnitaEvent.h:78</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ac84b5c53e71e67af1dcd64809d929f4d"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ac84b5c53e71e67af1dcd64809d929f4d">TruthAnitaEvent::hitangle_e</a></div><div class="ttdeci">Double_t hitangle_e[48]</div><div class="ttdoc">Hit angles rel. to e plane stored for each antenna. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00053">TruthAnitaEvent.h:53</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a54781617ba9086e115ea859a4fbd86ff"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a54781617ba9086e115ea859a4fbd86ff">TruthAnitaEvent::run</a></div><div class="ttdeci">Int_t run</div><div class="ttdoc">Run number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00032">TruthAnitaEvent.h:32</a></div></div>
<div class="ttc" id="class_interaction_html_a8d6ead334dc4c35bfd23a25237e212af"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a8d6ead334dc4c35bfd23a25237e212af">Interaction::r_enterice</a></div><div class="ttdeci">Position r_enterice</div><div class="ttdoc">position where neutrino enters the ice </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00195">Primaries.h:195</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a1d912f2b59fa4116566506eccc51607c"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a1d912f2b59fa4116566506eccc51607c">TruthAnitaEvent::SNRAtTrigger</a></div><div class="ttdeci">Double_t SNRAtTrigger[12 *9]</div><div class="ttdoc">Array of SNR at trigger. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00084">TruthAnitaEvent.h:84</a></div></div>
<div class="ttc" id="class_position_html_a736146228c802ee9b3f0953349c4410a"><div class="ttname"><a href="../../d7/d3b/class_position.html#a736146228c802ee9b3f0953349c4410a">Position::Lon</a></div><div class="ttdeci">double Lon() const </div><div class="ttdoc">Returns longitude. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/dd0/position_8cc_source.html#l00051">position.cc:51</a></div></div>
<div class="ttc" id="class_interaction_html_a3fe851ac8a75b2ab8485e9c15d465a09"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a3fe851ac8a75b2ab8485e9c15d465a09">Interaction::d1</a></div><div class="ttdeci">double d1</div><div class="ttdoc">same as chord in m (earth entrance to rock-ice boundary) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00203">Primaries.h:203</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_adc79242f0c81308db3e97095b387f85f"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#adc79242f0c81308db3e97095b387f85f">TruthAnitaEvent::maxSNRAtDigitizerH</a></div><div class="ttdeci">Double_t maxSNRAtDigitizerH</div><div class="ttdoc">Max SNR at digitizer H-POL. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00089">TruthAnitaEvent.h:89</a></div></div>
<div class="ttc" id="class_interaction_html_a4d6cb6fc1548e0abada65e2f031eff4a"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a4d6cb6fc1548e0abada65e2f031eff4a">Interaction::banana_signal_fluct</a></div><div class="ttdeci">static constexpr double banana_signal_fluct</div><div class="ttdoc">Turn off noise for banana plots (settings1-&gt;SIGNAL_FLUCT) (shouldn&amp;#39;t matter) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00217">Primaries.h:217</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_a055774db95517a74290a7735576beeef"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#a055774db95517a74290a7735576beeef">RawAnitaHeader::trigType</a></div><div class="ttdeci">UChar_t trigType</div><div class="ttdoc">Bit 0 is RF, 1 is ADU5, 2 is G12, 3 is software/external. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00148">RawAnitaHeader.h:148</a></div></div>
<div class="ttc" id="class_source_model_html_a54fab06569b09be7003bdff436994db3"><div class="ttname"><a href="../../de/d30/class_source_model.html#a54fab06569b09be7003bdff436994db3">SourceModel::setUpWeights</a></div><div class="ttdeci">void setUpWeights(double t0, double t1, double minE=1e9, double maxE=1e12, int N=1e6)</div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d2c/source_8cc_source.html#l00684">source.cc:684</a></div></div>
<div class="ttc" id="class_raw_anita_header_html_aff1b80a19465ac1784e336e0023573f6"><div class="ttname"><a href="../../d0/dc4/class_raw_anita_header.html#aff1b80a19465ac1784e336e0023573f6">RawAnitaHeader::triggerTime</a></div><div class="ttdeci">UInt_t triggerTime</div><div class="ttdoc">Trigger time from TURF converted to unixTime. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d0f/_raw_anita_header_8h_source.html#l00176">RawAnitaHeader.h:176</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_ac8ccc120179f7aa550ee7f3c420ee24e"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#ac8ccc120179f7aa550ee7f3c420ee24e">TruthAnitaEvent::phaseWeight</a></div><div class="ttdeci">Double_t phaseWeight</div><div class="ttdoc">Phase weight assigned by icemc. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00065">TruthAnitaEvent.h:65</a></div></div>
<div class="ttc" id="class_truth_anita_event_html_a26f272fa6d96cf9f2bca78b9d0662b63"><div class="ttname"><a href="../../d7/dd8/class_truth_anita_event.html#a26f272fa6d96cf9f2bca78b9d0662b63">TruthAnitaEvent::balloonDir</a></div><div class="ttdeci">Double_t balloonDir[3]</div><div class="ttdoc">Balloon direction. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc7/_truth_anita_event_8h_source.html#l00037">TruthAnitaEvent.h:37</a></div></div>
<div class="ttc" id="class_ice_model_html"><div class="ttname"><a href="../../de/d63/class_ice_model.html">IceModel</a></div><div class="ttdoc">Ice thicknesses and water depth. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dee/icemodel_8hh_source.html#l00103">icemodel.hh:103</a></div></div>
<div class="ttc" id="class_interaction_html_a2f87c301b70f44c40b2fa43951ad55d5"><div class="ttname"><a href="../../d3/d8e/class_interaction.html#a2f87c301b70f44c40b2fa43951ad55d5">Interaction::nnu</a></div><div class="ttdeci">Vector nnu</div><div class="ttdoc">direction of neutrino (+z in south pole direction) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/dea/_primaries_8h_source.html#l00187">Primaries.h:187</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 5 2021 19:55:41 for ANITA Software by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
