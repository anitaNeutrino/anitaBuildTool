<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>ANITA Software: components/icemc/anita.cc Source File</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
	<table cellspacing="0" cellpadding="0">
	  <tbody>	    
	    <tr style="height: 56px;">
	      <td id="projectlogo"><img width="960" alt="Logo" src="../../anitaSoftware.png"/></td>
	    </tr>
	  </tbody>
	</table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Introduction</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="../../dir_de1961011fa38df2c6d5e9e49bef1e29.html">icemc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">anita.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &quot;vector.hh&quot;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;position.hh&quot;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;Constants.h&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;earthmodel.hh&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;icemodel.hh&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;TF1.h&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;rx.hpp&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;anita.hh&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;ChanTrigger.h&quot;</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;balloon.hh&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;Tools.h&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;TTree.h&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;TH1F.h&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;TH1.h&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;TF1.h&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;TFile.h&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;TStyle.h&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;TLegend.h&quot;</span></div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;TMath.h&quot;</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;EnvironmentVariable.h&quot;</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;FFTtools.h&quot;</span></div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;AnitaEventCalibrator.h&quot;</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;AnitaGeomTool.h&quot;</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;AnitaConventions.h&quot;</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;icemc_random.h&quot;</span> </div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">const</span> std::string ICEMC_SRC_DIR=<a class="code" href="../../d4/d7f/namespace_environment_variable.html#a064f876067320b15e34beb8c29c8ffdc">EnvironmentVariable::ICEMC_SRC_DIR</a>();</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">const</span> std::string ICEMC_DATA_DIR=ICEMC_SRC_DIR+<span class="stringliteral">&quot;/data/&quot;</span>;</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">using</span> std::cout;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">using</span> std::cin;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">using</span> std::endl;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keyword">using</span> std::vector;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;Anita::Anita() {</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  stemp = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> irx=0;irx&lt;<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>*<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>;irx++) {</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;    arrival_times[0][irx]=arrival_times[1][irx]=0.;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  NCH_PASS=4;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  rx_minarrivaltime=0.;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  Tools::Zero(VNOISE_ANITALITE,16);</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  INCLINE_TOPTHREE = 10.; <span class="comment">// cant angle of top three layers of antennas</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  INCLINE_NADIR = 10.; <span class="comment">// cant angle of nadir (bottom) layer of antennas</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  SIGMA_THETA=0.5*RADDEG; <span class="comment">// resolution on the polar angle of the signal</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    </div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;  FREQ_LOW=0.;<span class="comment">//200.E6;</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  FREQ_HIGH=1300.E6; <span class="comment">//1200.E6;</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    </div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;  antennatosurf[0]=2;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;  antennatosurf[1]=4;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  antennatosurf[2]=6;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  antennatosurf[3]=8;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  antennatosurf[4]=2;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  antennatosurf[5]=4;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  antennatosurf[6]=6;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  antennatosurf[7]=8;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">// layer 1</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  antennatosurf[8]=1;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  antennatosurf[9]=3;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  antennatosurf[10]=5;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  antennatosurf[11]=7;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  antennatosurf[12]=1;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  antennatosurf[13]=3;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  antennatosurf[14]=5;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  antennatosurf[15]=7;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="comment">// layer 2</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  antennatosurf[16]=1;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  antennatosurf[17]=2;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  antennatosurf[18]=3;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  antennatosurf[19]=4;</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  antennatosurf[20]=5;</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  antennatosurf[21]=6;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  antennatosurf[22]=7;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  antennatosurf[23]=8;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  antennatosurf[24]=1;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  antennatosurf[25]=2;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  antennatosurf[26]=3;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  antennatosurf[27]=4;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  antennatosurf[28]=5;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  antennatosurf[29]=6;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;  antennatosurf[30]=7;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;  antennatosurf[31]=8; <span class="comment">// layer 3</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  maxthreshold=0.;</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  Tools::Zero(bwslice_thresholds,5); <span class="comment">// thresholds for each band -- this is just an initialization- this is set in the input file</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    bwslice_allowed[i]=1; <span class="comment">// these bands are allowed to contribute to the trigger sum -- this is set in the input file</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  }</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;  bwslice_required[0]=0;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  bwslice_required[1]=0;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;  bwslice_required[2]=0;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  bwslice_required[3]=0;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;  bwslice_required[4]=1; <span class="comment">// these bands are required to be among the channels that pass -- this is set in the input file</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;  pol_allowed[0]=1;<span class="comment">// which polarisations are allowed to have channels that fire (V,H)</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;  pol_allowed[1]=1;<span class="comment">// which polarisations are allowed to have channels that fire (V,H)</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;  pol_required[0]=1;<span class="comment">// which polarisations are required to have channels that fire (V,H)</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  pol_required[1]=0;<span class="comment">// which polarisations are required to have channels that fire (V,H)</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    </div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    </div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;  bwslice_center[0]=265.e6;</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  bwslice_center[1]=435.e6;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  bwslice_center[2]=650.e6;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  bwslice_center[3]=980.e6;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  bwslice_center[4]=682.5E6; <span class="comment">// center frequencies</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    </div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  bwslice_width[0]=130.e6;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;  bwslice_width[1]=160.e6;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  bwslice_width[2]=250.e6;</div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  bwslice_width[3]=370.e6;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  bwslice_width[4]=965.E6; <span class="comment">// 3 dB bandwidths, without overlap</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    </div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;4;i++) {</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    bwslice_min[i]=bwslice_center[i]-bwslice_width[i]/2.;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    bwslice_max[i]=bwslice_center[i]+bwslice_width[i]/2.;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 5; i++) </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  {</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    iminbin[i] = 0; </div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    imaxbin[i] = NFOUR/2; </div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    </div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  bwslice_min[4]= bwslice_center[0]-bwslice_width[0]/2.; <span class="comment">//minimum of each bandwidth slice</span></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  bwslice_max[4]=bwslice_center[3]+bwslice_width[3]/2.; <span class="comment">//minimum of each bandwidth slice</span></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    </div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  bwmin=0.; <span class="comment">// minimum width of any allowed bandwidth slice</span></div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// If outputs dir doesn&#39;t already exist, create it</span></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">char</span>* outputdir;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  outputdir = <span class="stringliteral">&quot;outputs&quot;</span>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keyword">struct </span>stat sb;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  </div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">if</span> (stat(outputdir, &amp;sb) == 0 &amp;&amp; S_ISDIR(sb.st_mode))</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    {</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      <span class="comment">// dir already exists don&#39;t overwrite</span></div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    }</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    {</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;      mkdir(outputdir,S_IRWXU);</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    }</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  </div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  </div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;Anita::~Anita(){</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  coherent_datafile-&gt;cd();</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    </div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;  coherent_waveform_sum_tree-&gt;Write();</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;  coherent_datafile-&gt;Write();</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    </div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  coherent_waveform_sum_tree-&gt;Delete();</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  coherent_datafile-&gt;Close();</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  coherent_datafile-&gt;Delete();</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    </div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    </div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="keywordtype">int</span> Anita::Match(<span class="keywordtype">int</span> ilayer,<span class="keywordtype">int</span> ifold,<span class="keywordtype">int</span> rx_minarrivaltime) {</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    </div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keywordflow">if</span> (ilayer==GetLayer(rx_minarrivaltime) &amp;&amp; ifold==GetIfold(rx_minarrivaltime))</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    </div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;}</div><div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="../../df/da2/class_anita.html#a8a17f63c21511dc1f3fb4bf84ce00813">  197</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/da2/class_anita.html#a8a17f63c21511dc1f3fb4bf84ce00813">Anita::GetRx</a>(<span class="keywordtype">int</span> ilayer, <span class="keywordtype">int</span> ifold) { <span class="comment">// get antenna number based on which layer and position it is</span></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    </div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <span class="keywordtype">int</span> irx=0;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ilayer;i++) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    irx+=NRX_PHI[i];</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  }</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  irx+=ifold;</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">return</span> irx;</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    </div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;}</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div><div class="line"><a name="l00208"></a><span class="lineno"><a class="line" href="../../df/da2/class_anita.html#a2d70e8618f531c7f4e94f147b275a886">  208</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../df/da2/class_anita.html#a2d70e8618f531c7f4e94f147b275a886">Anita::GetRxTriggerNumbering</a>(<span class="keywordtype">int</span> ilayer, <span class="keywordtype">int</span> ifold) { <span class="comment">// get antenna number based on which layer and position it is</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  <span class="comment">// make the top trigger layer count 1-16 left to right</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="keywordflow">if</span> (ilayer==0)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;ilayer, ifold, getrx are &quot; &lt;&lt; ilayer &lt;&lt; &quot;\t&quot; &lt;&lt; ifold &lt;&lt; &quot;\t&quot; &lt;&lt; 2*ifold+ilayer &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">return</span> 2*ifold;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ilayer==1) {</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">return</span> 2*ifold+1;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  }</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;ilayer, ifold, getrx are &quot; &lt;&lt; ilayer &lt;&lt; &quot;\t&quot; &lt;&lt; ifold &lt;&lt; &quot;\t&quot; &lt;&lt; GetRx(ilayer,ifold) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keywordflow">return</span> GetRx(ilayer,ifold);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  }</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;}</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordtype">void</span> Anita::SetNoise(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,<a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1,<a class="code" href="../../de/d63/class_ice_model.html">IceModel</a> *antarctica) {</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    </div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="comment">// these should only be used for the frequency domain trigger.</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==2 || settings1-&gt;WHICH==6) { <span class="comment">//this is for anita 1</span></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> il=0;il&lt;NLAYERS_MAX;il++) {</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      bwslice_vnoise[il][0]=5.5125E-6;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;      bwslice_vnoise[il][1]=6.1157E-6;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;      bwslice_vnoise[il][2]=7.64446E-6;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;      bwslice_vnoise[il][3]=9.29989E-6;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;      bwslice_vnoise[il][4]=0.;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;4;i++) {</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    bwslice_vnoise[il][4]+=bwslice_vnoise[il][i]*bwslice_vnoise[il][i];</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;      }</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      bwslice_vnoise[il][4]=sqrt(bwslice_vnoise[il][4]);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    }</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// if not anita 1</span></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> il=0;il&lt;NLAYERS_MAX;il++) {</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibw=0;ibw&lt;5;ibw++) {</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    bwslice_vnoise[il][ibw]=<a class="code" href="../../dd/d24/class_chan_trigger.html#a7ee27fceaba30ae0beabce566468dfb0">ChanTrigger::GetNoise</a>(settings1,bn1-&gt;altitude_bn,antarctica-&gt;SurfaceAboveGeoid(bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a6bf058d1320831ad733db4c5f9ce3cbe">phi_bn</a>,bn1-&gt;theta_bn),THETA_ZENITH[il],bwslice_max[ibw]-bwslice_min[ibw],0.);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;      }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  }</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    </div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    </div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="../../df/da2/class_anita.html#aa4c8e6d42e2b0cacc85db69dbc547adc">  249</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../df/da2/class_anita.html#aa4c8e6d42e2b0cacc85db69dbc547adc">Anita::Initialize</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,ofstream &amp;foutput,<span class="keywordtype">int</span> thisInu, TString outputdir)</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;{</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    </div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    </div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  tuffIndex=0; <span class="comment">// keith edits</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  count_getnoisewaveforms=0;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  rms_lab[0]=rms_lab[1]=0.;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  rms_rfcm[0]=rms_rfcm[1]=0.;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    </div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  NBANDS=4; <span class="comment">// subbands (not counting full band)</span></div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  inu=thisInu;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    </div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  PERCENTBW=10; <span class="comment">// subbands (not counting full band)</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  TIMESTEP=(1./2.6)*1.E-9; <span class="comment">// time step between samples</span></div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  USEPHASES=0;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  ntuffs=1;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==10) ntuffs=7;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  </div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;HALFNFOUR;i++)   fTimes[i] = i * TIMESTEP * 1.0E9; </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ;i++) {</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    freq[i]=FREQ_LOW+(FREQ_HIGH-FREQ_LOW)*(<span class="keywordtype">double</span>)i/(double)NFREQ; <span class="comment">// freq. of each bin.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    avgfreq_rfcm[i]=0.;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    avgfreq_rfcm_lab[i]=0.;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;  } <span class="comment">//for</span></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;  initializeFixedPowerThresholds(foutput);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  additionalDt=0;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==10){</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">// powerthreshold[4] /= TMath::Sqrt(2.);</span></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    powerthreshold[4] = -3.1;</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    additionalDt=30.e-9;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  }</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME==5)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    l1window=3.75E-9;</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    l1window=11.19E-9; <span class="comment">// l1 coincidence window</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    </div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;  minsignalstrength=0.1;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    </div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;  impedence=50.;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;  phase=90.; <span class="comment">// phase for positive frequencies</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;  <span class="comment">// assuming v(t) is real, then phase(neg)=-phase(pos)</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;  INTEGRATIONTIME=3.5E-9; <span class="comment">// integration time of trigger diode</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  DEADTIME=10.E-9; <span class="comment">// dead time after a trigger</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  energythreshold=3.;  <span class="comment">// power threshold</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;    </div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="comment">// for ANITA 3 trigger</span></div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  TRIG_TIMESTEP=3.75E-9;</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;  N_STEPS_PHI = 100;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  N_STEPS_THETA = 100;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  MIN_PHI_HYPOTHESIS=-22.5;</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  MAX_PHI_HYPOTHESIS=22.5;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  MIN_THETA_HYPOTHESIS=-50.;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  MAX_THETA_HYPOTHESIS=20.;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;  <span class="comment">//MIN_THETA_HYPOTHESIS=-55.;</span></div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;  <span class="comment">//MAX_THETA_HYPOTHESIS=20.;</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;  <span class="keywordtype">double</span> freqstep=1./(double)(NFOUR/2)/TIMESTEP;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;  <span class="comment">// double freqstep_long=1./(double)(NFOUR)/TIMESTEP; // freqstep_long is actually shorter so that time domain waveform is longer</span></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    </div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;HALFNFOUR;i++) {</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    freq_forfft[2*i]=(double)i*freqstep;</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    freq_forfft[2*i+1]=(double)i*freqstep;</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      </div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <span class="keywordflow">if</span> (i&lt;HALFNFOUR/2) freq_forplotting[i]=freq_forfft[2*i];</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        </div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;  }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;  readVariableThresholds(settings1);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;  phiTrigMask=0;</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  phiTrigMaskH=0;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  l1TrigMask=0;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  l1TrigMaskH=0;</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  readAmplification();    </div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    </div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">// get lab attenuation data</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  getLabAttn(NPOINTS_LAB,freqlab,labattn);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    </div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  getDiodeDataAndAttenuation(settings1, outputdir);</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;PULSER==1) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    getPulserData();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  } </div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    </div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="comment">// for antenna gains</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  reference_angle[0]=0.;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  reference_angle[1]=5.;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  reference_angle[2]=10.;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  reference_angle[3]=20.;</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  reference_angle[4]=30.;</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  reference_angle[5]=45.;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  reference_angle[6]=90.; <span class="comment">// reference angles for finding gains of antennas</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  </div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;  THERMALNOISE_FACTOR=settings1-&gt;THERMALNOISE_FACTOR;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;settings1-&gt;NLAYERS;j++) {</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;    <span class="comment">// noise depends on cant angle of antenna</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <span class="comment">//     //   VNOISE[j]=ChanTrigger::GetNoise(altitude_bn,surface_under_balloon,THETA_ZENITH[j],BW_SEAVEYS,0.);</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    VNOISE[j]=1.52889E-5; <span class="comment">// this comes from V^2/R=kT*bw -&gt; V=sqrt(kT*bw*R)</span></div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    VNOISE[j]*=THERMALNOISE_FACTOR;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  }<span class="comment">//for</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;NOISEFROMFLIGHTDIGITIZER || settings1-&gt;NOISEFROMFLIGHTTRIGGER){</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    readNoiseFromFlight(settings1);</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  }</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;APPLYIMPULSERESPONSEDIGITIZER){</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    readImpulseResponseDigitizer(settings1);</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keywordflow">if</span>(settings1-&gt;TUFFSTATUS&gt;0){</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;      readTuffResponseDigitizer(settings1);</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;      readTuffResponseTrigger(settings1);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;APPLYIMPULSERESPONSETRIGGER){</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    readImpulseResponseTrigger(settings1);</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  }</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// ANITA-4 uses Rayleigh distributions from ANITA-3 to generate thermal noise</span></div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="comment">// Some channels weren&#39;t great for ANITA-3 but were ok in ANITA-4</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==10){</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordtype">double</span> denom, trig, dig;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="comment">// ANITA-3 channel 4TV was broken and channel 5TH had the alfa filter</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    <span class="comment">// For ANITA-4 the Rayleigh distributions of those channels are taken from channels nearby</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    RayleighFits[0][3] =  (TGraph*)RayleighFits[0][2]-&gt;Clone();</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;    RayleighFits[1][4] =  (TGraph*)RayleighFits[1][3]-&gt;Clone();</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    <span class="comment">// 11MH 14BH 11MV 12MV 0BV show weird high/low noise for ANITA-4</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    RayleighFits[1][27] =  (TGraph*)RayleighFits[1][26]-&gt;Clone();</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    RayleighFits[1][46] =  (TGraph*)RayleighFits[1][47]-&gt;Clone();</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    RayleighFits[0][27] =  (TGraph*)RayleighFits[0][26]-&gt;Clone();</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    RayleighFits[0][28] =  (TGraph*)RayleighFits[0][29]-&gt;Clone();</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    RayleighFits[0][32] =  (TGraph*)RayleighFits[0][33]-&gt;Clone();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    RayleighFits[1][9]  =  (TGraph*)RayleighFits[1][5]-&gt;Clone();</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    RayleighFits[1][42] =  (TGraph*)RayleighFits[1][6]-&gt;Clone();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    </div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifreq=0; ifreq&lt;numFreqs; ifreq++){</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[0][0][3][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[0][0][2][ifreq];</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[1][0][4][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[1][0][3][ifreq];</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[1][1][11][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[1][1][10][ifreq];</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[1][2][14][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[1][2][15][ifreq];</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[0][1][11][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[0][1][10][ifreq];</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[0][1][12][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[0][1][13][ifreq];</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[0][2][0][ifreq] =fSignalChainResponseA3DigitizerFreqDomain[0][2][1][ifreq];</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[1][0][9][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[1][0][5][ifreq];</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;      fSignalChainResponseA3DigitizerFreqDomain[1][2][10][ifreq]=fSignalChainResponseA3DigitizerFreqDomain[1][0][6][ifreq];</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    }</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;       </div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;  }</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;  </div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;  calculateImpulseResponsesRatios(settings1);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;  </div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;TRIGGEREFFSCAN){</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    readTriggerEfficiencyScanPulser(settings1);</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;  }</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160; </div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;  </div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  setDiodeRMS(settings1, outputdir);</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;  </div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;  <span class="comment">// Setting up output files</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;  </div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;  <span class="keywordtype">string</span> stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/signals.root&quot;</span>;</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  fsignals=<span class="keyword">new</span> TFile(stemp.c_str(),<span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  tsignals=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;tsignals&quot;</span>,<span class="stringliteral">&quot;tsignals&quot;</span>);</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    </div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/data.root&quot;</span>;</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;  fdata=<span class="keyword">new</span> TFile(stemp.c_str(),<span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;  tdata=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;tdata&quot;</span>,<span class="stringliteral">&quot;tdata&quot;</span>);</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    </div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    </div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;signal_vpol_inanita&quot;</span>,&amp;signal_vpol_inanita,<span class="stringliteral">&quot;signal_vpol_inanita[5][512]/D&quot;</span>);</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;timedomainnoise_rfcm_banding&quot;</span>,&amp;timedomainnoise_rfcm_banding,<span class="stringliteral">&quot;timedomainnoise_rfcm_banding[2][5][512]/D&quot;</span>);</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;total_vpol_inanita&quot;</span>,&amp;total_vpol_inanita,<span class="stringliteral">&quot;total_vpol_inanita[5][512]/D&quot;</span>);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;total_diodeinput_1_inanita&quot;</span>,&amp;total_diodeinput_1_inanita,<span class="stringliteral">&quot;total_diodeinput_1_inanita[5][512]/D&quot;</span>); <span class="comment">// this is the waveform that is input to the tunnel diode in the first (LCP or vertical) polarization</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;total_diodeinput_2_inanita&quot;</span>,&amp;total_diodeinput_2_inanita,<span class="stringliteral">&quot;total_diodeinput_2_inanita[5][512]/D&quot;</span>); <span class="comment">// this is the waveform that is input to the tunnel diode in the first (RCP or horizontal) polarization</span></div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;timedomain_output_corrected_forplotting&quot;</span>,&amp;timedomain_output_corrected_forplotting,<span class="stringliteral">&quot;timedomain_output_1_corrected_forplotting[2][6][512]/D&quot;</span>); </div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;timedomain_output_inanita&quot;</span>,&amp;timedomain_output_inanita,<span class="stringliteral">&quot;timedomain_output_inanita[2][5][512]/D&quot;</span>);</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    </div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    </div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak_rx_rfcm_lab&quot;</span>,&amp;peak_rx_rfcm_lab,<span class="stringliteral">&quot;peak_rx_rfcm_lab[2]/D&quot;</span>);</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>,&amp;inu,<span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;dangle&quot;</span>,&amp;dangle_inanita,<span class="stringliteral">&quot;dangle/D&quot;</span>);</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;emfrac&quot;</span>,&amp;emfrac_inanita,<span class="stringliteral">&quot;emfrac/D&quot;</span>);</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;hadfrac&quot;</span>,&amp;hadfrac_inanita,<span class="stringliteral">&quot;hadfrac/D&quot;</span>);</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;ston&quot;</span>,&amp;ston,<span class="stringliteral">&quot;ston[5]/D&quot;</span>);</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak&quot;</span>,                     &amp;peak_v_banding_rfcm,      <span class="stringliteral">&quot;peak_v_banding_rfcm[2][5]/D&quot;</span>   );</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak_rx&quot;</span>,                  &amp;peak_rx_signalonly,       <span class="stringliteral">&quot;peak_rx[2]/D&quot;</span>                  );</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak_rx_rfcm&quot;</span>,             &amp;peak_rx_rfcm,             <span class="stringliteral">&quot;peak_rx_rfcm[2]/D&quot;</span>             );</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak_rx_rfcm_signalonly&quot;</span>,  &amp;peak_rx_rfcm_signalonly,  <span class="stringliteral">&quot;peak_rx_rfcm_signalonly[2]/D&quot;</span>  );</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;peak_rx_rfcm_lab&quot;</span>,         &amp;peak_rx_rfcm_lab,         <span class="stringliteral">&quot;peak_rx_rfcm_lab[2]/D&quot;</span>         );</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;bwslice_vrms&quot;</span>,&amp;bwslice_vrms,<span class="stringliteral">&quot;bwslice_vrms[5]/D&quot;</span>);</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;iminbin&quot;</span>,&amp;iminbin,<span class="stringliteral">&quot;iminbin[5]/I&quot;</span>);</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;imaxbin&quot;</span>,&amp;imaxbin,<span class="stringliteral">&quot;imaxbin[5]/I&quot;</span>);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;maxbin_fortotal&quot;</span>,&amp;maxbin_fortotal,<span class="stringliteral">&quot;maxbin_fortotal[5]/I&quot;</span>);</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;channels_passing&quot;</span>,&amp;channels_passing,<span class="stringliteral">&quot;channels_passing[2][5]/I&quot;</span>);</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;bwslice_rmsdiode&quot;</span>,&amp;bwslice_rmsdiode,<span class="stringliteral">&quot;bwslice_rmsdiode[2][5]/D&quot;</span>);</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;l1_passing&quot;</span>,&amp;l1_passing,<span class="stringliteral">&quot;l1_passing/I&quot;</span>);</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;integral_vmmhz&quot;</span>,&amp;integral_vmmhz_foranita,<span class="stringliteral">&quot;integral_vmmhz/D&quot;</span>);</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;  <span class="comment">//tsignals-&gt;Branch(&quot;dnutries&quot;,&amp;dnutries,&quot;dnutries/D&quot;);</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;  <span class="comment">//tsignals-&gt;Branch(&quot;weight_test&quot;,&amp;weight_test,&quot;weight_test/D&quot;);</span></div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;flag_e_inanita&quot;</span>,&amp;flag_e_inanita,<span class="stringliteral">&quot;flag_e_inanita[5][512]/I&quot;</span>);</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;  tsignals-&gt;Branch(<span class="stringliteral">&quot;flag_h_inanita&quot;</span>,&amp;flag_h_inanita,<span class="stringliteral">&quot;flag_h_inanita[5][512]/I&quot;</span>);</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    </div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    </div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;  tdata=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;tdata&quot;</span>,<span class="stringliteral">&quot;tdata&quot;</span>);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;total_diodeinput_1_allantennas&quot;</span>,&amp;total_diodeinput_1_allantennas,<span class="stringliteral">&quot;total_diodeinput_1_allantennas[48][512]/D&quot;</span>); <span class="comment">// this is the waveform that is input to the tunnel diode in the first (LCP or vertical) polarization</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;total_diodeinput_2_allantennas&quot;</span>,&amp;total_diodeinput_2_allantennas,<span class="stringliteral">&quot;total_diodeinput_2_allantennas[48][512]/D&quot;</span>); <span class="comment">// this is the waveform that is input to the tunnel diode in the first (LCP or vertical) polarization</span></div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;timedomain_output_allantennas&quot;</span>,&amp;timedomain_output_allantennas,<span class="stringliteral">&quot;timedomain_output_allantennas[2][48][512]/D&quot;</span>); <span class="comment">// this is the waveform that is output to the tunnel diode in the first (LCP or vertical) polarization</span></div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;arrival_times&quot;</span>,&amp;arrival_times,<span class="stringliteral">&quot;arrival_times[2][48]/D&quot;</span>);</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>,&amp;inu,<span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;powerthreshold&quot;</span>,&amp;powerthreshold,<span class="stringliteral">&quot;powerthreshold[5]/D&quot;</span>);</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;bwslice_rmsdiode&quot;</span>,&amp;bwslice_rmsdiode,<span class="stringliteral">&quot;bwslice_rmsdiode[2][5]/D&quot;</span>);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;  <span class="comment">//std::array&lt; std::array&lt; std::array&lt; std::array&lt;std::vector&lt;int&gt;,5&gt;, 2&gt;, 16&gt;, 3&gt;  arrayofhits_inanita; </span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;arrayofhits_inanita&quot;</span>,&amp;arrayofhits_inanita,<span class="stringliteral">&quot;arrayofhits_inanita[3][16][2][512]/I&quot;</span>);</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;l1trig_anita3and4_inanita&quot;</span>,&amp;l1trig_anita3and4_inanita,<span class="stringliteral">&quot;l1trig_anita3and4_inanita[2][16][512]/I&quot;</span>);</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;l1trig_anita4lr_inanita&quot;</span>,&amp;l1trig_anita4lr_inanita,<span class="stringliteral">&quot;l1trig_anita4lr_inanita[3][16][512]/I&quot;</span>);</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;l2trig_anita4lr_inanita&quot;</span>,&amp;l2trig_anita4lr_inanita,<span class="stringliteral">&quot;l2trig_anita4lr_inanita[16][3][512]/I&quot;</span>);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;l3type0trig_anita4lr_inanita&quot;</span>,&amp;l3type0trig_anita4lr_inanita,<span class="stringliteral">&quot;l3type0trig_anita4lr_inanita[16][512]/I&quot;</span>);</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;l3trig_anita4lr_inanita&quot;</span>,&amp;l3trig_anita4lr_inanita,<span class="stringliteral">&quot;l3trig_anita4lr_inanita[16][512]/I&quot;</span>);</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;  <span class="comment">//tdata-&gt;Branch(&quot;arrayofhits_inanita&quot;,&amp;arrayofhits_inanita,&quot;std::array&lt; std::array&lt; std::array&lt; std::array&lt;std::vector&lt;int&gt;,5&gt;, 2&gt;, 16&gt;, 3&gt;&quot;);</span></div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;  tdata-&gt;Branch(<span class="stringliteral">&quot;passglobtrig&quot;</span>,&amp;passglobtrig,<span class="stringliteral">&quot;passglobtrig[2]/I&quot;</span>);</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    </div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;  tgaryanderic=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;tgaryanderic&quot;</span>,<span class="stringliteral">&quot;tgaryanderic&quot;</span>);</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;arrayofhits&quot;</span>,&amp;arrayofhits_forgaryanderic,<span class="stringliteral">&quot;arrayofhits_forgaryanderic[3][16][2][512]/I&quot;</span>);</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;l1trig&quot;</span>,&amp;l1trig_anita4lr_forgaryanderic,<span class="stringliteral">&quot;l1trig_anita4lr_forgaryanderic[3][16][512]/I&quot;</span>);</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;l2trig&quot;</span>,&amp;l2trig_anita4lr_forgaryanderic,<span class="stringliteral">&quot;l2trig_anita4lr_forgaryanderic[16][512]/I&quot;</span>); </div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;l3type0trig&quot;</span>,&amp;l3type0trig_anita4lr_forgaryanderic,<span class="stringliteral">&quot;l3type0trig_anita4lr_forgaryanderic[16][512]/I&quot;</span>); </div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;l3type1trig&quot;</span>,&amp;l3type1trig_anita4lr_forgaryanderic,<span class="stringliteral">&quot;l3type1trig_anita4lr_forgaryanderic[16][512]/I&quot;</span>); </div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;passglobtrig&quot;</span>,&amp;passglobtrig,<span class="stringliteral">&quot;passglobtrig[2]/I&quot;</span>);</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;weight&quot;</span>,&amp;weight_inanita,<span class="stringliteral">&quot;weight_inanita/D&quot;</span>);</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;  tgaryanderic-&gt;Branch(<span class="stringliteral">&quot;time&quot;</span>,&amp;time_trig,<span class="stringliteral">&quot;time_trig[512]/D&quot;</span>);</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;  tglob=<span class="keyword">new</span> TTree(<span class="stringliteral">&quot;tglob&quot;</span>,<span class="stringliteral">&quot;tglob&quot;</span>);</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;  tglob-&gt;Branch(<span class="stringliteral">&quot;inu&quot;</span>,&amp;inu,<span class="stringliteral">&quot;inu/I&quot;</span>);</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;  tglob-&gt;Branch(<span class="stringliteral">&quot;passglobtrig&quot;</span>,&amp;passglobtrig,<span class="stringliteral">&quot;passglobtrig[2]/I&quot;</span>);</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;  tglob-&gt;Branch(<span class="stringliteral">&quot;l1_passing_allantennas&quot;</span>,&amp;l1_passing_allantennas,<span class="stringliteral">&quot;l1_passing_allantennas[48]/I&quot;</span>);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;  </div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;  </div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;  <span class="comment">// Prepare the file and tree for the coherent sum trigger&#39;s data tree</span></div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;  coherent_datafile = <span class="keyword">new</span> TFile(Form(<span class="stringliteral">&quot;%s/coherent_sum_data_file.root&quot;</span>, outputdir.Data()),<span class="stringliteral">&quot;RECREATE&quot;</span>);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;  coherent_waveform_sum_tree = <span class="keyword">new</span> TTree(<span class="stringliteral">&quot;coherent_waveform_sum_tree&quot;</span>, <span class="stringliteral">&quot;Coherent Waveform Sum&quot;</span>);</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;event_number&quot;</span>, &amp;cwst_event_number);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;center_phi_sector&quot;</span>, &amp;cwst_center_phi_sector);</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;rms_noise&quot;</span>, &amp;cwst_rms_noise);</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;actual_rms&quot;</span>, &amp;cwst_actual_rms);</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;threshold&quot;</span>, &amp;cwst_threshold);</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;window_start&quot;</span>, &amp;cwst_window_start);</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;window_end&quot;</span>, &amp;cwst_window_end);</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    </div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;deg_theta&quot;</span>, &amp;cwst_deg_theta);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;deg_phi&quot;</span>, &amp;cwst_deg_phi);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    </div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;actual_deg_theta&quot;</span>, &amp;cwst_actual_deg_theta);</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;actual_deg_phi&quot;</span>, &amp;cwst_actual_deg_phi);</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    </div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;timesteps&quot;</span>, cwst_timesteps);</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    </div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i = 0; i &lt; 48; ++i) {</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    cwst_RXs[i].waveform = <span class="keyword">new</span> vector &lt;double&gt;(HALFNFOUR, 0.);</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    cwst_RXs[i].digitized = <span class="keyword">new</span> vector &lt;double&gt;(HALFNFOUR, 0.);</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    coherent_waveform_sum_tree-&gt;Branch(Form(<span class="stringliteral">&quot;rx%u&quot;</span>, i), &amp;(cwst_RXs[i]));</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    </div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 9; i++) {</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    cwst_aligned_wfms[i].digitized = <span class="keyword">new</span> vector &lt;double&gt;(HALFNFOUR, 0.);</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    coherent_waveform_sum_tree-&gt;Branch(Form(<span class="stringliteral">&quot;aligned_wfms%u&quot;</span>, i), &amp;(cwst_aligned_wfms[i]));</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="comment">/*</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">    //coherent_waveform_sum_tree-&gt;Branch(Form(&quot;whole_wfms%u&quot;, i), &amp;(cwst_whole_wfms[i]));</span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">    cwst_whole_wfms[i] = new vector &lt;double&gt;(HALFNFOUR, 0.);</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">    cwst_wfms[i] = new vector &lt;double&gt;(HALFNFOUR, 0.);</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">    cwst_aligned_wfms[i] = new vector &lt;double&gt;(HALFNFOUR, 0.);</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment">    coherent_waveform_sum_tree-&gt;Branch(Form(&quot;whole_wfms%u&quot;, i), &amp;(cwst_whole_wfms[i]));</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">    coherent_waveform_sum_tree-&gt;Branch(Form(&quot;wfms%u&quot;, i), &amp;(cwst_wfms[i]));</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">    coherent_waveform_sum_tree-&gt;Branch(Form(&quot;aligned_wfms%u&quot;, i), &amp;(cwst_aligned_wfms[i]));</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">    */</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;  }</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    </div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;summed_wfm&quot;</span>, &amp;cwst_summed_wfm);</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;power_of_summed_wfm&quot;</span>, &amp;cwst_power_of_summed_wfm);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;  coherent_waveform_sum_tree-&gt;Branch(<span class="stringliteral">&quot;power&quot;</span>, &amp;cwst_power);</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;  <span class="comment">// End of preparition for the coherent sum trigger&#39;s data tree</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;  </div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;  </div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;}</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordtype">void</span> Anita::initializeFixedPowerThresholds(ofstream &amp;foutput){</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    </div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;  <span class="keywordflow">if</span> (BANDING==2) { <span class="comment">//anita 2</span></div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        </div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="comment">// I derive these thresholds from Ryan&#39;s plot</span></div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="comment">//of measured rates vs. threshold</span></div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <span class="comment">// that appears on p. 9 of his talk at the Anita meeting 19th Feb 2008</span></div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <span class="comment">//  Using 14 MHz, 8 MHz, 8MHz and 1 MHz for L, M, H and full bands</span></div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    powerthreshold[0]=-1.87; <span class="comment">// low band</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    powerthreshold[1]=-2.53; <span class="comment">// middle band</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    powerthreshold[2]=-2.15; <span class="comment">// high band</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    powerthreshold[3]=-1.; <span class="comment">// not used for Anita 2</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    powerthreshold[4]=-4.41; <span class="comment">// full band - use this threshold when other bands are used</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="comment">//powerthreshold[4]=-5.3; // full band - use this threshold for full band only trigger</span></div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        </div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        </div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    powerthreshold_nadir[0]=-6.7; <span class="comment">// low band</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    powerthreshold_nadir[1]=-6.5; <span class="comment">// middle band</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    powerthreshold_nadir[2]=-5.1; <span class="comment">// high band</span></div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    powerthreshold_nadir[3]=-1.; <span class="comment">// not used for Anita 2</span></div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    powerthreshold_nadir[4]=-6.7; <span class="comment">// full band - use this threshold when other bands are used</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;        </div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        </div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Thresholds are (in p/&lt;p&gt;):  &quot;</span> &lt;&lt;</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      powerthreshold[0] &lt;&lt; <span class="stringliteral">&quot; (L)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      powerthreshold[1] &lt;&lt; <span class="stringliteral">&quot; (M)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;      powerthreshold[2] &lt;&lt; <span class="stringliteral">&quot; (H)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      powerthreshold[4] &lt;&lt; <span class="stringliteral">&quot; (F)\n&quot;</span>;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;  }</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==0 || BANDING==1) { <span class="comment">// anita 1 or set your own</span></div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        </div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    powerthreshold[0]=-3.27;</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    powerthreshold[1]=-3.24;</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    powerthreshold[2]=-2.48;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    powerthreshold[3]=-2.56;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    powerthreshold[4]=-3.;</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        </div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Thresholds are (in p/&lt;p&gt;):  &quot;</span> &lt;&lt;</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;      powerthreshold[0] &lt;&lt; <span class="stringliteral">&quot; (L)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;      powerthreshold[1] &lt;&lt; <span class="stringliteral">&quot; (M1)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;      powerthreshold[2] &lt;&lt; <span class="stringliteral">&quot; (M2)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;      powerthreshold[3] &lt;&lt; <span class="stringliteral">&quot; (H)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      powerthreshold[4] &lt;&lt; <span class="stringliteral">&quot; \n&quot;</span>;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        </div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==4 || BANDING==5){ <span class="comment">// anita-3</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    powerthreshold[0]=-1; <span class="comment">// not used </span></div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    powerthreshold[1]=-1; <span class="comment">// not used </span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    powerthreshold[2]=-1; <span class="comment">// not used </span></div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    powerthreshold[3]=-1; <span class="comment">// not used</span></div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    powerthreshold[4]=-5.40247; <span class="comment">// Average Anita-3 scaler is 450kHz, which corresponds to this threshold as seen in</span></div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="comment">// p. 9 of Ryan&#39;s talk at the Anita meeting 19th Feb 2008</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        </div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    foutput &lt;&lt; <span class="stringliteral">&quot;Thresholds are (in p/&lt;p&gt;):  &quot;</span> &lt;&lt;</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      powerthreshold[0] &lt;&lt; <span class="stringliteral">&quot; (L)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      powerthreshold[1] &lt;&lt; <span class="stringliteral">&quot; (M1)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;      powerthreshold[2] &lt;&lt; <span class="stringliteral">&quot; (M2)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      powerthreshold[3] &lt;&lt; <span class="stringliteral">&quot; (H)\t&quot;</span> &lt;&lt;</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      powerthreshold[4] &lt;&lt; <span class="stringliteral">&quot; \n&quot;</span>;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      </div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  }</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;}</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;<span class="keywordtype">void</span> Anita::readVariableThresholds(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==8) { <span class="comment">// ANITA-2</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    fturf=<span class="keyword">new</span> TFile((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/turfrate_icemc.root&quot;</span>).c_str());</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    turfratechain=(TTree*)fturf-&gt;Get(<span class="stringliteral">&quot;turfrate_icemc&quot;</span>);</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    turfratechain-&gt;SetMakeClass(1);</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;phiTrigMask&quot;</span>,&amp;phiTrigMask);</div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;realTime&quot;</span>,&amp;realTime_turfrate);</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    turfratechain-&gt;BuildIndex(<span class="stringliteral">&quot;realTime&quot;</span>);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    turfratechain-&gt;GetEvent(0);</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    realTime_tr_min=realTime_turfrate; <span class="comment">// realTime of first event in the file</span></div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    turfratechain-&gt;GetEvent(turfratechain-&gt;GetEntries()-1);</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    realTime_tr_max=realTime_turfrate; <span class="comment">// realTime of last event in file</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    </div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){ <span class="comment">// ANITA-3 and 4</span></div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    </div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="keywordtype">string</span> turfFile=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordtype">string</span> surfFile=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9){</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      turfFile+=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/SampleTurf_icemc_anita3.root&quot;</span>;</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      surfFile+=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/SampleSurf_icemc_anita3.root&quot;</span>;</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      turfFile+=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/SampleTurf_run42to367_anita4.root&quot;</span>;</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      surfFile+=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/SampleSurf_run42to367_anita4.root&quot;</span>;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    }</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    <span class="comment">// Reading in masking every 60 seconds</span></div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    fturf=<span class="keyword">new</span> TFile(turfFile.c_str());</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    turfratechain=(TTree*)fturf-&gt;Get(<span class="stringliteral">&quot;turfrate_icemc&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    turfratechain-&gt;SetMakeClass(1);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;phiTrigMask&quot;</span>,&amp;phiTrigMask);</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;phiTrigMaskH&quot;</span>,&amp;phiTrigMaskH);</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;l1TrigMask&quot;</span>,&amp;l1TrigMask);</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;l1TrigMaskH&quot;</span>,&amp;l1TrigMaskH);</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;deadTime&quot;</span>,&amp;deadTime);</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;    turfratechain-&gt;SetBranchAddress(<span class="stringliteral">&quot;realTime&quot;</span>,&amp;realTime_turfrate);</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    turfratechain-&gt;BuildIndex(<span class="stringliteral">&quot;realTime&quot;</span>);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    turfratechain-&gt;GetEvent(0);</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    realTime_tr_min=realTime_turfrate; <span class="comment">// realTime of first event in the file</span></div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    turfratechain-&gt;GetEvent(turfratechain-&gt;GetEntries()-1);</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    realTime_tr_max=realTime_turfrate; <span class="comment">// realTime of last event in file</span></div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;    <span class="comment">// Reading in thresholds/scalers every 60 seconds</span></div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    fsurf=<span class="keyword">new</span> TFile(surfFile.c_str());</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    surfchain=(TTree*)fsurf-&gt;Get(<span class="stringliteral">&quot;surf_icemc&quot;</span>);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    surfchain-&gt;SetMakeClass(1);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;thresholds&quot;</span>,       &amp;thresholds       );</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;scalers&quot;</span>,          &amp;scalers          );</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;fakeThreshold&quot;</span>,    &amp;fakeThresholds   );</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;fakeThreshold2&quot;</span>,   &amp;fakeThresholds2  );</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;fakeScaler&quot;</span>,       &amp;fakeScalers      );</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    surfchain-&gt;SetBranchAddress(<span class="stringliteral">&quot;realTime&quot;</span>,         &amp;realTime_surf    );</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    surfchain-&gt;BuildIndex(<span class="stringliteral">&quot;realTime&quot;</span>);</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    surfchain-&gt;GetEvent(0);</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    realTime_surf_min=realTime_surf; <span class="comment">// realTime of first event in the file</span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;    surfchain-&gt;GetEvent(surfchain-&gt;GetEntries()-1);</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    realTime_surf_max=realTime_surf; <span class="comment">// realTime of last event in file</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;  }</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;}</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;<span class="keywordtype">void</span> Anita::readAmplification(){</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    </div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="comment">// get rfcm amplification data</span></div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;  <span class="comment">// read from tree with amplification data</span></div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;  <span class="comment">// this tree contains a different event for each antenna and polarization</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;  TFile *f2=<span class="keyword">new</span> TFile((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/gains.root&quot;</span>).c_str());</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;  TTree *tgain=(TTree*)f2-&gt;Get(<span class="stringliteral">&quot;tree1&quot;</span>);</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    </div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <span class="keywordtype">float</span> freq_ampl_eachantenna[NPOINTS_AMPL];</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <span class="keywordtype">float</span> ampl_eachantenna[NPOINTS_AMPL];</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <span class="keywordtype">float</span> noisetemp_eachantenna[NPOINTS_AMPL];</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    </div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  tgain-&gt;SetBranchAddress(<span class="stringliteral">&quot;freq&quot;</span>,freq_ampl_eachantenna);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  tgain-&gt;SetBranchAddress(<span class="stringliteral">&quot;ampl&quot;</span>,ampl_eachantenna);</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  tgain-&gt;SetBranchAddress(<span class="stringliteral">&quot;noisetemp&quot;</span>,noisetemp_eachantenna);</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0;iant&lt;48;iant++) {</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    tgain-&gt;GetEvent(iant);</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NPOINTS_AMPL;j++) {</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    </div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;      freq_ampl[iant][j]=(double)freq_ampl_eachantenna[j];</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    </div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;      ampl[iant][j]=(double)ampl_eachantenna[j];</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    </div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;      ampl[iant][j]+=32.; <span class="comment">// add 32 dB to correct for attenuation that was used during the test</span></div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      ampl_notdb[iant][j]=pow(10.,ampl[iant][j]/10.); <span class="comment">// convert to regular fraction</span></div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    </div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      noisetemp[iant][j]=(double)noisetemp_eachantenna[j]; <span class="comment">// so far we don&#39;t use this for anything</span></div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;  }</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;  f2-&gt;Close();</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;}</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;<span class="keywordtype">void</span> Anita::getDiodeDataAndAttenuation(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, TString outputdir){</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;  <span class="comment">// get vnoise data</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;  <span class="keywordtype">string</span> sdiode;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;  <span class="keywordflow">if</span> (BANDING==0)</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    sdiode=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/diode_anita1.root&quot;</span>;</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==1) </div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;    sdiode=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/diode_nobanding.root&quot;</span>;</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==2)</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;    sdiode=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/diode_anita2.root&quot;</span>;</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==4 || BANDING==5) <span class="comment">// Linda</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;    sdiode=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/diode_anita3.root&quot;</span>;</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    </div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;  fnoise=<span class="keyword">new</span> TFile(sdiode.c_str());</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;  tdiode=(TTree*)fnoise-&gt;Get(<span class="stringliteral">&quot;diodeoutputtree&quot;</span>);</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    </div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    </div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    </div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  <span class="keywordtype">string</span> sbands;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keywordflow">if</span> (BANDING==0)</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    sbands=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/bands_anita1.root&quot;</span>;</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==1)   </div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    sbands=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/bands_nobanding.root&quot;</span>;</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==2)</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    sbands=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/bands_anita2.root&quot;</span>;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==4 || BANDING==5) <span class="comment">// Linda </span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    sbands=ICEMC_DATA_DIR+<span class="stringliteral">&quot;/bands_anita2.root&quot;</span>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    </div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  TFile *fbands=<span class="keyword">new</span> TFile(sbands.c_str());</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;  TTree *tbands=(TTree*)fbands-&gt;Get(<span class="stringliteral">&quot;bandstree&quot;</span>);</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    </div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;    </div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;HALFNFOUR;i++) {</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;    time[i]=(double)i*TIMESTEP;</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;    time_long[i]=time[i];</div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;time is &quot; &lt;&lt; time[i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    time_centered[i]=time[i]-(double)HALFNFOUR/2*TIMESTEP;</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;  }</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=HALFNFOUR;i&lt;NFOUR;i++) {</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    time_long[i]=(double)i*TIMESTEP;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;  }</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;    </div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    </div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;  <span class="comment">// get diode model</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;  getDiodeModel();</div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    </div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;  <span class="keywordtype">int</span> m=(int)(maxt_diode/TIMESTEP);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;m;i++) {</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      fdiode_real[j][i]=diode_real[j][i];</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    }</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=m;i&lt;NFOUR;i++) {</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;      fdiode_real[j][i]=0.;   <span class="comment">// now fdiode_real is NFOUR array which is double sized then the signal we have. This is for zero padding for later convolution.</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    }</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      </div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    Tools::realft(fdiode_real[j],1,NFOUR);  <span class="comment">// now fdiode_real is in freq domain</span></div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;  }</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;  <span class="comment">// try applying an exponential to the frequency domain</span></div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    </div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;    </div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;  TCanvas *cdiode=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cdiode&quot;</span>,<span class="stringliteral">&quot;cdiode&quot;</span>,880,800);</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;  cdiode-&gt;Divide(1,2);</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  TGraph *gdiode=<span class="keyword">new</span> TGraph(NFOUR/2,time,diode_real[4]);</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  cdiode-&gt;cd(1);</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  gdiode-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;  gdiode=<span class="keyword">new</span> TGraph(NFOUR/2,freq_forfft,fdiode_real[4]);</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  cdiode-&gt;cd(2);</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;  gdiode-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;  </div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/diode.eps&quot;</span>;</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  cdiode-&gt;Print((TString)stemp);</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;    </div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;  tdiode-&gt;SetBranchAddress(<span class="stringliteral">&quot;avgfreqdomain_lab&quot;</span>,&amp;(avgfreqdomain_lab[0]));</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;  tdiode-&gt;SetBranchAddress(<span class="stringliteral">&quot;freqdomain_amp_icemc&quot;</span>,&amp;(freqdomain_rfcm[0]));</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;  tdiode-&gt;SetBranchAddress(<span class="stringliteral">&quot;freqdomain_rfcm_banding&quot;</span>,&amp;(freqdomain_rfcm_banding[0][0]));</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    </div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    </div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  tbands-&gt;SetBranchAddress(<span class="stringliteral">&quot;freq_bands&quot;</span>,freq_bands);</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  tbands-&gt;SetBranchAddress(<span class="stringliteral">&quot;bandsattn&quot;</span>,bandsattn);</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;  <span class="comment">//tbands-&gt;SetBranchAddress(&quot;correl&quot;,&amp;(correl[0][0]));</span></div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  tbands-&gt;SetBranchAddress(<span class="stringliteral">&quot;correl_banding&quot;</span>,&amp;(correl_banding[0][0]));</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;  tbands-&gt;SetBranchAddress(<span class="stringliteral">&quot;correl_lab&quot;</span>,&amp;(correl_lab[0]));</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  tbands-&gt;GetEntry(0);</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    </div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    </div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    </div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    </div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    </div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;WARNING!! Altering bandsattn.\n&quot;;</span></div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="comment">//BoxAverage(bandsattn[j],NPOINTS_BANDS,10);</span></div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NPOINTS_BANDS;i++) {</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            </div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;      <span class="comment">//    bandsattn[j][i]*=4.;</span></div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;      <span class="keywordflow">if</span> (bandsattn[j][i]&gt;1.)</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    bandsattn[j][i]=1.;</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            </div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;      <span class="comment">//    if (BANDING==0 &amp;&amp; j==4) // make this the same as the full band in anita 2</span></div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;      <span class="comment">//bandsattn[j][i]=1.;</span></div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    }</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  }</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    </div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    </div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  TGraph *gbandsattn[5];</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  TGraph *gcorr[5];</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  TH2F *hbandsattn=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;hbandsattn&quot;</span>,<span class="stringliteral">&quot;hbandsattn&quot;</span>,100,0.,2.E9,100,0.,1.);</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;  TH2F *hcorr=<span class="keyword">new</span> TH2F(<span class="stringliteral">&quot;hcorr&quot;</span>,<span class="stringliteral">&quot;hcorr&quot;</span>,100,0.,2.E9,100,0.,2.);</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    gbandsattn[i]=<span class="keyword">new</span> TGraph(NPOINTS_BANDS,freq_bands[i],bandsattn[i]);</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    gbandsattn[i]-&gt;SetLineColor(2+i);</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    gcorr[i]=<span class="keyword">new</span> TGraph(NPOINTS_BANDS,freq_bands[i],correl_banding[i]);</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;    gcorr[i]-&gt;SetLineColor(2+i);</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  }</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  TCanvas *cbands=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cbands&quot;</span>,<span class="stringliteral">&quot;cbands&quot;</span>,880,800);</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  cbands-&gt;Divide(1,2);</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;  cbands-&gt;cd(1);</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  hbandsattn-&gt;Draw();</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    gbandsattn[i]-&gt;Draw(<span class="stringliteral">&quot;l&quot;</span>);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  }</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  cbands-&gt;cd(2);</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;  hcorr-&gt;Draw();</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    gcorr[i]-&gt;Draw(<span class="stringliteral">&quot;l&quot;</span>);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  }</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/bands.eps&quot;</span>;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  cbands-&gt;Print((TString)stemp);</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    </div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    </div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    </div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="comment">//   if (BANDING==0)</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  <span class="comment">//     sbands=ICEMC_DATA_DIR+&quot;/bands_anita2.root&quot;;</span></div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    </div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    </div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  <span class="comment">//   TFile *fbands_temp=new TFile(sbands.c_str());</span></div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">//   TTree *tbands_temp=(TTree*)fbands_temp-&gt;Get(&quot;bandstree&quot;);</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">//   double bandsattn_temp[5][NPOINTS_BANDS];</span></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <span class="comment">//   tbands_temp-&gt;SetBranchAddress(&quot;bandsattn&quot;,bandsattn_temp);</span></div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;  <span class="comment">//   tbands_temp-&gt;GetEvent(0);</span></div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;  <span class="comment">//   for (int i=0;i&lt;NPOINTS_BANDS;i++) {</span></div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  <span class="comment">//     bandsattn[4][i]=bandsattn_temp[4][i];</span></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  <span class="comment">//   }</span></div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    </div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;}</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="keywordtype">void</span> Anita::setDiodeRMS(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, TString outputdir){</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;  <span class="keywordtype">double</span> mindiodeconvl[5];</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;  <span class="keywordtype">double</span> onediodeconvl[5];</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    </div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;  <span class="keywordtype">double</span> power_noise_eachband[5][NFOUR];</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="keywordtype">double</span> timedomain_output[5][NFOUR];</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    </div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="comment">// average result of diode integrator during quiet time</span></div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    </div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    bwslice_enoise[i]=0.;</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    bwslice_rmsdiode[0][i]=bwslice_rmsdiode[1][i]=0.;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    bwslice_vrms[i]=0.;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;  }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;  </div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  nnoiseevents=tdiode-&gt;GetEntries();</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;  noiseeventcounter=0;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    </div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    </div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;  <span class="keywordtype">int</span> nhnoisebins=100;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;  TH1F *hnoise[5];</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;    </div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="keywordtype">char</span> histname[150];</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;3;j++) {</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        </div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    sprintf(histname,<span class="stringliteral">&quot;hnoise_%d&quot;</span>,j);</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    <span class="keywordflow">if</span> (BANDING==2)</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;      hnoise[j]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-40.,20.);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      hnoise[j]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-80.,40.);</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  }</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  <span class="keywordflow">if</span> (BANDING==2) {</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    sprintf(histname,<span class="stringliteral">&quot;hnoise_3&quot;</span>);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    hnoise[3]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-60.0,40.0);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    sprintf(histname,<span class="stringliteral">&quot;hnoise_4&quot;</span>);</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    hnoise[4]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-60.0,40.0);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;  }</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    sprintf(histname,<span class="stringliteral">&quot;hnoise_3&quot;</span>);</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    hnoise[3]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-120.0,80.0);</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    sprintf(histname,<span class="stringliteral">&quot;hnoise_4&quot;</span>);</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    hnoise[4]=<span class="keyword">new</span> TH1F(histname,histname,nhnoisebins,-120.0,80.0);</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        </div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  }</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    </div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <span class="comment">// just take the average noise arrays from the tdiode tree</span></div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  tdiode-&gt;GetEvent(0);</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    </div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;after getting event, freqdomain_rfcm_banding is &quot;</span> &lt;&lt; freqdomain_rfcm_banding[0][NFOUR/8-1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    </div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;  <span class="comment">// TGraph *gfreqdomain_rfcm=new TGraph(NFOUR/4,freq_forplotting,freqdomain_rfcm);</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  <span class="comment">// TGraph *gavgfreqdomain_lab=new TGraph(NFOUR/4,freq_forplotting,avgfreqdomain_lab);</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// TGraph *gfreqdomain_rfcm_banding[5];</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;  <span class="comment">// for (int i=0;i&lt;5;i++) {</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;  <span class="comment">//   gfreqdomain_rfcm_banding[i]=new TGraph(NFOUR/4,freq_forplotting,freqdomain_rfcm_banding[i]);</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;  <span class="comment">// }</span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    </div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    </div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    </div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;  <span class="comment">// TCanvas *cfreq=new TCanvas(&quot;cfreq&quot;,&quot;cfreq&quot;,880,800);</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <span class="comment">// cfreq-&gt;Divide(1,3);</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;  <span class="comment">// cfreq-&gt;cd(1);</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="comment">// gfreqdomain_rfcm-&gt;Draw(&quot;al&quot;);</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;  <span class="comment">// cfreq-&gt;cd(2);</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <span class="comment">// gavgfreqdomain_lab-&gt;Draw(&quot;al&quot;);</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;  <span class="comment">// cfreq-&gt;cd(3);</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// gfreqdomain_rfcm_banding[4]-&gt;Draw(&quot;al&quot;);</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="comment">// for (int i=0;i&lt;5;i++) {</span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  <span class="comment">//   gfreqdomain_rfcm_banding[i]-&gt;Draw(&quot;l&quot;);</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <span class="comment">// }</span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <span class="comment">// stemp=string(outputdir.Data())+&quot;/freqdomainplots.eps&quot;;</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  <span class="comment">// cfreq-&gt;Print((TString)stemp);</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        </div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    </div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="comment">// do the box banding for BANDING==1</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;  <span class="keywordflow">if</span> (BANDING==1) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;    </div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;NFOUR/4;k++) {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      </div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <span class="keywordflow">if</span> (bwslice_min[j]&gt;freq_forplotting[k] || bwslice_max[j]&lt;freq_forplotting[k]) {</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;      freqdomain_rfcm_banding[j][k]=0.;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;      }</div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    }<span class="comment">// end loop over bands</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  }</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    </div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;  </div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;  </div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;  <span class="keywordtype">double</span> power=0.;</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;NFOUR/4;k++) {</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      power+=freqdomain_rfcm_banding[j][k]/((double)NFOUR/4); <span class="comment">// in V^2</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    }</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    <span class="comment">//  cout &lt;&lt; &quot;power is &quot; &lt;&lt; power &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    </div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordtype">int</span> ngeneratedevents=1000;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;  <span class="keywordtype">int</span> passes[5]={0,0,0,0,0};</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  <span class="keywordtype">double</span> averageoutput[5]={0.,0.,0.,0.,0.};</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  </div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;  <span class="keywordflow">if</span> (!settings1-&gt;NOISEFROMFLIGHTTRIGGER){</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      cout &lt;&lt; double(i)/double(ngeneratedevents) &lt;&lt; endl;</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="comment">// put phases to freqdomain_rfcm_banding_rfcm array</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="comment">// assign phases (w/ correlations) to freqdomain_rfcm_banding_rfmc_banding array</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;      GetNoiseWaveforms();</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="comment">//       // timedomainnoise_rfcm_banding_e[j] contain noise waveforms for</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    <span class="comment">//       // each band.  They come from taking the waveforms measured in</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <span class="comment">//       // the signal stream, removing the rfcm&#39;s and lab attn.,</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    <span class="comment">//       // then reinserting rfcm&#39;s and band attn.</span></div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="comment">//       // so they should be narrow band</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="comment">//       // myconvlv performs a convolution on that time domain waveform</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    <span class="comment">//       // based on the function that you define in getDiodeModel</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        </div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    <span class="comment">//       cout &lt;&lt; &quot;timedomainnoise_rfcm_banding_e is &quot; &lt;&lt; timedomainnoise_rfcm_banding_e[j][NFOUR/4-1] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;    myconvlv(timedomainnoise_rfcm_banding[0][j],NFOUR,fdiode_real[j],mindiodeconvl[j],onediodeconvl[j],power_noise_eachband[j],timedomain_output[j]);</div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            </div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    hnoise[j]-&gt;Fill(onediodeconvl[j]*1.E15);</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            </div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;    bwslice_enoise[j]+=onediodeconvl[j];</div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            </div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            </div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;      bwslice_meandiode[j]+=timedomain_output[j][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      bwslice_vrms[j]+=timedomainnoise_rfcm_banding[0][j][m]*timedomainnoise_rfcm_banding[0][j][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP)); <span class="comment">// this is the rms of the diode input voltage</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      averageoutput[j]+=timedomain_output[j][m]*timedomain_output[j][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    } <span class="comment">// end loop over samples where diode function is fully contained</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            </div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      } <span class="comment">// end loop over bands</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    } <span class="comment">// end loop over generated events</span></div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    </div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="comment">// TCanvas *ctest=new TCanvas(&quot;ctest&quot;,&quot;ctest&quot;,880,800);</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;    <span class="comment">// ctest-&gt;Divide(1,5);</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    <span class="comment">// TGraph *gtest[5];</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;    <span class="comment">// for (int i=0;i&lt;5;i++) {</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="comment">//   ctest-&gt;cd(i+1);</span></div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">//   gtest[i]=new TGraph(NFOUR,time_long,timedomain_output[i]);</span></div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">//   gtest[i]-&gt;Draw(&quot;al&quot;);</span></div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// }</span></div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    <span class="comment">// stemp = string(outputdir.Data())+&quot;/test.eps&quot;;</span></div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="comment">// ctest-&gt;Print((TString)stemp);</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    </div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      </div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      bwslice_vrms[j]=sqrt(bwslice_vrms[j]); <span class="comment">// this is the rms input voltage</span></div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    }</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    </div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    </div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      bwslice_enoise[j]=hnoise[j]-&gt;GetMean()/1.E15; <span class="comment">// mean diode output with no correlations</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      </div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      bwslice_fwhmnoise[j]=Tools::GetFWHM(hnoise[j]);</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      </div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;    }</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;    </div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {<span class="comment">// now we need to get the rms</span></div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      GetNoiseWaveforms();</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    </div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;    myconvlv(timedomainnoise_rfcm_banding[0][j],NFOUR,fdiode_real[j],mindiodeconvl[j],onediodeconvl[j],power_noise_eachband[j],timedomain_output[j]);</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    </div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {    </div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;      bwslice_rmsdiode[0][j]+=(timedomain_output[j][m]-bwslice_meandiode[j])*(timedomain_output[j][m]-bwslice_meandiode[j])/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    }</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;      </div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      }</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    }</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    </div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      bwslice_rmsdiode[0][j]=bwslice_rmsdiode[1][j]=sqrt(bwslice_rmsdiode[0][j]);</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;mean, rms are &quot;</span> &lt;&lt; bwslice_meandiode[j] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; bwslice_rmsdiode[0][j] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    }</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  </div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="keywordtype">double</span> thresh_begin=-1.;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="keywordtype">double</span> thresh_end=-11.;</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="keywordtype">double</span> thresh_step=1.;</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  </div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keywordtype">double</span> rate[5][100];</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">double</span> testthresh=thresh_begin;testthresh&gt;=thresh_end;testthresh-=thresh_step) {</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    passes[j]=0;</div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;      }</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    </div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    GetNoiseWaveforms();</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;      myconvlv(timedomainnoise_rfcm_banding[0][j],NFOUR,fdiode_real[j],mindiodeconvl[j],onediodeconvl[j],power_noise_eachband[j],timedomain_output[j]);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    </div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        </div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <span class="keywordflow">if</span> (timedomain_output[j][m+1]&lt;bwslice_rmsdiode[0][j]*testthresh) {</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;          passes[j]++;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;          m+=(int)(DEADTIME/TIMESTEP);</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        }</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                </div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      } <span class="comment">// end loop over samples where diode function is fully contained</span></div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    }</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;      }</div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;      <span class="comment">// brian m.</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordtype">int</span> ibin=(int)fabs((testthresh-thresh_begin)/thresh_step);</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="comment">// relthresh[j][ibin]=fabs(testthresh);</span></div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    rate[j][ibin]=passes[j]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2*(TIMESTEP)-maxt_diode));</div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="keywordflow">if</span> (rate[j][ibin]!=0)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      rate[j][ibin]=log10(rate[j][ibin]);</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Threshold &quot; &lt;&lt; testthresh &lt;&lt; &quot; For the &quot; &lt;&lt; j &lt;&lt; &quot;th band, rate is &quot; &lt;&lt; rate[j][ibin] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;      }</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    }</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    </div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;  } <span class="keywordflow">else</span> { <span class="comment">// IF WE HAVE NOISE FROM FLIGHT</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    </div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    <span class="keywordtype">double</span> quickNoise[HALFNFOUR];</div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;    memset(bwslice_diodemean_fullband_allchan,  0, <span class="keyword">sizeof</span>(bwslice_diodemean_fullband_allchan)  );</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    memset(bwslice_dioderms_fullband_allchan,   0, <span class="keyword">sizeof</span>(bwslice_dioderms_fullband_allchan)   );</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;</div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keyword">static</span> <span class="keywordtype">double</span> tempdiodeoutput[1000][NFOUR];</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9) { <span class="comment">// ANITA-3</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;48; iant++){</div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;      <span class="comment">// This takes for ages, and may appear to hang... some basic flushing to show user the status, esp for A4</span></div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;Using noise from flight to get rms of channel &quot;</span> &lt;&lt; (ipol == 0 ? iant : 48+iant) + 1 &lt;&lt; <span class="stringliteral">&quot; of 96\r&quot;</span> &lt;&lt; std::flush;</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      <span class="keywordflow">if</span>((ipol == 0 ? iant : 48+iant) + 1 == 96){std::cout &lt;&lt; std::endl;}</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;    </div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ituff=0; ituff&lt;ntuffs; ituff++){</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;        memset(tempdiodeoutput, 0, <span class="keyword">sizeof</span>(tempdiodeoutput) );</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      </div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;          getQuickTrigNoiseFromFlight(settings1, quickNoise, ipol, iant, ituff);</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      </div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;          myconvlv(quickNoise,NFOUR,fdiode_real[4],mindiodeconvl[4],onediodeconvl[4],power_noise_eachband[4],tempdiodeoutput[i]);</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;          <span class="comment">// First calculate the mean</span></div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;        bwslice_diodemean_fullband_allchan[ipol][iant][ituff]+=tempdiodeoutput[i][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;        <span class="comment">//    cout &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt; timedomain_output[j][m] &lt;&lt; &quot; &quot; &lt;&lt; ((double)ngeneratedevents*((double)NFOUR/2-maxt_diode/TIMESTEP)) &lt;&lt; endl;</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;      </div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;          }</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;        }</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="comment">// Then get the RMS</span></div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      </div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;        bwslice_dioderms_fullband_allchan[ipol][iant][ituff]+=(tempdiodeoutput[i][m]-bwslice_diodemean_fullband_allchan[ipol][iant][ituff])*(tempdiodeoutput[i][m]-bwslice_diodemean_fullband_allchan[ipol][iant][ituff])/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;          }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;        }</div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    </div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;        bwslice_dioderms_fullband_allchan[ipol][iant][ituff]=sqrt(bwslice_dioderms_fullband_allchan[ipol][iant][ituff]);</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        <span class="comment">//    cout &lt;&lt; &quot;EACH CHAN MEAN, RMS &quot; &lt;&lt;  ipol &lt;&lt; &quot; &quot; &lt;&lt; iant &lt;&lt; &quot; &quot; &lt;&lt; ituff &lt;&lt; &quot; &quot; &lt;&lt; bwslice_diodemean_fullband_allchan[ipol][iant][ituff] &lt;&lt; &quot; , &quot; &lt;&lt; bwslice_dioderms_fullband_allchan[ipol][iant][ituff] &lt;&lt; endl;  </span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    </div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;      }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    }</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;        </div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;      }</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==10){ <span class="comment">// ANITA-4</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;      <span class="keywordtype">double</span> quickNoise2[2][HALFNFOUR];</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      <span class="keywordtype">double</span> lcprcpNoise[2][HALFNFOUR];</div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      </div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="keyword">static</span> <span class="keywordtype">double</span> tempdiodeoutput2[1000][NFOUR];</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;      </div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;48; iant++){</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">// This takes for ages, and may appear to hang... some basic flushing to show user the status, esp for A4</span></div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Using noise from flight to get rms of channel pair &quot;</span> &lt;&lt; iant + 1 &lt;&lt; <span class="stringliteral">&quot; of 48\r&quot;</span> &lt;&lt; std::flush;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="keywordflow">if</span>( iant + 1 == 48 ){std::cout &lt;&lt; std::endl;}</div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    </div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ituff=0; ituff&lt;ntuffs; ituff++){</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      memset(tempdiodeoutput, 0, <span class="keyword">sizeof</span>(tempdiodeoutput) );</div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      memset(tempdiodeoutput2, 0, <span class="keyword">sizeof</span>(tempdiodeoutput2) );</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;      </div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;          getQuickTrigNoiseFromFlight(settings1, quickNoise2[ipol], ipol, iant, ituff);</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;        }</div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;        </div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;        <a class="code" href="../../d4/da0/namespace_tools.html#a37243f7802df0a924c0551b680594bd0">Tools::ConvertHVtoLRTimedomain</a>(NFOUR, quickNoise2[0], quickNoise2[1], lcprcpNoise[0], lcprcpNoise[1]);</div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        myconvlv(lcprcpNoise[0],NFOUR,fdiode_real[4],mindiodeconvl[4],onediodeconvl[4],power_noise_eachband[4],tempdiodeoutput[i]);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;        myconvlv(lcprcpNoise[1],NFOUR,fdiode_real[4],mindiodeconvl[4],onediodeconvl[4],power_noise_eachband[4],tempdiodeoutput2[i]);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        <span class="comment">// First calculate the mean</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;          bwslice_diodemean_fullband_allchan[0][iant][ituff]+=tempdiodeoutput[i][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;          bwslice_diodemean_fullband_allchan[1][iant][ituff]+=tempdiodeoutput2[i][m]/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;          <span class="comment">//      cout &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt; timedomain_output[j][m] &lt;&lt; &quot; &quot; &lt;&lt; ((double)ngeneratedevents*((double)NFOUR/2-maxt_diode/TIMESTEP)) &lt;&lt; endl;</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;          </div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        }</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        </div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;      }</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;      </div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;      <span class="comment">// Then get the RMS</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ngeneratedevents;i++) {</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        </div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> m=(<span class="keywordtype">int</span>)(maxt_diode/TIMESTEP);m&lt;NFOUR/2;m++) {</div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;          bwslice_dioderms_fullband_allchan[0][iant][ituff]+=(tempdiodeoutput[i][m]-bwslice_diodemean_fullband_allchan[0][iant][ituff])*(tempdiodeoutput[i][m]-bwslice_diodemean_fullband_allchan[0][iant][ituff])/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;          bwslice_dioderms_fullband_allchan[1][iant][ituff]+=(tempdiodeoutput2[i][m]-bwslice_diodemean_fullband_allchan[1][iant][ituff])*(tempdiodeoutput2[i][m]-bwslice_diodemean_fullband_allchan[1][iant][ituff])/((double)ngeneratedevents*((<span class="keywordtype">double</span>)NFOUR/2-maxt_diode/TIMESTEP));</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        }</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        </div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;      }</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      </div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      bwslice_dioderms_fullband_allchan[0][iant][ituff]=sqrt(bwslice_dioderms_fullband_allchan[0][iant][ituff]);</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;      bwslice_dioderms_fullband_allchan[1][iant][ituff]=sqrt(bwslice_dioderms_fullband_allchan[1][iant][ituff]);</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="comment">//      cout &lt;&lt; &quot;EACH CHAN MEAN, RMS &quot; &lt;&lt;  ipol &lt;&lt; &quot; &quot; &lt;&lt; iant &lt;&lt; &quot; &quot; &lt;&lt; ituff &lt;&lt; &quot; &quot; &lt;&lt; bwslice_diodemean_fullband_allchan[ipol][iant][ituff] &lt;&lt; &quot; , &quot; &lt;&lt; bwslice_dioderms_fullband_allchan[ipol][iant][ituff] &lt;&lt; endl;  </span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      </div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    }</div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      }</div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      </div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    }</div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;  </div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;  </div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;  </div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;   </div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="preprocessor">#endif </span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;  }</div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    </div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  TF1 *frice[5];</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;    </div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;  <span class="keywordtype">int</span> jplot;</div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;  TCanvas *c4=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;c4&quot;</span>,<span class="stringliteral">&quot;c4&quot;</span>,880,800);</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;  c4-&gt;Divide(1,5);</div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    </div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    </div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;cd to &quot; &lt;&lt; j+1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    frice[j]=<span class="keyword">new</span> TF1(<span class="stringliteral">&quot;frice&quot;</span>,<span class="stringliteral">&quot;[2]*(-1.*x-[1])/[0]^2*exp(-1.*(-1.*x-[1])^2/2/[0]^2)&quot;</span>,-50.,50.);</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    frice[j]-&gt;SetParameter(0,4.);</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">//    frice[j]-&gt;SetParameter(1,-5.);</span></div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    frice[j]-&gt;SetParameter(1,5.);</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    frice[j]-&gt;SetParameter(2,400.);</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    <span class="comment">//frice[j]-&gt;SetParameter(2,frice[j]-&gt;GetParameter(2)*hnoise[j]-&gt;GetEntries()/frice[j]-&gt;Integral(-500.,500.));</span></div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    jplot=j;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="comment">//    if (BANDING==2 &amp;&amp; j==4)</span></div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;    <span class="comment">//jplot=j-1;</span></div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;    </div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;    <span class="keywordflow">if</span> ((BANDING==2 &amp;&amp; j!=3) ||</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">//  (BANDING!=2 &amp;&amp; j!=4)) {</span></div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    (BANDING!=2 &amp;&amp; BANDING!=4) ||</div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    ((BANDING==4||BANDING==5) &amp;&amp; j==4) ){</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      c4-&gt;cd(jplot+1);</div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        </div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;      <span class="keywordflow">if</span> (j==0 &amp;&amp; BANDING==2)</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,1.);</div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;      <span class="keywordflow">if</span> (j==1 &amp;&amp; BANDING==2)</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,2.);</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="keywordflow">if</span> (j==2 &amp;&amp; BANDING==2)</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,10.);</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;      <span class="keywordflow">if</span> (j==4 &amp;&amp; (BANDING==2 || BANDING==4 || BANDING==5))</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-15.,15.);</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        </div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;      <span class="keywordflow">if</span> (j==0 &amp;&amp; BANDING==0)</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,5.);</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;      <span class="keywordflow">if</span> (j==1 &amp;&amp; BANDING==0)</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,5.);</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      <span class="keywordflow">if</span> (j==2 &amp;&amp; BANDING==0)</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,15.);</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">if</span> (j==3 &amp;&amp; BANDING==0)</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    hnoise[j]-&gt;Fit(frice[j],<span class="stringliteral">&quot;Q&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,-20.,20.);</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        </div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;      frice[j]-&gt;GetHistogram()-&gt;SetLineWidth(3);</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;        </div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;      hnoise[j]-&gt;SetLineWidth(3);</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;      hnoise[j]-&gt;SetXTitle(<span class="stringliteral">&quot;Diode Output (10^{-15} Joules)&quot;</span>);</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;      hnoise[j]-&gt;SetYTitle(<span class="stringliteral">&quot;Number of Noise Waveforms&quot;</span>);</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;      hnoise[j]-&gt;SetTitleSize(0.05,<span class="stringliteral">&quot;X&quot;</span>);</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;      hnoise[j]-&gt;SetTitleSize(0.05,<span class="stringliteral">&quot;Y&quot;</span>);</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        </div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;      hnoise[j]-&gt;Draw();</div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;      frice[j]-&gt;Draw(<span class="stringliteral">&quot;same&quot;</span>);</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;bwslice_enoise is &quot; &lt;&lt; bwslice_enoise[j] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    }</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    </div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;  }</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;  stemp=string(outputdir.Data())+<span class="stringliteral">&quot;/hnoise.eps&quot;</span>;</div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;  c4-&gt;Print((TString)stemp);</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;</div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;  </div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;  </div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;}</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="keywordtype">void</span> Anita::getQuickTrigNoiseFromFlight(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1, <span class="keywordtype">double</span> justNoise[HALFNFOUR], <span class="keywordtype">int</span> ipol, <span class="keywordtype">int</span> iant, <span class="keywordtype">int</span> ituff){</div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;</div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;  <a class="code" href="../../d3/d11/class_f_f_t_w_complex.html">FFTWComplex</a> *phasorsTrig = <span class="keyword">new</span> <a class="code" href="../../d3/d11/class_f_f_t_w_complex.html">FFTWComplex</a>[numFreqs];</div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;  phasorsTrig[0].setMagPhase(0,0);</div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;  Double_t sigma, realPart, imPart, norm;</div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;  <span class="keywordtype">int</span> iring=2;</div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;  <span class="keywordflow">if</span> (iant&lt;16) iring=0;</div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iant&lt;32) iring=1;</div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;</div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;  <span class="keywordtype">int</span> iphi = iant - (iring*16);</div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;</div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;  TRandom * fRand  = getRNG(RNG_NOISE); </div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=1;i&lt;numFreqs;i++) {</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    </div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordflow">if</span> (freqs[i]*1e6&gt;=settings1-&gt;FREQ_LOW_SEAVEYS &amp;&amp; freqs[i]*1e6&lt;=settings1-&gt;FREQ_HIGH_SEAVEYS){</div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    norm           = fRatioTriggerToA3DigitizerFreqDomain[ipol][iring][iphi][ituff][i];</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    sigma          = RayleighFits[ipol][iant]-&gt;Eval(freqs[i])*4./TMath::Sqrt(numFreqs);</div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    sigma*=norm;</div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    realPart       = fRand-&gt;Gaus(0,sigma);</div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    imPart         = fRand-&gt;Gaus(0,sigma);</div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    }<span class="keywordflow">else</span> {</div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;      imPart=realPart=0;</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot; &quot; &lt;&lt; i &lt;&lt; &quot; &quot; &lt;&lt; trig &lt;&lt; &quot; &quot; &lt;&lt; dig &lt;&lt; &quot; &quot; &lt;&lt; trig/dig &lt;&lt; &quot; &quot; &lt;&lt; norm &lt;&lt; endl;</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    phasorsTrig[i] = <a class="code" href="../../d3/d11/class_f_f_t_w_complex.html">FFTWComplex</a>(realPart, imPart);</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;  }</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;  <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a> *rfNoiseTrig   = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(numFreqs,freqs,phasorsTrig,1);  </div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;  Double_t *justNoiseTemp = rfNoiseTrig-&gt;GetY();</div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;  </div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;HALFNFOUR; i++){</div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    justNoise[i]  = justNoiseTemp[i]*THERMALNOISE_FACTOR;</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;  }</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;  <span class="keyword">delete</span> rfNoiseTrig;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;  <span class="keyword">delete</span>[] phasorsTrig;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;  </div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;}</div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keywordtype">void</span> Anita::getPulserData(){</div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;      </div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;  TFile *fpulser=<span class="keyword">new</span> TFile((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/pulser.root&quot;</span>).c_str());</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    </div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;  TGraph *gpulser=(TGraph*)fpulser-&gt;Get(<span class="stringliteral">&quot;pulser&quot;</span>);</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;  TGraph *gphases=(TGraph*)fpulser-&gt;Get(<span class="stringliteral">&quot;phases&quot;</span>);</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;  TGraph *gnoise=(TGraph*)fpulser-&gt;Get(<span class="stringliteral">&quot;noise&quot;</span>);</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    </div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;  USEPHASES=1;</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;  </div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;  <span class="keywordtype">double</span> *temp1=gpulser-&gt;GetX();</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/4;i++) {</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    f_pulser[i]=temp1[i];</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;  }</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;  <span class="keywordtype">double</span> *temp2=gphases-&gt;GetX();</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/4;i++) {</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    f_phases[i]=temp2[i];</div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  }</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;  <span class="keywordtype">double</span> *temp3=gpulser-&gt;GetY();</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;  <span class="keywordtype">double</span> *temp4=gnoise-&gt;GetY();</div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    </div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;    </div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/4;i++) {</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    v_pulser[i]=sqrt(temp3[i]); <span class="comment">// is this right</span></div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;    v_noise[i]=sqrt(temp4[i]);</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;    <span class="keywordflow">if</span> (f_phases[i]&lt;75.E6)</div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      v_noise[i]=0.;</div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;        </div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;  }</div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    </div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;  TGraph *gpulser_eachband;</div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;  TGraph *gnoise_eachband;</div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;  TCanvas *cpulser=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cpulser&quot;</span>,<span class="stringliteral">&quot;cpulser&quot;</span>,880,800);</div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;  cpulser-&gt;Divide(1,5);</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;  <span class="keywordtype">int</span> iplot;</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    iplot=i;</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            </div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <span class="keywordflow">if</span> (i!=3) {</div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;      cpulser-&gt;cd(iplot+1);</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                </div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;      gpulser_eachband=<span class="keyword">new</span> TGraph(NFOUR/4,f_pulser,v_pulser);</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;                </div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      gpulser_eachband-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;  }</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;        </div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;  cpulser-&gt;Print(<span class="stringliteral">&quot;pulser.eps&quot;</span>);</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        </div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;  TCanvas *cnoise=<span class="keyword">new</span> TCanvas(<span class="stringliteral">&quot;cnoise&quot;</span>,<span class="stringliteral">&quot;cnoise&quot;</span>,880,800);</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;  cnoise-&gt;Divide(1,5);</div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    iplot=i;</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            </div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;    <span class="keywordflow">if</span> (i!=3) {</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;      cnoise-&gt;cd(iplot+1);</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;      gnoise_eachband=<span class="keyword">new</span> TGraph(NFOUR/4,f_pulser,v_noise);</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                </div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;      gnoise_eachband-&gt;Draw(<span class="stringliteral">&quot;al&quot;</span>);</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    }</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;  }</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        </div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;  cnoise-&gt;Print(<span class="stringliteral">&quot;noise.eps&quot;</span>);</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;           </div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        </div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;  <span class="comment">//    gpulser_eachband=new TGraph(NFOUR/4,f_pulser,v_pulser[iplot]);</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;  <span class="comment">//gpulser_eachband-&gt;Draw(&quot;al&quot;);</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        </div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        </div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        </div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;  <span class="keywordtype">double</span> sumpulserpower=0.;</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;  <span class="keywordtype">double</span> sumnoisepower=0.;</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;        </div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/4;i++) {</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;    sumpulserpower+=v_pulser[i]*v_pulser[i];</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    sumnoisepower+=v_noise[i]*v_noise[i];</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;  }</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        </div><div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;  <span class="keywordtype">double</span> *temp5=gphases-&gt;GetY();</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/4;i++) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;    v_phases[i]=temp5[i];</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  }</div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        </div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  gpulser-&gt;Delete();</div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  gphases-&gt;Delete();</div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;  gnoise-&gt;Delete();</div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        </div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;  fpulser-&gt;Close();</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;}</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;</div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;</div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;</div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;</div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;<span class="keywordtype">void</span> Anita::ReadGains(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;  <span class="comment">// gains from university of hawaii measurements.</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;  <span class="keywordtype">double</span> sfrequency;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;  <span class="keywordtype">int</span> iii;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;  ifstream gainsfile;</div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;  gainsfile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/hh_0&quot;</span>).c_str()); <span class="comment">// gains for horizontal polarization</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;  <span class="keywordflow">if</span>(gainsfile.fail()) {</div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/hh_0\n&quot;</span>;</div><div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    exit(1);</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;  }</div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;  <span class="keywordflow">for</span>(iii = 0; iii &lt; NPOINTS_GAIN; iii++)</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    gainsfile &gt;&gt; frequency_forgain_measured[iii] &gt;&gt; gainh_measured[iii];</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;  gainsfile.close();</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    </div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  gainsfile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/vv_0&quot;</span>).c_str()); <span class="comment">// gains for vertical polarization</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="keywordflow">if</span>(gainsfile.fail()) {</div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/vv_0\n&quot;</span>;</div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    exit(1);</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;  }</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keywordflow">for</span>(iii = 0; iii &lt; NPOINTS_GAIN; iii++) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    gainsfile &gt;&gt; sfrequency &gt;&gt; gainv_measured[iii];</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii])</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;warning: sfrequency = &quot;</span> &lt;&lt; sfrequency &lt;&lt; <span class="stringliteral">&quot;, frequency_forgain_measured[iii] = &quot;</span> &lt;&lt; frequency_forgain_measured[iii] &lt;&lt; endl;</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;  }</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  gainsfile.close();</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    </div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;  gainsfile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/hv_0&quot;</span>).c_str()); <span class="comment">// gains for h--&gt;v cross polarization</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;  <span class="keywordflow">if</span>(gainsfile.fail()) {</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/hv_0\n&quot;</span>;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    exit(1);</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;  }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">for</span>(iii = 0; iii &lt; NPOINTS_GAIN; iii++) {</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;    gainsfile &gt;&gt; sfrequency &gt;&gt; gainhv_measured[iii];</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii])</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;warning: sfrequency = &quot;</span> &lt;&lt; sfrequency &lt;&lt; <span class="stringliteral">&quot;, frequency_forgain_measured[iii] = &quot;</span> &lt;&lt; frequency_forgain_measured[iii] &lt;&lt; endl;</div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;  }</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;  gainsfile.close();</div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    </div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;  gainsfile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/vh_0&quot;</span>).c_str()); <span class="comment">// gains for v--&gt;h cross polarization</span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;  <span class="keywordflow">if</span>(gainsfile.fail()) {</div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/vh_0\n&quot;</span>;</div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    exit(1);</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;  }</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;  <span class="keywordflow">for</span>(iii = 0; iii &lt; NPOINTS_GAIN; iii++) {</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    gainsfile &gt;&gt; sfrequency &gt;&gt; gainvh_measured[iii];</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii])</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;warning: sfrequency = &quot;</span> &lt;&lt; sfrequency &lt;&lt; <span class="stringliteral">&quot;, frequency_forgain_measured[iii] = &quot;</span> &lt;&lt; frequency_forgain_measured[iii] &lt;&lt; endl;</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  }</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;  gainsfile.close();</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;} <span class="comment">//ReadGains</span></div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="keywordtype">void</span> Anita::AntennaGain(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,<span class="keywordtype">double</span> hitangle_e,<span class="keywordtype">double</span> hitangle_h,<span class="keywordtype">double</span> e_component,<span class="keywordtype">double</span> h_component,<span class="keywordtype">int</span> k,<span class="keywordtype">double</span> &amp;vsignalarray_e,<span class="keywordtype">double</span> &amp;vsignalarray_h) {</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    </div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;  <span class="keywordflow">if</span> (freq[k]&gt;=settings1-&gt;FREQ_LOW_SEAVEYS &amp;&amp; freq[k]&lt;=settings1-&gt;FREQ_HIGH_SEAVEYS) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        </div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordtype">double</span> relativegains[4]; <span class="comment">// fill this for each frequency bin for each antenna.  It&#39;s the gain of the antenna given the angle that the signal hits the balloon, for vv, vh, hv, hh, relative to the gain at boresight</span></div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;        </div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pols=0;pols&lt;2;pols++) {<span class="comment">// loop over vv, hv</span></div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      <span class="keywordflow">if</span> (fabs(hitangle_e)&lt;PI/2)</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    relativegains[pols]=Get_gain_angle(pols,k,hitangle_e);<span class="comment">//change here to be constant if need be (ABBY).  Add a setting to the code for use constant gain or dish or something.  Make this a member function.</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;    relativegains[pols]=0.;</div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;      <span class="comment">//if (fabs(hitangle_e)&lt;PI/12)</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;relative gains is &quot; &lt;&lt; relativegains[pols] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;    }</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        </div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        </div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="comment">//      if (fabs(hitangle_e)&lt;PI/12)</span></div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;vsignalarray_e before is &quot; &lt;&lt; vsignalarray_e &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;    </div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    vsignalarray_e = settings1-&gt;IGNORE_CROSSPOL ?  0.5*vsignalarray_e * vvGaintoHeight[k] * e_component * sqrt(relativegains[0]) </div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;                     : vsignalarray_e * 0.5 * sqrt(vvGaintoHeight[k] * vvGaintoHeight[k] * e_component * e_component * relativegains[0] + hvGaintoHeight[k] * hvGaintoHeight[k] * h_component * h_component * relativegains[1]); <span class="comment">// 0.5 is for voltage dividing</span></div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        </div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;In AntennaGain, vsignalarray_e is &quot; &lt;&lt; vsignalarray_e &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        </div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="comment">//if (fabs(hitangle_e)&lt;PI/12)</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;vsignalarray_e after is &quot; &lt;&lt; vsignalarray_e &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        </div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> pols=2;pols&lt;4;pols++) { <span class="comment">// loop over hh, vh</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;      <span class="keywordflow">if</span> (fabs(hitangle_h)&lt;PI/2)</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    relativegains[pols]=Get_gain_angle(pols,k,hitangle_h);</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;      <span class="keywordflow">else</span></div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    relativegains[pols]=0.;</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        </div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    <span class="comment">// V/MHz</span></div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;        </div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">//if (fabs(hitangle_h)&lt;PI/12)</span></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;vsignalarray_h before is &quot; &lt;&lt; vsignalarray_h &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        </div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    vsignalarray_h= settings1-&gt;IGNORE_CROSSPOL ?  vsignalarray_h * 0.5 * hhGaintoHeight[k] * h_component * sqrt(relativegains[2]) </div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                   : vsignalarray_h*0.5* sqrt(hhGaintoHeight[k]*hhGaintoHeight[k]*h_component*h_component*relativegains[2] + vhGaintoHeight[k]*vhGaintoHeight[k]*e_component*e_component*relativegains[3]);</div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;</div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <span class="comment">// the assumption is that the sign is set by the dominant component... the crosspol might actually be destructive :( </span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;POL_SIGN_HACK &amp;&amp; !settings1-&gt;IGNORE_CROSSPOL)</div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    {</div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;      <span class="keywordflow">if</span> (e_component &lt; 0) vsignalarray_e *=-1; </div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;      <span class="keywordflow">if</span> (h_component &lt; 0) vsignalarray_h *=-1; </div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;    }</div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        </div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;    <span class="comment">//      if (fabs(hitangle_h)&lt;PI/12)</span></div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;vsignalarray_h after is &quot; &lt;&lt; vsignalarray_h &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        </div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;  }</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;}</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment">// The deck affects signals reaching the upper ring. These equations are for Fresnel diffraction around a half plane. The edge of the half plane passes just over and in front of the lower ring antenna that&#39;s facing the radio pulse. This assumption should be okay for the three upper ring antenns in the phi sector facing the pulse and should underestimate the effect of diffraction for the other upper ring antennas.</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">// This only corrects for signal strength, not for changes in polarization and signal direction.</span></div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">// page and figure references are from Principles of Optics, by Born &amp; Wolf, 7th edition</span></div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="keywordtype">void</span> Anita::SetDiffraction() {</div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> cc = 299792458.0;</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> height[2] = {3.21571, 2.25625}; <span class="comment">// height of the phase centers of antennas 1 and 9 above the deck</span></div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> radius[2] = {1.40185, 1.5677}; <span class="comment">// radius of the deck minus how far the phase centers of antennas 1 and 9 are from the payload&#39;s axis.</span></div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> ntau = 200;</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;  <span class="keywordtype">double</span> ww, xx, ss, theta, sintheta, squigglyC, squigglyS, tau, dtau;</div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jj = 0; jj &lt; 2; jj++) <span class="comment">// loop through antenna layers</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> kk = 0; kk &lt; 89; kk++) { <span class="comment">// loop through pulse directions</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;      sintheta = 0.37 + 0.005*double(kk);</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;      theta = asin(sintheta); <span class="comment">// angle between the direction from the center of the Earth to the payload and the direction of the pulse. This should be delta in figure 8.38</span></div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;      ss = height[jj]/cos(theta); <span class="comment">// page 382 fig 8.5 . This should be the distance between the phase center and wherever the pulse passes the deck.</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;      xx = height[jj]*tan(theta)-radius[jj]; <span class="comment">// page 429 fig 8.38</span></div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ll = 0; ll &lt; NFREQ; ll++) { <span class="comment">// loop through frequencies</span></div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;    ww = sqrt(2./cc*freq[ll]/ss)*xx*sintheta; <span class="comment">// page 433 eq 23</span></div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    dtau = ww/double(ntau);</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    squigglyS = 0.0;</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    squigglyC = 0.0;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ii = 0; ii &lt; ntau; ii++) { <span class="comment">// page 430 eq 12</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;      tau = dtau*(double(ii)+0.5);</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;      squigglyC += cos(M_PI*0.5*tau*tau);</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;      squigglyS += sin(M_PI*0.5*tau*tau);</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    squigglyC *= dtau;</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    squigglyS *= dtau;</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    diffraction[jj][kk][ll] = sqrt(0.5*((0.5+squigglyC)*(0.5+squigglyC)+(0.5+squigglyS)*(0.5+squigglyS))); <span class="comment">// page 434 eq 28</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    <span class="keywordflow">if</span>(jj == 0 &amp;&amp; kk &gt; 66) diffraction[jj][kk][ll] = 1.0; <span class="comment">// in the top layer, diffraction[][][] has values greater than 1 in the low frequencies for sintheta &gt; 0.73</span></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;      }</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    }</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;} <span class="comment">// void SetDiffraction()</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;</div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="keywordtype">double</span> Anita::GetDiffraction(<span class="keywordtype">int</span> ilayer, <span class="keywordtype">double</span> zenith_angle, <span class="keywordtype">int</span> ifreq) {</div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;  <span class="keywordtype">double</span> reference1 = (sin(zenith_angle)-0.37)*200.0;</div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;  <span class="keywordtype">int</span> whichbin = int(reference1);</div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;  <span class="keywordtype">double</span> factor = reference1 - double(whichbin);</div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;  <span class="keywordflow">return</span> factor*diffraction[ilayer][whichbin+1][ifreq] + (1.-factor)*diffraction[ilayer][whichbin][ifreq];</div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;}</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;<span class="keywordtype">int</span> Anita::SurfChanneltoBand(<span class="keywordtype">int</span> ichan) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    </div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;  <span class="comment">// takes surf channel (0-31) and finds what band it is</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;  <span class="keywordflow">if</span> (ichan&lt;0 || ichan&gt;31) {</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;surf channel out of range!\n&quot;</span>;</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    exit(1);</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;  }</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    </div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;  <span class="keywordtype">int</span> iband= (ichan%8-ichan%2)/2;</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    </div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    </div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;  <span class="keywordflow">return</span> iband;</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    </div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;}</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;<span class="comment">//  int Anita::GetScalarNumber(int lr,int ibw, int ilayer,int ifold) {</span></div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;<span class="comment">//   int rx = GetAntennaNumber(ilayer,ifold);</span></div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;<span class="comment">//   int rx_on_surf = (rx-1)%4 + 1; // surf holds four antennas.  This number is 1-4.</span></div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;<span class="comment">//   int scalar= (rx_on_surf-1)*8 + ibw*2 + lr;</span></div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;<span class="comment">//   // returns the scalar number</span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;<span class="comment">//   return scalar;</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;<span class="comment">// }</span></div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;<span class="keywordtype">int</span> Anita::GetAntennaNumber(<span class="keywordtype">int</span> ilayer,<span class="keywordtype">int</span> ifold) {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    </div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;  <span class="keywordflow">return</span> 8*(ilayer)+ifold+1; <span class="comment">// antenna number 1-32</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;    </div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;}</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;<span class="keywordtype">int</span> Anita::GetLayer(<span class="keywordtype">int</span> rx) {</div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;  <span class="keywordflow">if</span> (rx&gt;=0 &amp;&amp; rx&lt;8)</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rx&gt;=8 &amp;&amp; rx&lt;16)</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rx&gt;=16 &amp;&amp; rx&lt;32)</div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <span class="keywordflow">return</span> 2;</div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    </div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;}</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="keywordtype">int</span> Anita::GetIfold(<span class="keywordtype">int</span> rx) {</div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;  <span class="keywordflow">if</span> (rx&gt;=0 &amp;&amp; rx&lt;16)</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <span class="keywordflow">return</span> rx%8;</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rx&lt;32)</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    <span class="keywordflow">return</span> rx%16;</div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    </div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;}</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;<span class="keywordtype">int</span> Anita::AntennaWaveformtoSurf(<span class="keywordtype">int</span> ilayer,<span class="keywordtype">int</span> ifold) {</div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    </div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;  <span class="keywordtype">int</span> antenna=GetAntennaNumber(ilayer,ifold); <span class="comment">// antenna number 1-32</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;    </div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;  <span class="keywordflow">return</span> antennatosurf[antenna-1]; <span class="comment">// returns the surf number</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    </div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;}</div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="keywordtype">int</span> Anita::AntennaNumbertoSurfNumber(<span class="keywordtype">int</span> ilayer,<span class="keywordtype">int</span> ifold) {</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;  <span class="keywordtype">int</span> antenna=GetAntennaNumber(ilayer,ifold); <span class="comment">// antenna number 1-32</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    </div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;  <span class="keywordflow">return</span> (antenna-1-(antenna-1)%4)/4+1; <span class="comment">// returns the surf number 1-9</span></div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;    </div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    </div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;}</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="keywordtype">int</span> Anita::GetSurfChannel(<span class="keywordtype">int</span> antenna,<span class="keywordtype">int</span> ibw,<span class="keywordtype">int</span> ipol) { <span class="comment">// 1 to 32</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;    </div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;  <span class="keywordflow">return</span> ((antenna-1)%4)*8+WhichBand(ibw,ipol);<span class="comment">//which scalar channel, numbered 1 to 32</span></div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    </div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;}</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;<span class="keywordtype">int</span> Anita::WhichBand(<span class="keywordtype">int</span> ibw,<span class="keywordtype">int</span> ipol) {</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    </div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;  <span class="keywordflow">return</span> 2*ibw+ipol+1; <span class="comment">// from 1 to 8, which scalar channel on an antenna this band corresponds to, in order as they are on the surfs</span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;}</div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="keywordtype">void</span> Anita::Banding(<span class="keywordtype">int</span> j,<span class="keywordtype">double</span> *freq_noise,<span class="keywordtype">double</span> *vmmhz,<span class="keywordtype">int</span> NPOINTS_NOISE) {</div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    </div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;  <span class="keywordflow">if</span> (j&lt;0 || j&gt;4) {</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Band out of range.\n&quot;</span>;</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    exit(1);</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;  }</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;  <span class="keywordflow">if</span> (BANDING!=1) {</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;    <span class="keywordtype">int</span> iband; <span class="comment">// which index of freq_bands</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NPOINTS_NOISE;i++) {</div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            </div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;      iband=Tools::findIndex(freq_bands[j],freq_noise[i],NPOINTS_BANDS,freq_bands[j][0],freq_bands[j][NPOINTS_BANDS-1]);</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;      <span class="comment">//      cout &lt;&lt; &quot;freq_bands, freq_noise, NPOINTS_BANDS, freq_bands are &quot; &lt;&lt; freq_noise[i] &lt;&lt; &quot; &quot; &lt;&lt; NPOINTS_BANDS &lt;&lt; &quot; &quot; &lt;&lt; freq_bands[j][0] &lt;&lt; &quot; &quot; &lt;&lt; iband &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;      vmmhz[i]=vmmhz[i]*sqrt(bandsattn[j][iband]); <span class="comment">// sqrt since it&#39;s voltage and not power</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            </div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            </div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;    }</div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;  }</div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (BANDING==1) {</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        </div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NPOINTS_NOISE;i++) {</div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;      <span class="keywordflow">if</span> (freq_noise[i]&lt;bwslice_min[j] || freq_noise[i]&gt;bwslice_max[j])</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;    vmmhz[i]=0.;</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;    } <span class="comment">// loop over frequency bins</span></div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;        </div><div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;  } <span class="comment">// if it&#39;s choose-your-own banding</span></div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;}</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;<span class="keywordtype">void</span> Anita::RFCMs(<span class="keywordtype">int</span> ilayer,<span class="keywordtype">int</span> ifold,<span class="keywordtype">double</span> *vmmhz) {</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;    </div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;  <span class="keywordtype">int</span> irx=Anita::GetAntennaNumber(ilayer,ifold)-1; <span class="comment">// want this to be 0-31</span></div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    </div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;  <span class="keywordtype">int</span> iampl;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ;i++) {</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="comment">// first find the index of the amplification array</span></div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    iampl=Tools::findIndex(freq_ampl[irx],freq[i],NPOINTS_AMPL,freq_ampl[irx][0],freq_ampl[irx][NPOINTS_AMPL-1]);</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        </div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    vmmhz[i]=vmmhz[i]*sqrt(ampl_notdb[irx][iampl]);</div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        </div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;  }</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;    </div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;}</div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;</div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">// reads in the effect of a signal not hitting the antenna straight on</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">// also reads in gainxx_measured and sets xxgaintoheight</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="keywordtype">void</span> Anita::Set_gain_angle(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,<span class="keywordtype">double</span> nmedium_receiver) {</div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;  <span class="keywordtype">string</span> gain_null1, gain_null2;</div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;  <span class="keywordtype">double</span> sfrequency;</div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;  <span class="keywordtype">int</span> iii, jjj;</div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;  ifstream anglefile;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;  <span class="keywordflow">for</span>(jjj = 0; jjj &lt; 4; jjj++)</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <span class="keywordflow">for</span>(iii = 0; iii &lt; 131; iii++)</div><div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;      gain_angle[jjj][iii][0] = 1.;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    </div><div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;  anglefile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/vv_az&quot;</span>).c_str()); <span class="comment">// v polarization, a angle</span></div><div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;  <span class="keywordflow">if</span>(anglefile.fail()) {</div><div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/vv_az\n&quot;</span>;</div><div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;    exit(1);</div><div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;  }</div><div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;  <span class="keywordflow">for</span>(jjj = 1; jjj &lt; 7; jjj++)</div><div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="keywordflow">for</span>(iii = 0; iii &lt; 131; iii++) {</div><div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;      anglefile &gt;&gt; sfrequency &gt;&gt; gain_angle[0][iii][jjj];</div><div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;      <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii]) cout &lt;&lt; <span class="stringliteral">&quot;check frequencies for vv_az\n&quot;</span>;</div><div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;    }</div><div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;  anglefile.close();</div><div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    </div><div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    </div><div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    </div><div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;  anglefile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/hh_az&quot;</span>).c_str()); <span class="comment">// h polarization, a angle</span></div><div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;  <span class="keywordflow">if</span>(anglefile.fail()) {</div><div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/hh_az\n&quot;</span>;</div><div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    exit(1);</div><div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;  }</div><div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;  <span class="keywordflow">for</span>(jjj = 1; jjj &lt; 7; jjj++)</div><div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="keywordflow">for</span>(iii = 0; iii &lt; 131; iii++) {</div><div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;      anglefile &gt;&gt; sfrequency &gt;&gt; gain_angle[1][iii][jjj];</div><div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;      <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii]) cout &lt;&lt; <span class="stringliteral">&quot;check frequencies for hh_az\n&quot;</span>;</div><div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    }</div><div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;  anglefile.close();</div><div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    </div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  anglefile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/hh_el&quot;</span>).c_str()); <span class="comment">// h polarization, e angle</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="keywordflow">if</span>(anglefile.fail()) {</div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/hh_el\n&quot;</span>;</div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    exit(1);</div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  }</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;  <span class="keywordflow">for</span>(jjj = 1; jjj &lt; 7; jjj++)</div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;    <span class="keywordflow">for</span>(iii = 0; iii &lt; 131; iii++) {</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;      anglefile &gt;&gt; sfrequency &gt;&gt; gain_angle[2][iii][jjj];</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;      <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii]) cout &lt;&lt; <span class="stringliteral">&quot;check frequencies for hh_el\n&quot;</span>;</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    }</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;  anglefile.close();</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    </div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;  anglefile.open((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/vv_el&quot;</span>).c_str()); <span class="comment">// v polarization, e angle</span></div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;  <span class="keywordflow">if</span>(anglefile.fail()) {</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t open `$ICEMC_DATA_DIR`/vv_el\n&quot;</span>;</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    exit(1);</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;  }</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;  <span class="keywordflow">for</span>(jjj = 1; jjj &lt; 7; jjj++)</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    <span class="keywordflow">for</span>(iii = 0; iii &lt; 131; iii++) {</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;      anglefile &gt;&gt; sfrequency &gt;&gt; gain_angle[3][iii][jjj];</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;      <span class="keywordflow">if</span>(sfrequency != frequency_forgain_measured[iii]) cout &lt;&lt; <span class="stringliteral">&quot;check frequencies for vv_el\n&quot;</span>;</div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    }</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;  anglefile.close();</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  <span class="keywordflow">for</span>(jjj = 0; jjj &lt; 6; jjj++) inv_angle_bin_size[jjj] = 1. /</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                 (reference_angle[jjj+1] - reference_angle[jjj]); <span class="comment">// this is used for interpolating gains at angles between reference angles</span></div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;    </div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;  <span class="keywordtype">double</span> gainhv, gainhh, gainvh, gainvv;</div><div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;  <span class="keywordtype">double</span> gain_step = frequency_forgain_measured[1]-frequency_forgain_measured[0]; <span class="comment">// how wide are the steps in frequency;</span></div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;    </div><div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;GAINS is &quot;</span> &lt;&lt; GAINS &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NFREQ; ++k) {</div><div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;    whichbin[k] = int((freq[k] - frequency_forgain_measured[0]) / gain_step); <span class="comment">// finds the gains that were measured for the frequencies closest to the frequency being considered here</span></div><div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordflow">if</span>((whichbin[k] &gt;= NPOINTS_GAIN || whichbin[k] &lt; 0) &amp;&amp; !settings1-&gt;FORSECKEL) {</div><div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Set_gain_angle out of range, freq = &quot;</span> &lt;&lt; freq[k] &lt;&lt; endl;</div><div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;      exit(1);</div><div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    }</div><div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        </div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    <span class="comment">//now a linear interpolation for the frequency</span></div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;    scalef2[k] = (freq[k] - frequency_forgain_measured[whichbin[k]]) / gain_step;</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;    <span class="comment">// how far from the lower frequency</span></div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;    scalef1[k] = 1. - scalef2[k]; <span class="comment">// how far from the higher frequency</span></div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        </div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="comment">// convert the gain at 0 degrees to the effective antenna height at 0 degrees for every frequency</span></div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    <span class="keywordflow">if</span>(whichbin[k] == NPOINTS_GAIN - 1) { <span class="comment">// if the frequency is 1.5e9 or goes a little over due to rounding</span></div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;      gainhv = gainhv_measured[whichbin[k]];</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;      gainhh = gainh_measured[whichbin[k]];</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;      gainvh = gainvh_measured[whichbin[k]];</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;      gainvv = gainv_measured[whichbin[k]];</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;      <span class="comment">// These gains should be dimensionless numbers, not in dBi</span></div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;      gainhv = scalef1[k] * gainhv_measured[whichbin[k]] + scalef2[k] * gainhv_measured[whichbin[k] + 1];</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;      gainhh = scalef1[k] * gainh_measured[whichbin[k]] + scalef2[k] * gainh_measured[whichbin[k] + 1];</div><div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;      gainvh = scalef1[k] * gainvh_measured[whichbin[k]] + scalef2[k] * gainvh_measured[whichbin[k] + 1];</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;      gainvv = scalef1[k] * gainv_measured[whichbin[k]] + scalef2[k] * gainv_measured[whichbin[k] + 1];</div><div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    }</div><div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;    <span class="keywordflow">if</span> (GAINS==0) {</div><div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            </div><div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;      gainhv=0.;</div><div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;      gainhh=gain[1][k];</div><div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;      gainvh=0.;</div><div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;      gainvv=gain[0][k];</div><div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;            </div><div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    }</div><div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        </div><div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        </div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;    hvGaintoHeight[k] = GaintoHeight(gainhv,freq[k],nmedium_receiver);</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    hhGaintoHeight[k] = GaintoHeight(gainhh,freq[k],nmedium_receiver);</div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    vhGaintoHeight[k] = GaintoHeight(gainvh,freq[k],nmedium_receiver);</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    vvGaintoHeight[k] = GaintoHeight(gainvv,freq[k],nmedium_receiver);</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        </div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;  } <span class="comment">// loop through frequency bins</span></div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    </div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    </div><div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;    </div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;    </div><div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;    </div><div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;    </div><div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;    </div><div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    </div><div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    </div><div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;} <span class="comment">// void Set_gain_angle()</span></div><div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;<span class="comment">// determines the effect of a signal not hitting the antenna straight on</span></div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;<span class="comment">// for the gain type, 0 means V polarization and el angle, 1 means H polarization and el angle, 2 means H polarization and az angle, 3 means V polarization and az angle</span></div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;<span class="comment">// gain_angle[gain_type][][] lists the decrease in gain for different frequencies and angles. This subroutine finds the two angles closest to hitangle and the two frequencies closest to freq. It then returns a linear interpolation in 2 dimensions.</span></div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;<span class="keywordtype">int</span> Anita::GetBeamWidths(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1) {</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;    </div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;  <span class="comment">// first component is frequency</span></div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;  <span class="comment">// second component is which plane and which polarization</span></div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;  <span class="comment">// it goes  e-plane: vp/hp, h-plane: vp/hp</span></div><div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;    </div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;  <span class="comment">// these number were read from antenna specs</span></div><div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;    </div><div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;  <span class="comment">// these are beam widths</span></div><div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    </div><div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;  <span class="keywordtype">double</span> freq_specs[5];</div><div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;  <span class="keywordtype">int</span> NFREQ_FORGAINS; <span class="comment">// Number of</span></div><div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    </div><div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==7) { <span class="comment">// EeVa</span></div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    NFREQ_FORGAINS=4;</div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;    freq_specs[0]=265.E6; <span class="comment">// lower edge of</span></div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    freq_specs[1]=435.E6;</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    freq_specs[2]=650.E6;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    freq_specs[3]=992.5E6;</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;        </div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;        </div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;  }</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==11) { <span class="comment">// Satellite</span></div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    NFREQ_FORGAINS=4;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    freq_specs[0]=265.E6; <span class="comment">// lower edge of</span></div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    freq_specs[1]=435.E6;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;    freq_specs[2]=650.E6;</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    freq_specs[3]=992.5E6;</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        </div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;  }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;    </div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// everything else</span></div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;    NFREQ_FORGAINS=5;</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    freq_specs[0]=300.E6;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;    freq_specs[1]=600.E6;</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    freq_specs[2]=900.E6;</div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;    freq_specs[3]=1200.E6;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;    freq_specs[4]=1500.E6;</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;        </div><div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;  }</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;    </div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;    </div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;    </div><div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;  <span class="keywordtype">double</span> specs[5][4];</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;    </div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==7) { <span class="comment">// EeVA</span></div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;        </div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;        </div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;    <span class="comment">// these are all for 200 MHz</span></div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;    specs[0][0]=2.5; <span class="comment">// eplane, vp</span></div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;    specs[0][1]=2.5;<span class="comment">// eplane, hp</span></div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;    specs[0][2]=1.5;<span class="comment">// hplane, vp</span></div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;    specs[0][3]=1.5;<span class="comment">// hplane, hp</span></div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;        </div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;    <span class="comment">// these are for 355 MHz</span></div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;    specs[1][0]=2.2;</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    specs[1][1]=2.2;</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;    specs[1][2]=1.2;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;    specs[1][3]=1.2;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;        </div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;    <span class="comment">// 515 MHz</span></div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;    specs[2][0]=2.2;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;    specs[2][1]=2.2;</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;    specs[2][2]=1.0;</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;    specs[2][3]=1.0;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;        </div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="comment">// 785 MHz</span></div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;    specs[3][0]=2.2;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;    specs[3][1]=2.2;</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;    specs[3][2]=0.9;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;    specs[3][3]=0.9;</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;        </div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;  }</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// everything but EeVA</span></div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;    <span class="comment">// for now use this for satellite even</span></div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;    <span class="comment">// these are beam widths in degrees</span></div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="comment">// these are all for 300 MHz</span></div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;    specs[0][0]=57.5; <span class="comment">// eplane, vp</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;    specs[0][1]=58.5;<span class="comment">// eplane, hp</span></div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    specs[0][2]=66;<span class="comment">// hplane, vp</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    specs[0][3]=57;<span class="comment">// hplane, hp</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        </div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    <span class="comment">// these are for 600 MHz</span></div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;    specs[1][0]=33.5;</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    specs[1][1]=34.5;</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;    specs[1][2]=36.5;</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;    specs[1][3]=38;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;        </div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;    <span class="comment">// 900 MHz</span></div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;    specs[2][0]=50.5;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    specs[2][1]=53;</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;    specs[2][2]=33;</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;    specs[2][3]=32;</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        </div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;    <span class="comment">// 1200 MHz</span></div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;    specs[3][0]=43.5;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;    specs[3][1]=43;</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    specs[3][2]=39;</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;    specs[3][3]=41.5;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        </div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="comment">//1500 MHz</span></div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;    specs[4][0]=36.5;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;    specs[4][1]=46.5;</div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;    specs[4][2]=32;</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;    specs[4][3]=31;</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;  }</div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;    </div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;  <span class="comment">// These are gains, which are not used because we use Ped&#39;s numbers instead</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;  <span class="keywordtype">double</span> specs2[5][2];</div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    </div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==7) {<span class="comment">// EeVA</span></div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;    <span class="comment">// this is in dBi</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;    <span class="comment">// 200 MHz</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;    specs2[0][0]=26.85; <span class="comment">// vp</span></div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;    specs2[0][1]=26.85; <span class="comment">// hp</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        </div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="comment">// 355 MHz</span></div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;    specs2[1][0]=35.8;</div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    specs2[1][1]=35.8;</div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;        </div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="comment">// 515 MHz</span></div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    specs2[2][0]=25.;</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;    specs2[2][1]=25.;</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        </div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    <span class="comment">// 785 MHz</span></div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    specs2[3][0]=10.5;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    specs2[3][1]=10.5;</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;        </div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        </div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;  }</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==11) { <span class="comment">// satellite</span></div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        </div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="comment">// this is in dBi</span></div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="comment">// 40 MHz</span></div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    specs2[0][0]=7.5; <span class="comment">// vp</span></div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    specs2[0][1]=7.5; <span class="comment">// hp</span></div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;    <span class="comment">//specs2[0][0]=0.0; // vp</span></div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    <span class="comment">//specs2[0][1]=0.0; // hp</span></div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;        </div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="comment">//  MHz</span></div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;    specs2[1][0]=6.5;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    specs2[1][1]=6.5;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    <span class="comment">//specs2[1][0]=0.0;</span></div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;    <span class="comment">//specs2[1][1]=0.0;</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;        </div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="comment">//  MHz</span></div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    specs2[2][0]=6.5;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    specs2[2][1]=6.5;</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="comment">//specs2[2][0]=0.0;</span></div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="comment">//specs2[2][1]=0.0;</span></div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        </div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="comment">//  MHz</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    specs2[3][0]=5.5;</div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    specs2[3][1]=5.5;</div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="comment">//specs2[3][0]=0.0;</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;    <span class="comment">//specs2[3][1]=0.0;</span></div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;        </div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;        </div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        </div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;        </div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;  }</div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// everything else</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    <span class="comment">// these are dimensionless gains</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="comment">// turn to dBi below</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="comment">// 300 MHz</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    specs2[0][0]=8.5; <span class="comment">// vp</span></div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    specs2[0][1]=8.8; <span class="comment">// hp</span></div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        </div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    <span class="comment">// 600 MHz</span></div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    specs2[1][0]=11.0;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    specs2[1][1]=9.2;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;        </div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="comment">// 900 MHz</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    specs2[2][0]=9.3;</div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    specs2[2][1]=9.6;</div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;        </div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    <span class="comment">// 1200 MHz</span></div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    specs2[3][0]=10.1;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    specs2[3][1]=11.5;</div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        </div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <span class="comment">// 1500 MHz</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;    specs2[4][0]=8.9;</div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    specs2[4][1]=9.0;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;        </div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;  }</div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    </div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;  <span class="comment">// now convert to dimensionless units</span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;4;i++) {</div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;      specs2[i][j]=pow(10.,specs2[i][j]/10.);</div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    }</div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;  }</div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    </div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    </div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    </div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    </div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    </div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;  <span class="keywordtype">double</span> scale=0;</div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;  <span class="comment">// loop through frequency bins and fill the flare array</span></div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;NFREQ;k++) {</div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <span class="comment">// if the frequency is below the lowest from the specs, just use the 300 MHz value</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keywordflow">if</span> (freq[k]&lt;freq_specs[0]) {</div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++) {</div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;    flare[j][k]=specs[0][j]*RADDEG;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;    <span class="comment">// if the frequency is higher than the highest frequency from the specs, just use the 1500 MHz value</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq[k]&gt;=freq_specs[NFREQ_FORGAINS-1]) {</div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++) {</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    flare[j][k]=specs[NFREQ_FORGAINS-1][j]*RADDEG;</div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;                </div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    } <span class="comment">//else if</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="comment">// if it is in between, interpolate</span></div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ_FORGAINS;i++) {</div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    <span class="keywordflow">if</span> (freq[k]&gt;=freq_specs[i] &amp;&amp; freq[k]&lt;freq_specs[i+1]) {</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;      scale = (freq[k]-freq_specs[i])/(freq_specs[i+1]-freq_specs[i]);</div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                    </div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;4;j++) {</div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        flare[j][k]=(specs[i][j]+scale*(specs[i+1][j]-specs[i][j]))*RADDEG;</div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                        </div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;      i=NFREQ_FORGAINS;</div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;  } <span class="comment">//for (frequencies)</span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    </div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    <span class="comment">// loop through frequencies to fill the gain array</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;NFREQ;k++) {</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <span class="comment">// if below 300 MHz, use the 300 MHz value</span></div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">if</span> (freq[k]&lt;freq_specs[0]) {</div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    gain[j][k]=specs2[0][j];</div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    <span class="comment">// if higher than 1500 MHz, use the 1500 MHz value</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (freq[k]&gt;=freq_specs[NFREQ_FORGAINS-1]) {</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;    gain[j][k]=specs2[NFREQ_FORGAINS-1][j];</div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    } <span class="comment">//else if</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="comment">// if in between, interpolate</span></div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ_FORGAINS;i++) {</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="keywordflow">if</span> (freq[k]&gt;=freq_specs[i] &amp;&amp; freq[k]&lt;freq_specs[i+1]) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      scale = (freq[k]-freq_specs[i])/(freq_specs[i+1]-freq_specs[i]);</div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;                    </div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;        gain[j][k]=specs2[i][j]+scale*(specs2[i+1][j]-specs2[i][j]);</div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                        </div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;      i=NFREQ_FORGAINS;</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    } <span class="comment">//else</span></div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;  } <span class="comment">//for (frequencies)</span></div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    </div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;} <span class="comment">//GetBeamWidths</span></div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;<span class="keywordtype">double</span> Anita::Get_gain_angle(<span class="keywordtype">int</span> gain_type, <span class="keywordtype">int</span> k, <span class="keywordtype">double</span> hitangle) {</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;  <span class="keywordtype">double</span> scaleh1, scaleh2;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;  <span class="keywordflow">if</span>(gain_type &lt; 0 || gain_type &gt; 3) {</div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;gain_type out of range\n&quot;</span>;</div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;    exit(1);</div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;  }</div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;    </div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;  hitangle = fabs(hitangle)*DEGRAD;</div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;  flare[gain_type][k]=flare[gain_type][k]*DEGRAD;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  <span class="keywordflow">if</span>(hitangle &gt; 90.00001) {</div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;hitangle out of range\n&quot;</span>;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;    exit(1);</div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;  }</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;  <span class="keywordflow">if</span>(hitangle &gt;= 90.) hitangle = 89.99999;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;    </div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;  <span class="comment">// int pol;</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;  <span class="keywordflow">if</span> (GAINS==0) {</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;    <span class="comment">// for this simple model just treat the cross pols the same with regard to effect of being hit off-axis</span></div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;    <span class="comment">// the absolute gain will of course be different for these</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    <span class="comment">// pol=(int)((double)gain_type/2.);</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;        </div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;gain_type, k, flare, gain are &quot; &lt;&lt; gain_type &lt;&lt; &quot; &quot; &lt;&lt; k &lt;&lt; &quot; &quot; &lt;&lt; flare[gain_type][k] &lt;&lt; &quot; &quot; &lt;&lt; gain[pol][k] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;hitangle, flare, factor are &quot; &lt;&lt; hitangle &lt;&lt; &quot; &quot; &lt;&lt; flare[gain_type][k] &lt;&lt; &quot; &quot; &lt;&lt; exp(-1.*(hitangle*hitangle)/(2*flare[gain_type][k]*flare[gain_type][k])) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">return</span> exp(-1.*(hitangle*hitangle)/(2*flare[gain_type][k]*flare[gain_type][k]));</div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii = 1; iii &lt; 7; iii++) { <span class="comment">// linear interpolation for the angle</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;      <span class="keywordflow">if</span>(hitangle &lt;= reference_angle[iii]) {</div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    scaleh2 = (hitangle - reference_angle[iii-1]) *</div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;      inv_angle_bin_size[iii-1]; <span class="comment">// how far from the smaller angle</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;    scaleh1 = 1. - scaleh2; <span class="comment">// how far from the larger angle</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;                </div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;    <span class="keywordflow">if</span>(whichbin[k] == NPOINTS_GAIN - 1) <span class="comment">// if the frequency is 1.5e9 or goes a little over due to rounding</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;      <span class="keywordflow">return</span> scaleh1 * gain_angle[gain_type][whichbin[k]][iii-1] +</div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;        scaleh2 * gain_angle[gain_type][whichbin[k]][iii];</div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                </div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keywordflow">return</span> scaleh1 * scalef1[k] * gain_angle[gain_type][whichbin[k]][iii-1] +</div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;      scaleh1 * scalef2[k] * gain_angle[gain_type][whichbin[k]+1][iii-1] +</div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;      scaleh2 * scalef1[k] * gain_angle[gain_type][whichbin[k]][iii] +</div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;      scaleh2 * scalef2[k] * gain_angle[gain_type][whichbin[k]+1][iii];</div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;                </div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;      }</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    }</div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;  }</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    </div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    </div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;Get_gain_angle should have returned a value\n&quot;</span>;</div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;  exit(1);</div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;} <span class="comment">// double Get_gain_angle(int gain_type, double freq, double hitangle)</span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;</div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;<span class="keywordtype">void</span> Anita::getDiodeModel( ) {</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    </div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;    </div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;  <span class="comment">//  this is our homegrown diode response function which is a downgoing gaussian followed by an upward step function</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;  TF1 *fdown1=<span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fl_down1&quot;</span>,<span class="stringliteral">&quot;[3]+[0]*exp(-1.*(x-[1])*(x-[1])/(2*[2]*[2]))&quot;</span>,-300.E-9,300.E-9);</div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;  fdown1-&gt;SetParameter(0,-0.8);</div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;  <span class="comment">//  fdown1-&gt;SetParameter(1,15.E-9);</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;  fdown1-&gt;SetParameter(1,15.E-9);</div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;  fdown1-&gt;SetParameter(2,2.3E-9);</div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;  <span class="comment">//fdown1-&gt;SetParameter(2,0.5E-9);</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;  fdown1-&gt;SetParameter(3,0.);</div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    </div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;  TF1 *fdown2=<span class="keyword">new</span> TF1(<span class="stringliteral">&quot;fl_down2&quot;</span>,<span class="stringliteral">&quot;[3]+[0]*exp(-1.*(x-[1])*(x-[1])/(2*[2]*[2]))&quot;</span>,-300.E-9,300.E-9);</div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;  fdown2-&gt;SetParameter(0,-0.2);</div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;  <span class="comment">//  fdown2-&gt;SetParameter(1,15.E-9);</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;  fdown2-&gt;SetParameter(1,15.E-9);</div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  fdown2-&gt;SetParameter(2,4.0E-9);</div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;  <span class="comment">//fdown2-&gt;SetParameter(2,0.5E-9);</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;  fdown2-&gt;SetParameter(3,0.);</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;    </div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;    </div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;  maxt_diode=70.E-9;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;  idelaybeforepeak[0]=(int)(5.E-9/TIMESTEP);</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  iwindow[0]=(int)(20.E-9/TIMESTEP);</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;  idelaybeforepeak[1]=(int)(5.E-9/TIMESTEP);</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;  iwindow[1]=(int)(20.E-9/TIMESTEP);</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;  idelaybeforepeak[2]=(int)(5.E-9/TIMESTEP);</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;  iwindow[2]=(int)(20.E-9/TIMESTEP);</div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;  idelaybeforepeak[3]=(int)(5.E-9/TIMESTEP);</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;  iwindow[3]=(int)(20.E-9/TIMESTEP);</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;  idelaybeforepeak[4]=(int)(13.E-9/TIMESTEP);</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;  iwindow[4]=(int)(4.E-9/TIMESTEP);</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    </div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;  fdown1-&gt;Copy(fdiode);</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;    </div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;  TF1 *f_up=<span class="keyword">new</span> TF1(<span class="stringliteral">&quot;f_up&quot;</span>,<span class="stringliteral">&quot;[0]*([3]*(x-[1]))^2*exp(-(x-[1])/[2])&quot;</span>,-200.E-9,100.E-9);</div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    </div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;  f_up-&gt;SetParameter(2,7.0E-9);</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  f_up-&gt;SetParameter(0,1.);</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;  f_up-&gt;SetParameter(1,18.E-9);</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;  f_up-&gt;SetParameter(3,1.E9);</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;    </div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  f_up-&gt;SetParameter(0,-1.*sqrt(2.*PI)*(fdiode.GetParameter(0)*fdiode.GetParameter(2)+fdown2-&gt;GetParameter(0)*fdown2-&gt;GetParameter(2))/(2.*pow(f_up-&gt;GetParameter(2),3.)*1.E18));</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;    </div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  <span class="keywordtype">double</span> sum=0.;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;        </div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keywordflow">if</span> (j==0)</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;      f_up-&gt;SetParameter(0,0.00275);</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (j==1)</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;      f_up-&gt;SetParameter(0,0.004544);</div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;      f_up-&gt;SetParameter(0,-1.*sqrt(2.*PI)*(fdiode.GetParameter(0)*fdiode.GetParameter(2)+fdown2-&gt;GetParameter(0)*fdown2-&gt;GetParameter(2))/(2.*pow(f_up-&gt;GetParameter(2),3.)*1.E18));</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        </div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/2;i++) {</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;            </div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      <span class="keywordflow">if</span> (time[i]&gt;0. &amp;&amp; time[i]&lt;maxt_diode) {</div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            </div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    diode_real[j][i]=fdiode.Eval(time[i])+fdown2-&gt;Eval(time[i]);</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;    <span class="keywordflow">if</span> (time[i]&gt;f_up-&gt;GetParameter(1))</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      diode_real[j][i]+=f_up-&gt;Eval(time[i]);</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;            </div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;    sum+=diode_real[j][i];</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;      }</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      <span class="keywordflow">else</span> {</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;    diode_real[j][i]=0.;</div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;diode: &quot; &lt;&lt; time[i] &lt;&lt; &quot; &quot; &lt;&lt; diode_real[i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      }</div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    }</div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;  }</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    </div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    </div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="comment">// diode_real is the time domain response of the diode</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;}</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="keywordtype">void</span> Anita::myconvlv(<span class="keywordtype">double</span> *data,<span class="keyword">const</span> <span class="keywordtype">int</span> NFOUR,<span class="keywordtype">double</span> *fdiode,<span class="keywordtype">double</span> &amp;mindiodeconvl,<span class="keywordtype">double</span> &amp;onediodeconvl,<span class="keywordtype">double</span> *power_noise,<span class="keywordtype">double</span> *diodeconv) {</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    </div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  <span class="comment">// NFOUR is the size array of fdiode_real, while data is NFOUR/2 sized array.</span></div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  <span class="comment">// so we are going to make data array to NFOUR sized array with zero padding (see Numerical Recipes 3rd ED, 643 page)</span></div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  <span class="comment">// We are actually using NFOUR/2 array for zero padding which might be too long in terms of efficiency but it&#39;s a simple way.</span></div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  <span class="comment">// Returned diodeconv array is NFOUR sized array but actually initial NFOUR/2 is the information what we need</span></div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <span class="comment">// Last half NFOUR/2 array of diodeconv is result from zero padding and some spoiled information.</span></div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;    </div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">int</span> length=NFOUR;</div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="comment">// double data_copy[length];</span></div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;  <span class="comment">//double fdiode_real[length];</span></div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;  <span class="keywordtype">double</span> power_noise_copy[length];</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    </div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    </div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR/2;i++) {</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    power_noise_copy[i]=(data[i]*data[i])/impedence*TIMESTEP;</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;  }</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=NFOUR/2;i&lt;NFOUR;i++) {</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    power_noise_copy[i]=0.;</div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;  }</div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;</div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;  </div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;  <span class="comment">// TCanvas *c = new TCanvas(&quot;c&quot;);</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;  <span class="comment">// string name = &quot;oldnoise&quot;;</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;  <span class="comment">// TGraph *gV = new TGraph(HALFNFOUR, fTimes, power_noise_copy);</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;  <span class="comment">// gV-&gt;Draw(&quot;Al&quot;);</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;  <span class="comment">// c-&gt;Print(Form(&quot;%s_%d_diodePower.png&quot;, name.c_str(), inu));</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;  <span class="comment">// delete gV;</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;  <span class="comment">// delete c;</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    </div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;  Tools::realft(power_noise_copy,1,length);</div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;  <span class="comment">//  realft(fdiode_real,1,length);</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    </div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;  <span class="keywordtype">double</span> ans_copy[length];</div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;    </div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    </div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    </div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;  <span class="comment">// the +, - sign in the equation might look different then Numerical Recipes 3rd ED 649 page.</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;  <span class="comment">// our equation (below) is the situation when power_noise_copy&#39;s 0th bin starts to meet fdiode&#39;s 0th bin</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;  <span class="comment">// while code in Numerical Recipes 649 page is the situation when power_noise_copy&#39;s final bin starts to meet fdiode&#39;s 0th bin</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;  <span class="comment">// so, in our case, below equation is correct.</span></div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=1;j&lt;length/2;j++) {</div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;    ans_copy[2*j]=(power_noise_copy[2*j]*fdiode[2*j]-power_noise_copy[2*j+1]*fdiode[2*j+1])/((<span class="keywordtype">double</span>)length/2);</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    ans_copy[2*j+1]=(power_noise_copy[2*j+1]*fdiode[2*j]+power_noise_copy[2*j]*fdiode[2*j+1])/((<span class="keywordtype">double</span>)length/2);</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;  }</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  ans_copy[0]=power_noise_copy[0]*fdiode[0]/((double)length/2);</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  ans_copy[1]=power_noise_copy[1]*fdiode[1]/((double)length/2);</div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;   </div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    </div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    </div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  Tools::realft(ans_copy,-1,length);</div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    </div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    </div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  <span class="comment">// even if there are NFOUR array in diodeconv, only first NFOUR/2 is meaningful for us.</span></div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFOUR;i++) {</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    power_noise[i]=power_noise_copy[i];</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    diodeconv[i]=ans_copy[i];</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  }</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    </div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    </div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    </div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="keywordtype">int</span> iminsamp,imaxsamp; <span class="comment">// find min and max samples such that</span></div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;  <span class="comment">// the diode response is fully overlapping with the noise waveform</span></div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;  iminsamp=(int)(maxt_diode/TIMESTEP);</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;  <span class="comment">// the noise waveform is NFOUR/2 long</span></div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;  <span class="comment">// then for a time maxt_diode/TIMESTEP at the end of that, the</span></div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;  <span class="comment">// diode response function is only partially overlappying with the</span></div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;  <span class="comment">// waveform in the convolution</span></div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;  imaxsamp=NFOUR/2;</div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    </div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;iminsamp, imaxsamp are &quot; &lt;&lt; iminsamp &lt;&lt; &quot; &quot; &lt;&lt; imaxsamp &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;  <span class="keywordflow">if</span> (imaxsamp&lt;iminsamp) {</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Noise waveform is not long enough for this diode response.\n&quot;</span>;</div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    exit(1);</div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;  }</div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    </div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;  <span class="keywordtype">int</span> ibin=((iminsamp+imaxsamp)-(iminsamp+imaxsamp)%2)/2;</div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;ibin is &quot; &lt;&lt; ibin &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    </div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;  <span class="comment">// return the 50th sample, right in the middle</span></div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;  onediodeconvl=diodeconv[ibin];</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;    </div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;    </div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;  mindiodeconvl=0.;</div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;    </div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=iminsamp;i&lt;imaxsamp;i++) {</div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;        </div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="keywordflow">if</span> (diodeconv[i]&lt;mindiodeconvl)</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      mindiodeconvl=diodeconv[i];</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;        </div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        </div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;  }</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    </div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    </div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    </div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    </div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    </div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    </div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;}</div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;</div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;</div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;</div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;</div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;</div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;</div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;</div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;<span class="comment">// get the frequency bin for a given frequency, the lower and upper limits and the</span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;<span class="comment">// number of bins</span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;</div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;<span class="keywordtype">void</span> Anita::GetPhases() {</div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;</div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;  <span class="keywordtype">int</span> iband;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;  <span class="keywordtype">double</span> corr,uncorr;</div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;  <span class="keywordtype">double</span> phase_corr,phase_uncorr;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;  <span class="keywordtype">double</span> phasor_x,phasor_y;</div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;  TRandom * rng = getRNG(RNG_PHASES); </div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    </div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;NFOUR/4;k++) { <span class="comment">// loop through samples</span></div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    iband=Tools::findIndex(freq_bands[0],freq_forfft[2*k],NPOINTS_BANDS,freq_bands[0][0],freq_bands[0][NPOINTS_BANDS-1]);</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        </div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;        </div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    phases_rfcm[0][k]=2*PI*rng-&gt;Rndm(); <span class="comment">// set phases at output of rfcm randoml</span></div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    phases_rfcm[1][k]=2*PI*rng-&gt;Rndm(); <span class="comment">// set phases at output of rfcm randomly</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;        </div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        </div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">// now set phases at the lab chip</span></div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        </div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="keywordflow">if</span>(iband &lt; 0) corr = 0;</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="keywordflow">else</span> corr=correl_lab[iband];</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    uncorr=1-corr;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    phase_corr=phases_rfcm[0][k];</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    phase_uncorr=2*PI*rng-&gt;Rndm();</div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    phasor_x=corr*cos(phase_corr)+uncorr*cos(phase_uncorr);</div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    phasor_y=corr*sin(phase_corr)+uncorr*sin(phase_uncorr);</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;    phases_lab[0][k]=TMath::ATan2(phasor_y,phasor_x);</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;        </div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        </div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        </div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    phase_corr=phases_rfcm[1][k];</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    phase_uncorr=2*PI*rng-&gt;Rndm();</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    phasor_x=corr*cos(phase_corr)+uncorr*cos(phase_uncorr);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    phasor_y=corr*sin(phase_corr)+uncorr*sin(phase_uncorr);</div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    phases_lab[1][k]=TMath::ATan2(phasor_y,phasor_x);</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;        </div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;        </div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <span class="comment">// do the same thing for the bands</span></div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;5;j++) {</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            </div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;      <span class="keywordflow">if</span>(iband &lt; 0) corr = 0;</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;      <span class="keywordflow">else</span> corr=correl_banding[j][iband];</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;      uncorr=1-corr;</div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;      phase_corr=phases_rfcm[0][k];</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;      phase_uncorr=2*PI*rng-&gt;Rndm();</div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;      phasor_x=corr*cos(phase_corr)+uncorr*cos(phase_uncorr);</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;      phasor_y=corr*sin(phase_corr)+uncorr*sin(phase_uncorr);</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;      phases_rfcm_banding[0][j][k]=TMath::ATan2(phasor_y,phasor_x);</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;      phase_corr=phases_rfcm[1][k];</div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      phase_uncorr=2*PI*rng-&gt;Rndm();</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;      phasor_x=corr*cos(phase_corr)+uncorr*cos(phase_uncorr);</div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;      phasor_y=corr*sin(phase_corr)+uncorr*sin(phase_uncorr);</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;      phases_rfcm_banding[1][j][k]=TMath::ATan2(phasor_y,phasor_x);</div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;    }</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  }</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;    </div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    </div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;</div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    </div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;}</div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;</div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;<span class="keywordtype">void</span> Anita::normalize_for_nsamples(<span class="keywordtype">double</span> *spectrum, <span class="keywordtype">double</span> nsamples, <span class="keywordtype">double</span> nsamp){</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NFOUR / 4; k++){</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    spectrum[2 * k] *= sqrt((<span class="keywordtype">double</span>) nsamples / (<span class="keywordtype">double</span>) nsamp);</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    spectrum[2 * k + 1] *= sqrt((<span class="keywordtype">double</span>) nsamples / (<span class="keywordtype">double</span>) nsamp);</div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;  }</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;}</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;</div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;<span class="keywordtype">void</span> Anita::convert_power_spectrum_to_voltage_spectrum_for_fft(<span class="keywordtype">int</span> length,<span class="keywordtype">double</span> *spectrum, <span class="keywordtype">double</span> domain[], <span class="keywordtype">double</span> phase[]){</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;  <span class="keywordtype">double</span> current_amplitude, current_phase;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  <span class="comment">//    for (int k = 0; k &lt; NFOUR / 4; k++){</span></div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; length/2 ; k++){</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    current_amplitude = domain[k];</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    current_phase = phase[k];</div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;      </div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="comment">// Uncomment the following line of code to allow the the noise generated to have a Rician/Rayleigh distribution, which should increase the number of weighted neutrinos that pass *slightly*.</span></div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    Tools::get_random_rician(0., 0., sqrt(2. / M_PI) * domain[k], current_amplitude, current_phase);</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="comment">// The above function uses 0. as the mean of the rician distribution, and uses sqrt(2. / M_PI) * domain[k] as the standard deviation for the distribution, as discussed in Goodman&#39;s &quot;Statistical Optics&quot;, equation 2.9-13 on page 49</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;      </div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    spectrum[2 * k] = sqrt(current_amplitude) * cos(phase[k]) / (( (double) NFOUR / 2) / 2);</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    spectrum[2 * k + 1] = sqrt(current_amplitude) * sin(phase[k]) / (( (double) NFOUR / 2) / 2);</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  }</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;}</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;<span class="keywordtype">void</span> Anita::GetNoiseWaveforms() {</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;  GetPhases();</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;  <span class="keywordtype">int</span> nsamples = NFOUR / 2;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="comment">// int nsamples_long = NFOUR;</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="keywordtype">double</span> sumfreqdomain = 0.;</div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordtype">double</span> sumtimedomain = 0.;</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;</div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;  count_getnoisewaveforms++;</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;</div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;  <span class="comment">// This is done in a stupid way for the moment to provide the same order of gRandom calls</span></div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;  <span class="comment">// So that I have the exact same results as masters</span></div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;  <span class="comment">// This should be done in 1 loop once I merge the trigger branch with master</span></div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;  <span class="comment">// LC, 16/02/17</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;  </div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++)</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;    convert_power_spectrum_to_voltage_spectrum_for_fft(nsamples, timedomainnoise_rfcm[ipol], freqdomain_rfcm,   phases_rfcm[ipol] );</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++)</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;    convert_power_spectrum_to_voltage_spectrum_for_fft(nsamples, timedomainnoise_lab[ipol],  avgfreqdomain_lab, phases_lab[ipol]  );</div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;  <span class="comment">//     convert_power_spectrum_to_voltage_spectrum_for_fft(nsamples_long, timedomainnoise_rfcm_long[ipol], freqdomain_rfcm_long,   phases_rfcm_long[ipol] );</span></div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="comment">//     convert_power_spectrum_to_voltage_spectrum_for_fft(nsamples_long, timedomainnoise_lab_long[ipol],  avgfreqdomain_lab_long, phases_lab_long[ipol]  );</span></div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    </div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;  <span class="comment">// want to restrict it to NFOUR/2 samples -# samples that equal twice</span></div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;  <span class="comment">// maxt_diode</span></div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;  <span class="comment">// freqdomain_rfcm_banding was made by averaging many nsamp=100-sample noise waveforms in the</span></div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;  <span class="comment">// frequency domain</span></div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;  <span class="comment">// the noise waveform that we create from it has NFOUR/2 samples</span></div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;  <span class="comment">// I don&#39;t know how to restrict it to nsamp=100 samples.</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;  <span class="comment">// So in order to restrict the power to nsamp=100 samples we zero</span></div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;  <span class="comment">// everything but the middle nsamp samples and scale the waveforms</span></div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  <span class="comment">// by sqrt((NFOUR/2)/nsamp)</span></div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    </div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    normalize_for_nsamples(timedomainnoise_rfcm[ipol], (<span class="keywordtype">double</span>) nsamples, (<span class="keywordtype">double</span>) nsamp);</div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    normalize_for_nsamples(timedomainnoise_lab[ipol],  (<span class="keywordtype">double</span>) nsamples, (<span class="keywordtype">double</span>) nsamp);</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;    <span class="comment">//     normalize_for_nsamples(timedomainnoise_rfcm_long[ipol], (double) nsamples_long, (double) nsamp);</span></div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="comment">//     normalize_for_nsamples(timedomainnoise_lab_long[ipol],  (double) nsamples_long, (double) nsamp);</span></div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    </div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NFOUR / 4; k++){</div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      sumfreqdomain += avgfreqdomain_lab[k];</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    }</div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    </div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    Tools::realft(timedomainnoise_rfcm[ipol], -1, NFOUR / 2);</div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    Tools::realft(timedomainnoise_lab[ipol],  -1, NFOUR / 2);</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="comment">//    Tools::realft(timedomainnoise_rfcm_long[ipol], -1, NFOUR );</span></div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;    <span class="comment">//     Tools::realft(timedomainnoise_lab_long[ipol],-1, NFOUR );</span></div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    </div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k = 0; k &lt; NFOUR / 2; k++) {</div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;      timedomainnoise_lab[ipol][k] *=THERMALNOISE_FACTOR;</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;      timedomainnoise_rfcm[ipol][k]*=THERMALNOISE_FACTOR;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;      </div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;      <span class="keywordflow">if</span> (ipol==0){</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;    sumtimedomain += timedomainnoise_lab[ipol][k] * timedomainnoise_lab[ipol][k];</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    rms_rfcm_e_single_event += timedomainnoise_rfcm[ipol][k] * timedomainnoise_rfcm[ipol][k];</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;      }</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;      rms_rfcm[ipol] += timedomainnoise_rfcm[ipol][k] * timedomainnoise_rfcm[ipol][k] / ((double) NFOUR / 2);</div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;      rms_lab[ipol]  += timedomainnoise_lab[ipol][k] * timedomainnoise_lab[ipol][k] / ((double) NFOUR / 2);</div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            </div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;    }</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;    </div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;  }</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;</div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iband=0; iband&lt;5; iband++) {</div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++)</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;      convert_power_spectrum_to_voltage_spectrum_for_fft(NFOUR/2,timedomainnoise_rfcm_banding[ipol][iband], freqdomain_rfcm_banding[iband], phases_rfcm_banding[ipol][iband]);</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++)</div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;      normalize_for_nsamples(timedomainnoise_rfcm_banding[ipol][iband], (<span class="keywordtype">double</span>) nsamples, (double) nsamp);</div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++)</div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;      Tools::realft(timedomainnoise_rfcm_banding[ipol][iband], -1, NFOUR / 2);</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;    <span class="comment">//      convert_power_spectrum_to_voltage_spectrum_for_fft(NFOUR,timedomainnoise_rfcm_banding_long[ipol][iband], freqdomain_rfcm_banding_long[iband], phases_rfcm_banding_e_long[iband]);</span></div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <span class="comment">//       normalize_for_nsamples(timedomainnoise_rfcm_banding_long[ipol][iband], (double) nsamples_long, (double) nsamp);</span></div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    <span class="comment">//       Tools::realft(timedomainnoise_rfcm_banding_long[ipol][iband], -1, NFOUR);</span></div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;    </div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    </div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;  }</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;}</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;<span class="keywordtype">void</span> Anita::GetArrayFromFFT(<span class="keywordtype">double</span> *tmp_fftvhz, <span class="keywordtype">double</span> *vhz_rx){</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  </div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;  <span class="keywordtype">int</span> firstNonZero = Tools::Getifreq(freq[0],freq_forfft[0],freq_forfft[NFOUR/2-1],NFOUR/4);</div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;  <span class="keywordtype">int</span> lastNonZero  = Tools::Getifreq(freq[NFREQ-1],freq_forfft[0],freq_forfft[NFOUR/2-1],NFOUR/4);</div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;  <span class="keywordtype">double</span> norm=TMath::Sqrt(<span class="keywordtype">double</span>(lastNonZero-firstNonZero)/<span class="keywordtype">double</span>(NFREQ));</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;  <span class="comment">//  cout &lt;&lt; firstNonZero &lt;&lt; &quot; &quot; &lt;&lt; lastNonZero &lt;&lt; &quot; &quot; &lt;&lt; lastNonZero-firstNonZero &lt;&lt; &quot; &quot; &lt;&lt; norm &lt;&lt; endl;</span></div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifreq=0;ifreq&lt;NFOUR/4;ifreq++){</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    tmp_fftvhz[ifreq]=TMath::Sqrt(tmp_fftvhz[2*ifreq]*tmp_fftvhz[2*ifreq] + tmp_fftvhz[2*ifreq+1]*tmp_fftvhz[2*ifreq+1]);</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;  }</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    </div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifreq=0; ifreq&lt;NFREQ; ifreq++){</div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      </div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    <span class="keywordtype">int</span> ifour=Tools::Getifreq(freq[ifreq],freq_forfft[0],freq_forfft[NFOUR/2-1],NFOUR/4);</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    vhz_rx[ifreq]=tmp_fftvhz[ifour]*norm;</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    <span class="comment">//cout &lt;&lt; ifour &lt;&lt; &quot; &quot; &lt;&lt; freq[ifreq] &lt;&lt; &quot; &quot; &lt;&lt; vhz_rx[ifreq] &lt;&lt; &quot; &quot; &lt;&lt; endl;</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;  }</div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;</div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;}</div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;</div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;</div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;<span class="keywordtype">void</span> Anita::GetPhasesFromFFT(<span class="keywordtype">double</span> *tmp_fftvhz, <span class="keywordtype">double</span> *phases){</div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;  </div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifreq=0; ifreq&lt;NFOUR/4; ifreq++){</div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    phases[ifreq]=TMath::ATan2(tmp_fftvhz[ifreq+1], tmp_fftvhz[ifreq])*180./PI;</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  }</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;}</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;<span class="keywordtype">void</span> Anita::FromTimeDomainToIcemcArray(<span class="keywordtype">double</span> *vsignalarray, <span class="keywordtype">double</span> vhz[NFREQ]){</div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;  </div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;  <span class="comment">// find the frequency domain</span></div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;  Tools::realft(vsignalarray,1,NFOUR/2);</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;</div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;  GetPhasesFromFFT(vsignalarray, v_phases);</div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;  </div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;  <span class="comment">//convert the V pol time waveform into frequency amplitudes</span></div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  GetArrayFromFFT(vsignalarray, vhz);</div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;</div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;</div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;}</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;<span class="keywordtype">void</span> Anita::MakeArrayforFFT(<span class="keywordtype">double</span> *vsignalarray_e,<span class="keywordtype">double</span> *vsignal_e_forfft, <span class="keywordtype">double</span> phasedelay, <span class="keywordtype">bool</span> useconstantdelay) {</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    </div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;  Tools::Zero(vsignal_e_forfft,NFOUR/2);</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;    </div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;  <span class="keywordtype">double</span> previous_value_e_even=0.;</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;  <span class="keywordtype">double</span> previous_value_e_odd=0.;</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;  <span class="keywordtype">int</span> count_nonzero=0;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;  <span class="keywordtype">int</span> iprevious=0;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;  <span class="keywordtype">int</span> ifirstnonzero=-1;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;  <span class="keywordtype">int</span> ilastnonzero=2000;</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ;i++) {</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="comment">// freq_forfft has NFOUR/2 elements because it is meant to cover real and imaginary values</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="comment">// but there are only NFOUR/4 different values</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="comment">// it&#39;s the index among the NFOUR/4 that we&#39;re interested in</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="keywordtype">int</span> ifour=Tools::Getifreq(freq[i],freq_forfft[0],freq_forfft[NFOUR/2-1],NFOUR/4);</div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;      </div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="keywordflow">if</span> (ifour!=-1 &amp;&amp; 2*ifour+1&lt;NFOUR/2) {</div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;      count_nonzero++;</div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;      <span class="keywordflow">if</span> (ifirstnonzero==-1){</div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    ifirstnonzero=ifour;</div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;      }</div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;</div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;      vsignal_e_forfft[2*ifour]=vsignalarray_e[i]*2/((double)NFOUR/2); <span class="comment">// phases is 90 deg.</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;</div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;      <span class="comment">//      cout &lt;&lt; &quot;ifour, vsignal is &quot; &lt;&lt; ifour &lt;&lt; &quot; &quot; &lt;&lt; vsignal_e_forfft[2*ifour] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;</div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;      vsignal_e_forfft[2*ifour+1]=vsignalarray_e[i]*2/((double)NFOUR/2); <span class="comment">// phase is 90 deg.</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;      <span class="comment">// the 2/(nfour/2) needs to be included since were using Tools::realft with the -1 setting</span></div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      <span class="comment">// the 2/(nfour/2) needs to be included since were using Tools::realft with the -1 setting</span></div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      <span class="comment">// how about we interpolate instead of doing a box average</span></div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;</div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=iprevious+1;j&lt;ifour;j++) {</div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;        vsignal_e_forfft[2*j]=previous_value_e_even+(vsignal_e_forfft[2*ifour]-previous_value_e_even)*(<span class="keywordtype">double</span>)(j-iprevious)/(<span class="keywordtype">double</span>)(ifour-iprevious);</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;        <span class="comment">//  cout &lt;&lt; &quot;j, vsignal is &quot; &lt;&lt; j &lt;&lt; &quot; &quot; &lt;&lt; vsignal_e_forfft[2*j] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        vsignal_e_forfft[2*j+1]=previous_value_e_odd+(vsignal_e_forfft[2*ifour+1]-previous_value_e_odd)*(<span class="keywordtype">double</span>)(j-iprevious)/(<span class="keywordtype">double</span>)(ifour-iprevious);</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;      }</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      ilastnonzero=ifour;</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;      iprevious=ifour;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      previous_value_e_even=vsignal_e_forfft[2*ifour];</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      previous_value_e_odd=vsignal_e_forfft[2*ifour+1];</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;    }</div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      </div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;  } <span class="comment">// end loop over nfreq</span></div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    </div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="comment">// EH check</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;    <span class="comment">// cout &lt;&lt; &quot;ifirstnonzero, ilastnonzero are &quot; &lt;&lt; ifirstnonzero &lt;&lt; &quot; &quot; &lt;&lt; ilastnonzero &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    <span class="comment">// cout &lt;&lt; &quot;ratio is &quot; &lt;&lt; (double)count_nonzero/(double)(ilastnonzero-ifirstnonzero) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NFOUR/4;j++) {</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    vsignal_e_forfft[2*j]*=sqrt((<span class="keywordtype">double</span>)count_nonzero/(<span class="keywordtype">double</span>)(ilastnonzero-ifirstnonzero));</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    vsignal_e_forfft[2*j+1]*=sqrt((<span class="keywordtype">double</span>)count_nonzero/(<span class="keywordtype">double</span>)(ilastnonzero-ifirstnonzero));</div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;  }</div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    </div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  <span class="comment">//  Tools::InterpolateComplex(vsignal_e_forfft,NFOUR/4);</span></div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;</div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <span class="keywordflow">if</span> (useconstantdelay){</div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;    <span class="keywordtype">double</span> cosphase=cos(phasedelay*PI/180.);</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordtype">double</span> sinphase=sin(phasedelay*PI/180.);</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ifour=0;ifour&lt;NFOUR/4;ifour++) {      </div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;      <span class="keywordflow">if</span> (USEPHASES) {</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;    cosphase = cos(v_phases[ifour]*PI/180.);</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;    sinphase = sin(v_phases[ifour]*PI/180.);</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;      }</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;      vsignal_e_forfft[2*ifour]*=cosphase;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;      vsignal_e_forfft[2*ifour+1]*=sinphase;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;    }</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  }</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;}</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;<span class="keywordtype">void</span> Anita::BoxAverageComplex(<span class="keywordtype">double</span> *array, <span class="keyword">const</span> <span class="keywordtype">int</span> n,<span class="keywordtype">int</span> navg) {</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;  <span class="comment">// to get rid of the zero bins</span></div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;  <span class="keywordtype">double</span> array_temp[2*n];</div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;n;i++) {</div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        </div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;    array_temp[2*i]=0.;</div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    array_temp[2*i+1]=0.;</div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        </div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        </div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i;k&lt;i+navg;k++) {</div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;      <span class="keywordflow">if</span> (k&lt;n) {</div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;    array_temp[2*i]+=array[2*k];</div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;    array_temp[2*i+1]+=array[2*k+1];</div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;      }</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;    }</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        </div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;    array[2*i]=array_temp[2*i]/(double)navg;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;    array[2*i+1]=array_temp[2*i+1]/(double)navg;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        </div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;    array_temp[2*i]=array[2*i];</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    array_temp[2*i+1]=array[2*i+1];</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        </div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;  }</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;}</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;<span class="keywordtype">void</span> Anita::BoxAverage(<span class="keywordtype">double</span> *array, <span class="keyword">const</span> <span class="keywordtype">int</span> n,<span class="keywordtype">int</span> navg) {</div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;  <span class="comment">// to get rid of the zero bins</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;  <span class="keywordtype">double</span> array_temp[n];</div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;n;i++) {</div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;        </div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    array_temp[i]=0.;</div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        </div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=i;k&lt;i+navg;k++) {</div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;      <span class="keywordflow">if</span> (k&lt;n) {</div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    array_temp[i]+=array[k];</div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;      }</div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;    }</div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;        </div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;    array[i]=array_temp[i]/(double)navg;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;        </div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        </div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    array_temp[i]=array[i];</div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        </div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;  }</div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;}</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;<span class="keywordtype">void</span> Anita::labAttn(<span class="keywordtype">double</span> *vhz) {</div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NFREQ;i++) {</div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;    <span class="comment">// next find the index of the lab attenuation array</span></div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;    <span class="keywordtype">int</span> ilab=Tools::findIndex(freqlab,freq[i],NPOINTS_LAB,freqlab[0],freqlab[NPOINTS_LAB-1]);</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;    <span class="keywordflow">if</span> (ilab!=-1) {</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;      vhz[i]*=sqrt(labattn[ilab]);</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;      vhz[i]*=sqrt(labattn[ilab]);</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;    }</div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Lab attenuation outside of band.\n&quot;</span>;</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;  }</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;}</div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;</div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;<span class="keywordtype">int</span> Anita::getLabAttn(<span class="keywordtype">int</span> NPOINTS_LAB,<span class="keywordtype">double</span> *freqlab,<span class="keywordtype">double</span> *labattn) {</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;    </div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  ifstream flab((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/surfatten_run294_ch23v.dat&quot;</span>).c_str());</div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="keywordflow">if</span> (flab.fail()) {</div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Cannot open lab data file.\n&quot;</span>;</div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;    exit(1);</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  }</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;  <span class="keywordtype">int</span> index=0;</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    </div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  <span class="keywordtype">string</span> line;</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  getline(flab,line); <span class="comment">// first two lines are junk</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;  getline(flab,line);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    </div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <span class="keywordtype">float</span> ffreqlab,flabattn;</div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;    </div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="comment">// read in the rest of the lab data from a file</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="keywordflow">while</span> (!flab.eof() &amp;&amp; index&lt;NPOINTS_LAB) {</div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;        </div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;    flab &gt;&gt; ffreqlab &gt;&gt; flabattn;</div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    labattn[index]=(double)pow(10.,flabattn/10.);</div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;Mofifying labattn!\n&quot;;</span></div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="comment">//labattn[index]*=2.;</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        </div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;    freqlab[index]=(double)ffreqlab;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        </div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;    index++;</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        </div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;  }</div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;    </div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;    </div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;  flab.close();</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    </div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;  <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;    </div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;}</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;<span class="keywordtype">double</span> Anita::GaintoHeight(<span class="keywordtype">double</span> gain,<span class="keywordtype">double</span> freq,<span class="keywordtype">double</span> nmedium_receiver) {</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    </div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;  <span class="comment">// from gain=4*pi*A_eff/lambda^2</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;  <span class="comment">// and h_eff=2*sqrt(A_eff*Z_rx/Z_air)</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  <span class="comment">// gain is in dB</span></div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="keywordflow">return</span> 2*sqrt(gain/4/PI*CLIGHT*CLIGHT/(freq*freq)*Zr/(Z0*nmedium_receiver));</div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;} <span class="comment">//GaintoHeight</span></div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;</div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;</div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;<span class="keywordtype">void</span> Anita::fill_coherent_waveform_sum_tree(<span class="keywordtype">unsigned</span> event_number, <span class="keywordtype">unsigned</span> center_phi_sector_index, <a class="code" href="../../db/d2b/class_settings.html">Settings</a>* settings1, <span class="keywordtype">double</span> rms_noise, <span class="keywordtype">double</span> actual_rms, <span class="keywordtype">unsigned</span> window_start, <span class="keywordtype">unsigned</span> window_end, <span class="keywordtype">double</span> deg_theta, <span class="keywordtype">double</span> deg_phi, <span class="keywordtype">double</span> actual_deg_theta, <span class="keywordtype">double</span> actual_deg_phi, vector &lt;double&gt;&amp; summed_wfm, vector &lt;double&gt;&amp; power_of_summed_wfm, <span class="keywordtype">double</span> power){</div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;    </div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  cwst_event_number = event_number;</div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  cwst_center_phi_sector = center_phi_sector_index;</div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  cwst_rms_noise = rms_noise;</div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  cwst_actual_rms = actual_rms;</div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;  cwst_threshold = settings1-&gt;COHERENT_THRESHOLD;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  cwst_window_start = window_start;</div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;  cwst_window_end = window_end;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    </div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;  cwst_deg_theta = deg_theta;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;  cwst_deg_phi = deg_phi;</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    </div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;  cwst_actual_deg_theta = actual_deg_theta;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;  cwst_actual_deg_phi = actual_deg_phi;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    </div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;  <span class="comment">// Reassign the array associated with the timesteps branch</span></div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; HALFNFOUR; i++){</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    cwst_timesteps[i] = i;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;  }</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    </div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;  cwst_summed_wfm = summed_wfm;</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;  cwst_power_of_summed_wfm = power_of_summed_wfm;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  cwst_power = power;</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    </div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;  coherent_waveform_sum_tree-&gt;Fill();</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    </div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;}</div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="keywordtype">void</span> Anita::GetPayload(<a class="code" href="../../db/d2b/class_settings.html">Settings</a>* settings1, <a class="code" href="../../d2/d24/class_balloon.html">Balloon</a>* bn1){</div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;  <span class="comment">// anita-lite payload</span></div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;  <span class="comment">// see comments next to variable definitions</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;  <span class="keywordtype">double</span> temp_eachrx[<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]; <span class="comment">// temperature of each antenna (for the anita-lite configuration)</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    </div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gps_offset = atan2(-0.7042,0.71), MINCH = 0.0254, phase_center = 0.17;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  <span class="comment">// const double phase_center_anita2=0.17;</span></div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> phase_center_anita2_analysis=.2;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="comment">//const double gps_offset_anita2=atan2(0.89,-0.29);</span></div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gps_offset_anita2=atan2(-0.7085,0.7056); <span class="comment">// from elog 473</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> gps_offset_anita3= 45*RADDEG; <span class="comment">// Linda: 45 degrees from EventReader</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  <span class="keyword">const</span> <span class="keywordtype">double</span> phase_center_anita3=0.20; <span class="comment">// Linda: phase-centers are around 20 cm inwards of antennas face-end</span></div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;</div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==0) { <span class="comment">// anita-lite</span></div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        </div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    settings1-&gt;NFOLD=3;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;        </div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=0;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    PHI_EACHLAYER[0][0]=0.;</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    PHI_EACHLAYER[0][1]=22.5*RADDEG;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    NRX_PHI[0]=2;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    PHI_OFFSET[0]=0;</div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;    THETA_ZENITH[0]=PI/2+10.*RADDEG;</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;    LAYER_VPOSITION[0]=0.; <span class="comment">// vertical separation between layers</span></div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;    LAYER_HPOSITION[0]=0.;  <span class="comment">// position of layer relative to center axis in horizontal plane</span></div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;    LAYER_PHIPOSITION[0]=0.; <span class="comment">// phi of position of layer</span></div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;        </div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;      RRX[i]=3.006;</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    }</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        </div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NRX_PHI[0];i++) {</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;      VNOISE_ANITALITE[i]=<a class="code" href="../../dd/d24/class_chan_trigger.html#a7ee27fceaba30ae0beabce566468dfb0">ChanTrigger::GetNoise</a>(settings1,bn1-&gt;altitude_bn,bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a82033268c70493ca7c6e850e82e8c49d">surface_under_balloon</a>,THETA_ZENITH[i],settings1-&gt;BW_SEAVEYS,temp_eachrx[i]);</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;  } <span class="comment">//if (ANITA-lite)</span></div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    </div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <span class="comment">//Ross Payload</span></div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==1) {</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="comment">//settings1-&gt;NFOLD=8;</span></div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=1;</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        </div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    NRX_PHI[0]=5;</div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    NRX_PHI[1]=5;</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    NRX_PHI[2]=5;</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    NRX_PHI[3]=5;</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    NRX_PHI[4]=4;</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;        </div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    PHI_OFFSET[0]=0;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    PHI_OFFSET[1]=2*PI/(double)NRX_PHI[1]/2;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    PHI_OFFSET[2]=0;</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    PHI_OFFSET[3]=2*PI/(double)NRX_PHI[3]/2;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    PHI_OFFSET[4]=0;</div><div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;        </div><div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    THETA_ZENITH[0]=PI/2+10.*RADDEG;</div><div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    THETA_ZENITH[1]=PI/2+10.*RADDEG;</div><div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    THETA_ZENITH[2]=PI/2+10.*RADDEG;</div><div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    THETA_ZENITH[3]=PI/2+10.*RADDEG;</div><div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    THETA_ZENITH[4]=3*PI/4;</div><div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        </div><div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    <span class="comment">// anita proposal &quot;says that the separation between upper and lower</span></div><div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    <span class="comment">// 2 layers of antennas is just under 4m.</span></div><div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    LAYER_VPOSITION[0]=3.5;</div><div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    LAYER_VPOSITION[1]=2.0;</div><div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    LAYER_VPOSITION[2]=-0.5;</div><div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;    LAYER_VPOSITION[3]=-2.0;</div><div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;    LAYER_VPOSITION[4]=-3.5;</div><div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        </div><div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    LAYER_HPOSITION[0]=0.;</div><div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    LAYER_HPOSITION[1]=0.;</div><div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    LAYER_HPOSITION[2]=0.;</div><div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;    LAYER_HPOSITION[3]=0.;</div><div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    LAYER_HPOSITION[4]=0.;</div><div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;        </div><div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    LAYER_PHIPOSITION[0]=0.;</div><div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    LAYER_PHIPOSITION[1]=0.;</div><div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;    LAYER_PHIPOSITION[2]=0.;</div><div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    LAYER_PHIPOSITION[3]=0.;</div><div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    LAYER_PHIPOSITION[4]=0.;</div><div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;        </div><div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="comment">// position of layers in z relative to vertical center of the payload</span></div><div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;    <span class="comment">// radius that antennas sit at on the payload</span></div><div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;      RRX[i]=0.5;</div><div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    }</div><div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;        </div><div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;  } <span class="comment">//else if (Ross payload)</span></div><div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="comment">// Smex payload (full ANITA flown 2006-2007)</span></div><div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==2) {</div><div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=1;</div><div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        </div><div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;    <span class="comment">//these are physical layers</span></div><div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    NRX_PHI[0]=8;</div><div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    NRX_PHI[1]=8;</div><div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    NRX_PHI[2]=16;</div><div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;    NRX_PHI[3]=8;</div><div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        </div><div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;    PHITRIG[0]=16; <span class="comment">// number of positions in phi in each *trigger* layer</span></div><div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;    PHITRIG[1]=16;</div><div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;    PHITRIG[2]=8;</div><div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        </div><div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    <span class="comment">//these are physical layers again</span></div><div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    PHI_OFFSET[0]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="comment">// it&#39;s rotated by 1/2 the azimuth that separates two antennas on the 0th layer</span></div><div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;    PHI_OFFSET[1]=-2.*PI/(double)NRX_PHI[0]/2.;</div><div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    PHI_OFFSET[2]=-2.*PI/(double)NRX_PHI[0]/2.;</div><div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;    PHI_OFFSET[3]=-2.*PI/(double)NRX_PHI[0]/4.;</div><div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;        </div><div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="comment">//double INCLINE_NADIR=55; // this is set in the input file now EWG: so why not remove it?</span></div><div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        </div><div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    THETA_ZENITH[2]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;    THETA_ZENITH[3]=PI/2+INCLINE_NADIR*RADDEG;</div><div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;        </div><div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;    <span class="comment">// radius from center axis of the payload</span></div><div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    RRX[0] = 0.9210802;</div><div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;    RRX[1] = 0.7553198;</div><div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;    RRX[2] = 2.0645374;</div><div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;    RRX[3]=1.40; <span class="comment">// this is wrong, but I put this version of icemc here just to show one possible strategy to use V polarization and nadirs so it doesn&#39;t matter</span></div><div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;        </div><div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;    <span class="comment">// vertical separation between layers.</span></div><div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;    LAYER_VPOSITION[0]=0;</div><div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;    LAYER_VPOSITION[1] = -0.9670034;</div><div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    LAYER_VPOSITION[2] = -3.730752;</div><div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;    LAYER_VPOSITION[3]=(-3.175-0.948-0.889); <span class="comment">// this is wrong too, but nadirs are probably gone so doesn&#39;t matter.</span></div><div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;        </div><div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;    LAYER_HPOSITION[0]=0.;</div><div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    LAYER_HPOSITION[1] = 0.;</div><div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;    LAYER_HPOSITION[2] = 0.;</div><div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    LAYER_HPOSITION[3]=0.; <span class="comment">// this is wrong too, but nadirs are probably gone so doesn&#39;t matter.</span></div><div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        </div><div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        </div><div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;  } <span class="comment">//else if (SMEX payload - default)</span></div><div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==3) {</div><div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        </div><div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Is this configuration cylindrically symmetric? Yes(1) or No(0)\n&quot;</span>;</div><div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160;    cin &gt;&gt; settings1-&gt;CYLINDRICALSYMMETRY;</div><div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;        </div><div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;How many layers?\n&quot;</span>;</div><div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    cin &gt;&gt; settings1-&gt;NLAYERS;</div><div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;        </div><div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;settings1-&gt;NLAYERS;i++) {</div><div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;            </div><div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;How many antennas in the &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;th layer?\n&quot;</span>;</div><div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;      cin &gt;&gt; NRX_PHI[i];</div><div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;            </div><div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the offset in phi for the &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;th layer?\n&quot;</span>;</div><div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;      cin &gt;&gt; PHI_OFFSET[i];</div><div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;            </div><div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the theta ascent for the &quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;th layer (0 if pointed straight upwards, PI if pointed straight downwards)?\n&quot;</span>;</div><div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;      cin &gt;&gt; THETA_ZENITH[i];</div><div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;            </div><div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the vertical position of this layer relative to the vertical center of the payload?&quot;</span>;</div><div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;      cin &gt;&gt; LAYER_VPOSITION[i];</div><div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;            </div><div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the distance between of the vertical axis of the payload and the center of this layer?&quot;</span>;</div><div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;      cin &gt;&gt; LAYER_HPOSITION[i];</div><div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;            </div><div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the phi of this layer relative to the vertical center of the payload in the horizontal plane?&quot;</span>;</div><div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;      cin &gt;&gt; LAYER_PHIPOSITION[i];</div><div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;            </div><div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;            </div><div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            </div><div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;CYLINDRICALSYMMETRY==0) {</div><div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NRX_PHI[i];j++) {</div><div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;What is the phi of the &quot;</span> &lt;&lt; j &lt;&lt; <span class="stringliteral">&quot;th antenna is this layer?\n&quot;</span>;</div><div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;      cin &gt;&gt; PHI_EACHLAYER[i][j];</div><div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    } <span class="comment">//for (read antenna phi)</span></div><div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;      }<span class="comment">//if (not cylindrically symmetric)</span></div><div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    } <span class="comment">//for (antenna layers)</span></div><div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        </div><div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;How many polarizations must pass a voltage threshold?\n&quot;</span>;</div><div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;    cin &gt;&gt; settings1-&gt;NFOLD;</div><div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        </div><div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;How many times the expected noise level should the voltage threshold be?\n&quot;</span>;</div><div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;    cin &gt;&gt; maxthreshold;</div><div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;  } <span class="comment">//else if (custom payload)</span></div><div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;    </div><div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==4) {<span class="comment">// anita hill</span></div><div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;        </div><div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;    <span class="comment">//settings1-&gt;NFOLD=1; // how many channels must pass the trigger</span></div><div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;    <span class="comment">//maxthreshold=2.3;</span></div><div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;        </div><div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;NLAYERS!=2)</div><div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Warning!!! Did not enter the right number of layers in the input file.  For Anita Hill, it&#39;s 2.&quot;</span>;</div><div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        </div><div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=1;</div><div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;        </div><div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;    NRX_PHI[0]=1; <span class="comment">// this is how many antennas we have in phi on each &quot;layer&quot;</span></div><div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;    NRX_PHI[1]=1; <span class="comment">// for anita hill, we are calling each station a different &quot;layer&quot;</span></div><div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;        </div><div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;        </div><div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;    PHI_OFFSET[0]=(bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a3fb3960c3971912072c734c3df055f87">BN_LONGITUDE</a>+0.)*RADDEG; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    <span class="comment">// it&#39;s rotated by 1/2 the azimuth that separates two antennas on the 0th layer</span></div><div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;    PHI_OFFSET[1]=(bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a3fb3960c3971912072c734c3df055f87">BN_LONGITUDE</a>+0.)*RADDEG;</div><div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        </div><div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;phi_offsets are &quot;</span> &lt;&lt; PHI_OFFSET[0] &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; PHI_OFFSET[1] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;        </div><div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <span class="comment">//double INCLINE_NADIR=55; SET IN INPUT NOW!!!!</span></div><div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        </div><div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        </div><div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    <span class="comment">// radius from center axis of the payload</span></div><div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;    RRX[0] = 1.;</div><div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    RRX[1] = 1.;</div><div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;        </div><div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="comment">// vertical separation between layers.</span></div><div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    LAYER_VPOSITION[0]=0.;</div><div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    LAYER_VPOSITION[1] = 0.;</div><div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;        </div><div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    LAYER_HPOSITION[0]=0.;</div><div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    LAYER_HPOSITION[1] = 100.; <span class="comment">// in meters</span></div><div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;        </div><div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    LAYER_PHIPOSITION[0]=0.;</div><div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;    LAYER_PHIPOSITION[1] = 30.*RADDEG;<span class="comment">// in radians</span></div><div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;  }</div><div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    </div><div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span>(settings1-&gt;WHICH==6) { <span class="comment">// Kurt&#39;s measurements for the first flight in elog 345</span></div><div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="comment">//settings1-&gt;NFOLD=8;</span></div><div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=0;</div><div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        </div><div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    NRX_PHI[0]=8;</div><div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    NRX_PHI[1]=8;</div><div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;    NRX_PHI[2]=16;</div><div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        </div><div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    PHITRIG[0]=16; <span class="comment">// number of positions in phi in each trigger layer</span></div><div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    PHITRIG[1]=16;</div><div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    PHITRIG[2]=8;</div><div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;        </div><div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        </div><div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;    THETA_ZENITH[2]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        </div><div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;    PHI_OFFSET[0]=0.;</div><div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;    PHI_OFFSET[1]=0.;</div><div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    PHI_OFFSET[2]=0.;</div><div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        </div><div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    ANTENNA_POSITION_START[0][0][0] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(40.957,-39.29,125.38).RotateZ(-gps_offset);</div><div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;    ANTENNA_POSITION_START[0][0][1] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(57.608,0.606,124.97).RotateZ(-gps_offset);</div><div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    ANTENNA_POSITION_START[0][0][2] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(41.049,40.605,124.896).RotateZ(-gps_offset);</div><div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    ANTENNA_POSITION_START[0][0][3] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(1.032,57.128,124.93).RotateZ(-gps_offset);</div><div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;    ANTENNA_POSITION_START[0][0][4] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-38.832,40.508,125.607).RotateZ(-gps_offset);</div><div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    ANTENNA_POSITION_START[0][0][5] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-55.545,0.549,125.851).RotateZ(-gps_offset);</div><div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;    ANTENNA_POSITION_START[0][0][6] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-38.793,-39.423,126.105).RotateZ(-gps_offset);</div><div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;    ANTENNA_POSITION_START[0][0][7] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(1.113,-55.918,125.731).RotateZ(-gps_offset);</div><div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;    ANTENNA_POSITION_START[0][1][0] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(19.841,-45.739,87.738).RotateZ(-gps_offset);</div><div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;    ANTENNA_POSITION_START[0][1][1] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(46.959,-18.601,87.364).RotateZ(-gps_offset);</div><div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;    ANTENNA_POSITION_START[0][1][2] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(46.983,19.646,87.208).RotateZ(-gps_offset);</div><div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;    ANTENNA_POSITION_START[0][1][3] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(19.823,46.633,87.194).RotateZ(-gps_offset);</div><div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;    ANTENNA_POSITION_START[0][1][4] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-18.429,46.496,87.486).RotateZ(-gps_offset);</div><div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;    ANTENNA_POSITION_START[0][1][5] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-45.439,19.34,88.0).RotateZ(-gps_offset);</div><div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;    ANTENNA_POSITION_START[0][1][6] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-45.446,-18.769,88.183).RotateZ(-gps_offset);</div><div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;    ANTENNA_POSITION_START[0][1][7] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-18.297,-45.857,88.066).RotateZ(-gps_offset);</div><div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;    ANTENNA_POSITION_START[0][2][0] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(38.622,-94.184,-20.615).RotateZ(-gps_offset);</div><div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;    ANTENNA_POSITION_START[0][2][1] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(71.662,-72.036,-20.966).RotateZ(-gps_offset);</div><div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;    ANTENNA_POSITION_START[0][2][2] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(93.857,-39.130,-21.512).RotateZ(-gps_offset);</div><div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;    ANTENNA_POSITION_START[0][2][3] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(101.664,-0.202,-21.942).RotateZ(-gps_offset);</div><div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;    ANTENNA_POSITION_START[0][2][4] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(93.993,38.733,-22.351).RotateZ(-gps_offset);</div><div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;    ANTENNA_POSITION_START[0][2][5] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(71.92,71.815,-22.386).RotateZ(-gps_offset);</div><div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;    ANTENNA_POSITION_START[0][2][6] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(38.944,93.885,-22.274).RotateZ(-gps_offset);</div><div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;    ANTENNA_POSITION_START[0][2][7] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(0.036,101.619,-21.813).RotateZ(-gps_offset);</div><div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    ANTENNA_POSITION_START[0][2][8] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-38.991,93.809,-21.281).RotateZ(-gps_offset);</div><div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;    ANTENNA_POSITION_START[0][2][9] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-71.899,71.704,-20.777).RotateZ(-gps_offset);</div><div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    ANTENNA_POSITION_START[0][2][10] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-94.121,38.754,-20.825).RotateZ(-gps_offset);</div><div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;    ANTENNA_POSITION_START[0][2][11] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-101.986,-0.133,-20.71).RotateZ(-gps_offset);</div><div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    ANTENNA_POSITION_START[0][2][12] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-94.175,-39.024,-20.671).RotateZ(-gps_offset);</div><div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    ANTENNA_POSITION_START[0][2][13] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-72.138,-72.132,-20.295).RotateZ(-gps_offset);</div><div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;    ANTENNA_POSITION_START[0][2][14] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-39.111,-94.25,-20.23).RotateZ(-gps_offset);</div><div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    ANTENNA_POSITION_START[0][2][15] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(-0.163,-101.975,-20.229).RotateZ(-gps_offset);</div><div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;    PHI_EACHLAYER[0][0] = -45.103 * RADDEG - gps_offset;</div><div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;    PHI_EACHLAYER[0][1] = -0.14 * RADDEG - gps_offset;</div><div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;    PHI_EACHLAYER[0][2] = 44.559 * RADDEG - gps_offset;</div><div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;    PHI_EACHLAYER[0][3] = 89.959 * RADDEG - gps_offset;</div><div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    PHI_EACHLAYER[0][4] = 135.555 * RADDEG - gps_offset;</div><div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    PHI_EACHLAYER[0][5] = 179.651 * RADDEG - gps_offset;</div><div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;    PHI_EACHLAYER[0][6] = -135.14 * RADDEG - gps_offset;</div><div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;    PHI_EACHLAYER[0][7] = -90.18 * RADDEG - gps_offset;</div><div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;    PHI_EACHLAYER[1][0] = -67.283 * RADDEG - gps_offset;</div><div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;    PHI_EACHLAYER[1][1] = -23.004 * RADDEG - gps_offset;</div><div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    PHI_EACHLAYER[1][2] = 22.72 * RADDEG - gps_offset;</div><div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;    PHI_EACHLAYER[1][3] = 67.82 * RADDEG - gps_offset;</div><div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;    PHI_EACHLAYER[1][4] = 112.698 * RADDEG - gps_offset;</div><div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    PHI_EACHLAYER[1][5] = 157.565 * RADDEG - gps_offset;</div><div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;    PHI_EACHLAYER[1][6] = -157.376 * RADDEG - gps_offset;</div><div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    PHI_EACHLAYER[1][7] = -112.449 * RADDEG - gps_offset;</div><div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    PHI_EACHLAYER[2][0] = -67.26 * RADDEG - gps_offset;</div><div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    PHI_EACHLAYER[2][1] = -45.284 * RADDEG - gps_offset;</div><div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;    PHI_EACHLAYER[2][2] = -22.457 * RADDEG - gps_offset;</div><div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    PHI_EACHLAYER[2][3] = 0.227 * RADDEG - gps_offset;</div><div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;    PHI_EACHLAYER[2][4] = 22.318 * RADDEG - gps_offset;</div><div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    PHI_EACHLAYER[2][5] = 45.008 * RADDEG - gps_offset;</div><div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160;    PHI_EACHLAYER[2][6] = 67.751 * RADDEG - gps_offset;</div><div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    PHI_EACHLAYER[2][7] = 89.913 * RADDEG - gps_offset;</div><div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    PHI_EACHLAYER[2][8] = 113.016 * RADDEG - gps_offset;</div><div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    PHI_EACHLAYER[2][9] = 135.608 * RADDEG - gps_offset;</div><div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    PHI_EACHLAYER[2][10] = 157.487 * RADDEG - gps_offset;</div><div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;    PHI_EACHLAYER[2][11] = 179.709 * RADDEG - gps_offset;</div><div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    PHI_EACHLAYER[2][12] = -157.569 * RADDEG - gps_offset;</div><div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;    PHI_EACHLAYER[2][13] = -135.021 * RADDEG - gps_offset;</div><div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    PHI_EACHLAYER[2][14] = -112.773 * RADDEG - gps_offset;</div><div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    PHI_EACHLAYER[2][15] = -89.959 * RADDEG - gps_offset;</div><div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;    ANTENNA_DOWN[0][0] = 10.422 * RADDEG;</div><div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    ANTENNA_DOWN[0][1] = 10.207 * RADDEG;</div><div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160;    ANTENNA_DOWN[0][2] = 10.714 * RADDEG;</div><div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    ANTENNA_DOWN[0][3] = 10.381 * RADDEG;</div><div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    ANTENNA_DOWN[0][4] = 10.026 * RADDEG;</div><div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    ANTENNA_DOWN[0][5] = 9.515 * RADDEG;</div><div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    ANTENNA_DOWN[0][6] = 9.677 * RADDEG;</div><div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    ANTENNA_DOWN[0][7] = 9.544 * RADDEG;</div><div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;    ANTENNA_DOWN[1][0] = 10.183 * RADDEG;</div><div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    ANTENNA_DOWN[1][1] = 10.44 * RADDEG;</div><div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    ANTENNA_DOWN[1][2] = 10.562 * RADDEG;</div><div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;    ANTENNA_DOWN[1][3] = 10.655 * RADDEG;</div><div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    ANTENNA_DOWN[1][4] = 10.265 * RADDEG;</div><div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;    ANTENNA_DOWN[1][5] = 9.77 * RADDEG;</div><div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    ANTENNA_DOWN[1][6] = 9.422 * RADDEG;</div><div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    ANTENNA_DOWN[1][7] = 9.526 * RADDEG;</div><div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;    ANTENNA_DOWN[2][0] = 9.364 * RADDEG;</div><div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;    ANTENNA_DOWN[2][1] = 9.712 * RADDEG;</div><div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;    ANTENNA_DOWN[2][2] = 9.892 * RADDEG;</div><div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    ANTENNA_DOWN[2][3] = 10.253 * RADDEG;</div><div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    ANTENNA_DOWN[2][4] = 10.574 * RADDEG;</div><div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;    ANTENNA_DOWN[2][5] = 10.62 * RADDEG;</div><div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;    ANTENNA_DOWN[2][6] = 10.416 * RADDEG;</div><div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;    ANTENNA_DOWN[2][7] = 10.189 * RADDEG;</div><div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;    ANTENNA_DOWN[2][8] = 9.776 * RADDEG;</div><div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;    ANTENNA_DOWN[2][9] = 9.596 * RADDEG;</div><div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;    ANTENNA_DOWN[2][10] = 9.561 * RADDEG;</div><div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    ANTENNA_DOWN[2][11] = 9.695 * RADDEG;</div><div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;    ANTENNA_DOWN[2][12] = 9.445 * RADDEG;</div><div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    ANTENNA_DOWN[2][13] = 9.387 * RADDEG;</div><div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;    ANTENNA_DOWN[2][14] = 9.398 * RADDEG;</div><div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;    ANTENNA_DOWN[2][15] = 9.288 * RADDEG;</div><div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii = 0; iii &lt; 3; iii++) <span class="comment">// move from the square centers to the phase centers</span></div><div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jjj = 0; jjj &lt; NRX_PHI[iii]; jjj++)</div><div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    ANTENNA_POSITION_START[1][iii][jjj] = ANTENNA_POSITION_START[0][iii][jjj] = ANTENNA_POSITION_START[0][iii][jjj] - phase_center * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(cos(PHI_EACHLAYER[iii][jjj])*sin(90.*RADDEG+ANTENNA_DOWN[iii][jjj]), sin(PHI_EACHLAYER[iii][jjj])*sin(90.*RADDEG+ANTENNA_DOWN[iii][jjj]), cos(90.*RADDEG+ANTENNA_DOWN[iii][jjj]));</div><div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;  }</div><div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==7) {</div><div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        </div><div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;    <span class="comment">// Just one layer of antennas around balloon</span></div><div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;    <span class="comment">// EeVEX</span></div><div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        </div><div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    <span class="comment">//   settings1-&gt;NFOLD=1; //</span></div><div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    <span class="comment">//maxthreshold=2.3;</span></div><div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;        </div><div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=1;</div><div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;        </div><div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;    NRX_PHI[0]=360;</div><div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;    NRX_PHI[1]=360;</div><div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    NRX_PHI[2]=360;</div><div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    NRX_PHI[3]=360;</div><div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;    NRX_PHI[4]=360;</div><div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        </div><div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    PHITRIG[0]=360;</div><div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;    PHITRIG[1]=360;</div><div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;    PHITRIG[2]=360;</div><div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;    PHITRIG[3]=360;</div><div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;    PHITRIG[4]=360;</div><div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        </div><div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        </div><div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    PHI_OFFSET[0]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    PHI_OFFSET[1]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;    PHI_OFFSET[2]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;    PHI_OFFSET[3]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;    PHI_OFFSET[4]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    <span class="comment">// it&#39;s rotated by 1/2 the azimuth that separates two antennas on the 0th layer</span></div><div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        </div><div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;    THETA_ZENITH[0]=PI/2+5.5*RADDEG;</div><div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;    THETA_ZENITH[1]=PI/2+7.5*RADDEG;</div><div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;    THETA_ZENITH[2]=PI/2+9.5*RADDEG;</div><div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;    THETA_ZENITH[3]=PI/2+11.5*RADDEG;</div><div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;    THETA_ZENITH[4]=PI/2+13.5*RADDEG;</div><div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        </div><div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;        </div><div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    <span class="comment">// radius from center axis of the payload</span></div><div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;    RRX[0] = 0.9210802;</div><div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;    RRX[1] = 0.9210802;</div><div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;    RRX[2] = 0.9210802;</div><div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    RRX[3] = 0.9210802;</div><div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;    RRX[4] = 0.9210802;</div><div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        </div><div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;    <span class="comment">// vertical separation between layers.</span></div><div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;    LAYER_VPOSITION[0]=0;</div><div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    LAYER_VPOSITION[1]=10.;</div><div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;    LAYER_VPOSITION[2]=20.;</div><div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    LAYER_VPOSITION[3]=30.;</div><div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    LAYER_VPOSITION[4]=40.;</div><div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;        </div><div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;    LAYER_HPOSITION[0]=0.;</div><div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    LAYER_HPOSITION[1]=0.;</div><div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;    LAYER_HPOSITION[2]=0.;</div><div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    LAYER_HPOSITION[3]=0.;</div><div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;    LAYER_HPOSITION[4]=0.;</div><div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;        </div><div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;  } <span class="comment">//else if (EeVEX)</span></div><div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;    <span class="comment">//anitaII or satellite</span></div><div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==8) {</div><div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    cout&lt;&lt;<span class="stringliteral">&quot;initializing and using anitaII payload geometry&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        </div><div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;    <span class="comment">// layer 0 is antennas 1-8 on the payload</span></div><div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;    <span class="comment">// layer 1 is antennas 9-15</span></div><div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    <span class="comment">// layer 2 is antennas 16-32</span></div><div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;        </div><div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="comment">//settings1-&gt;NFOLD=8;</span></div><div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;    <span class="comment">//maxthreshold=2.3;</span></div><div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        </div><div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=0;</div><div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        </div><div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160;    NRX_PHI[0]=8;</div><div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;    NRX_PHI[1]=8;</div><div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;    NRX_PHI[2]=16;</div><div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    NRX_PHI[3]=8;</div><div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;        </div><div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;    PHITRIG[0]=16; <span class="comment">// number of positions in phi in each trigger layer</span></div><div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    PHITRIG[1]=16;</div><div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;    PHITRIG[2]=8;</div><div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;        </div><div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    PHI_OFFSET[0]=0.;</div><div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    PHI_OFFSET[1]=0;</div><div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;    PHI_OFFSET[2]=0;</div><div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;    PHI_OFFSET[3]=0;</div><div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        </div><div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;    THETA_ZENITH[2]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;    THETA_ZENITH[3]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        </div><div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;    ANTENNA_POSITION_START[0][0][0] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(40.438,-36.958,147.227);</div><div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    ANTENNA_POSITION_START[0][0][1] = MINCH * Vector(57.134,3.109,146.476);</div><div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;    ANTENNA_POSITION_START[0][0][2] = MINCH * Vector(40.549,43.106,145.871);</div><div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    ANTENNA_POSITION_START[0][0][3] = MINCH * Vector(0.624,59.688,145.361);</div><div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160;    ANTENNA_POSITION_START[0][0][4] = MINCH * Vector(-39.455,43.147,145.928);</div><div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    ANTENNA_POSITION_START[0][0][5] = MINCH * Vector(-56.096,3.177,146.894);</div><div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;    ANTENNA_POSITION_START[0][0][6] = MINCH * Vector(-39.355,-36.753,147.757);</div><div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    ANTENNA_POSITION_START[0][0][7] = MINCH * Vector(0.645,-53.539,147.876);</div><div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;    ANTENNA_POSITION_START[0][1][0] = MINCH * Vector(19.554,-43.890,109.531);</div><div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    ANTENNA_POSITION_START[0][1][1] = MINCH * Vector(46.600,-16.625,108.889);</div><div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    ANTENNA_POSITION_START[0][1][2] = MINCH * Vector(46.587,21.659,108.220);</div><div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;    ANTENNA_POSITION_START[0][1][3] = MINCH * Vector(19.476,48.539,107.671);</div><div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    ANTENNA_POSITION_START[0][1][4] = MINCH * Vector(-18.798,48.502,107.852);</div><div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    ANTENNA_POSITION_START[0][1][5] = MINCH * Vector(-45.899,21.424,108.516);</div><div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    ANTENNA_POSITION_START[0][1][6] = MINCH * Vector(-45.895,-16.821,109.354);</div><div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    ANTENNA_POSITION_START[0][1][7] = MINCH * Vector(-18.691,-43.864,109.843);</div><div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;    ANTENNA_POSITION_START[0][2][0] = MINCH * Vector(38.636,-93.988,2.636);</div><div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160;    ANTENNA_POSITION_START[0][2][1] = MINCH * Vector(71.690,-72.108,1.953);</div><div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;    ANTENNA_POSITION_START[0][2][2] = MINCH * Vector(93.897,-39.211,0.498);</div><div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    ANTENNA_POSITION_START[0][2][3] = MINCH * Vector(101.790,-0.212,-0.661);</div><div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    ANTENNA_POSITION_START[0][2][4] = MINCH * Vector(94.047,38.773,-1.788);</div><div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    ANTENNA_POSITION_START[0][2][5] = MINCH * Vector(72.080,71.816,-2.223);</div><div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    ANTENNA_POSITION_START[0][2][6] = MINCH * Vector(39.065,93.999,-2.561);</div><div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    ANTENNA_POSITION_START[0][2][7] = MINCH * Vector(0.121,101.815,-2.314);</div><div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    ANTENNA_POSITION_START[0][2][8] = MINCH * Vector(-38.815,94.002,-2.034);</div><div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    ANTENNA_POSITION_START[0][2][9] = MINCH * Vector(-71.809,71.912,-1.102);</div><div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;    ANTENNA_POSITION_START[0][2][10] = MINCH * Vector(-93.886,39.000,-0.673);</div><div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;    ANTENNA_POSITION_START[0][2][11] = MINCH * Vector(-101.885,0.048,0.102);</div><div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    ANTENNA_POSITION_START[0][2][12] = MINCH * Vector(-94.017,-38.841,0.865);</div><div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;    ANTENNA_POSITION_START[0][2][13] = MINCH * Vector(-72.079,-71.902,1.864);</div><div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    ANTENNA_POSITION_START[0][2][14] = MINCH * Vector(-39.152,-93.935,2.464);</div><div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    ANTENNA_POSITION_START[0][2][15] = MINCH * Vector(-0.290,-101.771,2.991);</div><div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    ANTENNA_POSITION_START[0][3][0] = MINCH * Vector(32.625,-82.045,-71.140);</div><div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    ANTENNA_POSITION_START[0][3][1] = MINCH * Vector(79.071,-35.639,-72.809);</div><div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;    ANTENNA_POSITION_START[0][3][2] = MINCH * Vector(79.172,30.988,-74.893);</div><div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    ANTENNA_POSITION_START[0][3][3] = MINCH * Vector(32.608,77.414,-75.342);</div><div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    ANTENNA_POSITION_START[0][3][4] = MINCH * Vector(-33.398,78.088,-74.957);</div><div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    ANTENNA_POSITION_START[0][3][5] = MINCH * Vector(-79.367,31.568,-73.922);</div><div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    ANTENNA_POSITION_START[0][3][6] = MINCH * Vector(-78.900,-34.192,-72.645);</div><div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    ANTENNA_POSITION_START[0][3][7] = MINCH * Vector(-33.046,-81.696,-70.907);</div><div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;    PHI_EACHLAYER[0][0] = -45.012 * RADDEG ;<span class="comment">//ant 7</span></div><div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    PHI_EACHLAYER[0][1] = -0.588 * RADDEG ;<span class="comment">//ant 0</span></div><div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160;    PHI_EACHLAYER[0][2] = 45.694 * RADDEG ;<span class="comment">//ant 1</span></div><div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;    PHI_EACHLAYER[0][3] = 90.310 * RADDEG ;<span class="comment">//ant 2</span></div><div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    PHI_EACHLAYER[0][4] = 135.161 * RADDEG ;<span class="comment">//ant3</span></div><div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    PHI_EACHLAYER[0][5] = 179.861 * RADDEG ;<span class="comment">//ant4</span></div><div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;    PHI_EACHLAYER[0][6] = -134.930 * RADDEG ;<span class="comment">//ant5</span></div><div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    PHI_EACHLAYER[0][7] = -90.638 * RADDEG ;<span class="comment">//ant 6</span></div><div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    PHI_EACHLAYER[1][0] = -67.412 * RADDEG ;<span class="comment">//ant 15</span></div><div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    PHI_EACHLAYER[1][1] = -23.005 * RADDEG ;<span class="comment">//ant 8</span></div><div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    PHI_EACHLAYER[1][2] = 22.503 * RADDEG ;<span class="comment">//ant 9</span></div><div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;    PHI_EACHLAYER[1][3] = 67.722 * RADDEG ;<span class="comment">//ant 10</span></div><div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;    PHI_EACHLAYER[1][4] = 112.614 * RADDEG ;<span class="comment">//ant 11</span></div><div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;    PHI_EACHLAYER[1][5] = 157.685 * RADDEG ;<span class="comment">//ant 12</span></div><div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;    PHI_EACHLAYER[1][6] = -156.639 * RADDEG ;<span class="comment">//ant 13</span></div><div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    PHI_EACHLAYER[1][7] = -112.587 * RADDEG ;<span class="comment">//ant 14</span></div><div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    PHI_EACHLAYER[2][0] = -67.365 * RADDEG ;<span class="comment">//ant 29 </span></div><div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;    PHI_EACHLAYER[2][1] = -45.135 * RADDEG ;<span class="comment">//ant 30</span></div><div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    PHI_EACHLAYER[2][2] = -23.002 * RADDEG ;<span class="comment">//ant 31</span></div><div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    PHI_EACHLAYER[2][3] = -1.013 * RADDEG ;<span class="comment">//ant 16</span></div><div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    PHI_EACHLAYER[2][4] = 21.934 * RADDEG ;<span class="comment">//ant 17</span></div><div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;    PHI_EACHLAYER[2][5] = 44.467 * RADDEG ;<span class="comment">//ant 18</span></div><div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;    PHI_EACHLAYER[2][6] = 67.288 * RADDEG ;<span class="comment">//ant 19</span></div><div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;    PHI_EACHLAYER[2][7] = 89.971 * RADDEG ;<span class="comment">//ant 20</span></div><div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    PHI_EACHLAYER[2][8] = 112.390 * RADDEG ;<span class="comment">//ant 21</span></div><div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;    PHI_EACHLAYER[2][9] = 134.988 * RADDEG ;<span class="comment">//ant 22</span></div><div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    PHI_EACHLAYER[2][10] = 157.387 * RADDEG ;<span class="comment">//ant 23</span></div><div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;    PHI_EACHLAYER[2][11] = 179.843 * RADDEG ;<span class="comment">//ant 24</span></div><div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    PHI_EACHLAYER[2][12] = -157.444 * RADDEG ;<span class="comment">//ant 25</span></div><div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    PHI_EACHLAYER[2][13] = -134.877 * RADDEG ;<span class="comment">//ant 26</span></div><div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    PHI_EACHLAYER[2][14] = -112.406 * RADDEG ;<span class="comment">//ant 27</span></div><div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    PHI_EACHLAYER[2][15] = -90.081 * RADDEG ;<span class="comment">//ant 28</span></div><div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    PHI_EACHLAYER[3][0] = -67.997 * RADDEG ;<span class="comment">//ant </span></div><div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    PHI_EACHLAYER[3][1] = -22.948 * RADDEG ;<span class="comment">//ant </span></div><div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;    PHI_EACHLAYER[3][2] = 22.382 * RADDEG ;<span class="comment">//ant</span></div><div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    PHI_EACHLAYER[3][3] = 67.583 * RADDEG ;<span class="comment">//ant</span></div><div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    PHI_EACHLAYER[3][4] = 112.844 * RADDEG ;<span class="comment">//ant</span></div><div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    PHI_EACHLAYER[3][5] = 157.761 * RADDEG ;<span class="comment">//ant </span></div><div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    PHI_EACHLAYER[3][6] = -157.896 * RADDEG ;<span class="comment">//ant</span></div><div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    PHI_EACHLAYER[3][7] = -112.791 * RADDEG ;<span class="comment">//ant</span></div><div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;    ANTENNA_DOWN[0][0] = 9.637 * RADDEG;</div><div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;    ANTENNA_DOWN[0][1] = 10.108 * RADDEG;</div><div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    ANTENNA_DOWN[0][2] = 11.245 * RADDEG;</div><div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    ANTENNA_DOWN[0][3] = 11.291 * RADDEG;</div><div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;    ANTENNA_DOWN[0][4] = 10.988 * RADDEG;</div><div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    ANTENNA_DOWN[0][5] = 9.491 * RADDEG;</div><div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    ANTENNA_DOWN[0][6] = 9.027 * RADDEG;</div><div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    ANTENNA_DOWN[0][7] = 8.743 * RADDEG;</div><div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;    ANTENNA_DOWN[1][0] = 9.445 * RADDEG;</div><div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;    ANTENNA_DOWN[1][1] = 10.061 * RADDEG;</div><div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;    ANTENNA_DOWN[1][2] = 10.772 * RADDEG;</div><div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    ANTENNA_DOWN[1][3] = 11.484 * RADDEG;</div><div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;    ANTENNA_DOWN[1][4] = 11.122 * RADDEG;</div><div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;    ANTENNA_DOWN[1][5] = 10.376 * RADDEG;</div><div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;    ANTENNA_DOWN[1][6] = 9.410 * RADDEG;</div><div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;    ANTENNA_DOWN[1][7] = 9.039 * RADDEG;</div><div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    ANTENNA_DOWN[2][0] = 8.233 * RADDEG;</div><div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    ANTENNA_DOWN[2][1] = 8.807 * RADDEG;</div><div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;    ANTENNA_DOWN[2][2] = 9.120 * RADDEG;</div><div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;    ANTENNA_DOWN[2][3] = 10.352 * RADDEG;</div><div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;    ANTENNA_DOWN[2][4] = 10.889 * RADDEG;</div><div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;    ANTENNA_DOWN[2][5] = 11.315 * RADDEG;</div><div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;    ANTENNA_DOWN[2][6] = 11.402 * RADDEG;</div><div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    ANTENNA_DOWN[2][7] = 11.379 * RADDEG;</div><div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;    ANTENNA_DOWN[2][8] = 10.842 * RADDEG;</div><div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;    ANTENNA_DOWN[2][9] = 10.725 * RADDEG;</div><div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;    ANTENNA_DOWN[2][10] = 10.143 * RADDEG;</div><div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;    ANTENNA_DOWN[2][11] = 10.067 * RADDEG;</div><div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    ANTENNA_DOWN[2][12] = 9.503 * RADDEG;</div><div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    ANTENNA_DOWN[2][13] = 9.021 * RADDEG;</div><div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    ANTENNA_DOWN[2][14] = 8.453 * RADDEG;</div><div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    ANTENNA_DOWN[2][15] = 8.268 * RADDEG;</div><div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;    ANTENNA_DOWN[3][0] = 8.007 * RADDEG;</div><div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;    ANTENNA_DOWN[3][1] = 9.817 * RADDEG;</div><div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;    ANTENNA_DOWN[3][2] = 10.259 * RADDEG;</div><div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    ANTENNA_DOWN[3][3] = 11.648 * RADDEG;</div><div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    ANTENNA_DOWN[3][4] = 10.271 * RADDEG;</div><div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;    ANTENNA_DOWN[3][5] = 10.015 * RADDEG;</div><div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    ANTENNA_DOWN[3][6] = 10.889 * RADDEG;</div><div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    ANTENNA_DOWN[3][7] = 7.314 * RADDEG;</div><div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;</div><div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;    SIMON_DELTA_R[0][0] = -0.0384839;</div><div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    SIMON_DELTA_R[0][1] = 0.00634697;</div><div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    SIMON_DELTA_R[0][2] = -0.0861167;</div><div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    SIMON_DELTA_R[0][3] = 0.0461873;</div><div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;    SIMON_DELTA_R[0][4] = 0.0153388;</div><div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    SIMON_DELTA_R[0][5] = -0.00927728;</div><div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;    SIMON_DELTA_R[0][6] = 0.0239867;</div><div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    SIMON_DELTA_R[0][7] = 0.0125282;</div><div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;    SIMON_DELTA_R[1][0] = -0.0111636;</div><div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;    SIMON_DELTA_R[1][1] = -0.0959452;</div><div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    SIMON_DELTA_R[1][2] = -0.0330808;</div><div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;    SIMON_DELTA_R[1][3] = -0.0475617;</div><div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;    SIMON_DELTA_R[1][4] = 0.0196292;</div><div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    SIMON_DELTA_R[1][5] = -0.0190837;</div><div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;    SIMON_DELTA_R[1][6] = -0.00922367;</div><div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    SIMON_DELTA_R[1][7] = -0.0294811;</div><div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    SIMON_DELTA_R[2][0] = 0.0140245;</div><div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;    SIMON_DELTA_R[2][1] = -0.0621836;</div><div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;    SIMON_DELTA_R[2][2] = -0.0379325;</div><div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;    SIMON_DELTA_R[2][3] = -0.0108062;</div><div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;    SIMON_DELTA_R[2][4] = -0.0601935;</div><div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    SIMON_DELTA_R[2][5] = -0.0968276;</div><div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    SIMON_DELTA_R[2][6] = -0.0348523;</div><div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    SIMON_DELTA_R[2][7] = 0.0121726;</div><div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    SIMON_DELTA_R[2][8] = 0.0405193;</div><div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;    SIMON_DELTA_R[2][9] = 0.0239992;</div><div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    SIMON_DELTA_R[2][10] = -0.0405203;</div><div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;    SIMON_DELTA_R[2][11] = -0.00401756;</div><div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    SIMON_DELTA_R[2][12] = -0.0362955;</div><div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;    SIMON_DELTA_R[2][13] = -0.00587152;</div><div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    SIMON_DELTA_R[2][14] = -0.00611182;</div><div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    SIMON_DELTA_R[2][15] = -0.00321244;</div><div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    SIMON_DELTA_R[3][0] = -0.0437687;</div><div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;    SIMON_DELTA_R[3][1] = -0.0643475;</div><div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;    SIMON_DELTA_R[3][2] = -0.0804245;</div><div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;    SIMON_DELTA_R[3][3] = -0.0112675;</div><div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    SIMON_DELTA_R[3][4] = 0.0337428;</div><div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    SIMON_DELTA_R[3][5] = -0.0525977;</div><div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    SIMON_DELTA_R[3][6] = -0.101587;</div><div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    SIMON_DELTA_R[3][7] = -0.0401037;</div><div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;</div><div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;    SIMON_DELTA_PHI[0][0] = -0.0100608;</div><div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;    SIMON_DELTA_PHI[0][1] = -0.00313443;</div><div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;    SIMON_DELTA_PHI[0][2] = -0.015312;</div><div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;    SIMON_DELTA_PHI[0][3] = 0.00206827;</div><div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;    SIMON_DELTA_PHI[0][4] = -0.0227948;</div><div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;    SIMON_DELTA_PHI[0][5] = 0.00750385;</div><div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    SIMON_DELTA_PHI[0][6] = 0.00388065;</div><div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;    SIMON_DELTA_PHI[0][7] = -0.00131021;</div><div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;    SIMON_DELTA_PHI[1][0] = -0.0299233;</div><div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;    SIMON_DELTA_PHI[1][1] = -0.00165365;</div><div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;    SIMON_DELTA_PHI[1][2] = -0.0107407;</div><div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;    SIMON_DELTA_PHI[1][3] = 0.0145914;</div><div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;    SIMON_DELTA_PHI[1][4] = -0.0150373;</div><div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;    SIMON_DELTA_PHI[1][5] = -0.0121967;</div><div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;    SIMON_DELTA_PHI[1][6] = -0.0038106;</div><div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    SIMON_DELTA_PHI[1][7] = 0.0106842;</div><div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;    SIMON_DELTA_PHI[2][0] = -0.0087849;</div><div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    SIMON_DELTA_PHI[2][1] = 0.000682206;</div><div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    SIMON_DELTA_PHI[2][2] = -0.00516052;</div><div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    SIMON_DELTA_PHI[2][3] = -0.00770935;</div><div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    SIMON_DELTA_PHI[2][4] = -0.00862535;</div><div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    SIMON_DELTA_PHI[2][5] = -0.00920648;</div><div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    SIMON_DELTA_PHI[2][6] = 0.00037431;</div><div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;    SIMON_DELTA_PHI[2][7] = 0.00310935;</div><div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;    SIMON_DELTA_PHI[2][8] = -0.00546085;</div><div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;    SIMON_DELTA_PHI[2][9] = -0.00901249;</div><div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;    SIMON_DELTA_PHI[2][10] = -0.0145529;</div><div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;    SIMON_DELTA_PHI[2][11] = -0.00666063;</div><div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;    SIMON_DELTA_PHI[2][12] = -0.00372999;</div><div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;    SIMON_DELTA_PHI[2][13] = 0.00197442;</div><div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;    SIMON_DELTA_PHI[2][14] = -0.000789595;</div><div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;    SIMON_DELTA_PHI[2][15] = 0.000188257;</div><div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;    SIMON_DELTA_PHI[3][0] = -0.00289577;</div><div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;    SIMON_DELTA_PHI[3][1] = -0.0203117;</div><div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    SIMON_DELTA_PHI[3][2] = -0.00503387;</div><div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    SIMON_DELTA_PHI[3][3] = -0.000220575;</div><div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;    SIMON_DELTA_PHI[3][4] = -0.00416114;</div><div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;    SIMON_DELTA_PHI[3][5] = -0.0223176;</div><div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;    SIMON_DELTA_PHI[3][6] = 0.0058874;</div><div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;    SIMON_DELTA_PHI[3][7] = 0.00899651;</div><div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;        </div><div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii = 0; iii &lt; 4; iii++){ <span class="comment">// move from the square centers to the phase centers</span></div><div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jjj = 0; jjj &lt; NRX_PHI[iii]; jjj++){</div><div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;             </div><div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;    <span class="comment">//ANTENNA_DOWN is measured from horiztonal. Put negatives in correct places. Verified with analysis code </span></div><div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    ANTENNA_POSITION_START[0][iii][jjj] = ANTENNA_POSITION_START[0][iii][jjj] - phase_center_anita2_analysis * Vector(cos(PHI_EACHLAYER[iii][jjj])*cos(-1*ANTENNA_DOWN[iii][jjj]), sin(PHI_EACHLAYER[iii][jjj])*cos(-1*ANTENNA_DOWN[iii][jjj]), sin(-1*ANTENNA_DOWN[iii][jjj]));</div><div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;      }<span class="comment">//jjj</span></div><div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    }<span class="comment">//iii</span></div><div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;    <span class="keywordtype">double</span> r;</div><div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;    <span class="keywordtype">double</span> phi;</div><div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        </div><div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;    <span class="keywordtype">double</span> x;</div><div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;    <span class="keywordtype">double</span> y;</div><div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;    <span class="keywordtype">double</span> z;</div><div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;</div><div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;    </div><div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii = 0; iii &lt; 4; iii++){ <span class="comment">// move from the square centers to the phase centers</span></div><div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jjj = 0; jjj &lt; NRX_PHI[iii]; jjj++){</div><div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;    x = ANTENNA_POSITION_START[0][iii][jjj][0];</div><div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;    y = ANTENNA_POSITION_START[0][iii][jjj][1];</div><div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    z = ANTENNA_POSITION_START[0][iii][jjj][2];</div><div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;</div><div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;    r = sqrt(pow(x,2)+pow(y,2));</div><div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;    phi = atan2(y,x);</div><div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;           </div><div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    ANTENNA_POSITION_START[0][iii][jjj]= Vector((r+SIMON_DELTA_R[iii][jjj])*cos(phi+SIMON_DELTA_PHI[iii][jjj]),(r+SIMON_DELTA_R[iii][jjj])*sin(phi+SIMON_DELTA_PHI[iii][jjj]),z);</div><div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;           </div><div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;    ANTENNA_POSITION_START[1][iii][jjj]=ANTENNA_POSITION_START[0][iii][jjj]=ANTENNA_POSITION_START[0][iii][jjj].RotateZ(-gps_offset_anita2);</div><div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;    PHI_EACHLAYER[iii][jjj]=atan2(ANTENNA_POSITION_START[0][iii][jjj][1],ANTENNA_POSITION_START[0][iii][jjj][0]);<span class="comment">//set phi of each antennas to correct starting position</span></div><div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;</div><div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;    <span class="comment">//cout&lt;&lt;&quot;Antenna pos is &quot;&lt;&lt;ANTENNA_POSITION_START[0][iii][jjj]&lt;&lt;&quot; PHI is &quot;&lt;&lt;PHI_EACHLAYER[iii][jjj]&lt;&lt;&quot;\n&quot;;</span></div><div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;      }</div><div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;    }</div><div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;</div><div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;        </div><div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;  } </div><div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10) { <span class="comment">// ANITA-3 and ANITA-4</span></div><div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;    </div><div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;    <span class="comment">// Read photogrammetry positions</span></div><div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    <span class="keywordtype">string</span> whichANITAroman=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9) whichANITAroman+=<span class="stringliteral">&quot;III&quot;</span>;</div><div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    <span class="keywordflow">else</span> whichANITAroman+=<span class="stringliteral">&quot;IV&quot;</span>;</div><div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    cout&lt;&lt;<span class="stringliteral">&quot;Initializing and using ANITA-&quot;</span> &lt;&lt; whichANITAroman &lt;&lt; <span class="stringliteral">&quot; payload geometry&quot;</span>&lt;&lt;endl;</div><div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;    </div><div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    <span class="comment">// layer 0 is antennas 1-8 on the payload</span></div><div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;    <span class="comment">// layer 1 is antennas 9-15</span></div><div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <span class="comment">// layer 2 is antennas 16-32</span></div><div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    <span class="comment">// layer 3 is antennas 32-48</span></div><div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;        </div><div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160;      </div><div class="line"><a name="l03401"></a><span class="lineno"> 3401</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=0;</div><div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;      </div><div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="comment">//these are physical layers</span></div><div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    NRX_PHI[0]=8;</div><div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;    NRX_PHI[1]=8;</div><div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    NRX_PHI[2]=16;</div><div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;    NRX_PHI[3]=16;</div><div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;      </div><div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    PHITRIG[0]=16; <span class="comment">// number of positions in phi in each *trigger* layer</span></div><div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    PHITRIG[1]=16;</div><div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    PHITRIG[2]=16;</div><div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;      </div><div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;    <span class="comment">//these are physical layers again</span></div><div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    PHI_OFFSET[0]=0.; </div><div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    PHI_OFFSET[1]=0.; <span class="comment">// 2.*PI/(double)NRX_PHI[0]/2.; // Linda: changed this offset to 0 as  it shouldn&#39;t be needed</span></div><div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    PHI_OFFSET[2]=0.;</div><div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    PHI_OFFSET[3]=0.;</div><div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;      </div><div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;    <span class="comment">//double INCLINE_NADIR=55; // this is set in the input file now So should be removed</span></div><div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;      </div><div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    THETA_ZENITH[2]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;    THETA_ZENITH[3]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;      </div><div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    <span class="keywordtype">string</span> photoFile;</div><div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    photoFile += ( (string)getenv(<span class="stringliteral">&quot;ANITA_UTIL_INSTALL_DIR&quot;</span>) +<span class="stringliteral">&quot;/share/anitaCalib/anita&quot;</span>+whichANITAroman+<span class="stringliteral">&quot;Photogrammetry.csv&quot;</span>);</div><div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    photoFile += (ICEMC_DATA_DIR+<span class="stringliteral">&quot;/anita&quot;</span>+whichANITAroman+<span class="stringliteral">&quot;Photogrammetry.csv&quot;</span>);</div><div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    </div><div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;    std::ifstream Anita3PhotoFile(photoFile.c_str());</div><div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;      <span class="keywordflow">if</span> (!Anita3PhotoFile){</div><div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;      std::cerr &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t open photogrammetry!&quot;</span> &lt;&lt; std::endl;</div><div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;      <span class="keywordflow">return</span>;</div><div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    }</div><div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;</div><div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    <span class="comment">//First up are the antenna positions</span></div><div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    TString line;</div><div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;2;i++) {</div><div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;      line.ReadLine(Anita3PhotoFile);</div><div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;      <span class="comment">//std::cout &lt;&lt; line.Data() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;    }</div><div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;</div><div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;    <span class="comment">//Array with photogrammetry values</span></div><div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    Double_t xAntPhoto[48]; <span class="comment">//inch</span></div><div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    Double_t yAntPhoto[48]; <span class="comment">//inch</span></div><div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;    Double_t zAntPhoto[48]; <span class="comment">//inch</span></div><div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    Double_t rAntPhoto[48]; <span class="comment">//inch</span></div><div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;    Double_t azCentrePhoto[48]; <span class="comment">//deg</span></div><div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;    Double_t apertureAzPhoto[48]; <span class="comment">//deg</span></div><div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    Double_t apertureElPhoto[48]; <span class="comment">//deg  </span></div><div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;</div><div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ant=0;ant&lt;48;ant++) {</div><div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;      line.ReadLine(Anita3PhotoFile);</div><div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;Seavey:\t&quot; &lt;&lt; line.Data() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;      TObjArray *tokens = line.Tokenize(<span class="stringliteral">&quot;,&quot;</span>);</div><div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0;j&lt;8;j++) {</div><div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="keyword">const</span> TString subString = ((TObjString*)tokens-&gt;At(j))-&gt;GetString();</div><div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="comment">//  TString *subString = (TString*) tokens-&gt;At(j);</span></div><div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="comment">//  std::cout &lt;&lt; j &lt;&lt; &quot;\t&quot; &lt;&lt; subString.Data() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    <span class="keywordflow">switch</span>(j) {</div><div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;    <span class="keywordflow">case</span> 0:</div><div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;      <span class="keywordflow">if</span> (ant+1 != subString.Atoi()) {</div><div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Antenna number mismatch\n&quot;</span>;</div><div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;      }</div><div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;    <span class="keywordflow">case</span> 1:    </div><div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;      xAntPhoto[ant]=subString.Atof(); <span class="comment">//inch</span></div><div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="keywordflow">case</span> 2:    </div><div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;      yAntPhoto[ant]=subString.Atof(); <span class="comment">//inch</span></div><div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;    <span class="keywordflow">case</span> 3:    </div><div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;      zAntPhoto[ant]=subString.Atof(); <span class="comment">//inch</span></div><div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;    <span class="keywordflow">case</span> 4:    </div><div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;      rAntPhoto[ant]=subString.Atof(); <span class="comment">//inch</span></div><div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;    <span class="keywordflow">case</span> 5:    </div><div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;      azCentrePhoto[ant]=subString.Atof(); <span class="comment">//deg</span></div><div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;    <span class="keywordflow">case</span> 6:    </div><div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;      apertureAzPhoto[ant]=subString.Atof(); <span class="comment">//deg</span></div><div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    <span class="keywordflow">case</span> 7:    </div><div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;      apertureElPhoto[ant]=subString.Atof()*(-1); <span class="comment">//deg // photogrammetry elevation defined as negative, here positive</span></div><div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    <span class="keywordflow">default</span>:       </div><div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160;      <span class="keywordflow">break</span>;</div><div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;    }</div><div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;      </div><div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;      }</div><div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;      tokens-&gt;Delete();</div><div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;    </div><div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;    }</div><div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;    Anita3PhotoFile.close();</div><div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;</div><div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;    <span class="comment">// Fill photogrammetry position for top rings</span></div><div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;8;iant++){</div><div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;      ANTENNA_POSITION_START[1][0][iant] = ANTENNA_POSITION_START[0][0][iant] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(xAntPhoto[iant*2], yAntPhoto[iant*2], zAntPhoto[iant*2]).RotateZ(-gps_offset_anita3);        <span class="comment">// top ring top antennas</span></div><div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;      ANTENNA_POSITION_START[1][1][iant] = ANTENNA_POSITION_START[0][1][iant] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(xAntPhoto[iant*2+1], yAntPhoto[iant*2+1], zAntPhoto[iant*2+1]).RotateZ(-gps_offset_anita3);  <span class="comment">// top ring bottom antennas</span></div><div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;</div><div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;      PHI_EACHLAYER[0][iant] = azCentrePhoto[iant*2] * RADDEG - gps_offset_anita3;</div><div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;      PHI_EACHLAYER[1][iant] = azCentrePhoto[iant*2+1] * RADDEG - gps_offset_anita3;</div><div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;      ANTENNA_DOWN[0][iant] = apertureElPhoto[iant*2] * RADDEG; </div><div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;      ANTENNA_DOWN[1][iant] = apertureElPhoto[iant*2+1] * RADDEG; </div><div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160; </div><div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    }</div><div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;</div><div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <span class="comment">// Fill photogrammetry position for middle and bottom rings</span></div><div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;16;iant++){</div><div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;      ANTENNA_POSITION_START[1][2][iant] = ANTENNA_POSITION_START[0][2][iant] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(xAntPhoto[iant+16], yAntPhoto[iant+16], zAntPhoto[iant+16]).RotateZ(-gps_offset_anita3);     <span class="comment">// middle ring antennas</span></div><div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;      ANTENNA_POSITION_START[1][3][iant] = ANTENNA_POSITION_START[0][3][iant] = MINCH * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(xAntPhoto[iant+32], yAntPhoto[iant+32], zAntPhoto[iant+32]).RotateZ(-gps_offset_anita3);  <span class="comment">// bottom ring antennas</span></div><div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;</div><div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;      PHI_EACHLAYER[2][iant] = azCentrePhoto[iant+16] * RADDEG - gps_offset_anita3;</div><div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;      ANTENNA_DOWN[2][iant] = apertureElPhoto[iant+16] * RADDEG; </div><div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;</div><div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;      PHI_EACHLAYER[3][iant] = azCentrePhoto[iant+32] * RADDEG - gps_offset_anita3;</div><div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;      ANTENNA_DOWN[3][iant] = apertureElPhoto[iant+32] * RADDEG; </div><div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;</div><div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    }</div><div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;      </div><div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    <span class="comment">// HERE HPOL IS 0 AND VPOL IS 1</span></div><div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    <span class="keywordtype">string</span> whichANITAcard=<span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9) whichANITAcard+=<span class="stringliteral">&quot;3&quot;</span>;</div><div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    <span class="keywordflow">else</span> whichANITAcard+=<span class="stringliteral">&quot;4&quot;</span>;</div><div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;    <span class="keywordtype">string</span> phaseCenterName;</div><div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    phaseCenterName += ( (string)getenv(<span class="stringliteral">&quot;ANITA_UTIL_INSTALL_DIR&quot;</span>) +<span class="stringliteral">&quot;/share/anitaCalib/phaseCenterPositionsRelativeToPhotogrammetryAnita&quot;</span>+whichANITAcard+<span class="stringliteral">&quot;.dat&quot;</span>);</div><div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    phaseCenterName += (ICEMC_DATA_DIR+<span class="stringliteral">&quot;/phaseCenterPositionsRelativeToPhotogrammetryAnita&quot;</span>+whichANITAcard+<span class="stringliteral">&quot;.dat&quot;</span>);</div><div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    </div><div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    std::ifstream PhaseCenterFile(phaseCenterName.c_str());</div><div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    Int_t antNum, tpol, pol;</div><div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    Double_t deltaR,deltaPhi,deltaZ;</div><div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    <span class="keywordtype">char</span> firstLine[180];</div><div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;    Double_t deltaRPhaseCentre[2][4][16]; <span class="comment">//Relative to photogrammetry + ring offset</span></div><div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;    Double_t deltaZPhaseCentre[2][4][16]; <span class="comment">//Relative to photogrammetry + ring offset</span></div><div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;    Double_t deltaPhiPhaseCentre[2][4][16]; <span class="comment">//Relative to photogrammetry + ring offset</span></div><div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;      </div><div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;    PhaseCenterFile.getline(firstLine,179);</div><div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;    <span class="comment">// HERE HPOL IS 0 AND VPOL IS 1 that&#39;s why we invert pol here</span></div><div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;    <span class="keywordflow">while</span>(PhaseCenterFile &gt;&gt; antNum &gt;&gt; tpol &gt;&gt; deltaR &gt;&gt; deltaPhi &gt;&gt; deltaZ) {</div><div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;      <span class="keywordtype">int</span> ilayer = (antNum&lt;16)*((antNum%2==0)*0 + (antNum%2==1)*1)+ (antNum&gt;15)*(antNum&lt;32)*2+(antNum&gt;31)*3;</div><div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;      <span class="keywordtype">int</span> ifold = (ilayer&lt;2)*((antNum-ilayer)/2)+(ilayer&gt;1)*(antNum%16);</div><div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;</div><div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;      <span class="keywordflow">if</span> (tpol==1) pol=0;</div><div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tpol==0) pol=1;</div><div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    </div><div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;      deltaRPhaseCentre[pol][ilayer][ifold]=deltaR;</div><div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;      deltaPhiPhaseCentre[pol][ilayer][ifold]=deltaPhi*TMath::DegToRad();</div><div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;      deltaZPhaseCentre[pol][ilayer][ifold]=deltaZ;</div><div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    } </div><div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;    PhaseCenterFile.close();</div><div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;</div><div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    std::ifstream relativePhaseCenterToAmpaDelaysFile((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/relativePhaseCenterToAmpaDelaysAnita&quot;</span>+whichANITAcard+<span class="stringliteral">&quot;.dat&quot;</span>).c_str());</div><div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;</div><div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <a class="code" href="../../d7/d7d/class_anita_event_calibrator.html">AnitaEventCalibrator</a>* cal = <a class="code" href="../../d7/d7d/class_anita_event_calibrator.html#ac1e6302b11bf7427beb5631bcda872a1">AnitaEventCalibrator::Instance</a>();</div><div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    <a class="code" href="../../d8/db1/class_anita_geom_tool.html">AnitaGeomTool</a> *fGeomTool = <a class="code" href="../../d8/db1/class_anita_geom_tool.html#a1082689d96e9b03316b7625a9de37b44">AnitaGeomTool::Instance</a>(stoi(whichANITAcard));</div><div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160;    <span class="keywordtype">int</span> tempAnt, intTempPol;</div><div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    <a class="code" href="../../d4/df7/namespace_anita_pol.html#a6c9ea9818ce94ee3510d3fc3e573d267">AnitaPol::AnitaPol_t</a> tempPol;</div><div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;    <span class="keywordflow">for</span>(Int_t surf=0; surf&lt;NUM_SURF; surf++){</div><div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;      <span class="keywordflow">for</span>(Int_t chan=0; chan&lt;NUM_CHAN; chan++){</div><div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;        fGeomTool-&gt;<a class="code" href="../../d8/db1/class_anita_geom_tool.html#a32a1c9069f5d8d29fa7dc9636cd44da8">getAntPolFromSurfChan</a>(surf,chan, tempAnt, tempPol);</div><div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="keywordflow">if</span> (tempAnt!=-1){</div><div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;      <span class="comment">// in EventReaderRoot 0: HPOL, 1: VPOL, in icemc it&#39;s the opposite</span></div><div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;      intTempPol = (tempPol==0) ? 1 : 0;</div><div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;      extraCableDelays[intTempPol][tempAnt] = cal-&gt;<a class="code" href="../../d7/d7d/class_anita_event_calibrator.html#a4912d18b072af69f109a3a3528239949">relativePhaseCenterToAmpaDelays</a>[surf][chan]*1e-9 ; </div><div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;      <span class="comment">//      extraCableDelays[intTempPol][tempAnt] -= cal-&gt;relativeCableDelays[surf][chan][0]*1e-9 ; </span></div><div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    }</div><div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;      }</div><div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;    }</div><div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;</div><div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;<span class="preprocessor">#else</span></div><div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;48; iant++){</div><div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    extraCableDelays[ipol][iant] = 0;</div><div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;      }</div><div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    }</div><div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;    </div><div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;</div><div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;    </div><div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;    <span class="keywordtype">double</span> x, y, z, r, phi;</div><div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ilayer = 0; ilayer &lt; 4; ilayer++){ </div><div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ifold = 0; ifold &lt; NRX_PHI[ilayer]; ifold++){</div><div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol = 1; ipol &gt;= 0; ipol--){</div><div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;</div><div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;      <span class="comment">// First attempt to define phase-centers is done by coming 20 cm</span></div><div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;      <span class="comment">// inwards from the antenna face end </span></div><div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;      ANTENNA_POSITION_START[ipol][ilayer][ifold] = ANTENNA_POSITION_START[ipol][ilayer][ifold] - phase_center_anita3 * <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(cos(PHI_EACHLAYER[ilayer][ifold])*cos(ANTENNA_DOWN[ilayer][ifold]), sin(PHI_EACHLAYER[ilayer][ifold])*cos(ANTENNA_DOWN[ilayer][ifold]), sin(ANTENNA_DOWN[ilayer][ifold]));</div><div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;      x = ANTENNA_POSITION_START[ipol][ilayer][ifold].GetX();</div><div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;      y = ANTENNA_POSITION_START[ipol][ilayer][ifold].GetY();</div><div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;      </div><div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;      r = sqrt(pow(x,2)+pow(y,2)) + deltaRPhaseCentre[ipol][ilayer][ifold];</div><div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;      phi = atan2(y,x) + deltaPhiPhaseCentre[ipol][ilayer][ifold];</div><div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;      z = ANTENNA_POSITION_START[ipol][ilayer][ifold].GetZ() + deltaZPhaseCentre[ipol][ilayer][ifold];    </div><div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;</div><div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;      <span class="keywordflow">if</span>(phi&lt;0) phi+=TMath::TwoPi();</div><div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;      <span class="keywordflow">if</span>(phi&gt;TMath::TwoPi()) phi-=TMath::TwoPi();</div><div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;      </div><div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;      ANTENNA_POSITION_START[ipol][ilayer][ifold]= Vector(r*cos(phi),r*sin(phi),z);</div><div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;</div><div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;      <span class="keywordflow">if</span> (ipol==0) PHI_EACHLAYER[ilayer][ifold]=phi;</div><div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;      </div><div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;    }</div><div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160;    <span class="comment">// Temp hack for ANITA-4</span></div><div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;    <span class="comment">// The different phase-centers between H and V create problems when</span></div><div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;    <span class="comment">// Making the LCP and RCP triggers</span></div><div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    <span class="comment">// This hack uses the VPOL phase-centers for both VPOL and HPOL channels</span></div><div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==10)  ANTENNA_POSITION_START[1][ilayer][ifold] = ANTENNA_POSITION_START[0][ilayer][ifold];</div><div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;      }</div><div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;    }</div><div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;  }</div><div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;    </div><div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;    </div><div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==11) { <span class="comment">// satellite</span></div><div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;      </div><div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;        </div><div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    <span class="comment">// layer 0 is antennas 1-8 on the payload</span></div><div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;    <span class="comment">// layer 1 is antennas 9-15</span></div><div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;    settings1-&gt;CYLINDRICALSYMMETRY=1;</div><div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;        </div><div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    <span class="comment">//these are physical layers</span></div><div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;    NRX_PHI[0]=8;</div><div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;    NRX_PHI[1]=8;</div><div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;        </div><div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    PHITRIG[0]=8; <span class="comment">// number of positions in phi in each *trigger* layer</span></div><div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    PHITRIG[1]=8;</div><div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        </div><div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    <span class="comment">//these are physical layers again</span></div><div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    PHI_OFFSET[0]=0.; <span class="comment">// antenna 1 on 0th layer is rotated in phi wrt antenna 9 and antenna 17</span></div><div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    <span class="comment">// it&#39;s rotated by 1/2 the azimuth that separates two antennas on the 0th layer</span></div><div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    PHI_OFFSET[1]=-2.*PI/(double)NRX_PHI[0]/2.;</div><div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;        </div><div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;    <span class="comment">// sets their declination</span></div><div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    THETA_ZENITH[0]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    THETA_ZENITH[1]=PI/2+INCLINE_TOPTHREE*RADDEG;</div><div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;        </div><div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    <span class="comment">// radius from center axis of the payload</span></div><div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;    RRX[0] = 0.9210802;</div><div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;    RRX[1] = 0.7553198;   </div><div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;        </div><div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;    <span class="comment">// vertical separation between layers.</span></div><div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    LAYER_VPOSITION[0]=0;</div><div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    LAYER_VPOSITION[1] = -7.5;</div><div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;        </div><div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;    LAYER_HPOSITION[0]=0.;</div><div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;    LAYER_HPOSITION[1] = 0.;</div><div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;        </div><div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;        </div><div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;  } <span class="comment">//else if (satellite)</span></div><div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;    </div><div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;  settings1-&gt;NANTENNAS=0;</div><div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;settings1-&gt;NLAYERS;i++)</div><div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    settings1-&gt;NANTENNAS+=NRX_PHI[i];</div><div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;    </div><div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;nantennas is &quot;</span> &lt;&lt; settings1-&gt;NANTENNAS &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;  number_all_antennas=settings1-&gt;NANTENNAS;</div><div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    </div><div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;  <span class="comment">// gets noise (vrms) for each bandwidth slice and antenna layer according to antenna theta</span></div><div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    </div><div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;  if (settings1-&gt;WHICH==0) {</div><div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    temp_eachrx[0]=919.4;</div><div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    temp_eachrx[1]=1051.8;</div><div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=2;j&lt;16;j++) {</div><div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;      temp_eachrx[j]=0.; <span class="comment">// noise temperature of each antenna?</span></div><div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;    }</div><div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;  }</div><div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;16;j++) {</div><div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;    </div><div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;      temp_eachrx[j]=(240.+200.); <span class="comment">// temp of each antenna in kelvin</span></div><div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;    }</div><div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;  }</div><div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;    </div><div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;NRX_PHI[0];i++) {</div><div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    VNOISE_ANITALITE[i]=<a class="code" href="../../dd/d24/class_chan_trigger.html#a7ee27fceaba30ae0beabce566468dfb0">ChanTrigger::GetNoise</a>(settings1,bn1-&gt;altitude_bn,bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#a82033268c70493ca7c6e850e82e8c49d">surface_under_balloon</a>,THETA_ZENITH[0],settings1-&gt;BW_SEAVEYS,temp_eachrx[i]);</div><div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;  }</div><div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;}<span class="comment">//GetPayload</span></div><div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;</div><div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;<span class="keywordtype">void</span> Anita::calculate_all_offsets(<span class="keywordtype">void</span>) {</div><div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    </div><div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;  <span class="keywordtype">double</span> angle_phi, angle_theta;</div><div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;    </div><div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;  <span class="keywordtype">double</span> hypothesis_offset[3][3];</div><div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;    </div><div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;  vector&lt;double&gt; angles_tmp;</div><div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;  vector&lt; vector &lt;double&gt; &gt; angles_diffthetas_tmp;</div><div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;</div><div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;  <span class="keywordtype">double</span> step_phi=(MAX_PHI_HYPOTHESIS-MIN_PHI_HYPOTHESIS)/(<span class="keywordtype">double</span>)N_STEPS_PHI;</div><div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;  <span class="keywordtype">double</span> step_theta=(MAX_THETA_HYPOTHESIS-MIN_THETA_HYPOTHESIS)/(<span class="keywordtype">double</span>)N_STEPS_THETA;</div><div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;</div><div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;  cout &lt;&lt; <span class="stringliteral">&quot;step_theta is &quot;</span> &lt;&lt; step_theta &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;</div><div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> center_phi_sector_index = 0; center_phi_sector_index &lt; 1; ++center_phi_sector_index) {</div><div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;    angles_tmp.clear();</div><div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi = 0; index_phi &lt; N_STEPS_PHI; ++index_phi) {</div><div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;      <span class="comment">//angle_phi = (center_phi_sector_index + 3)%16 * 22.5 - 22.5 + index_phi * 3.;</span></div><div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;      <span class="comment">// angle of this phi sector (=index_phi) rel to center phi sector </span></div><div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;      angle_phi = (double)center_phi_sector_index * 22.5 + MIN_PHI_HYPOTHESIS + (<span class="keywordtype">double</span>)index_phi * step_phi;</div><div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;      <span class="comment">// Note that the zeroth phi sector is actually not the one with the phi = 0 direction, it&#39;s actually the third.</span></div><div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;      <span class="comment">// The above statement is probably false because of the gps_offset_anita2 rotation! [0][0] should be right after all...</span></div><div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;      angles_diffthetas_tmp.clear();</div><div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_theta = 0; index_theta &lt; N_STEPS_THETA; ++index_theta) {</div><div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;    angle_theta = MIN_THETA_HYPOTHESIS + (double)index_theta*step_theta;</div><div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;</div><div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    <span class="comment">//    if (angle_phi==-11. &amp;&amp; angle_theta==-20.)</span></div><div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    <span class="comment">//if (fabs(angle_phi)&lt;1. &amp;&amp; angle_theta&gt;15 &amp;&amp; angle_theta&lt;17)</span></div><div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;angle phi, angle_theta are &quot; &lt;&lt; angle_phi &lt;&lt; &quot;\t&quot; &lt;&lt; angle_theta &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;    angles_tmp.clear();</div><div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;    angles_tmp.push_back(angle_phi);</div><div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;    angles_tmp.push_back(angle_theta);</div><div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;      </div><div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    angles_diffthetas_tmp.push_back(angles_tmp);</div><div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;      </div><div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    calculate_single_offset(center_phi_sector_index, angle_phi, angle_theta, hypothesis_offset);</div><div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;index_phi is &quot; &lt;&lt; index_phi &lt;&lt; &quot; &quot; &lt;&lt; &quot;index_theta is &quot; &lt;&lt; index_theta &lt;&lt; &quot; &quot;;</span></div><div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; N_SUMMED_LAYERS; ++i_layer) {</div><div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_sector = 0; i_sector &lt; N_SUMMED_PHI_SECTORS; ++i_sector) {</div><div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;        hypothesis_offsets[center_phi_sector_index][index_phi][index_theta][i_sector][i_layer] = int(Tools::round(hypothesis_offset[i_sector][i_layer] / TRIG_TIMESTEP));</div><div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;          </div><div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160;      }</div><div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    }</div><div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;      </div><div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;      }</div><div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;      hypothesis_angles.push_back(angles_diffthetas_tmp);</div><div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    }</div><div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;</div><div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;</div><div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;  }</div><div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;  getDifferentOffsets();</div><div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;  printDifferentOffsets();</div><div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;}</div><div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;<span class="keywordtype">void</span> Anita::printDifferentOffsets() {</div><div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;  ofstream ofile(<span class="stringliteral">&quot;outputs/offsets.txt&quot;</span>);</div><div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;  ofile &lt;&lt; <span class="stringliteral">&quot;number of offsets is &quot;</span> &lt;&lt; vdifferent_offsets.size() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;  </div><div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;</div><div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;vdifferent_offsets.size();i++) {</div><div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;      ofile &lt;&lt; vdifferent_angles[i][j] &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;</div><div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;    }</div><div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0;j&lt;N_SUMMED_PHI_SECTORS;j++) {</div><div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> k=0;k&lt;N_SUMMED_LAYERS;k++) {</div><div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;    <span class="comment">//    for (int j=0;j&lt;vdifferent_offsets[i].size();j++) {</span></div><div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;    ofile &lt;&lt; vdifferent_offsets[i][N_SUMMED_LAYERS*j+k] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    <span class="comment">//}</span></div><div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;      }</div><div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;      ofile &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span>;</div><div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    }</div><div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;    ofile &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;  }</div><div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;  ofile.close();</div><div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;}</div><div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;<span class="keywordtype">void</span> Anita::getDifferentOffsets() {</div><div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160; </div><div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;  vector&lt;int&gt; vtmp;</div><div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;  vector&lt;double&gt; vangles_tmp;</div><div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;</div><div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> center_phi_sector_index=0;center_phi_sector_index&lt;1;center_phi_sector_index++) {</div><div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi = 0; index_phi &lt; N_STEPS_PHI; ++index_phi) {</div><div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_theta = 0; index_theta &lt; N_STEPS_THETA; ++index_theta) {</div><div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;    vtmp.clear();</div><div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;    vangles_tmp.clear();</div><div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    vangles_tmp.push_back(hypothesis_angles[index_phi][index_theta][0]);</div><div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;    vangles_tmp.push_back(hypothesis_angles[index_phi][index_theta][1]);</div><div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;    </div><div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_sector = 0; i_sector &lt; N_SUMMED_PHI_SECTORS; ++i_sector) {  </div><div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; N_SUMMED_LAYERS; ++i_layer) {        </div><div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;        vtmp.push_back(hypothesis_offsets[center_phi_sector_index][index_phi][index_theta][i_sector][i_layer]);</div><div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;        <span class="comment">//if (hypothesis_angles[index_phi][index_theta][0]&lt;-21 &amp;&amp; hypothesis_angles[index_phi][index_theta][1] &gt;-29 &amp;&amp; hypothesis_angles[index_phi][index_theta][1]&lt;-27)</span></div><div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;        <span class="comment">//cout &lt;&lt; vtmp[vtmp.size()-1] &lt;&lt; &quot; &quot;;</span></div><div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;      }  <span class="comment">// end loop over layer</span></div><div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;    } <span class="comment">// end loop over sector</span></div><div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;</div><div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;    </div><div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    <span class="comment">// now loop over all previous offsets and see if it is new or a repeat</span></div><div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    <span class="keywordtype">int</span> foundone=0;</div><div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;</div><div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;</div><div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;vdifferent_offsets.size();i++) {</div><div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;      <span class="keywordflow">if</span> (vtmp==vdifferent_offsets[i]) {</div><div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;        foundone++;</div><div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;        <span class="comment">//if (hypothesis_angles[index_phi][index_theta][0]&lt;-21 &amp;&amp; hypothesis_angles[index_phi][index_theta][1] &gt;-29 &amp;&amp; hypothesis_angles[index_phi][index_theta][1]&lt;-27)</span></div><div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;found one is &quot; &lt;&lt; foundone &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;      }</div><div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;    }</div><div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;    <span class="comment">//if (hypothesis_angles[index_phi][index_theta][0]&lt;-21 &amp;&amp; hypothesis_angles[index_phi][index_theta][1] &gt;-29 &amp;&amp; hypothesis_angles[index_phi][index_theta][1]&lt;-27)</span></div><div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;just before if statement, found one is &quot; &lt;&lt; foundone &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;</div><div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;    <span class="keywordflow">if</span> (foundone==0) {</div><div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;      vdifferent_offsets.push_back(vtmp);</div><div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;      vdifferent_angles.push_back(vangles_tmp);</div><div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;    }</div><div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;    <span class="comment">//if (hypothesis_angles[index_phi][index_theta][0]&lt;-21 &amp;&amp; hypothesis_angles[index_phi][index_theta][1] &gt;-29 &amp;&amp; hypothesis_angles[index_phi][index_theta][1]&lt;-27)</span></div><div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;size of vdifferent_offsets is &quot; &lt;&lt; vdifferent_offsets.size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;      } <span class="comment">// end loop over hypotheses in theta</span></div><div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;    }  <span class="comment">// end loop over hypotheses in phi</span></div><div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;  } <span class="comment">// end loop over center_phi_sector</span></div><div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160;}</div><div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;<span class="keywordtype">void</span> Anita::calculate_single_offset(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> center_phi_sector_index, <span class="keyword">const</span> <span class="keywordtype">double</span> angle_phi, <span class="keyword">const</span> <span class="keywordtype">double</span> angle_theta, <span class="keywordtype">double</span> hypothesis_offset[][3]) {</div><div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;  <span class="keywordtype">double</span> maximum_time = -2000E-9;</div><div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;   </div><div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;  <span class="keywordtype">double</span> to_center_of_summed_phi_sectors=((double)N_SUMMED_PHI_SECTORS/2.)*22.5-11.25;</div><div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;  <span class="comment">//    cout &lt;&lt; &quot;to_center_of_summed_phi_sectors is &quot; &lt;&lt; to_center_of_summed_phi_sectors &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> normal_vector = <a class="code" href="../../d5/db2/class_vector.html">Vector</a>(cos(angle_theta * RADDEG) * cos((angle_phi+to_center_of_summed_phi_sectors) * RADDEG), cos(angle_theta * RADDEG) * sin((angle_phi+to_center_of_summed_phi_sectors) * RADDEG), sin(angle_theta * RADDEG));</div><div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    </div><div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;  <span class="comment">//    cout &lt;&lt; &quot;normal vector is &quot;;</span></div><div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;  <span class="comment">//normal_vector.Print();</span></div><div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;</div><div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;  <span class="comment">//    Vector first_antenna_pos = ANTENNA_POSITION_START[0][3][center_phi_sector_index];</span></div><div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;  <a class="code" href="../../d5/db2/class_vector.html">Vector</a> one_antenna_pos = antenna_positions[0][2*16+center_phi_sector_index];</div><div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;one_antenna_pos is &quot;;</span></div><div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;  <span class="comment">//one_antenna_pos.Print();</span></div><div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;</div><div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;  <span class="keywordtype">int</span> phi_start=-1*(int)((<span class="keywordtype">double</span>)N_SUMMED_PHI_SECTORS/2.)+1;</div><div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;    </div><div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;  <span class="comment">//    cout &lt;&lt; &quot;new set of 6.\n&quot;;</span></div><div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;phi_start, phi_end are &quot; &lt;&lt; phi_start &lt;&lt; &quot;\t&quot; &lt;&lt; phi_start+N_SUMMED_PHI_SECTORS &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;  <span class="comment">//for (signed int phi_sector_offset = phi_start; phi_sector_offset &lt; phi_start+N_SUMMED_PHI_SECTORS; phi_sector_offset++) {</span></div><div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">signed</span> <span class="keywordtype">int</span> phi_sector_offset = phi_start; phi_sector_offset &lt; (int)(phi_start+N_SUMMED_PHI_SECTORS); phi_sector_offset++) {</div><div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;    <span class="keywordtype">unsigned</span> i_sector = (phi_sector_offset + center_phi_sector_index + 16)%16; <span class="comment">// Must map to {0, ..., 15}.</span></div><div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;i_sector is &quot; &lt;&lt; i_sector &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; N_SUMMED_LAYERS; ++i_layer) {</div><div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;    </div><div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;</div><div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;      <a class="code" href="../../d5/db2/class_vector.html">Vector</a> antenna_pos = antenna_positions[0][16*i_layer+i_sector];</div><div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;i_layer, i_sector are &quot; &lt;&lt; i_layer &lt;&lt; &quot;\t&quot; &lt;&lt; i_sector &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;antenna_pos is &quot;;</span></div><div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;      <span class="comment">//antenna_pos.Print();</span></div><div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;    </div><div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;      <span class="keywordtype">double</span> offset = (-1. / CLIGHT) * normal_vector * (antenna_pos - one_antenna_pos);</div><div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;</div><div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;offset is &quot; &lt;&lt; offset &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;      <span class="keywordflow">if</span> (offset &gt;= maximum_time) {</div><div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;    maximum_time = offset;</div><div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;      }</div><div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    </div><div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;      <span class="comment">//unsigned i_layer_trig = ((i_layer &gt; 1) ? (i_layer - 1) : (0));  // Set i_layer_triger according to the following map:</span></div><div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;      <span class="comment">// 0 -&gt; 0 (if in even phi_sector)</span></div><div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;      <span class="comment">// 1 -&gt; 0 (if in odd phi_sector)</span></div><div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;      <span class="comment">// 2 -&gt; 1</span></div><div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;      <span class="comment">// 3 -&gt; 2</span></div><div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;phi_sector_offset-phi_start is &quot; &lt;&lt; phi_sector_offset-phi_start &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;      hypothesis_offset[phi_sector_offset-phi_start][i_layer] = offset; <span class="comment">// Use phi_sector_offset + 1 so that it maps {-1, 0, 1} to {0, 1, 2}.</span></div><div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;    }</div><div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;  }</div><div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;  <span class="comment">//    cout &lt;&lt; &quot;maximum_time is &quot; &lt;&lt; maximum_time &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; N_SUMMED_LAYERS; ++i_layer) {</div><div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_sector = 0; i_sector &lt; N_SUMMED_PHI_SECTORS; ++i_sector) {</div><div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;      hypothesis_offset[i_sector][i_layer] -= maximum_time;</div><div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;      hypothesis_offset[i_sector][i_layer]*=-1.;</div><div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;    }</div><div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;  }</div><div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;  <span class="keywordflow">return</span>;</div><div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;}</div><div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;</div><div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;</div><div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;<span class="keywordtype">void</span> Anita::GetArrivalTimes(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a>&amp; rf_direction,<a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1, <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1) {</div><div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;inside getarrivaltimes.\n&quot;;</span></div><div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;  </div><div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;</div><div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;  </div><div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> antenna_index = 0; antenna_index &lt; (number_all_antennas); antenna_index++) { <span class="comment">//loop over layers on the payload</span></div><div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;      arrival_times[ipol][antenna_index] = (antenna_positions[ipol][antenna_index] * rf_direction) / CLIGHT;</div><div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;</div><div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;      <span class="comment">//arrival_times[antenna_index] += extraCableDelays[0][antenna_index];</span></div><div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160;    </div><div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;index is &quot; &lt;&lt; antenna_index &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;antenna_positions are &quot; &lt;&lt; antenna_positions[antenna_index] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;rf direction is &quot; &lt;&lt; rf_direction &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;arrival_times is &quot; &lt;&lt; arrival_times[antenna_index] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;    } <span class="comment">// for: loop over antenna layers</span></div><div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    </div><div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;    <span class="keywordflow">if</span>( settings1-&gt;WHICH==8 ){<span class="comment">//ANITA-II offboresight delay</span></div><div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;      </div><div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;      <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rf_tmp_dir = bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#ace0902a765981b8ca408b4fce6857805">unRotatePayload</a>(-1*rf_direction);</div><div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;     </div><div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;      <span class="keywordtype">double</span> theta_deg =rf_tmp_dir.Theta() * DEGRAD;<span class="comment">//</span></div><div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;     </div><div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;      <span class="keywordtype">double</span> phi_deg = rf_tmp_dir.Phi() *DEGRAD;</div><div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;      <span class="keywordtype">double</span> totalAngledeg;</div><div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;      <span class="keywordtype">double</span> extra_delay;</div><div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;     </div><div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;      <span class="keywordtype">double</span> phi_eachlayer;</div><div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;      <span class="keywordtype">double</span> theta_offset;</div><div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;      <span class="keywordtype">int</span> ant_ctr=0;</div><div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;</div><div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;      theta_offset = 10;<span class="comment">//boresight_vector[ant_ctr].Theta()*DEGRAD;</span></div><div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;       </div><div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;      theta_deg = theta_deg -90;</div><div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;       </div><div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;     </div><div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;      theta_deg = theta_deg - theta_offset;</div><div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iii = 0; iii &lt; 4; iii++){ </div><div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> jjj = 0; jjj &lt; NRX_PHI[iii]; jjj++){</div><div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;           </div><div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;      phi_deg = rf_tmp_dir.Phi();</div><div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;      </div><div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;      phi_eachlayer =atan2(ANTENNA_POSITION_START[ipol][iii][jjj][1],ANTENNA_POSITION_START[ipol][iii][jjj][0]);</div><div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;       </div><div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;      phi_deg =phi_deg- phi_eachlayer;</div><div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;     </div><div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;      <span class="keywordflow">if</span>(fabs(phi_deg) &gt; fabs(phi_deg+2*PI)) phi_deg+=2*PI;</div><div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;      <span class="keywordflow">if</span>(fabs(phi_deg) &gt; fabs(phi_deg-2*PI)) phi_deg-=2*PI;</div><div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;      phi_deg =phi_deg*DEGRAD;</div><div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;      totalAngledeg = phi_deg*phi_deg + theta_deg*theta_deg;</div><div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;      <span class="keywordflow">if</span>(totalAngledeg &gt; 2500) totalAngledeg=2500;</div><div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;     </div><div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;      extra_delay  = (totalAngledeg*totalAngledeg)*1.45676e-8;<span class="comment">//pulled from Abby analysis</span></div><div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;      extra_delay -= (totalAngledeg)*5.01452e-6;<span class="comment">//pulled from Abby analysis</span></div><div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;    </div><div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;      arrival_times[ipol][ant_ctr]+=extra_delay*1E-9;</div><div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;      ant_ctr++;</div><div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;    }</div><div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;      }</div><div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;    }</div><div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;</div><div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;  }</div><div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;  </div><div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;  <span class="comment">//    double last_trigger_time=Tools::dMax(arrival_times,(number_all_antennas));</span></div><div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;last_trigger_time is &quot; &lt;&lt; last_trigger_time &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;  <span class="keywordtype">double</span> minV = Tools::dMin(arrival_times[0],(number_all_antennas));</div><div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;  <span class="keywordtype">double</span> minH = Tools::dMin(arrival_times[1],(number_all_antennas));</div><div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;  <span class="keywordtype">double</span> first_trigger_time = Tools::dMin(minV, minH);</div><div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;(number_all_antennas);i++){</div><div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;antenna_positions is &quot;;</span></div><div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;      <span class="comment">//  antenna_positions[i].Print();</span></div><div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;diff is &quot;;</span></div><div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;      <span class="comment">// (antenna_positions[i]-one_antenna_position).Print();</span></div><div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;</div><div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;      arrival_times[ipol][i] -= first_trigger_time;</div><div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;arrivaltimes is &quot; &lt;&lt; arrival_times[i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;      <span class="comment">// arrival_times[i] -= last_trigger_time;</span></div><div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;</div><div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;      <span class="comment">// if (arrival_times[i] == 0){</span></div><div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160;      <span class="comment">//     first_phi_sector_hit = (int)((double)i/16.);</span></div><div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;      <span class="comment">//        }</span></div><div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    }</div><div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;  }</div><div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;  <span class="comment">// cout &lt;&lt; &quot;end of GetArrivalTimes.\n&quot;;</span></div><div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;} <span class="comment">// GetArrivalTimes</span></div><div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;</div><div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;</div><div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;<span class="keywordtype">void</span> Anita::GetArrivalTimesBoresights(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rf_direction[NLAYERS_MAX][NPHI_MAX],<a class="code" href="../../d2/d24/class_balloon.html">Balloon</a> *bn1, <a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1) {</div><div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;</div><div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> antenna_index = 0; antenna_index &lt; (number_all_antennas); antenna_index++) { <span class="comment">//loop over layers on the payload</span></div><div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;      <span class="keywordtype">int</span> ilayer = (antenna_index&lt;8)*0 + (antenna_index&gt;7)*(antenna_index&lt;16)*1+ (antenna_index&gt;15)*(antenna_index&lt;32)*2+(antenna_index&gt;31)*3;</div><div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;      <span class="keywordtype">int</span> ifold = (ilayer&lt;2)*(antenna_index%8)+(ilayer&gt;1)*(antenna_index%16);</div><div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;      arrival_times[ipol][antenna_index] = (antenna_positions[ipol][antenna_index] * rf_direction[ilayer][ifold]) / CLIGHT;</div><div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;</div><div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;      <span class="comment">// cout &lt;&lt; antenna_index &lt;&lt; &quot; &quot; &lt;&lt; arrival_times[antenna_index] &lt;&lt; &quot; &quot; &lt;&lt; extraCableDelays[0][antenna_index] &lt;&lt; &quot; &quot; ;</span></div><div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;      <span class="comment">//      arrival_times[ipol][antenna_index] += extraCableDelays[ipol][antenna_index];</span></div><div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;      <span class="comment">// cout &lt;&lt; arrival_times[antenna_index] &lt;&lt; endl;</span></div><div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;    </div><div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;      <span class="comment">//  arrival_times[antenna_index]=0;</span></div><div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;      </div><div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;</div><div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;      <span class="keywordflow">if</span>(settings1-&gt;WHICH==8 ){<span class="comment">//ANITA-II offboresight delay</span></div><div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;      </div><div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;    <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rf_tmp_dir = bn1-&gt;<a class="code" href="../../d2/d24/class_balloon.html#ace0902a765981b8ca408b4fce6857805">unRotatePayload</a>(-1*rf_direction[ilayer][ifold]);</div><div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;     </div><div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;    <span class="keywordtype">double</span> theta_deg =rf_tmp_dir.Theta() * DEGRAD;<span class="comment">//</span></div><div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;     </div><div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;    <span class="keywordtype">double</span> phi_deg = rf_tmp_dir.Phi() *DEGRAD;</div><div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;    <span class="keywordtype">double</span> totalAngledeg;</div><div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;    <span class="keywordtype">double</span> extra_delay;</div><div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;     </div><div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    <span class="keywordtype">double</span> phi_eachlayer;</div><div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;    <span class="keywordtype">double</span> theta_offset;</div><div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;    <span class="keywordtype">int</span> ant_ctr=0;</div><div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;</div><div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    theta_offset = 10;<span class="comment">//boresight_vector[ant_ctr].Theta()*DEGRAD;</span></div><div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;       </div><div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    theta_deg = theta_deg -90;</div><div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;       </div><div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;     </div><div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;    theta_deg = theta_deg - theta_offset;</div><div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;           </div><div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    phi_deg = rf_tmp_dir.Phi();</div><div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;      </div><div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    phi_eachlayer =atan2(ANTENNA_POSITION_START[ipol][ilayer][ifold][1],ANTENNA_POSITION_START[ipol][ilayer][ifold][0]);</div><div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;       </div><div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;    phi_deg =phi_deg- phi_eachlayer;</div><div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;     </div><div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;    <span class="keywordflow">if</span>(fabs(phi_deg) &gt; fabs(phi_deg+2*PI)) phi_deg+=2*PI;</div><div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;    <span class="keywordflow">if</span>(fabs(phi_deg) &gt; fabs(phi_deg-2*PI)) phi_deg-=2*PI;</div><div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;    phi_deg =phi_deg*DEGRAD;</div><div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;    totalAngledeg = phi_deg*phi_deg + theta_deg*theta_deg;</div><div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;    <span class="keywordflow">if</span>(totalAngledeg &gt; 2500) totalAngledeg=2500;</div><div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;     </div><div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    extra_delay  = (totalAngledeg*totalAngledeg)*1.45676e-8;<span class="comment">//pulled from Abby analysis</span></div><div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    extra_delay -= (totalAngledeg)*5.01452e-6;<span class="comment">//pulled from Abby analysis</span></div><div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;    </div><div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    arrival_times[ipol][ant_ctr]+=extra_delay*1E-9;</div><div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    ant_ctr++;</div><div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;      </div><div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;      }  </div><div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;    }</div><div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;  }</div><div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;  </div><div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;  <span class="keywordtype">double</span> minV = Tools::dMin(arrival_times[0],(number_all_antennas));</div><div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;  <span class="keywordtype">double</span> minH = Tools::dMin(arrival_times[1],(number_all_antennas));</div><div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;  <span class="keywordtype">double</span> first_trigger_time = Tools::dMin(minV, minH);</div><div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;(number_all_antennas);i++){</div><div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;      </div><div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;      arrival_times[ipol][i] -= first_trigger_time;</div><div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;      <span class="comment">//cout&lt;&lt;&quot;arrival_times boresight[&quot;&lt;&lt;i&lt;&lt;&quot;] is &quot;&lt;&lt;arrival_times[i]&lt;&lt;&quot;\n&quot;;</span></div><div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    }</div><div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;  }</div><div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;} <span class="comment">// GetArrivalTimesBoresights</span></div><div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;</div><div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;</div><div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;<span class="keywordtype">void</span> Anita::GetArrivalTimesBoresights(<span class="keyword">const</span> <a class="code" href="../../d5/db2/class_vector.html">Vector</a> rf_direction[NLAYERS_MAX][NPHI_MAX]) {</div><div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;</div><div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> antenna_index = 0; antenna_index &lt; (number_all_antennas); antenna_index++) { <span class="comment">//loop over layers on the payload</span></div><div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;      <span class="keywordtype">int</span> ilayer = (antenna_index&lt;8)*0 + (antenna_index&gt;7)*(antenna_index&lt;16)*1+ (antenna_index&gt;15)*(antenna_index&lt;32)*2+(antenna_index&gt;31)*3;</div><div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;      <span class="keywordtype">int</span> ifold = (ilayer&lt;2)*(antenna_index%8)+(ilayer&gt;1)*(antenna_index%16);</div><div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;      arrival_times[ipol][antenna_index] = (antenna_positions[ipol][antenna_index] * rf_direction[ilayer][ifold]) / CLIGHT;</div><div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;</div><div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;      <span class="comment">// cout &lt;&lt; antenna_index &lt;&lt; &quot; &quot; &lt;&lt; arrival_times[antenna_index] &lt;&lt; &quot; &quot; &lt;&lt; extraCableDelays[0][antenna_index] &lt;&lt; &quot; &quot; ;</span></div><div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;      <span class="comment">//      arrival_times[ipol][antenna_index] += extraCableDelays[ipol][antenna_index];</span></div><div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;      <span class="comment">// cout &lt;&lt; arrival_times[antenna_index] &lt;&lt; endl;</span></div><div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;    </div><div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;      <span class="comment">//  arrival_times[antenna_index]=0;</span></div><div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;    } <span class="comment">// for: loop over antenna layers</span></div><div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;  }</div><div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;</div><div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;  </div><div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;  <span class="keywordtype">double</span> minV = Tools::dMin(arrival_times[0],(number_all_antennas));</div><div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;  <span class="keywordtype">double</span> minH = Tools::dMin(arrival_times[1],(number_all_antennas));</div><div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;  <span class="keywordtype">double</span> first_trigger_time = Tools::dMin(minV, minH);</div><div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;(number_all_antennas);i++){</div><div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;      </div><div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;      arrival_times[ipol][i] = arrival_times[ipol][i] - first_trigger_time + additionalDt;</div><div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;      <span class="comment">//cout&lt;&lt;&quot;arrival_times boresight[&quot;&lt;&lt;i&lt;&lt;&quot;] is &quot;&lt;&lt;arrival_times[i]&lt;&lt;&quot;\n&quot;;</span></div><div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;    }</div><div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;  }</div><div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;} <span class="comment">// GetArrivalTimesBoresights</span></div><div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;</div><div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;</div><div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;</div><div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;</div><div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;<span class="keywordtype">void</span> Anita::setphiTrigMask(UInt_t realTime_flightdata) {</div><div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;</div><div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;  <span class="keywordflow">if</span> (realTime_flightdata&lt;realTime_tr_min || realTime_flightdata&gt;realTime_tr_max) {</div><div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    phiTrigMask=0; <span class="comment">// if the realTime for this balloon position is out of range then just set mask to 0</span></div><div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    phiTrigMaskH=0;</div><div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    l1TrigMask=0;</div><div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160;    l1TrigMaskH=0;</div><div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    deadTime=0;</div><div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;  }</div><div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// if it&#39;s in range</span></div><div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;        </div><div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160;    iturf=turfratechain-&gt;GetEntryNumberWithBestIndex(realTime_flightdata); <span class="comment">// find entry in turfratechain that is closest to this realTime_flightdata</span></div><div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    <span class="keywordflow">if</span> (iturf&lt;0){ <span class="comment">// if it didn&#39;t find one</span></div><div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;      phiTrigMask=0; <span class="comment">// set to zero</span></div><div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160;      phiTrigMaskH=0;</div><div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;      l1TrigMask=0;</div><div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;      l1TrigMaskH=0;</div><div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;      deadTime=0;</div><div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;      turfratechain-&gt;GetEvent(iturf);</div><div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;    }</div><div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160;  } <span class="comment">// end if it&#39;s in range</span></div><div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;  </div><div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;}</div><div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160;</div><div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;</div><div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;</div><div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;<span class="keywordtype">void</span> Anita::setTimeDependentThresholds(UInt_t realTime_flightdata){</div><div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;  </div><div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160;  <span class="keywordflow">if</span> (realTime_flightdata&lt;realTime_surf_min || realTime_flightdata&gt;realTime_surf_max) {</div><div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0;iant&lt;48;iant++){</div><div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;    scalers[ipol][iant]=thresholds[ipol][iant]=0.;</div><div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;      }</div><div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;    }</div><div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;  }</div><div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160;  <span class="keywordflow">else</span> { <span class="comment">// if it&#39;s in range</span></div><div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        </div><div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;    isurf=surfchain-&gt;GetEntryNumberWithBestIndex(realTime_flightdata); <span class="comment">// find entry in surfchain that is closest to this realTime_flightdata</span></div><div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;    <span class="keywordflow">if</span> (isurf&lt;0){ <span class="comment">// if it didn&#39;t find one</span></div><div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0;iant&lt;48;iant++){</div><div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;      scalers[ipol][iant]=thresholds[ipol][iant]=0.;</div><div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;    }</div><div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;      }</div><div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;    }<span class="keywordflow">else</span>{</div><div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;      surfchain-&gt;GetEvent(isurf);      </div><div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;    }</div><div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;  } <span class="comment">// end if it&#39;s in range</span></div><div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;  </div><div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160;</div><div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;}</div><div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;</div><div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160;</div><div class="line"><a name="l04111"></a><span class="lineno"> 4111</span>&#160;<span class="preprocessor">#ifdef ANITA_UTIL_EXISTS</span></div><div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;<span class="keywordtype">void</span> Anita::readImpulseResponseDigitizer(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;  </div><div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;  <span class="comment">// Set deltaT to be used in the convolution</span></div><div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;  deltaT = 1./(2.6*16.);</div><div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160;  <span class="keywordtype">string</span> graphNames[2][3][16];</div><div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;  <span class="keywordtype">string</span> fileName;</div><div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;  <span class="keywordtype">double</span> norm=1;</div><div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160; </div><div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160;  <span class="comment">// For ANITA-2 we have 1 impulse response for VPOL and 1 for HPOL</span></div><div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;  <span class="comment">// For ANITA-3 we have 3 impulse responses (Top, Middle, Bottom ring) for VPOL and 3 for HPOL.</span></div><div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160;  <span class="comment">// Set Graph names for ANITA-2 and ANITA-3</span></div><div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==8){</div><div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;    fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/sumPicoImpulse.root&quot;</span>;</div><div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;    </div><div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0;iring&lt;3;iring++){</div><div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=1;iphi&lt;17;iphi++){</div><div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;    graphNames[0][iring][iphi]=<span class="stringliteral">&quot;grImpRespV&quot;</span>;</div><div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160;    graphNames[1][iring][iphi]=<span class="stringliteral">&quot;grImpRespH&quot;</span>;</div><div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;      }</div><div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;    }</div><div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160;    <span class="comment">//Now need to scale our impulse response from unit areas to the area of kronecker-delta (i.e dt)</span></div><div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;    norm*=0.1;</div><div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){</div><div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;</div><div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;    fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/Anita3_ImpulseResponseDigitizer.root&quot;</span>;</div><div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;</div><div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;    <span class="keywordtype">string</span> spol[2] ={<span class="stringliteral">&quot;V&quot;</span>, <span class="stringliteral">&quot;H&quot;</span>};</div><div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;    <span class="keywordtype">string</span> sring[3]={<span class="stringliteral">&quot;T&quot;</span>, <span class="stringliteral">&quot;M&quot;</span>, <span class="stringliteral">&quot;B&quot;</span>};</div><div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;    </div><div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l04142"></a><span class="lineno"> 4142</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0;iring&lt;3;iring++){</div><div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++){</div><div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;      graphNames[ipol][iring][iphi] = Form(<span class="stringliteral">&quot;g%02d%s%s&quot;</span>, iphi+1, sring[iring].c_str(), spol[ipol].c_str() ) ;</div><div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;    }</div><div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;      }</div><div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;    }</div><div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;</div><div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;    <span class="comment">// Normalisation of digitizer impulse response might be off by 3dB</span></div><div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    <span class="comment">// See LC&#39;s talk at icemc meeting of 2017 Nov 13</span></div><div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160;    norm *= TMath::Power(10., -3./20.);</div><div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;</div><div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;    norm *= TMath::Power(10., +1./20.);</div><div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;    </div><div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160;  }</div><div class="line"><a name="l04156"></a><span class="lineno"> 4156</span>&#160;</div><div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;  <span class="comment">// Read in input file</span></div><div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;  TFile fImpulse(fileName.c_str());</div><div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160;  </div><div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;  <span class="keywordflow">if</span>(!fImpulse.IsOpen()) {</div><div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t read siganl chain impulse response from &quot;</span> &lt;&lt; fileName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;    exit(0);</div><div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;</div><div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0;iring&lt;3;iring++){</div><div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++){</div><div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;      <span class="comment">// Read graph</span></div><div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;      TGraph *grTemp = (TGraph*) fImpulse.Get(graphNames[ipol][iring][iphi].c_str());</div><div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;      <span class="keywordflow">if</span>(!grTemp) {</div><div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t read signal chain impulse response&quot;</span> &lt;&lt; graphNames[ipol][iring][iphi] &lt;&lt; <span class="stringliteral">&quot; from file &quot;</span> &lt;&lt; fileName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        exit(0);</div><div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;      }</div><div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;      <span class="comment">// Interpolate to high sampling rate that will be used for the convolution</span></div><div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160;      TGraph *grInt = <a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a115e16408e5be63334ea1098dce47006">FFTtools::getInterpolatedGraph</a>(grTemp,deltaT); </div><div class="line"><a name="l04176"></a><span class="lineno"> 4176</span>&#160;      Int_t nPoints  = grInt-&gt;GetN();</div><div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;      Double_t *newx = grInt-&gt;GetX();</div><div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;      Double_t *newy = grInt-&gt;GetY();</div><div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;      <span class="comment">// Normalise</span></div><div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nPoints;i++){</div><div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160;        newy[i]=newy[i]*norm;</div><div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;        <span class="comment">// change time axis from ns to s</span></div><div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;        newx[i]=newx[i]*1E-9;</div><div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;      }</div><div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;      <span class="comment">// Pave to 0</span></div><div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;      <span class="keywordtype">int</span> paveNum = 8533;</div><div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;      grTemp = <span class="keyword">new</span> TGraph(nPoints,  newx, newy);</div><div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;      </div><div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160;      fSignalChainResponseDigitizer[ipol][iring][iphi] = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(<a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a954d82db89fffb091f2ffd5d3d7c94c7">FFTtools::padWaveToLength</a>(grTemp, paveNum));</div><div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;      </div><div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160;      <span class="keyword">delete</span> grInt;</div><div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;      <span class="keyword">delete</span> grTemp;</div><div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;</div><div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;      TGraph *gDig  = fSignalChainResponseDigitizer[ipol][iring][iphi]-&gt;getFreqMagGraph();</div><div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;      <span class="comment">// Smooth out the high frequency </span></div><div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160;      <span class="keywordtype">double</span> temparray[512];</div><div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;numFreqs;i++) {</div><div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;        temparray[i] =  gDig-&gt;Eval(freqs[i]*1e6);</div><div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;      }</div><div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;      </div><div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;      <span class="comment">// Smoothing magnitude response a bit to avoid trig/dig ratio explodes</span></div><div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numFreqs;i++){</div><div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        <span class="keywordflow">if</span> (freqs[i]&lt;900.){</div><div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;          fSignalChainResponseA3DigitizerFreqDomain[ipol][iring][iphi][i]  = temparray[i];</div><div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;          fSignalChainResponseA3DigitizerFreqDomain[ipol][iring][iphi][i]  = (temparray[i-2] + temparray[i-1] + temparray[i] + temparray[i+1] + temparray[i+2])/5.;</div><div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160;        }</div><div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;        fSignalChainResponseDigitizerFreqDomain[ipol][iring][iphi][0][i] = fSignalChainResponseA3DigitizerFreqDomain[ipol][iring][iphi][i];</div><div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;      }</div><div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;      </div><div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;      <span class="keyword">delete</span> gDig;</div><div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160;      </div><div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;    }</div><div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;      }</div><div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;    }</div><div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;  }</div><div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160;</div><div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;}</div><div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;</div><div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;<span class="keywordtype">void</span> Anita::readTuffResponseDigitizer(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;  <span class="comment">// for loops to make the RFSignal array that can be used in applyImpulseResponseDigitizer of ChanTrigger.cc</span></div><div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160;  <span class="comment">// ipol is the polarization &quot;v&quot; or &quot;H&quot; </span></div><div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;  <span class="comment">// ring is the number 3 for tmb or bottom middle top</span></div><div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;  <span class="comment">// iphi is the antenna number</span></div><div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;  <span class="comment">// ituff is the notch directory</span></div><div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160;  TString filename;</div><div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;  <span class="keywordtype">string</span> snotch_dir[6]={<span class="stringliteral">&quot;notches_260_0_0&quot;</span>,<span class="stringliteral">&quot;notches_260_375_0&quot;</span>,<span class="stringliteral">&quot;notches_260_0_460&quot;</span>,<span class="stringliteral">&quot;notches_260_385_0&quot;</span>,<span class="stringliteral">&quot;notches_260_365_0&quot;</span>,<span class="stringliteral">&quot;notches_260_375_460&quot;</span>};</div><div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;  <span class="keywordtype">string</span> spol[2] = {<span class="stringliteral">&quot;V&quot;</span>,<span class="stringliteral">&quot;H&quot;</span>};</div><div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;  <span class="keywordtype">string</span> sring[3] = {<span class="stringliteral">&quot;T&quot;</span>,<span class="stringliteral">&quot;M&quot;</span>,<span class="stringliteral">&quot;B&quot;</span>};</div><div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160; <span class="comment">// Set deltaT to be used in the convolution</span></div><div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;  deltaT = 1./(2.6*16.);</div><div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;</div><div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;  <span class="comment">// Additional norm constant?</span></div><div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;  <span class="comment">//  double norm = TMath::Power(10., +6./20.);</span></div><div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160;<span class="comment">//  double norm = 100.; // LC: 2019 Dec 11 From John Russell&#39;s studies, additional factor of 54.4. 54.4*TMath::Power(10., +6./20.)~100</span></div><div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;  <span class="keywordtype">double</span> norm = 10.;  <span class="comment">//  Let&#39;s see if this factor needed to be updated from John Russell&#39;s Sep 2020 studies.</span></div><div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;</div><div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160; <span class="comment">//  JR: From 2020 Sep results from John Russell&#39;s studies, changing from a global normalization to a per-channel array. As clock channels aren&#39;t filled, I decided to set their normalization to 1 to indicate no change.</span></div><div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160;<span class="comment">//  std::ifstream channelNormScaleFile(TString::Format(&quot;%s/channelNormScale-Anita%d.dat&quot;, ICEMC_DATA_DIR.data(), settings1 -&gt; ANITAVERSION).Data());  //  Read in file where channel normalization scales stored. Currently for ANITA-4 only.</span></div><div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;<span class="comment">//  int chanIdx = 0;</span></div><div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160; <span class="comment">// double scale;</span></div><div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;<span class="comment">//  double norms[108][6];</span></div><div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;</div><div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;<span class="comment">//  for (int chanIdx = 0; chanIdx &lt; 108; ++chanIdx) channelNormScaleFile &gt;&gt; norms[chanIdx][0] &gt;&gt; norms[chanIdx][1] &gt;&gt; norms[chanIdx][2] &gt;&gt; norms[chanIdx][3] &gt;&gt; norms[chanIdx][4] &gt;&gt; norms[chanIdx][5];</span></div><div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;<span class="comment">//  channelNormScaleFile.close();</span></div><div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160;</div><div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipol=0; ipol&lt;=1; ipol++) {</div><div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iring = 0; iring&lt;=2; iring++){</div><div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iphi=0; iphi&lt;=15; iphi++) {</div><div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ituff=0; ituff &lt;=6; ituff++) {</div><div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;      </div><div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;          <span class="keywordflow">if</span>(ituff==6){</div><div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;        filename = Form(<span class="stringliteral">&quot;%s/share/AnitaAnalysisFramework/responses/A4noNotches/%02d%s%s.imp&quot;</span>,getenv(<span class="stringliteral">&quot;ANITA_UTIL_INSTALL_DIR&quot;</span>), iphi+1, sring[iring].c_str(), spol[ipol].c_str());       </div><div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160;          }<span class="comment">// if tuffs notches off but tuffs on, these files are loaded and in different directory than other tuff notch configurations</span></div><div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;          <span class="keywordflow">else</span> {</div><div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;        filename = Form(<span class="stringliteral">&quot;%s/share/AnitaAnalysisFramework/responses/A4ImpulseTUFFs/%s/%02d%s%s.imp&quot;</span>,getenv(<span class="stringliteral">&quot;ANITA_UTIL_INSTALL_DIR&quot;</span>), snotch_dir[ituff].c_str(), iphi+1, sring[iring].c_str(), spol[ipol].c_str());            </div><div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;          }<span class="comment">// tuff responses with notches on are in different directory than with notches off</span></div><div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;</div><div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;      TGraph *gtemp = <span class="keyword">new</span> TGraph(filename);</div><div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160;      <span class="comment">// interpolate</span></div><div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;      TGraph *gint = Tools::getInterpolatedGraph(gtemp,deltaT); </div><div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;<span class="comment">// edits for debugging volumes</span></div><div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;          Int_t nPoints  = gint-&gt;GetN();</div><div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;          Double_t *newx = gint-&gt;GetX();</div><div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;          Double_t *newy = gint-&gt;GetY();</div><div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;      </div><div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;      <span class="comment">// Sep 2020, JR: Determine channel index based on ipol, iring, iphi for norms[108].</span></div><div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160;<span class="comment">//    int chanIndex = AnitaGeomTool::getChanIndexFromRingPhiPol(AnitaRing::AnitaRing_t(iring), iphi, AnitaPol::AnitaPol_t(ipol));</span></div><div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;</div><div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;      <span class="comment">// Normalize</span></div><div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nPoints;i++){</div><div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;        <span class="comment">// change time axis from ns to s</span></div><div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        newx[i]=newx[i]*1E-9;</div><div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;        newy[i]=newy[i]*norm;</div><div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;<span class="comment">//      newy[i]=newy[i]*norms[chanIndex][ituff];</span></div><div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;          }</div><div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;          *gint = TGraph(nPoints,newx,newy);</div><div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;<span class="comment">// end edits for debugging volumes</span></div><div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;      <span class="keywordtype">int</span> paveNum=8533; <span class="comment">// change for 0 to just signal back </span></div><div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;      fSignalChainResponseDigitizerTuffs[ipol][iring][iphi][ituff] = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(<a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a954d82db89fffb091f2ffd5d3d7c94c7">FFTtools::padWaveToLength</a>(gint, paveNum)); </div><div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;      <span class="keyword">delete</span> gint;</div><div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;      <span class="keyword">delete</span> gtemp;</div><div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;      </div><div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;      TGraph *gDig  = fSignalChainResponseDigitizerTuffs[ipol][iring][iphi][ituff]-&gt;getFreqMagGraph();</div><div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;      <span class="comment">// Smooth out the high frequency </span></div><div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;      <span class="keywordtype">double</span> temparray[512];</div><div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;numFreqs;i++) {</div><div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;        temparray[i] =  gDig-&gt;Eval(freqs[i]*1e6);</div><div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;      }</div><div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;      </div><div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;      <span class="comment">// Smoothing magnitude response a bit to avoid trig/dig ratio explodes</span></div><div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numFreqs;i++){</div><div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;        <span class="keywordflow">if</span> (freqs[i]&lt;900.){</div><div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;          fSignalChainResponseDigitizerFreqDomain[ipol][iring][iphi][ituff][i]  = temparray[i];</div><div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;          fSignalChainResponseDigitizerFreqDomain[ipol][iring][iphi][ituff][i]  = (temparray[i-2] + temparray[i-1] + temparray[i] + temparray[i+1] + temparray[i+2])/5.;</div><div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        }</div><div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;      }</div><div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;      </div><div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;      <span class="keyword">delete</span> gDig;</div><div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;      </div><div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;    }<span class="comment">// end for loop ituff</span></div><div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;      } <span class="comment">// end for loop iphi</span></div><div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;    }<span class="comment">// end for loop iring</span></div><div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;  }<span class="comment">// end for loop ipol</span></div><div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;}</div><div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;</div><div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;<span class="keywordtype">void</span> Anita::readTuffResponseTrigger(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;  <span class="comment">// for loops to make the RFSignal array that can be used in applyImpulseResponseTrigger of ChanTrigger.cc Do we need one for each antenna???</span></div><div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;  TString filename;</div><div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;  <span class="keywordtype">string</span> snotch_dir[7]={<span class="stringliteral">&quot;trigconfigA.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigB.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigC.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigG.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigO.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigP.imp&quot;</span>,<span class="stringliteral">&quot;trigconfigK.imp&quot;</span>};</div><div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160; <span class="comment">// Set deltaT to be used in the convolution</span></div><div class="line"><a name="l04314"></a><span class="lineno"> 4314</span>&#160;  deltaT = 1./(2.6*16.);</div><div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipol=0; ipol&lt;=1; ipol++) {</div><div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iring = 0; iring&lt;=2; iring++){</div><div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iphi=0; iphi&lt;=15; iphi++) {</div><div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ituff=0; ituff &lt;=6; ituff++) {</div><div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;            filename = Form(<span class="stringliteral">&quot;%s/share/AnitaAnalysisFramework/responses/A4ImpulseTUFFs/%s&quot;</span>,getenv(<span class="stringliteral">&quot;ANITA_UTIL_INSTALL_DIR&quot;</span>), snotch_dir[ituff].c_str());</div><div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160;            <span class="comment">//debugging</span></div><div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;            <span class="comment">//cout &lt;&lt; Form(&quot;%s/share/AnitaAnalysisFramework/responses/TUFFs/%s&quot;,getenv(&quot;ANITA_UTIL_INSTALL_DIR&quot;), snotch_dir[ituff].c_str()) &lt;&lt; endl;</span></div><div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;          TGraph *gtemp = <span class="keyword">new</span> TGraph(filename);</div><div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;          <span class="comment">// interpolate</span></div><div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;          TGraph *gint = Tools::getInterpolatedGraph(gtemp,deltaT); </div><div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;<span class="comment">// edits for debugging volumes</span></div><div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;          Int_t nPoints  = gint-&gt;GetN();</div><div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160;          Double_t *newx = gint-&gt;GetX();</div><div class="line"><a name="l04328"></a><span class="lineno"> 4328</span>&#160;          Double_t *newy = gint-&gt;GetY();</div><div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;          <span class="comment">// Normalise</span></div><div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nPoints;i++){</div><div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;          <span class="comment">// change time axis from ns to s</span></div><div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;          newx[i]=newx[i]*1E-9;</div><div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;          }</div><div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160;          *gint = TGraph(nPoints,newx,newy);</div><div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;<span class="comment">// end edits for debugging volumes</span></div><div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160;          <span class="keywordtype">int</span> paveNum=8533; <span class="comment">// change for 0 to just signal back </span></div><div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;          fSignalChainResponseTriggerTuffs[ipol][iring][iphi][ituff] = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(<a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a954d82db89fffb091f2ffd5d3d7c94c7">FFTtools::padWaveToLength</a>(gint, paveNum)); </div><div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;          <span class="keyword">delete</span> gint;</div><div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;          <span class="keyword">delete</span> gtemp;</div><div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;</div><div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;      </div><div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;      TGraph *gTrig  = fSignalChainResponseTriggerTuffs[ipol][iring][iphi][ituff]-&gt;getFreqMagGraph();</div><div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160;      <span class="comment">// Smooth out the high frequency </span></div><div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;      <span class="keywordtype">double</span> temparray[512];</div><div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;numFreqs;i++) {</div><div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;        temparray[i] =  gTrig-&gt;Eval(freqs[i]*1e6);</div><div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;      }</div><div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;      </div><div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;      <span class="comment">// Smoothing magnitude response a bit to avoid trig/dig ratio explodes</span></div><div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;numFreqs;i++){</div><div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;        <span class="keywordflow">if</span> (freqs[i]&lt;900.){</div><div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;          fSignalChainResponseTriggerFreqDomain[ipol][iring][iphi][ituff][i]  = temparray[i];</div><div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;          fSignalChainResponseTriggerFreqDomain[ipol][iring][iphi][ituff][i]  = (temparray[i-2] + temparray[i-1] + temparray[i] + temparray[i+1] + temparray[i+2])/5.;</div><div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;        }</div><div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;      }</div><div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;      </div><div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;      <span class="keyword">delete</span> gTrig;</div><div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;        }<span class="comment">// end for loop ituff</span></div><div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;      } <span class="comment">// end for loop iphi</span></div><div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    }<span class="comment">// end for loop iring</span></div><div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160;  }<span class="comment">// end for loop ipol</span></div><div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;}</div><div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160;</div><div class="line"><a name="l04365"></a><span class="lineno"> 4365</span>&#160;<span class="keywordtype">void</span> Anita::readNoiseFromFlight(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;  </div><div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;  TFile *fRayleighAnita3 = <span class="keyword">new</span> TFile((ICEMC_DATA_DIR+<span class="stringliteral">&quot;/RayleighAmplitudesAnita3_noSun_Interp.root&quot;</span>).c_str(), <span class="stringliteral">&quot;read&quot;</span>);</div><div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;  </div><div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0;iant&lt;48;iant++){</div><div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    RayleighFits[0][iant] = (TGraph*)fRayleighAnita3-&gt;Get(Form(<span class="stringliteral">&quot;grSigma%dV_interp&quot;</span>, iant+1));</div><div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    RayleighFits[1][iant] = (TGraph*)fRayleighAnita3-&gt;Get(Form(<span class="stringliteral">&quot;grSigma%dH_interp&quot;</span>, iant+1));</div><div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;  }</div><div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160;   </div><div class="line"><a name="l04374"></a><span class="lineno"> 4374</span>&#160;  Double_t *timeVals = <span class="keyword">new</span> Double_t [780];</div><div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;  Double_t *voltVals = <span class="keyword">new</span> Double_t [780];</div><div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;780;i++){</div><div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;    timeVals[i] = i*1./2.6;</div><div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;    voltVals[i] = 0.1;</div><div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160;  }</div><div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;  </div><div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;  <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a> *rfTemplate = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(780,timeVals,voltVals,<span class="keyword">true</span>);</div><div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;  </div><div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;  numFreqs=rfTemplate-&gt;getNumFreqs();</div><div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;  freqs=rfTemplate-&gt;getFreqs();</div><div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;  </div><div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;  </div><div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160;}</div><div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;</div><div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;</div><div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;</div><div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;<span class="keywordtype">void</span> Anita::readImpulseResponseTrigger(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;</div><div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;  <span class="comment">// So far only available for ANITA-3</span></div><div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;  </div><div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;  <span class="comment">// Set deltaT to be used in the convolution</span></div><div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;  deltaT = 1./(2.6*16.);</div><div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;  <span class="keywordtype">string</span> graphNames[2][3][16];</div><div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;  <span class="keywordtype">string</span> fileName;</div><div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;  <span class="keywordtype">double</span> norm=1;</div><div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;</div><div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;  <span class="keywordflow">if</span>(settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10){</div><div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;    <span class="keywordflow">if</span>(settings1-&gt;WHICH==9){</div><div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;      fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/Anita3_ImpulseResponseTrigger.root&quot;</span>;</div><div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160;    }</div><div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;      fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/Anita4_ImpulseResponseTrigger.root&quot;</span>;</div><div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;    }</div><div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;    <span class="keywordtype">string</span> spol[2] ={<span class="stringliteral">&quot;V&quot;</span>, <span class="stringliteral">&quot;H&quot;</span>};</div><div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160;    <span class="keywordtype">string</span> sring[3]={<span class="stringliteral">&quot;T&quot;</span>, <span class="stringliteral">&quot;M&quot;</span>, <span class="stringliteral">&quot;B&quot;</span>};</div><div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    </div><div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++){</div><div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0;iring&lt;3;iring++){</div><div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++){</div><div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;      graphNames[ipol][iring][iphi]= Form(<span class="stringliteral">&quot;gTrigPath&quot;</span>) ;</div><div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160;    }</div><div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;      }</div><div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;    }</div><div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160;</div><div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    <span class="comment">// Impulse response accounts for trigger/digitizer splitter</span></div><div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    <span class="comment">// norm *= sqrt(2);</span></div><div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;    <span class="comment">// if we are using the trigger impulse response and the old noise</span></div><div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;    <span class="comment">// we need to add this 7dB attenuation to have sensible results</span></div><div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;    <span class="comment">// see LC&#39;s talk on 2017 Nov 13</span></div><div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160;    <span class="keywordflow">if</span> (!settings1-&gt;NOISEFROMFLIGHTTRIGGER) norm *= TMath::Power(10, -7/20.);</div><div class="line"><a name="l04425"></a><span class="lineno"> 4425</span>&#160;  }</div><div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;</div><div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;  <span class="comment">// Read in input file</span></div><div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;  TFile fImpulse(fileName.c_str());</div><div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160;  </div><div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;  <span class="keywordflow">if</span>(!fImpulse.IsOpen()) {</div><div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;    std::cerr &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t read signal chain impulse response from &quot;</span> &lt;&lt; fileName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;    exit(0);</div><div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;  } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;</div><div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0; iring&lt;3; iring++){</div><div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0; iphi&lt;16; iphi++){</div><div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;      <span class="comment">// Read graph</span></div><div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;      TGraph *grTemp = (TGraph*) fImpulse.Get(graphNames[ipol][iring][iphi].c_str());</div><div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;      <span class="keywordflow">if</span>(!grTemp) {</div><div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160;        std::cerr &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t read signal chain impulse response&quot;</span> &lt;&lt; graphNames[ipol][iring][iphi] &lt;&lt; <span class="stringliteral">&quot; from file &quot;</span> &lt;&lt; fileName &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;        exit(0);</div><div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;      }</div><div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;      <span class="comment">// Interpolate to high sampling rate that will be used for the convolution</span></div><div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;      TGraph *grInt = <a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a115e16408e5be63334ea1098dce47006">FFTtools::getInterpolatedGraph</a>(grTemp,deltaT); </div><div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;      Int_t nPoints  = grInt-&gt;GetN();</div><div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;      Double_t *newx = grInt-&gt;GetX();</div><div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;      Double_t *newy = grInt-&gt;GetY();</div><div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;      <span class="comment">// Normalise</span></div><div class="line"><a name="l04450"></a><span class="lineno"> 4450</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nPoints;i++){</div><div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;        newy[i]=newy[i]*norm;</div><div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;        <span class="comment">// change time axis from ns to s</span></div><div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;        newx[i]=newx[i]*1E-9;</div><div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;      }</div><div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;      <span class="comment">// Pave to 0</span></div><div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160;      <span class="keywordtype">int</span> paveNum = 8533;</div><div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;      grTemp = <span class="keyword">new</span> TGraph(nPoints,  newx, newy);</div><div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    </div><div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;      fSignalChainResponseTrigger[ipol][iring][iphi] = <span class="keyword">new</span> <a class="code" href="../../d2/df7/class_r_f_signal.html">RFSignal</a>(<a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a954d82db89fffb091f2ffd5d3d7c94c7">FFTtools::padWaveToLength</a>(grTemp, paveNum));</div><div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    </div><div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160;      <span class="keyword">delete</span> grInt;</div><div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;      <span class="keyword">delete</span> grTemp;</div><div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;</div><div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;TUFFSTATUS==0){</div><div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160;        TGraph *gTrig = fSignalChainResponseTrigger[ipol][iring][iphi]-&gt;getFreqMagGraph();</div><div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;numFreqs;i++) {</div><div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;          fSignalChainResponseTriggerFreqDomain[ipol][iring][iphi][0][i]    = gTrig-&gt;Eval(freqs[i]*1e6);</div><div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;        }</div><div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;        <span class="keyword">delete</span> gTrig;</div><div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160;      }</div><div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;      </div><div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;    }</div><div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;      }</div><div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;    }</div><div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;  }</div><div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;</div><div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;}</div><div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;</div><div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;<span class="keywordtype">void</span> Anita::calculateImpulseResponsesRatios(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;</div><div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;  <span class="keywordtype">double</span> denom, dig, trig;</div><div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;</div><div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;  <span class="keywordtype">double</span> norm = 1.;</div><div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160;  <span class="comment">// thermal noise is calculated from ANITA-3 flight data</span></div><div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;  <span class="comment">// the ANITA-4 thermal noise was roughly 85% of the ANITA-3 one</span></div><div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==10) norm=0.85;</div><div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;  </div><div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0; ipol&lt;2; ipol++){</div><div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iring=0; iring&lt;3; iring++){</div><div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0; iphi&lt;16; iphi++){</div><div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ituff=0; ituff&lt;ntuffs; ituff++){</div><div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;        </div><div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;numFreqs;i++){</div><div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        denom  = fSignalChainResponseA3DigitizerFreqDomain[ipol][iring][iphi][i];</div><div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;        trig   = fSignalChainResponseTriggerFreqDomain[ipol][iring][iphi][ituff][i];</div><div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160;        dig    = fSignalChainResponseDigitizerFreqDomain[ipol][iring][iphi][ituff][i];</div><div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;</div><div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;        <span class="keywordflow">if</span> (freqs[i]&lt;160.) {</div><div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;          fRatioTriggerToA3DigitizerFreqDomain[ipol][iring][iphi][ituff][i] = 0.1;  </div><div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160;        } <span class="keywordflow">else</span> {</div><div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;          fRatioTriggerToA3DigitizerFreqDomain[ipol][iring][iphi][ituff][i] = (trig/denom)*norm;</div><div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;        }</div><div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;        </div><div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;        fRatioDigitizerToA3DigitizerFreqDomain[ipol][iring][iphi][ituff][i]  = (dig/denom)*norm;</div><div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;        <span class="comment">//      cout &lt;&lt; &quot;Numbers are &quot; &lt;&lt; dig &lt;&lt;  &quot; &quot; &lt;&lt; trig &lt;&lt; &quot; &quot; &lt;&lt; denom  &lt;&lt; &quot; &quot; &lt;&lt; trig/denom &lt;&lt; &quot; &quot; &lt;&lt; dig/denom &lt;&lt; endl;</span></div><div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;      }<span class="comment">// end for loop to fill fRatioTriggerDigitizerFreqDomain</span></div><div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;    }<span class="comment">// end tuffIndex loop</span></div><div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160;     </div><div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;      } <span class="comment">// end for loop over iphi</span></div><div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;    } <span class="comment">// end for loop over iring</span></div><div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;  } <span class="comment">// end for loop over ipol</span></div><div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;  <span class="comment">// delete fout;</span></div><div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160;</div><div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;</div><div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;  </div><div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;</div><div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;</div><div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;  </div><div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;}</div><div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;</div><div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160;</div><div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;<span class="keywordtype">void</span> Anita::readTriggerEfficiencyScanPulser(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1){</div><div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;</div><div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;  <span class="keywordflow">if</span>(settings1-&gt;WHICH==10 || settings1-&gt;WHICH==9){</div><div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;</div><div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160;    <span class="keywordflow">if</span>(settings1-&gt;WHICH==10){</div><div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;      <span class="keywordtype">string</span> fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/TriggerEfficiencyScanPulser_anita4_33dB_avg_trimmed.root&quot;</span>;</div><div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160;      TFile *f = <span class="keyword">new</span> TFile(fileName.c_str(), <span class="stringliteral">&quot;read&quot;</span>);</div><div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;      gPulseAtAmpa  = (TGraph*)f-&gt;Get(<span class="stringliteral">&quot;Phisector_3_33dBCh1_trimmed&quot;</span>);</div><div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;</div><div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;<span class="comment">// change to nanoseconds from seconds</span></div><div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;      Int_t nPoints  = gPulseAtAmpa-&gt;GetN();</div><div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;      Double_t *newx = gPulseAtAmpa-&gt;GetX();</div><div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160;      Double_t *newy = gPulseAtAmpa-&gt;GetY();</div><div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;      Double_t meany = TMath::Mean(nPoints/10, newy);</div><div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;      </div><div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nPoints;i++){</div><div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;      <span class="comment">// change time axis s to ns</span></div><div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160;        newx[i]=newx[i]*1E9;</div><div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    newy[i]-=meany;</div><div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;      }</div><div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160;      *gPulseAtAmpa = TGraph(nPoints,newx,newy);</div><div class="line"><a name="l04543"></a><span class="lineno"> 4543</span>&#160;<span class="comment">// end change to ns</span></div><div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;<span class="comment">//      TCanvas *ctemp = new TCanvas(&quot;ctemp&quot;);</span></div><div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;<span class="comment">//      gPulseAtAmpa-&gt;Draw(&quot;AL&quot;);</span></div><div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;<span class="comment">//      ctemp-&gt;Print(&quot;pulse.png&quot;);</span></div><div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;      f-&gt;Close();</div><div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;    }</div><div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;      <span class="keywordtype">string</span> fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/TriggerEfficiencyScanPulser_anita3.root&quot;</span>;</div><div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;      TFile *f = <span class="keyword">new</span> TFile(fileName.c_str(), <span class="stringliteral">&quot;read&quot;</span>);</div><div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;    <span class="comment">// Get average pulse as measured by scope</span></div><div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;      gPulseAtAmpa  = (TGraph*)f-&gt;Get(<span class="stringliteral">&quot;gAvgPulseAtAmpa&quot;</span>);</div><div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;<span class="comment">//      TCanvas *ctemp = new TCanvas(&quot;ctemp&quot;);</span></div><div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;<span class="comment">//      gPulseAtAmpa-&gt;Draw(&quot;AL&quot;);</span></div><div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;<span class="comment">//      ctemp-&gt;Print(&quot;pulse.png&quot;);</span></div><div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;      f-&gt;Close();</div><div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;<span class="comment">//      cout &lt;&lt; &quot;Pulse has this many points &quot; &lt;&lt; gPulseAtAmpa-&gt;GetN() &lt;&lt; endl;</span></div><div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;</div><div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    }</div><div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;    <span class="keywordtype">bool</span> useDelayGenerator = <span class="keyword">false</span>;</div><div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;</div><div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;    <span class="keywordtype">double</span> maxDelays =  (Tools::dMax(trigEffScanRingDelay, 3) + Tools::dMax(trigEffScanPhiDelay,5) );</div><div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;    maxDelays       -=  (Tools::dMin(trigEffScanRingDelay, 3) + Tools::dMin(trigEffScanPhiDelay,5) );</div><div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;    </div><div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;    <span class="keywordflow">if</span> (maxDelays!=0) useDelayGenerator=<span class="keyword">true</span>;</div><div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;    </div><div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;gPulseAtAmpa-&gt;GetN();i++){</div><div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;      <span class="keywordflow">if</span>(settings1-&gt;WHICH==9){</div><div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160;        <span class="comment">// 7db fixed attenuation</span></div><div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;        gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10,-7./20.);</div><div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(settings1-&gt;WHICH==10){</div><div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;</div><div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;        <span class="comment">// 0db fixed attenuation</span></div><div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;<span class="comment">//        if(i==1000){</span></div><div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;<span class="comment">//          cout &lt;&lt; &quot;y value for entry 1000 before attenuation of 0db is  &quot; &lt;&lt; gPulseAtAmpa-&gt;GetY()[i] &lt;&lt; endl;</span></div><div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;<span class="comment">//        }</span></div><div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;    <span class="comment">// Fixed attenuation was -25dB</span></div><div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160;    <span class="comment">// Input is the pulse at -33dB variable attenuation</span></div><div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;    gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10,(-25.0+33.0)/20.);</div><div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;</div><div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;<span class="comment">//        if(i==1000){</span></div><div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;<span class="comment">//          cout &lt;&lt; &quot;y value for entry 1000 is after attenuation of 0db is &quot; &lt;&lt; gPulseAtAmpa-&gt;GetY()[i] &lt;&lt; endl;</span></div><div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160;<span class="comment">//        }</span></div><div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;</div><div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160;      }</div><div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;</div><div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;      <span class="comment">// Variable attenuation of central phi sector</span></div><div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;      gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10, trigEffScanAtt[2]*1./20.);</div><div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160;</div><div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;      <span class="keywordflow">if</span>(settings1-&gt;WHICH==9){</div><div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;        <span class="comment">// Signal in a 12-way splitter </span></div><div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160;        gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10, -10.8/20.);</div><div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(settings1-&gt;WHICH==10){</div><div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;        <span class="comment">// Signal in a 16-way splitter </span></div><div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;        gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10, -12./20.);</div><div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;      }</div><div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;</div><div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;      <span class="comment">// Attenutation due to delay generator</span></div><div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;      <span class="keywordflow">if</span> (useDelayGenerator){</div><div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;    gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10, -12./20.);</div><div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160;      }</div><div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;</div><div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;      <span class="comment">// Splitter between digitizer and trigger path</span></div><div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;      gPulseAtAmpa-&gt;GetY()[i]*=TMath::Power(10,-3./20.);</div><div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;       </div><div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;    }</div><div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;</div><div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;<span class="comment">//    TCanvas *ctemp2 = new TCanvas(&quot;ctemp2&quot;);</span></div><div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;<span class="comment">//    gPulseAtAmpa-&gt;Draw(&quot;AL&quot;);</span></div><div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160;<span class="comment">//    ctemp2-&gt;Print(&quot;pulse_after_atten.png&quot;);</span></div><div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;</div><div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;    <span class="comment">// To get the correct interpolation we need to shift the waveform</span></div><div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160;    <span class="comment">// We shift it by 8*(1/(2.6*16)) ns</span></div><div class="line"><a name="l04615"></a><span class="lineno"> 4615</span>&#160;    </div><div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;    <span class="keywordtype">double</span> *x = gPulseAtAmpa-&gt;GetX();</div><div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;    <span class="keywordtype">double</span> *y = gPulseAtAmpa-&gt;GetY();</div><div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <span class="keywordtype">double</span> xnew[10000], ynew[10000];</div><div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <span class="keywordtype">int</span> N = gPulseAtAmpa-&gt;GetN();</div><div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    </div><div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <span class="keywordtype">int</span> newn = N - 6;</div><div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160;    </div><div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=6; j&lt;N; j++){</div><div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160;      xnew[j-6] = x[j];</div><div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;      ynew[j-6] = y[j];</div><div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;    }</div><div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;    </div><div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;    TGraph *gtemp = <span class="keyword">new</span> TGraph (newn, xnew, ynew);</div><div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;    </div><div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;    TGraph *gPulseAtAmpaInt = <a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a115e16408e5be63334ea1098dce47006">FFTtools::getInterpolatedGraph</a>(gtemp, 1/2.6);</div><div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    </div><div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;HALFNFOUR;i++){</div><div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;      trigEffScanPulseAtAmpa[i] = gPulseAtAmpaInt-&gt;Eval(fTimes[i]);</div><div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;    }</div><div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;    <span class="keywordflow">if</span>(settings1-&gt;WHICH==9){</div><div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;      gPulseAtAmpa  = <a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a7032954306c77e9dc08dfd752a91deda">FFTtools::translateGraph</a>(gPulseAtAmpa, 77.5721);</div><div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;    }</div><div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;<span class="comment">//    TCanvas *ctemp1 = new TCanvas(&quot;ctemp1&quot;);</span></div><div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;<span class="comment">//    gPulseAtAmpa-&gt;Draw(&quot;AL&quot;);</span></div><div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160;<span class="comment">//    ctemp1-&gt;Print(&quot;pulse_after_interp.png&quot;);</span></div><div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;</div><div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;    <span class="keyword">delete</span> gPulseAtAmpaInt;</div><div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;    <span class="keyword">delete</span> gtemp;</div><div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;     </div><div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;    <span class="keywordflow">if</span>(settings1-&gt;WHICH==9){</div><div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;      <span class="keywordtype">string</span> fileName = ICEMC_DATA_DIR+<span class="stringliteral">&quot;/TriggerEfficiencyScanPulser_anita3.root&quot;</span>;</div><div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;      TFile *f = <span class="keyword">new</span> TFile(fileName.c_str(), <span class="stringliteral">&quot;read&quot;</span>);</div><div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;</div><div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> isample=0;isample&lt;250;isample++){</div><div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;        <span class="comment">// Get average waveform at SURF as measured by scope</span></div><div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;        TGraph *gPulseAtSurf = (TGraph*)f-&gt;Get(Form(<span class="stringliteral">&quot;gSamplePulseAtSurf_%i&quot;</span>, isample));</div><div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;     </div><div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;        TGraph *gPulseAtSurfInt = <a class="code" href="../../de/dc5/namespace_f_f_ttools.html#a115e16408e5be63334ea1098dce47006">FFTtools::getInterpolatedGraph</a>(gPulseAtSurf, 1/(2.6));</div><div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160;        <span class="keywordtype">double</span> *y2 = gPulseAtSurfInt-&gt;GetY();</div><div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;        <span class="comment">// 20dB attenuation was applied at the scope</span></div><div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;HALFNFOUR;i++){</div><div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;      trigEffScanPulseAtSurf[isample][i]=y2[i]/10.;</div><div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;        }</div><div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160;      </div><div class="line"><a name="l04660"></a><span class="lineno"> 4660</span>&#160;        <span class="keyword">delete</span> gPulseAtSurfInt;</div><div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;        <span class="keyword">delete</span> gPulseAtSurf;</div><div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;      }</div><div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;      f-&gt;Close();</div><div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;</div><div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160;    }</div><div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;  }</div><div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;    cout &lt;&lt; <span class="stringliteral">&quot;Impulse response on trigger path can only be used with ANITA-3 or ANITA-4&quot;</span> &lt;&lt; endl;</div><div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;    exit(1);</div><div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;  }</div><div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160; </div><div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;}</div><div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;</div><div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;</div><div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;</div><div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;<span class="keywordtype">void</span> Anita::calculateDelaysForEfficiencyScan(){</div><div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;</div><div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;  <span class="keywordtype">int</span> irx, phiIndex;</div><div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;</div><div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iant=0; iant&lt;48; iant++){</div><div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;    </div><div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;    phiIndex = trigEffScanPhi - (iant%16);</div><div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;    <span class="keywordflow">if</span> (phiIndex&gt;8) phiIndex=phiIndex-16;</div><div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;</div><div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;    <span class="keywordflow">if</span>(TMath::Abs(phiIndex)&lt;=2){</div><div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;</div><div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;      irx = iant;</div><div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;      <span class="keywordflow">if</span> (iant&lt;16) {</div><div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160;    <span class="keywordflow">if</span> (iant%2==0) irx = iant/2;</div><div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;    <span class="keywordflow">else</span>          irx = 8 + iant/2;</div><div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;      }</div><div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;</div><div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;      <span class="comment">// Add phi sector delay</span></div><div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;      arrival_times[0][irx] += trigEffScanPhiDelay[phiIndex+2];</div><div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;</div><div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;      <span class="comment">// Check if we are adding the ring delay to this phi sector</span></div><div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;      <span class="keywordflow">if</span> (trigEffScanApplyRingDelay[phiIndex+2]&gt;0){</div><div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;    <span class="comment">// Add ring delay (T-M, M-B, T-B)</span></div><div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;    <span class="keywordflow">if</span> (iant&lt;16)       arrival_times[0][irx] += trigEffScanRingDelay[0] + trigEffScanRingDelay[2];</div><div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (iant&lt;32)  arrival_times[0][irx] += trigEffScanRingDelay[1];</div><div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;      </div><div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;      }</div><div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;    }</div><div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;    </div><div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;  }</div><div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;</div><div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;}</div><div class="ttc" id="class_balloon_html_a6bf058d1320831ad733db4c5f9ce3cbe"><div class="ttname"><a href="../../d2/d24/class_balloon.html#a6bf058d1320831ad733db4c5f9ce3cbe">Balloon::phi_bn</a></div><div class="ttdeci">double phi_bn</div><div class="ttdoc">theta,phi of balloon wrt south pole </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00065">balloon.hh:65</a></div></div>
<div class="ttc" id="class_anita_event_calibrator_html_ac1e6302b11bf7427beb5631bcda872a1"><div class="ttname"><a href="../../d7/d7d/class_anita_event_calibrator.html#ac1e6302b11bf7427beb5631bcda872a1">AnitaEventCalibrator::Instance</a></div><div class="ttdeci">static AnitaEventCalibrator * Instance(int version=0)</div><div class="ttdoc">Instance generator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd3/_anita_event_calibrator_8cxx_source.html#l00067">AnitaEventCalibrator.cxx:67</a></div></div>
<div class="ttc" id="class_anita_html_a2d70e8618f531c7f4e94f147b275a886"><div class="ttname"><a href="../../df/da2/class_anita.html#a2d70e8618f531c7f4e94f147b275a886">Anita::GetRxTriggerNumbering</a></div><div class="ttdeci">int GetRxTriggerNumbering(int ilayer, int ifold)</div><div class="ttdoc">get antenna number based on which layer and position it is </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4f/anita_8cc_source.html#l00208">anita.cc:208</a></div></div>
<div class="ttc" id="class_anita_geom_tool_html_a32a1c9069f5d8d29fa7dc9636cd44da8"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html#a32a1c9069f5d8d29fa7dc9636cd44da8">AnitaGeomTool::getAntPolFromSurfChan</a></div><div class="ttdeci">static Int_t getAntPolFromSurfChan(Int_t surf, Int_t chan, Int_t &amp;ant, AnitaPol::AnitaPol_t &amp;pol)</div><div class="ttdoc">Convert surf-chan to ant-pol. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/_anita_geom_tool_8cxx_source.html#l00801">AnitaGeomTool.cxx:801</a></div></div>
<div class="ttc" id="namespace_f_f_ttools_html_a954d82db89fffb091f2ffd5d3d7c94c7"><div class="ttname"><a href="../../de/dc5/namespace_f_f_ttools.html#a954d82db89fffb091f2ffd5d3d7c94c7">FFTtools::padWaveToLength</a></div><div class="ttdeci">TGraph * padWaveToLength(const TGraph *grA, Int_t newLength)</div><div class="ttdoc">Zero pad a wave making it up to newLength points. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/_f_f_ttools_8cxx_source.html#l01769">FFTtools.cxx:1769</a></div></div>
<div class="ttc" id="class_r_f_signal_html"><div class="ttname"><a href="../../d2/df7/class_r_f_signal.html">RFSignal</a></div><div class="ttdoc">This is a wrapper class for an RF Signal. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d38/_r_f_signal_8h_source.html#l00012">RFSignal.h:12</a></div></div>
<div class="ttc" id="namespace_environment_variable_html_a064f876067320b15e34beb8c29c8ffdc"><div class="ttname"><a href="../../d4/d7f/namespace_environment_variable.html#a064f876067320b15e34beb8c29c8ffdc">EnvironmentVariable::ICEMC_SRC_DIR</a></div><div class="ttdeci">const char * ICEMC_SRC_DIR()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dd9/_environment_variable_8cc_source.html#l00056">EnvironmentVariable.cc:56</a></div></div>
<div class="ttc" id="class_anita_html_aa4c8e6d42e2b0cacc85db69dbc547adc"><div class="ttname"><a href="../../df/da2/class_anita.html#aa4c8e6d42e2b0cacc85db69dbc547adc">Anita::Initialize</a></div><div class="ttdeci">void Initialize(Settings *settings1, ofstream &amp;foutput, int inu, TString outputdir)</div><div class="ttdoc">initialize a bunch of stuff </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4f/anita_8cc_source.html#l00249">anita.cc:249</a></div></div>
<div class="ttc" id="namespace_f_f_ttools_html_a115e16408e5be63334ea1098dce47006"><div class="ttname"><a href="../../de/dc5/namespace_f_f_ttools.html#a115e16408e5be63334ea1098dce47006">FFTtools::getInterpolatedGraph</a></div><div class="ttdeci">TGraph * getInterpolatedGraph(const TGraph *grIn, Double_t deltaT)</div><div class="ttdoc">Interpolation Routines that use ROOT::Math::Interpolator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/_f_f_ttools_8cxx_source.html#l00032">FFTtools.cxx:32</a></div></div>
<div class="ttc" id="class_anita_event_calibrator_html"><div class="ttname"><a href="../../d7/d7d/class_anita_event_calibrator.html">AnitaEventCalibrator</a></div><div class="ttdoc">AnitaEventCalibrator  The ANITA Event Calibrator. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d05/_anita_event_calibrator_8h_source.html#l00046">AnitaEventCalibrator.h:46</a></div></div>
<div class="ttc" id="namespace_f_f_ttools_html_a7032954306c77e9dc08dfd752a91deda"><div class="ttname"><a href="../../de/dc5/namespace_f_f_ttools.html#a7032954306c77e9dc08dfd752a91deda">FFTtools::translateGraph</a></div><div class="ttdeci">TGraph * translateGraph(const TGraph *grWave, const Double_t deltaT)</div><div class="ttdoc">Returns a graph translated by deltaT. Such that t&amp;#39;=t+dt. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d8d/_f_f_ttools_8cxx_source.html#l01619">FFTtools.cxx:1619</a></div></div>
<div class="ttc" id="class_settings_html"><div class="ttname"><a href="../../db/d2b/class_settings.html">Settings</a></div><div class="ttdoc">Reads in and stores input settings for the run. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4a/_settings_8h_source.html#l00037">Settings.h:37</a></div></div>
<div class="ttc" id="class_chan_trigger_html_a7ee27fceaba30ae0beabce566468dfb0"><div class="ttname"><a href="../../dd/d24/class_chan_trigger.html#a7ee27fceaba30ae0beabce566468dfb0">ChanTrigger::GetNoise</a></div><div class="ttdeci">static double GetNoise(Settings *settings1, double altitude_bn, double geoid, double theta, double bw, double temp)</div><div class="ttdoc">Get Noise. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d47/_chan_trigger_8cc_source.html#l01474">ChanTrigger.cc:1474</a></div></div>
<div class="ttc" id="class_balloon_html_a3fb3960c3971912072c734c3df055f87"><div class="ttname"><a href="../../d2/d24/class_balloon.html#a3fb3960c3971912072c734c3df055f87">Balloon::BN_LONGITUDE</a></div><div class="ttdeci">double BN_LONGITUDE</div><div class="ttdoc">balloon longitude for fixed balloon location </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00088">balloon.hh:88</a></div></div>
<div class="ttc" id="namespace_tools_html_a37243f7802df0a924c0551b680594bd0"><div class="ttname"><a href="../../d4/da0/namespace_tools.html#a37243f7802df0a924c0551b680594bd0">Tools::ConvertHVtoLRTimedomain</a></div><div class="ttdeci">void ConvertHVtoLRTimedomain(const int nfour, double *vvolts, double *hvolts, double *left, double *right)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d22/_tools_8cc_source.html#l00746">Tools.cc:746</a></div></div>
<div class="ttc" id="class_f_f_t_w_complex_html"><div class="ttname"><a href="../../d3/d11/class_f_f_t_w_complex.html">FFTWComplex</a></div><div class="ttdoc">This is a wrapper class for a complex number. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d49/_f_f_t_w_complex_8h_source.html#l00012">FFTWComplex.h:12</a></div></div>
<div class="ttc" id="class_balloon_html_ace0902a765981b8ca408b4fce6857805"><div class="ttname"><a href="../../d2/d24/class_balloon.html#ace0902a765981b8ca408b4fce6857805">Balloon::unRotatePayload</a></div><div class="ttdeci">Vector unRotatePayload(Vector ant_pos)</div><div class="ttdoc">This function UN-rotates the payload. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d65/balloon_8cc_source.html#l01221">balloon.cc:1221</a></div></div>
<div class="ttc" id="class_balloon_html_a82033268c70493ca7c6e850e82e8c49d"><div class="ttname"><a href="../../d2/d24/class_balloon.html#a82033268c70493ca7c6e850e82e8c49d">Balloon::surface_under_balloon</a></div><div class="ttdeci">double surface_under_balloon</div><div class="ttdoc">distance between center of the earth and the surface of earth under balloon </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00076">balloon.hh:76</a></div></div>
<div class="ttc" id="class_anita_html_a6bc753f453f91e30ed38f3cc4c30fbc3"><div class="ttname"><a href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a></div><div class="ttdeci">static const int NLAYERS_MAX</div><div class="ttdoc">max number of layers (in smex design, it&amp;#39;s 4) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00059">anita.hh:59</a></div></div>
<div class="ttc" id="class_anita_html_a8a17f63c21511dc1f3fb4bf84ce00813"><div class="ttname"><a href="../../df/da2/class_anita.html#a8a17f63c21511dc1f3fb4bf84ce00813">Anita::GetRx</a></div><div class="ttdeci">int GetRx(int ilayer, int ifold)</div><div class="ttdoc">get antenna number based on which layer and position it is </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d4f/anita_8cc_source.html#l00197">anita.cc:197</a></div></div>
<div class="ttc" id="class_balloon_html"><div class="ttname"><a href="../../d2/d24/class_balloon.html">Balloon</a></div><div class="ttdoc">Handles everything related to balloon positions, payload orientation over the course of a flight...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d3b/balloon_8hh_source.html#l00030">balloon.hh:30</a></div></div>
<div class="ttc" id="class_vector_html"><div class="ttname"><a href="../../d5/db2/class_vector.html">Vector</a></div><div class="ttdoc">This class represents a three-vector. Operators are overloaded to provide for the familiar operations...</div><div class="ttdef"><b>Definition:</b> <a href="../../dc/d61/vector_8hh_source.html#l00027">vector.hh:27</a></div></div>
<div class="ttc" id="class_anita_html_af367aa78f54d08086f0f9c283ee3105e"><div class="ttname"><a href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a></div><div class="ttdeci">static const int NPHI_MAX</div><div class="ttdoc">max number of antennas around in phi (in smex, 16) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00061">anita.hh:61</a></div></div>
<div class="ttc" id="class_anita_event_calibrator_html_a4912d18b072af69f109a3a3528239949"><div class="ttname"><a href="../../d7/d7d/class_anita_event_calibrator.html#a4912d18b072af69f109a3a3528239949">AnitaEventCalibrator::relativePhaseCenterToAmpaDelays</a></div><div class="ttdeci">Double_t relativePhaseCenterToAmpaDelays[12][9]</div><div class="ttdoc">From phase center to AMPAs (hopefully) </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d05/_anita_event_calibrator_8h_source.html#l00121">AnitaEventCalibrator.h:121</a></div></div>
<div class="ttc" id="namespace_anita_pol_html_a6c9ea9818ce94ee3510d3fc3e573d267"><div class="ttname"><a href="../../d4/df7/namespace_anita_pol.html#a6c9ea9818ce94ee3510d3fc3e573d267">AnitaPol::AnitaPol_t</a></div><div class="ttdeci">enum AnitaPol::EAnitaPol AnitaPol_t</div><div class="ttdoc">Polarisation enumeration. </div></div>
<div class="ttc" id="class_anita_geom_tool_html_a1082689d96e9b03316b7625a9de37b44"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html#a1082689d96e9b03316b7625a9de37b44">AnitaGeomTool::Instance</a></div><div class="ttdeci">static AnitaGeomTool * Instance(int anita_version=0)</div><div class="ttdoc">Instance generator. If version_number == 0, uses AnitaVersion::get();. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d67/_anita_geom_tool_8cxx_source.html#l00431">AnitaGeomTool.cxx:431</a></div></div>
<div class="ttc" id="class_anita_geom_tool_html"><div class="ttname"><a href="../../d8/db1/class_anita_geom_tool.html">AnitaGeomTool</a></div><div class="ttdoc">AnitaGeomTool  The ANITA Geometry Tool. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/de8/_anita_geom_tool_8h_source.html#l00048">AnitaGeomTool.h:48</a></div></div>
<div class="ttc" id="class_ice_model_html"><div class="ttname"><a href="../../de/d63/class_ice_model.html">IceModel</a></div><div class="ttdoc">Ice thicknesses and water depth. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dee/icemodel_8hh_source.html#l00103">icemodel.hh:103</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 5 2021 19:55:40 for ANITA Software by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
