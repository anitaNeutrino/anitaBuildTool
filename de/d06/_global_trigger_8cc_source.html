<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="generator" content="Doxygen 1.8.11"/>
    <title>ANITA Software: components/icemc/GlobalTrigger.cc Source File</title>
    <link href="../../tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="../../jquery.js"></script>
    <script type="text/javascript" src="../../dynsections.js"></script>
    <link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="../../doxygen.css" rel="stylesheet" type="text/css" />
    <link href="../../customdoxygen.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
      <div id="titlearea">
	<table cellspacing="0" cellpadding="0">
	  <tbody>	    
	    <tr style="height: 56px;">
	      <td id="projectlogo"><img width="960" alt="Logo" src="../../anitaSoftware.png"/></td>
	    </tr>
	  </tbody>
	</table>
      </div>
      <!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Introduction</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="../../dir_de1961011fa38df2c6d5e9e49bef1e29.html">icemc</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">GlobalTrigger.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;fstream&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;vector.hh&quot;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;position.hh&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;TF1.h&quot;</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;TCanvas.h&quot;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;TGraph.h&quot;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;TTree.h&quot;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;TH2F.h&quot;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;TMath.h&quot;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;TVector3.h&quot;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;rx.hpp&quot;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;Constants.h&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;anita.hh&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;balloon.hh&quot;</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;Tools.h&quot;</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;Settings.h&quot;</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;screen.hh&quot;</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;ChanTrigger.h&quot;</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;GlobalTrigger.h&quot;</span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;icemc_random.h&quot;</span> </div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">using</span> std::cout;</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;GlobalTrigger::GlobalTrigger(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1){</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    </div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="comment">// 2=top,1=middle,0=bottom</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  WHICHLAYERSLCPRCP[0]=0;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  WHICHLAYERSLCPRCP[1]=1;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  WHICHLAYERSLCPRCP[2]=0;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="comment">// time step between sampling tunnel diode output for the trigger</span></div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  TRIGTIMESTEP=2.E-9; </div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;      </div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;   </div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  L3_COINCIDENCE=22.5e-9;</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="comment">// L1 coincidence window, in seconds  </span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  L1_COINCIDENCE_ANITA3[0]=16.E-9; <span class="comment">// B-&gt;M or T</span></div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  L1_COINCIDENCE_ANITA3[1]=12.E-9; <span class="comment">// M-&gt;B or T</span></div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  L1_COINCIDENCE_ANITA3[2]=4.E-9; <span class="comment">// T-&gt;B or M </span></div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="comment">// in this scenario B-&gt;M is the same as M-&gt;B for example</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="comment">// this needs to be generalized- using this same thing for all scenarios which isn&#39;t right</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  LASTTIMETOTESTL1_ANITA3=((double)anita1-&gt;NFOUR/2)*anita1-&gt;TIMESTEP-Tools::dMax(L1_COINCIDENCE_ANITA3,3); <span class="comment">// can&#39;t test L1 after this point because the l1_coincidence windows go past the end of the waveform.</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="comment">// layers indexed in reverse order!</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  <span class="comment">// B-&gt;M</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  <span class="comment">// B-&gt;T</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  L1_COINCIDENCE_LR_SCA[0]=16.E-9;</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  L1_COINCIDENCE_LR_SCA[1]=16.E-9;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;  LASTTIMETOTESTL1_ANITA4LR_SCA=Tools::dMax(L1_COINCIDENCE_LR_SCA,2);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  LASTTIMETOTESTL1_ANITA4LR_SCA=((double)anita1-&gt;NFOUR/2)*anita1-&gt;TIMESTEP-LASTTIMETOTESTL1_ANITA4LR_SCA; <span class="comment">// can&#39;t test L1 after this point because the l1_coincidence windows go past the end of the waveform.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  L1_COINCIDENCE_MOREGENERAL[0][0]=16.E-9;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  L1_COINCIDENCE_MOREGENERAL[0][1]=4.E-9;</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;  L1_COINCIDENCE_MOREGENERAL[1][0]=16.E-9;</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;  L1_COINCIDENCE_MOREGENERAL[1][1]=4.E-9;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;   </div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  L1_COINCIDENCE_MOREGENERAL[2][0]=4.E-9; <span class="comment">// L1 coincidence window, in seconds  ;</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;  L1_COINCIDENCE_MOREGENERAL[2][1]=4.E-9; <span class="comment">// L1 coincidence window, in seconds  ;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;  LASTTIMETOTESTL1_ANITA4=0.;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++) {</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;2;j++) {</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      <span class="keywordflow">if</span> (L1_COINCIDENCE_MOREGENERAL[i][j]&gt;LASTTIMETOTESTL1_ANITA4)</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    LASTTIMETOTESTL1_ANITA4=L1_COINCIDENCE_MOREGENERAL[i][j];</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    }</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  }</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  </div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  LASTTIMETOTESTL1_ANITA4=((double)anita1-&gt;NFOUR/2)*anita1-&gt;TIMESTEP-LASTTIMETOTESTL1_ANITA4;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">// can&#39;t test L1 after this point because the l1_coincidence windows go past the end of the waveform.</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  nstepback=(int)(2.E-9/TRIGTIMESTEP);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    </div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">// coincidence between lcp,rcp within an antenna</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;  L1_COINCIDENCE_ANITA4LR_SCB=4.e-9;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  <span class="comment">// B-&gt;T, B-&gt;M, M-&gt;T</span></div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  L2_COINCIDENCE_ANITA4LR_SCB[0]=12.e-9;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  L2_COINCIDENCE_ANITA4LR_SCB[1]=4.e-9;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  L2_COINCIDENCE_ANITA4LR_SCB[2]=8.e-9;</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  LASTTIMETOTESTL1_ANITA4LR_SCB=((double)anita1-&gt;NFOUR/2)*anita1-&gt;TIMESTEP-L1_COINCIDENCE_ANITA4LR_SCB; <span class="comment">// can&#39;t test L1 after this point because the l1_coincidence windows go past the end of the waveform.;</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  LASTTIMETOTESTL2_ANITA4LR_SCB=((double)anita1-&gt;NFOUR/2)*anita1-&gt;TIMESTEP-Tools::dMax(L2_COINCIDENCE_ANITA4LR_SCB,3); <span class="comment">// can&#39;t test L1 after this point because the l1_coincidence windows go past the end of the waveform.;</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  L3_COINCIDENCE_ANITA4LR_SCB=12.e-9;</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                   </div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  DELAYS[0]=0.; <span class="comment">// delay top</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  DELAYS[1]=4.e-9; <span class="comment">// delay middle    </span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  DELAYS[2]=4.e-9; <span class="comment">// delay bottom   </span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  Tools::Zero(triggerbits,Anita::NTRIG);</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    </div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;  phiTrigMask[0]=anita1-&gt;phiTrigMask; <span class="comment">// set the phi mask to the input value which comes from the balloon class</span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  phiTrigMask[1]=anita1-&gt;phiTrigMaskH; <span class="comment">// set the phi mask to the input value which comes from the balloon class</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  l1TrigMask[0]=anita1-&gt;l1TrigMask; <span class="comment">// set the phi mask to the input value which comes from the balloon class</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;  l1TrigMask[1]=anita1-&gt;l1TrigMaskH; <span class="comment">// set the phi mask to the input value which comes from the balloon class    </span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;  </div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;  </div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>;i++) {</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>;j++) {</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;2;k++) {</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p=0;p&lt;anita1-&gt;NBANDS+1;p++) {</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;      channels_passing[i][j][k][p]=0;</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;      channels_passing_justNoise[i][j][k][p]=0;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <span class="comment">// make vchannels_passing the proper length.</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      vchannels_passing[i][j][k].push_back(0);</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    }</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;      }</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    }</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;  }</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;3;i++) {</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;16;j++) {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;2;k++) {</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> p=0;p&lt;5;p++) {</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      arrayofhits[i][j][k][p].clear();</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;      arrayofhitsnoise[i][j][k][p].clear();</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;      }</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    }</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;  }    </div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    </div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;2;k++) {       </div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>;i++) {</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>;j++) {</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    volts[k][i][j]=0.;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    volts_em[k][i][j]=0.;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    volts_original[k][i][j]=0.;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;      }</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  }</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    </div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    </div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;  <span class="comment">//Zeroing</span></div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;settings1-&gt;NANTENNAS;i++) {</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    nchannels_perrx_triggered[i] = 0;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;8;j++) {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      nchannels_perband_triggered[i][j]=0;</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    }</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  } <span class="comment">//Zero the trigger array</span></div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    </div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    </div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    </div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    </div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;}</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div><div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">  211</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">GlobalTrigger::PassesTrigger</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> discones_passing,<span class="keywordtype">int</span> mode,<span class="keywordtype">int</span> *l3trig,<span class="keywordtype">int</span> l2trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> l1trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> antennaclump,<span class="keywordtype">int</span> loctrig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NLAYERS_MAX][Anita::NPHI_MAX],<span class="keywordtype">int</span> loctrig_nadironly[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NPHI_MAX],<span class="keywordtype">int</span> inu,  <span class="keywordtype">int</span> *thispasses, <span class="keywordtype">bool</span> noiseOnly) {</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  <span class="keywordtype">double</span> this_threshold= anita1-&gt;powerthreshold[4]; </div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  <span class="keywordflow">return</span> <a class="code" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">PassesTrigger</a>(settings1,anita1,discones_passing,mode,l3trig,l2trig,l1trig,antennaclump,loctrig,loctrig_nadironly,inu,this_threshold, thispasses, noiseOnly);   </div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;}</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">GlobalTrigger::PassesTrigger</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> discones_passing,<span class="keywordtype">int</span> mode,<span class="keywordtype">int</span> *l3trig,<span class="keywordtype">int</span> l2trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> l1trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> antennaclump,<span class="keywordtype">int</span> loctrig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NLAYERS_MAX][Anita::NPHI_MAX],<span class="keywordtype">int</span> loctrig_nadironly[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NPHI_MAX],<span class="keywordtype">int</span> inu,<span class="keywordtype">double</span> this_threshold, <span class="keywordtype">int</span> *thispasses, <span class="keywordtype">bool</span> noiseOnly) {</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  <span class="comment">//bool ishpol should only be used for anita3, by default do only vpol</span></div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME &lt; 3) {</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="comment">// Basic trigger refers to  frequency domain voltage (0) frequency domain energy (1) timedomain diode integration (2) </span></div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    PassesTriggerBasic(settings1, anita1, discones_passing, mode, l3trig, l2trig, l1trig, antennaclump, loctrig, loctrig_nadironly, thispasses, inu, noiseOnly);</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  }</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME == 3) {</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    PassesTriggerCoherentSum(settings1, anita1, inu, thispasses);</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;     </div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME == 4) {</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    PassesTriggerSummedPower(settings1, anita1);</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;TRIGGERSCHEME == 5) {</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    </div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// Don&#39;t know the name of this one so I&#39;ll call it 5</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    PassesTriggerScheme5(anita1, this_threshold, thispasses);</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;   </div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;  }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;}<span class="comment">//PassesTrigger</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keywordtype">void</span>  GlobalTrigger::PassesTriggerBasic(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> discones_passing,<span class="keywordtype">int</span> mode,<span class="keywordtype">int</span> *l3trig,<span class="keywordtype">int</span> l2trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> l1trig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NTRIGGERLAYERS_MAX],<span class="keywordtype">int</span> antennaclump,<span class="keywordtype">int</span> loctrig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NLAYERS_MAX][Anita::NPHI_MAX],<span class="keywordtype">int</span> loctrig_nadironly[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NPHI_MAX], <span class="keywordtype">int</span> *thispasses, <span class="keywordtype">int</span> inu, <span class="keywordtype">bool</span> noiseOnly){</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="keywordtype">int</span> ltsum=0;</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keywordtype">int</span> channsum=0;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keywordtype">int</span> ihit=0;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="comment">//  int thispasses[2]={0,0};</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keywordtype">int</span> required_bands_failed[2]={0,0}; <span class="comment">// keep track of whether bands that were required to pass did not, for each polarization</span></div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;  <span class="keywordflow">if</span> (noiseOnly){</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    arrayofhits = arrayofhitsnoise;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  }<span class="keywordflow">else</span>{</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    arrayofhits = arrayofhitsall;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  }</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <span class="comment">// this is an array with 1=pass and 0=fail for each channel</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <span class="comment">// the first two layers on the payload are &quot;compacted&quot;</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  <span class="comment">// into one trigger layer of 16 antennas.</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="comment">// layer number, antenna, polarization, bandwidth slice</span></div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;  <span class="keywordtype">int</span> channels_compacted_passing[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>][2][5] = {{{{0}}}};</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    </div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;k++) {</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    l3trig[k]=0;</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    Tools::Zero(l1trig[k],Anita::NTRIGGERLAYERS_MAX);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    Tools::Zero(l2trig[k],Anita::NTRIGGERLAYERS_MAX); <span class="comment">// for all three layers</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    Tools::Zero(loctrig_nadironly[k],Anita::NPHI_MAX);</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  }</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="comment">// which clumps of 3 antennas</span></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  <span class="comment">//within the nadir layer pass</span></div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <span class="comment">// 0th and 1st element= antenna at phi=0,</span></div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  <span class="comment">// 2nd and 3rd element=next antenna, etc.</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0;k&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;k++) {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">// for (int j=0;j&lt;Anita::NPHI_MAX;j++) {</span></div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      Tools::Zero(loctrig[k][ilayer],Anita::NPHI_MAX);</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    }</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    <span class="comment">// which clumps of 3 antennas</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">//within each trigger layer pass L2 trigger</span></div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <span class="comment">// layer, phi location</span></div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    <span class="comment">// } //for</span></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  } <span class="comment">// end of initializing to zero</span></div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;  <span class="keywordtype">int</span> NBAND=5; <span class="comment">// number of bandwidth slices</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;  <span class="keywordtype">int</span> whichlayer=0;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;  <span class="keywordtype">int</span> whichphisector=0;</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0;ilayer&lt;settings1-&gt;NLAYERS;ilayer++) {</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NRX_PHI[ilayer];iphi++) {</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    <span class="keywordflow">if</span> (anita1-&gt;pol_allowed[ipolar]==0) <span class="keywordflow">continue</span>;<span class="comment">// if this polarization is not allowed to contribute then don&#39;t do it</span></div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="comment">//    if (ishpol &amp;&amp; ipolar==0) continue; // Anita3 : only do the polarisation required</span></div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="comment">//else if ((!ishpol) &amp;&amp; ipolar==1) continue; // Anita3 : only do the polarisation required</span></div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;      </div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iband=0;iband&lt;NBAND;iband++) {</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;      <span class="keywordflow">if</span> (!anita1-&gt;bwslice_allowed[iband]) <span class="keywordflow">continue</span>;</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;      </div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;      <a class="code" href="../../d7/d39/class_global_trigger.html#a8d88f561ec14573c139ee67d100813ff">GetAnitaLayerPhiSector</a>(settings1,ilayer,iphi,whichlayer,whichphisector); <span class="comment">// Translate Anita physical layer to Anita trigger layer and phi sector (4 layers with 8,8,16,8 phi sector to 3 layers with 16 phi sectors each.  In the nadir layer, 8 of the 16 slots are empty on the trigger layer.)</span></div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        </div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        </div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        </div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;      <span class="comment">// combining top two layers on the payload into one trigger layer</span></div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;      <span class="comment">// this means the 0th antenna in the first trigger layer is</span></div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;      <span class="comment">// physically higher than the 1st antenna in the first trigger layer</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      <span class="comment">// which means that the nadirs are aligned with the antennas with indices 1,3,5 etc.</span></div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="comment">// we will still use indices 0-7 for them though</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;      <span class="keywordflow">if</span> (noiseOnly) channels_compacted_passing[whichlayer][whichphisector][ipolar][iband]+=channels_passing_justNoise[ilayer][iphi][ipolar][iband];</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;       <span class="keywordflow">else</span>  channels_compacted_passing[whichlayer][whichphisector][ipolar][iband]+=channels_passing[ilayer][iphi][ipolar][iband];</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;      <span class="comment">// if (channels_compacted_passing[whichlayer][whichphisector][ipolar][iband]&gt;0 &amp;&amp; ipolar==0) cout &lt;&lt; whichlayer &lt;&lt; &quot; &quot; &lt;&lt; whichphisector &lt;&lt; endl;</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    } <span class="comment">//for</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;      } <span class="comment">//for</span></div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    } <span class="comment">//for</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;  } <span class="comment">//for</span></div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;  <span class="keywordtype">int</span> antsum[2]={0,0}; <span class="comment">// counter for how many channels of each polarization on an antenna pass</span></div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="comment">/* antenna triggers */</span></div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    </div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;  <span class="keywordtype">int</span> Nreq_l2[<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>];</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="comment">// number of antennas within each clump</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  <span class="comment">//that need to pass for that clump to pass L2</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  <span class="comment">// 1st layer, 2nd layer,</span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">//nadir layer (to be &quot;OR&quot;ed with upper layers),</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// and nadir layer (for nadir-only) trigger</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <span class="comment">//int Ntrig_chann[4]={6,6,6,8}; // NOT USED:  number of channels</span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;  <span class="comment">//per clump that need to pass.</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>;i++) {</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    Nreq_l2[i]=anita1-&gt;trigRequirements[1];</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;  }</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    </div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    </div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;  <span class="keywordtype">int</span> ant[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][<a class="code" href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>] = {{{0}}}; <span class="comment">// which antennas and which polarizations pass at L1</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;  <span class="comment">// trigger layer, phi position</span></div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    </div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;  <span class="keywordtype">int</span> antpass[2]={0,0}; <span class="comment">// count how many antennas pass</span></div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;  <span class="keywordtype">int</span> iphitrig=0;  <span class="comment">// which trigger phi sector</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordtype">int</span> ihittrig=0;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;  <span class="comment">// local level 1 trigger at the antenna</span></div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++) { <span class="comment">// loop over layers</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="comment">// this is nlayers-1 because NLAYERS counts top 16 antennas as 2 layers</span></div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      </div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[iloc];iphi++) { <span class="comment">// loop over phi position</span></div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      iphitrig=<a class="code" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GetPhiSector</a>(settings1,iloc,iphi); <span class="comment">// get trigger phi sector</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      <span class="comment">// counts from 0</span></div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    </div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    antsum[ipolar] = 0; <span class="comment">// start sum for this antenna for each polarization</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    </div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iband=0;iband&lt;NBAND;iband++) {</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;      <span class="keywordflow">if</span>(channels_compacted_passing[iloc][iphitrig][ipolar][iband] == 1</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;         &amp;&amp; anita1-&gt;bwslice_allowed[iband]==1 &amp;&amp; anita1-&gt;pol_allowed[ipolar]==1) { <span class="comment">// only increment if it&#39;s one of the allowed bands and allowed polarizations.</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;          </div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">if</span> (settings1-&gt;PHIMASKING &amp;&amp; settings1-&gt;WHICH==9){ <span class="comment">// only applying channel masking like this if it&#39;s Anita-3</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;          <span class="comment">//        if ((ipolar==0 &amp;&amp; (1&lt;&lt;iphitrig &amp; l1TrigMask[0])) || (ipolar==1 &amp;&amp; (1&lt;&lt;iphitrig &amp; l1TrigMask[1])) ){</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;          <span class="keywordflow">if</span>  (1&lt;&lt;iphitrig &amp; l1TrigMask[ipolar])  {</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// was this channel masked?</span></div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;          }</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        antsum[ipolar] = antsum[ipolar] +1; <span class="comment">// sum channels that pass for this antenna, polarization</span></div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    } <span class="comment">// loop over bands</span></div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      } <span class="comment">// end loop over polarizations</span></div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    </div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    </div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    required_bands_failed[ipolar]=0;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iband=0;iband&lt;NBAND;iband++) { <span class="comment">// notice sum over 5 bands now</span></div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;      <span class="keywordflow">if</span>(channels_compacted_passing[iloc][iphitrig][ipolar][iband] == 0</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;         &amp;&amp; anita1-&gt;bwslice_required[iband]==1 ) { <span class="comment">// if this band was required to pass and it didn&#39;t,</span></div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        required_bands_failed[ipolar] = 1; <span class="comment">// fatal for this antenna, polarization</span></div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;      }</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        </div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    } <span class="comment">// end loop over bands</span></div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;      } <span class="comment">// end loop over polarizations</span></div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// if the required bands didn&#39;t pass then set antsum=0 so the antenna doesn&#39;t pass</span></div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    </div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {      </div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    ant[ipolar][iloc][iphitrig] = 1; <span class="comment">// start with every antenna passing L1.      </span></div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">if</span>( (anita1-&gt;pol_required[ipolar]==1 &amp;&amp; </div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;         (antsum[ipolar] &lt; anita1-&gt;trigRequirements[0]      </div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;          || required_bands_failed[ipolar]==1 ) )</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        || (anita1-&gt;pol_required[ipolar]==0)</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        )  { <span class="comment">// if this polarization is required and it doesn&#39;t pass then make the antenna fail</span></div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;      ant[ipolar][iloc][iphitrig]=0;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    } <span class="comment">//if</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">else</span>{</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;      antpass[ipolar]+=1;<span class="comment">// increment if it passed</span></div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    }</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;      }</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    } <span class="comment">//for (phi position)</span></div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;  } <span class="comment">//for (layers)</span></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    </div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;DISCONES==2) {</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="comment">// fill the slots in  between the actual antennas with the &quot;or&quot;</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// of the neighboring antennas</span></div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">FillInNadir</a>(anita1,ant[0][2]);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">FillInNadir</a>(anita1,ant[1][2]);</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  }</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    </div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++){ <span class="comment">//This is NLAYERS-1 because NLAYERS counts top 16 antennas as 2 layers</span></div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[iloc];iphi++){</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      iphitrig=<a class="code" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GetPhiSector</a>(settings1,iloc,iphi);</div><div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {      </div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">if</span> (ant[ipolar][iloc][iphitrig]==1) </div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;      l1trig[ipolar][iloc] += (1&lt;&lt;iphitrig); <span class="comment">// this keeps track of which antennas pass the l1 trigger</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      }</div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }<span class="comment">//for (phi position)</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  } <span class="comment">//for (layers) // Hmm this is not used</span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    </div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <span class="keywordflow">if</span> (mode == 1) {<span class="comment">// TRIGTYPE=2 -&gt; just require ANTtrig channels pass on 2 antennas</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;ipolar++) {</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;      <span class="keywordflow">if</span> (antpass[ipolar] &gt;= 2) </div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    thispasses[ipolar] = 1;</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    }</div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;   </div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (mode == 2) { <span class="comment">// TRIGTYPE=1 -&gt;</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// ANITA-3</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==9) {</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <span class="comment">// for each of these, need to set </span></div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="comment">// loctrig, l2trig</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl1trig;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    </div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      L1Anita3_AllPhiSectors(anita1,vl1trig);</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;      <span class="comment">// just have to modify this function so it&#39;s looping over all relevant trigtimesteps</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    </div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl1trig[ipol][iphi].size();ibin++) {</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=vl1trig[ipol][iphi][ibin];</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;        <span class="comment">// if (anita1-&gt;l1trig_anita3_inanita[ipol][iphi][ibin])</span></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="comment">//      cout &lt;&lt; &quot;This l1 is 1.\n&quot;;</span></div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;      }</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibin=vl1trig[ipol][iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=0;</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;      }</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    }</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      }</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;vl1trig size is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl2trig;</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    </div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      L2Anita3and4(anita1,vl1trig,</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;           vl2trig);</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;PHIMASKING){ <span class="comment">// only applying channel masking like this if it&#39;s Anita-3</span></div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        <span class="keywordflow">if</span>  ((1&lt;&lt;iphi &amp; l1TrigMask[ipol])||(1&lt;&lt;iphi &amp; phiTrigMask[ipol]))  {</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;          <span class="comment">// set phi sector to 0</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;          std::fill(vl2trig[ipol][iphi].begin(), vl2trig[ipol][iphi].end(), 0);</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        }</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      }</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    }</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      }</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    </div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="keywordtype">int</span> vl3trig[2][16];</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      L3Anita3and4(anita1,vl2trig,</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;           vl3trig,thispasses);</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordflow">if</span> (vl3trig[ipol][iphi]&gt;0)    l3trig[ipol]+=(1&lt;&lt;iphi);</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    }</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      }</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    </div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    }</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="comment">// ANITA-4</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==10 &amp;&amp; !(settings1-&gt;LCPRCP)) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl1trig;</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    </div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;      L1Anita4_AllPhiSectors(anita1,vl1trig);</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">// just have to modify this function so it&#39;s looping over all relevant trigtimesteps</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    </div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl1trig[ipol][iphi].size();ibin++) {</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=vl1trig[ipol][iphi][ibin];</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;         </div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        <span class="comment">//        if (anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin])</span></div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;        <span class="comment">//      cout &lt;&lt; &quot;This l1 is &quot; &lt;&lt; ipol &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; ibin &lt;&lt; &quot;\t&quot; &lt;&lt; anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      }</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=vl1trig[ipol][iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=0;</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      }</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    }</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;      }</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;vl1trig size is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;      std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl2trig;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    </div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;      L2Anita3and4(anita1,vl1trig,</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;           vl2trig);</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;      <span class="keywordtype">int</span> vl3trig[2][16];</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;      L3Anita3and4(anita1,vl2trig,</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;           vl3trig,thispasses);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;      </div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipol=0;ipol&lt;2;ipol++) {</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;      <span class="keywordflow">if</span> (vl3trig[ipol][iphi]&gt;0)    l3trig[ipol]+=(1&lt;&lt;iphi);</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;      }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;      </div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;    }</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==10 &amp;&amp; settings1-&gt;LCPRCP) {</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">//    std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl1trig;</span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;      <span class="comment">//    //cout &lt;&lt; &quot;calling allphisectors.\n&quot;;</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;      <span class="comment">//    L1Anita4LR_ScA_AllPhiSectors(anita1,vl1trig);</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;      <span class="comment">//    for (int ipol=0;ipol&lt;2;ipol++) {</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;      <span class="comment">//      for (int iphi=0;iphi&lt;16;iphi++) {</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;      <span class="comment">//        for (int ibin=0;ibin&lt;vl1trig[ipol][iphi].size();ibin++) {</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;      <span class="comment">//          anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=vl1trig[ipol][iphi][ibin];</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;         </div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;      <span class="comment">//          //if (anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin])</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;      <span class="comment">//          //cout &lt;&lt; &quot;This l1 is &quot; &lt;&lt; ipol &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; ibin &lt;&lt; &quot;\t&quot; &lt;&lt; anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;      <span class="comment">//        }</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;      <span class="comment">//        for (int ibin=vl1trig[ipol][iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;      <span class="comment">//          anita1-&gt;l1trig_anita3and4_inanita[ipol][iphi][ibin]=0;</span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;      <span class="comment">//        }</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;      <span class="comment">//      }</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;      <span class="comment">//    }</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;      <span class="comment">//    //  cout &lt;&lt; &quot;vl1trig size is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;      <span class="comment">//    std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl2trig;</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    </div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <span class="comment">//    L2Anita3and4(anita1,vl1trig,</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="comment">//             vl2trig);</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      <span class="comment">//    L3Anita4LR_ScA(anita1,vl2trig,</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;      <span class="comment">//           thispasses);</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;about to do delays.\n&quot;;</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;      delay_AllAntennas(anita1);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;did delays.\n&quot;;</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;      <span class="comment">// l1 triggers for all antennas</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      std::array&lt; std::array&lt; vector&lt;int&gt;,16&gt;,3&gt; vl1trig_anita4lr_scb;</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      <span class="comment">// keep track of whether you get a coincidence between 1, 2 or 3 antennas in a phi sector with the right windows.</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;      <span class="comment">// for each phi sector, whether there is a 1, 2 or 3 coincidence</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;      std::array&lt;std::array&lt;vector&lt;int&gt;,3&gt;,16&gt; vl2_realtime_anita4_scb;</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;did L2.\n&quot;;</span></div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      std::array&lt;vector&lt;int&gt;,16&gt; vl3trig_type0;</div><div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      std::array&lt;vector&lt;int&gt;,16&gt; vl3trig_type1;</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      <span class="keywordtype">int</span> thispasses_l3type0=0;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      <span class="keywordtype">int</span> thispasses_l3type1=0;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    </div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      <span class="keywordtype">double</span> time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;      <span class="keywordtype">int</span> itrigbin=nstepback;</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;about to loop.\n&quot;;</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;size of arrayofhits is &quot; &lt;&lt; arrayofhits[0][0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;      <span class="comment">// i should really do this in a different step so this function has fewer inputs.</span></div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;      <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;vector size is &quot; &lt;&lt; vl1trig_anita4lr_scb[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;    <span class="keywordtype">int</span> npassesl1=0;</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    L1Anita4LR_ScB_AllAntennas_OneBin(itrigbin,anita1,vl1trig_anita4lr_scb,npassesl1);</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="comment">//  if (npassesl1)</span></div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;npassesl1 is &quot; &lt;&lt; npassesl1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    itrigbin++;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;      } <span class="comment">// loop over time steps</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">//      cout &lt;&lt; &quot;got out of first loop.\n&quot;;</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;      time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;      itrigbin=nstepback;</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;      <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    </div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">int</span> npassesl2=0;</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordtype">int</span> npassesl2_type0=0;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    L2Anita4LR_ScB_AllPhiSectors_OneBin(itrigbin,anita1,vl1trig_anita4lr_scb,</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                        vl2_realtime_anita4_scb,npassesl2,npassesl2_type0);</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="comment">//      if (npassesl2)</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <span class="comment">//        cout &lt;&lt; &quot;npassesl2 is &quot; &lt;&lt; npassesl2 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="comment">//      if (npassesl2_type0)</span></div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;    <span class="comment">//        cout &lt;&lt; &quot;npassesl2_type0 is &quot; &lt;&lt; npassesl2_type0 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    </div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    itrigbin++;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      } <span class="comment">// loop over time steps</span></div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;      time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      itrigbin=nstepback;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      </div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      </div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    </div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    </div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    L3Anita4LR_ScB_OneBin(itrigbin,anita1,vl2_realtime_anita4_scb,</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                  vl3trig_type0, vl3trig_type1,</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                  thispasses_l3type0,thispasses_l3type1);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    </div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    <span class="comment">//  cout &lt;&lt; &quot;did L3.\n&quot;;</span></div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    itrigbin++;</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      } <span class="comment">// loop over time steps</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      </div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">// if (thispasses_l3type0)</span></div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      <span class="comment">//    thispasses[0]=1;</span></div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      <span class="keywordflow">if</span> (thispasses_l3type1)</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    thispasses[1]=thispasses[0]=1;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;      <span class="comment">//    if (thispasses[0] || thispasses[1])</span></div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;This passes! &quot; &lt;&lt; thispasses[0] &lt;&lt; &quot;\t&quot; &lt;&lt; thispasses[1] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0;ilayer&lt;anita1-&gt;NTRIGGERLAYERS;ilayer++) {</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;anita1-&gt;NPOL;ipolar++) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        Tools::reverseTimeOrdering(anita1-&gt;HALFNFOUR,anita1-&gt;arrayofhits_inanita[ilayer][iphi][ipolar],anita1-&gt;arrayofhits_forgaryanderic[ilayer][iphi][ipolar]);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;          </div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      }</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    }</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      }</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0;ilayer&lt;anita1-&gt;NTRIGGERLAYERS;ilayer++) {</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl1trig_anita4lr_scb[ilayer][iphi].size();ibin++) {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        anita1-&gt;l1trig_anita4lr_inanita[ilayer][iphi][ibin]=vl1trig_anita4lr_scb[ilayer][iphi][ibin];</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;      }</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=vl1trig_anita4lr_scb[ilayer][iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        anita1-&gt;l1trig_anita4lr_inanita[ilayer][iphi][ibin]=0;</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;      }</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      Tools::reverseTimeOrdering(anita1-&gt;HALFNFOUR,anita1-&gt;l1trig_anita4lr_inanita[ilayer][iphi],anita1-&gt;l1trig_anita4lr_forgaryanderic[ilayer][iphi]);</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    }</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;      }</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl2_realtime_anita4_scb[iphi][1].size();ibin++) {</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      anita1-&gt;l2trig_anita4lr_inanita[iphi][1][ibin]=vl2_realtime_anita4_scb[iphi][1][ibin];</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        </div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=vl2_realtime_anita4_scb[iphi][1].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;      anita1-&gt;l2trig_anita4lr_inanita[iphi][1][ibin]=0;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    }</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    Tools::reverseTimeOrdering(anita1-&gt;HALFNFOUR,anita1-&gt;l2trig_anita4lr_inanita[iphi][1],anita1-&gt;l2trig_anita4lr_forgaryanderic[iphi]);</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;      </div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl3trig_type0[iphi].size();ibin++) {</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;      anita1-&gt;l3type0trig_anita4lr_inanita[iphi][ibin]=vl3trig_type0[iphi][ibin];</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    }</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=vl3trig_type0[iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      anita1-&gt;l3type0trig_anita4lr_inanita[iphi][ibin]=0;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    }</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    Tools::reverseTimeOrdering(anita1-&gt;HALFNFOUR,anita1-&gt;l3type0trig_anita4lr_inanita[iphi],anita1-&gt;l3type0trig_anita4lr_forgaryanderic[iphi]);</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl3trig_type1[iphi].size();ibin++) {</div><div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        </div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;      anita1-&gt;l3trig_anita4lr_inanita[iphi][ibin]=vl3trig_type1[iphi][ibin];</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    }</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=vl3trig_type1[iphi].size();ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      anita1-&gt;l3trig_anita4lr_inanita[iphi][ibin]=0;</div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    }</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    Tools::reverseTimeOrdering(anita1-&gt;HALFNFOUR,anita1-&gt;l3trig_anita4lr_inanita[iphi],anita1-&gt;l3type1trig_anita4lr_forgaryanderic[iphi]);</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      }</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160; </div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    </div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ibin=0;ibin&lt;anita1-&gt;HALFNFOUR;ibin++) {</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    anita1-&gt;time_trig[ibin]=TRIGTIMESTEP*(double)ibin;</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      }</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="comment">// LC: not sure about this</span></div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0; ibin&lt;anita1-&gt;HALFNFOUR; ibin++){</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;      <span class="keywordflow">if</span> (anita1-&gt;l3trig_anita4lr_inanita[iphi][ibin]&gt;0){</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        l3trig[0]+=(1&lt;&lt;iphi);</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        ibin = anita1-&gt;HALFNFOUR;</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;      }</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;    }</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;      }</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    }</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="comment">// this is the one we&#39;re using for Anita 2</span></div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="comment">// int iloc=0; // top array</span></div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      <span class="comment">//int inad=0;  // phi position for nadir antennas,</span></div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;      <span class="comment">//only goes to 8, wheras iphi goes to 16</span></div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      <span class="keywordtype">int</span> x;<span class="comment">//for number of antenna in clump</span></div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keywordtype">int</span> y;<span class="comment">//for number of antenna in clump</span></div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      x = (antennaclump-1)/2;<span class="comment">//setting boundries for clump dependent on clump size(antennaclump)</span></div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;      y = (antennaclump-1)/2 +1;</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;      </div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++) {</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;ipolar++) {</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> iphi=0;iphi&lt;16;iphi++) {</div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        iphitrig=iphi;</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        </div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        </div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        ltsum = 0; <span class="comment">// zero counter for number of antennas that pass per clump</span></div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        channsum=0; <span class="comment">// zero counter for number of channels that pass per clump</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        </div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="comment">// loop over clump -- with boundary check -- ugly implement</span></div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="comment">// even uglier - we want to require 2/3 antennas per clump</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <span class="comment">// but the middle antenna has to be one of the two</span></div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        <span class="comment">// so we multiply by ant[iloc][iphi] so that when the middle one</span></div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        <span class="comment">// passes we are multiplying by 1 and when it doesn&#39;t we are</span></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="comment">// multiplying by zero.</span></div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> inbr=iphi-x;inbr&lt;iphi+y;inbr++) {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;          ihit = (inbr + 16) % 16; <span class="comment">// make any negative indices positive</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;          ihittrig=ihit;</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;          </div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;          <span class="keywordflow">if</span> (anita1-&gt;REQUIRE_CENTRE) {</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        ltsum+=ant[ipolar][iloc][ihittrig]*ant[ipolar][iloc][iphitrig]; <span class="comment">// increment if this antenna passes</span></div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;          }</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;          <span class="comment">// we multipy by ant[iloc][iphi] because this ensures that</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;          <span class="comment">// one of the triggered antennas is the center one in the clump</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;        ltsum+=ant[ipolar][iloc][ihittrig];</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        </div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iband=0;iband&lt;4;iband++) {</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;          channsum+=channels_compacted_passing[iloc][ihittrig][ipolar][iband]; <span class="comment">// increment if this channel passes</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;        } <span class="comment">//for</span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;          } <span class="comment">//for</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        } <span class="comment">//for</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;      </div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;        <span class="keywordflow">if</span>(ltsum &gt;= Nreq_l2[iloc]){ <span class="comment">// if enough antennas in this clump pass</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;          loctrig[ipolar][iloc][iphitrig] = 1;</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;          l2trig[ipolar][iloc] += (1&lt;&lt;iphi);</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        }<span class="comment">//if</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;      } <span class="comment">//for (phi position)</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    } <span class="comment">// end loop over polarizations</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;      } <span class="comment">// end loop over trigger layers</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;      </div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="comment">// fill the slots in  between the actual antennas with the &quot;or&quot;</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// of the neighboring antennas</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;DISCONES==2) {</div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">FillInNadir</a>(settings1,anita1,l2trig[0][2]);</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">FillInNadir</a>(settings1,anita1,l2trig[1][2]);</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;      }</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;      <span class="comment">// only difference between these is whether they implement masking in both polarizations</span></div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;      <span class="comment">// can we simplify it</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;      <span class="keywordflow">if</span> (settings1-&gt;PHIMASKING &amp;&amp; settings1-&gt;WHICH!=9) { <span class="comment">// not for Anita3</span></div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// nadir antennas are aligned with the second physical layer of antennas</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NTRIGPHISECTORS;iphi++) { <span class="comment">// loop over phi sectors</span></div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;      <span class="keywordflow">if</span> ((1&lt;&lt;iphi) &amp; phiTrigMask[0]) { <span class="comment">// if this phi sector is masked</span></div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;ipolar++) {</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++) {</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        loctrig[ipolar][iloc][iphi] = 0;</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordflow">if</span>(l2trig[ipolar][iloc] &amp; (1&lt;&lt;iphi)) l2trig[ipolar][iloc] -= (1&lt;&lt;iphi);</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;          }</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        } <span class="comment">// end loop over polarizations</span></div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;      } <span class="comment">// if this phi sector is masked</span></div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    }</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;PHIMASKING &amp;&amp; settings1-&gt;WHICH==9) { <span class="comment">// only for Anita3</span></div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="comment">// nadir antennas are aligned with the second physical layer of antennas</span></div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NTRIGPHISECTORS;iphi++) { <span class="comment">// loop over phi sectors</span></div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;ipolar++) {</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">if</span> ( (1&lt;&lt;iphi) &amp; phiTrigMask[ipolar] )   { <span class="comment">// if this phi sector is masked</span></div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++) {</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        loctrig[ipolar][iloc][iphi] = 0;</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">if</span>(l2trig[ipolar][iloc] &amp; (1&lt;&lt;iphi)) l2trig[ipolar][iloc] -= (1&lt;&lt;iphi);</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;          }</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        }</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;      }<span class="comment">// if this phi sector is masked</span></div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;    }</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;      }</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    }</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;    <span class="keywordflow">if</span> (anita1-&gt;trigRequirements[2]==0) {</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iloc=0;iloc&lt;anita1-&gt;NTRIGGERLAYERS;iloc++) {</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>;ipolar++) {</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NTRIGPHISECTORS;iphi++) {</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">if</span> (l2trig[ipolar][iloc] &amp; (1&lt;&lt;iphi)) { <span class="comment">// if we are not making a L3 trigger requirement and there was a l2 trigger then call it a pass</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;          thispasses[ipolar]=1;</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;          <span class="comment">//cout &lt;&lt; &quot;This one passes.  inu is &quot; &lt;&lt; inu &lt;&lt; &quot; &quot; &lt;&lt; &quot;iloc is &quot; &lt;&lt; iloc &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        }</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;      }</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    } <span class="comment">// end loop over polarizations</span></div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      }</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    }</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      </div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <a class="code" href="../../d7/d39/class_global_trigger.html#a9d27c09a9a6363f4f37dc4cb4f21cf3e">L3Trigger</a>(settings1,anita1,loctrig,loctrig_nadironly,discones_passing,l3trig,</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;          thispasses);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  } <span class="comment">//else if (mode 2)</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;} <span class="comment">// end of PassesTriggerBasic</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="comment">// This is the case for (settings1-&gt;TRIGGERSCHEME == 3), that coherent waveform sum is being used to trigger, based on Andres&#39; idea. This is specific to ANITA III&#39;s antenna geometry.</span></div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    </div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;<span class="comment">// Method:</span></div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;<span class="comment">//      All bands have passed so far, we now perform the following for the first-hit phi sector and its neighbors:</span></div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;<span class="comment">//          - Convert the relevent waveforms into a useful format</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="comment">//          - Calculate all arrival time delays relevent to the 3 phi sectors (9 antennas)</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="comment">//          f- For each of the direction hypotheses, do:</span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="comment">//          - Shift the waveforms according to their delay offsets</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="comment">//          - Sum the 9 waveforms, resulting in one coherently-summed waveform</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="comment">//          - Square each element of the summed waveform, resulting in the power of the coherently-summed waveform</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;<span class="comment">//          - For each of the 16 sample windows (with length of 32 time-samples) do:</span></div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">//              - Sum the powers of those samples</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="comment">//              - Compare the sum to the threshold, if greater, trigger on this event (return 1)</span></div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;<span class="comment">// Notes:</span></div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;<span class="comment">//      There will be several things hardcoded into the following method, feel free to change these to be variables within the Settings class, but for the sake of sanity, PLEASE no more global variables!</span></div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;<span class="comment">//      This will be made to implement all types of payloads shortly, what exists below is only a temporary specialization for ANITA III.</span></div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::PassesTriggerCoherentSum(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> inu, <span class="keywordtype">int</span> *thispasses) {</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    </div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> center_phi_sector_offset = -1; center_phi_sector_offset &lt;= 1; center_phi_sector_offset++){</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    <span class="keywordtype">int</span> center_phi_sector_index = first_phi_sector_hit + center_phi_sector_offset;</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">if</span> (center_phi_sector_index &gt; 15){center_phi_sector_index = 0;}</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">if</span> (center_phi_sector_index &lt; 0){center_phi_sector_index = 15;}</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;      </div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordtype">bool</span> coherent_trigger_passes = <span class="keyword">false</span>;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;      </div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordtype">unsigned</span> N_STEP_PHI = 16;   <span class="comment">// The number of different phi hypotheses for a given center phi sector</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <span class="keywordtype">unsigned</span> N_STEP_THETA = 81; <span class="comment">// The number of different theta hypotheses for a given center phi sector</span></div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordtype">unsigned</span> N_PHI_SECTORS = 16;    <span class="comment">// The number of phi sectors</span></div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordtype">unsigned</span> N_LAYERS_TRIGGER = 3;  <span class="comment">// The number of layers as seen by the trigger</span></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;      </div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <span class="keywordtype">double</span> highest_power = 0;</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;     </div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;      </div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    <span class="comment">// Here the 48 antennas are filled according to the waveforms passed to PassesTrigger(...).</span></div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    <span class="keywordtype">unsigned</span> fill_index = 0;</div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_phi_sector = 0; fill_index_phi_sector &lt; 16; ++fill_index_phi_sector) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_layer = 0; fill_index_layer &lt; 3; ++fill_index_layer) {</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    anita1-&gt;cwst_RXs[fill_index].phi_sector = fill_index_phi_sector;</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    anita1-&gt;cwst_RXs[fill_index].layer = fill_index_layer;</div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;      </div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordtype">unsigned</span> physical_layer_index = ((fill_index_phi_sector%2) ? (fill_index_layer + 1) : (0));   <span class="comment">// Maps the trigger layers {0, 1, 2} to the physical layers {0, 1, 2, 3}.</span></div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">if</span> (fill_index_phi_sector%2 == 0) {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      physical_layer_index = (fill_index_layer == 0) ? 0 : (fill_index + 1);</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    }</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="comment">// If phi sector is even then trigger layer zero maps to physical layer zero. If phi odd, maps to layer 1.</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordtype">unsigned</span> physical_phi_index (fill_index_phi_sector);</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;    <span class="keywordflow">if</span> (fill_index_layer == 0) {</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      physical_phi_index = unsigned(fill_index_phi_sector / 2.);   <span class="comment">// Map {0, ..., 15} to {0, ..., 7}.</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;    anita1-&gt;cwst_RXs[fill_index].x = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][0];</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    anita1-&gt;cwst_RXs[fill_index].y = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][1];</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    anita1-&gt;cwst_RXs[fill_index].z = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][2];</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        </div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    anita1-&gt;cwst_RXs[fill_index].waveform-&gt;assign(volts_rx_rfcm_trigger[fill_index_phi_sector][fill_index_layer].begin(),volts_rx_rfcm_trigger[fill_index_phi_sector][fill_index_layer].end());</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;      </div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_timestep = 0; fill_index_timestep &lt; anita1-&gt;HALFNFOUR; ++fill_index_timestep) {</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;      anita1-&gt;cwst_RXs[fill_index].digitized-&gt;at(fill_index_timestep) = <a class="code" href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08">three_bit_round</a>(anita1-&gt;cwst_RXs[fill_index].waveform-&gt;at(fill_index_timestep)/ anita1-&gt;rms_rfcm_e_single_event, (getRNG(RNG_SUMMED_TRIGGER)-&gt;Rndm() &gt;= 0.5), <span class="keyword">false</span>);</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    ++fill_index;</div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      }</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            </div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> center_phi_sector_index = 0; center_phi_sector_index &lt; N_PHI_SECTORS; ++center_phi_sector_index) {</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;      <span class="comment">// Loop over the hypotheses to align waveforms.</span></div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi = 0; index_phi &lt; N_STEP_PHI; ++index_phi) {</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_theta = 0; index_theta &lt; N_STEP_THETA; ++index_theta) {</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;      <span class="keywordtype">unsigned</span> fill_index = 0;</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      vector &lt;double&gt; summed_wfm(anita1-&gt;HALFNFOUR, 0.);</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        </div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> fill_index_phi_sector_offset = -1; fill_index_phi_sector_offset &lt;= 1; ++fill_index_phi_sector_offset) {</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <span class="keywordtype">unsigned</span> fill_index_phi_sector = (center_phi_sector_index + fill_index_phi_sector_offset + N_PHI_SECTORS)%N_PHI_SECTORS;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;          </div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_layer = 0; fill_index_layer &lt; N_LAYERS_TRIGGER; ++fill_index_layer) {</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;          <span class="keywordtype">unsigned</span> rx_index = fill_index_phi_sector * 3 + fill_index_layer;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;          anita1-&gt;cwst_aligned_wfms[fill_index].phi_sector = fill_index_phi_sector;</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;          anita1-&gt;cwst_aligned_wfms[fill_index].layer = fill_index_layer;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        </div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;          <span class="keywordtype">unsigned</span> physical_layer_index = ((fill_index_phi_sector%2) ? (fill_index_layer + 1) : (0));   <span class="comment">// Maps the trigger layers {0, 1, 2} to the physical layers {0, 1, 2, 3}.</span></div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;          <span class="comment">// If phi sector is even then trigger layer zero maps to physical layer zero. If phi odd, maps to layer 1.</span></div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;          <span class="keywordtype">unsigned</span> physical_phi_index (fill_index_phi_sector);</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          <span class="keywordflow">if</span> (fill_index_layer == 0) {</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        physical_phi_index = unsigned(fill_index_phi_sector / 2.);   <span class="comment">// Map {0, ..., 15} to {0, ..., 7}.</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;          }</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;          anita1-&gt;cwst_aligned_wfms[fill_index].x = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][0];</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;          anita1-&gt;cwst_aligned_wfms[fill_index].y = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][1];</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;          anita1-&gt;cwst_aligned_wfms[fill_index].z = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][2];</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;              </div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;          <span class="keywordtype">unsigned</span> time_offset = anita1-&gt;hypothesis_offsets[center_phi_sector_index][index_phi][index_theta][fill_index_phi_sector_offset + 1][fill_index_layer];</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        </div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_timestep = 0; fill_index_timestep &lt; anita1-&gt;HALFNFOUR - time_offset; ++fill_index_timestep) {</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        anita1-&gt;cwst_aligned_wfms[fill_index].digitized-&gt;at(fill_index_timestep) = anita1-&gt;cwst_RXs[rx_index].digitized-&gt;at(fill_index_timestep + time_offset);</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        summed_wfm.at(fill_index_timestep) += anita1-&gt;cwst_aligned_wfms[fill_index].digitized-&gt;at(fill_index_timestep);</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;          }</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;        </div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;          <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_timestep = anita1-&gt;HALFNFOUR - time_offset; fill_index_timestep &lt; anita1-&gt;HALFNFOUR; ++fill_index_timestep) {</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="comment">// Fill the ends of the waveforms with zeros. This should not negatively affect the simulation at all.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        <span class="comment">// This is an attempt to fix the power = 648 issue, where the bins were all +0.5 and summing to 9*0.5, summed over 32 bins.</span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        anita1-&gt;cwst_aligned_wfms[fill_index].digitized-&gt;at(fill_index_timestep) = 0.;</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;          }</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;          ++fill_index;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        </div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        } <span class="comment">// for fill layer indices</span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      } <span class="comment">// for fill phi sector indices</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;        </div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;      vector &lt;double&gt; power_of_summed_wfm;</div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;      <a class="code" href="../../d7/d39/class_global_trigger.html#a6bde1c1fb756b5a0ba4eea731d5bafc5">square_waveform_elements</a>(summed_wfm, power_of_summed_wfm);</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        </div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> window_index = 0; window_index &lt; power_of_summed_wfm.size() - 32; window_index += 16) {</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;        <span class="keywordtype">double</span> power = <a class="code" href="../../d7/d39/class_global_trigger.html#a4468958c2847209f5c84c21f616734be">summed_power_window</a>(power_of_summed_wfm, window_index, 32);</div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <span class="keywordflow">if</span> (highest_power &lt; power){</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;          highest_power = power;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;          <span class="comment">// hi_pow_center = center_phi_sector_index;</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;          <span class="comment">// hi_pow_phi_index = index_phi;</span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;          <span class="comment">// hi_pow_theta_index = index_theta;</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;        }</div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;          </div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <span class="keywordflow">if</span> (power &gt;= settings1-&gt;COHERENT_THRESHOLD){</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;          coherent_trigger_passes = <span class="keyword">true</span>;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;          thispasses += 2;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        }</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;          </div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">if</span> (power &gt;= settings1-&gt;COHERENT_THRESHOLD){</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;          anita1-&gt;fill_coherent_waveform_sum_tree(inu, center_phi_sector_index, settings1, anita1-&gt;rms_rfcm_e_single_event, 0., window_index, window_index + 32, index_theta - 45., index_phi, 33., 33.,summed_wfm, power_of_summed_wfm, power);</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;          <span class="comment">//thispasses = true;</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;          <span class="comment">//return 1;   // Return that this waveform passes.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        }</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;          </div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">if</span> (inu == 1808 &amp;&amp; center_phi_sector_index == 6) {</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;          anita1-&gt;fill_coherent_waveform_sum_tree(inu, center_phi_sector_index, settings1, anita1-&gt;rms_rfcm_e_single_event, 0., window_index, window_index + 32, index_theta - 45., index_phi, 33., 33.,summed_wfm, power_of_summed_wfm, power);</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;          <span class="comment">//return 1;</span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;        }</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;          </div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;        <span class="keywordflow">if</span> (coherent_trigger_passes){</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;          <span class="comment">// used to be return this_passes;</span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;          <span class="keywordflow">return</span>;</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        }</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;          </div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;      } <span class="comment">// for window indices</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    } <span class="comment">// for hypothesis theta indices</span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      } <span class="comment">// for hypothesis phi indices</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    } <span class="comment">// for hypothesis center phi sector indices</span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;      </div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  }</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;} <span class="comment">// end of PassesTriggerCoherentSum</span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::PassesTriggerSummedPower(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1){</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;                  </div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;  <span class="comment">//    TRIGGERSCHEME == 4 is the Summed Power Trigger.</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;  <span class="comment">//    For every window, all of the phi sectors find the maximum coherently summed power.</span></div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;  <span class="comment">//    These max powers are summed with the neighboring phi sectors (for three phi sectors in total) and compared to a threshold.</span></div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    </div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  <span class="keywordtype">double</span>        SummedPowerThreshold    = settings1-&gt;COHERENT_THRESHOLD;    <span class="comment">// The threshold against which all of the events will be compared.</span></div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;  <span class="keywordtype">double</span>        SummedPowerThetaMin     = -45.;     <span class="comment">// DEGREE!  The minimum theta (elevation) angle to try in the hypotheses.</span></div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;  <span class="keywordtype">double</span>        SummedPowerThetaMax     = +25.;     <span class="comment">// DEGREE!  The maximum theta (elevation) angle to try in the hypotheses.</span></div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;  <span class="keywordtype">double</span>        SummedPowerThetaStep    = 1.;       <span class="comment">// DEGREE!  The angle to advance from minimum theta to maximum theta.</span></div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    </div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  <span class="comment">// unsigned   N_STEP_THETA            = 81;       // The number of different theta hypotheses for a given center phi sector</span></div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// unsigned   N_PHI_SECTORS           = 16;       // The number of phi sectors</span></div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="comment">// unsigned   N_LAYERS_TRIGGER        = 3;        // The number of layers as seen by the trigger</span></div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    </div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;  <span class="comment">// double     highest_power           = 0.;</span></div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  <span class="comment">// unsigned   hi_pow_center           = 0;</span></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;  <span class="comment">// unsigned   hi_pow_phi_index        = 0;</span></div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;  <span class="comment">// unsigned   hi_pow_theta_index      = 0;</span></div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;    </div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;  <span class="comment">// Here the 48 antennas are filled according to the waveforms passed to PassesTrigger(...).</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;  <span class="keywordtype">unsigned</span>  fill_index              = 0;</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    </div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_phi_sector = 0; fill_index_phi_sector &lt; 16; ++fill_index_phi_sector) {</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_layer = 0; fill_index_layer &lt; 3; ++fill_index_layer) {</div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      anita1-&gt;cwst_RXs[fill_index].phi_sector = fill_index_phi_sector;</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      anita1-&gt;cwst_RXs[fill_index].layer = fill_index_layer;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    </div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    </div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;      <span class="keywordtype">unsigned</span> physical_phi_index = fill_index_phi_sector;</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="keywordtype">unsigned</span> physical_layer_index;</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    </div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    </div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="comment">// If the phi sector is an odd one, start with physical layer 1. If even, start with layer 0</span></div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="keywordflow">if</span> (fill_index_phi_sector%2) {</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;    physical_layer_index = fill_index_layer + 1;</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      } <span class="keywordflow">else</span></div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;    <span class="keywordflow">if</span> (fill_index_layer == 0) {</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      physical_layer_index = 0;</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      physical_layer_index = fill_index_layer + 1;</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;    }</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    </div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="keywordflow">if</span> (physical_layer_index == 0) {</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    physical_phi_index = unsigned(fill_index_phi_sector / 2);</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      }</div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    </div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;      <span class="keywordflow">if</span> (physical_layer_index == 1) {</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    physical_phi_index = unsigned(fill_index_phi_sector / 2);</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      }</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    </div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="comment">//    Set antenna positions</span></div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;      anita1-&gt;cwst_RXs[fill_index].x = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][0];</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      anita1-&gt;cwst_RXs[fill_index].y = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][1];</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      anita1-&gt;cwst_RXs[fill_index].z = anita1-&gt;ANTENNA_POSITION_START[0][physical_layer_index][physical_phi_index][2];</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;          </div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="comment">//    Fill the waveforms</span></div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      anita1-&gt;cwst_RXs[fill_index].waveform-&gt;assign(volts_rx_rfcm_trigger[fill_index_phi_sector][fill_index_layer].begin(),volts_rx_rfcm_trigger[fill_index_phi_sector][fill_index_layer].end());</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;    </div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> fill_index_timestep = 0; fill_index_timestep &lt; anita1-&gt;HALFNFOUR; ++fill_index_timestep) {</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    anita1-&gt;cwst_RXs[fill_index].digitized-&gt;at(fill_index_timestep) = <a class="code" href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08">three_bit_round</a>(anita1-&gt;cwst_RXs[fill_index].waveform-&gt;at(fill_index_timestep)/ anita1-&gt;rms_rfcm_e_single_event, <span class="keyword">false</span>);</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;      }</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;      ++fill_index;</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;  }</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    </div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    </div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">//  For whatever reason ANTENNA_POSITION_START[0] is a c-array, with large dimensions (5 by 400).</span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="comment">//  Most of these are initialized as a Vector with (0.,0.,1) for (x,y,z). These are non-existant antennas.</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;  <span class="comment">//  </span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;  <span class="comment">//  Make sure that the antennas positions being copied are actually from a real antenna, and pay attention to the physical</span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;  <span class="comment">//  antenna layers 0 &amp; 1, as they map to the 0th trigger layer.</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    </div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    </div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;  <span class="comment">//    Calculate the theta hypothesis angles</span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;  vector &lt;double&gt; theta_hypotheses_deg;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;  <span class="keywordtype">double</span> theta_deg = SummedPowerThetaMin;</div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    </div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;  <span class="keywordflow">do</span> {</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    theta_hypotheses_deg.push_back (theta_deg);</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    theta_deg += SummedPowerThetaStep;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;  } <span class="keywordflow">while</span> (theta_deg &lt;= SummedPowerThetaMax);</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    </div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;  <span class="comment">//    Now we begin the trigger.</span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    </div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;  <span class="comment">//    First steps over windows:</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_window = 0; index_window &lt; 31; ++index_window) {</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordtype">double</span> max_power_each_sector[16] = {0.};</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="keywordtype">double</span> summed_power_each_sector[16] = {0.};</div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;      </div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi_sector = 0; index_phi_sector &lt; 16; ++index_phi_sector) {</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;      <span class="keywordtype">double</span> max_power = 0.;</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    </div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;      <span class="comment">//    Use the current and opposite phi sectors to find an even horizontal line.</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;      TVector3 theta_zero (anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].x - anita1-&gt;cwst_RXs[(index_phi_sector + 8)%16 * 3 + 1].x, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].y - anita1-&gt;cwst_RXs[(index_phi_sector + 8)%16 * 3 + 1].y, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].z - anita1-&gt;cwst_RXs[(index_phi_sector + 8)%16 * 3 + 1].z);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="comment">//    Normalizes that line.</span></div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;      theta_zero = theta_zero.Unit();</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;    </div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;      <span class="comment">//    Loop over theta hypotheses</span></div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_theta_hypothesis = 0; index_theta_hypothesis &lt; theta_hypotheses_deg.size(); ++index_theta_hypothesis) {</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;    <span class="keywordtype">double</span> power = 0.;</div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;          </div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <span class="comment">//  Calculate the vector for the hypothesis&#39; direction.</span></div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordtype">double</span> hypoth_theta_rad = (theta_hypotheses_deg[index_theta_hypothesis] + 45.) * RADDEG;</div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordtype">double</span> hypoth_phi_rad = theta_zero.Phi() * RADDEG;</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    TVector3 hypoth_vector (sin (hypoth_theta_rad) * cos (hypoth_phi_rad), sin (hypoth_theta_rad) * sin (hypoth_phi_rad), cos (hypoth_theta_rad));</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;      </div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    <span class="comment">//  There will be three antenna time offsets per phi sector:</span></div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="keywordtype">double</span> dist[3] = {0.};</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="keywordtype">double</span> offset[3] = {0.};</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="keywordtype">unsigned</span> offset_steps[3] = {0};</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    TVector3 middle_rx (anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].x, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].y, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].z);</div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;      </div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;      </div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    <span class="comment">//  Calculate the relative path length distances</span></div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;    dist[0] = hypoth_vector * (TVector3(anita1-&gt;cwst_RXs[index_phi_sector * 3].x, anita1-&gt;cwst_RXs[index_phi_sector * 3].y, anita1-&gt;cwst_RXs[index_phi_sector * 3].z) - middle_rx);</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    dist[1] = 0.;   <span class="comment">// Just let this one be defined as &quot;zero&quot;, the other ones are relative.</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;    dist[2] = hypoth_vector * (TVector3(anita1-&gt;cwst_RXs[index_phi_sector * 3 + 2].x, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 2].y, anita1-&gt;cwst_RXs[index_phi_sector * 3 + 2].z) - middle_rx);</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;      </div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;      </div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="comment">//  Find time offsets from the relative path lengths</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_antenna = 0; index_antenna &lt; 3; ++index_antenna) {</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      offset[index_antenna] = dist[index_antenna] / CLIGHT;</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;      </div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">//  Make the lowest time offset be the minoffset</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;    <span class="keywordtype">double</span> minoffset = offset[0];</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;    <span class="keywordflow">if</span> (offset[1] &lt;= minoffset) {minoffset = offset[1];}</div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;    <span class="keywordflow">if</span> (offset[2] &lt;= minoffset) {minoffset = offset[2];}</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      </div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;      </div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="comment">//  Subtract the minoffset from the others, &quot;normalizing&quot; them so that the lowest value is zero</span></div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_antenna = 0; index_antenna &lt; 3; ++index_antenna) {</div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;      offset[index_antenna] -= minoffset;</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      offset_steps[index_antenna] = int(Tools::round(offset[index_antenna] / anita1-&gt;TIMESTEP));</div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    }</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;      </div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="comment">//  Check to make sure that all of the values will be in bounds</span></div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (offset_steps[0] + index_window * 16 + 32 &gt; 511) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;    <span class="keywordflow">if</span> (offset_steps[1] + index_window * 16 + 32 &gt; 511) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;    <span class="keywordflow">if</span> (offset_steps[2] + index_window * 16 + 32 &gt; 511) {<span class="keywordflow">continue</span>;}</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;      </div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="comment">//  Calculate the powers for every time in the window and then add it to the window power</span></div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> time_index = index_window * 16; time_index &lt; index_window * 16 + 32; ++time_index) {</div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;      <span class="keywordtype">double</span> thispower = (anita1-&gt;cwst_RXs[index_phi_sector * 3].digitized-&gt;at(time_index + offset_steps[0]) + anita1-&gt;cwst_RXs[index_phi_sector * 3 + 1].digitized-&gt;at(time_index + offset_steps[1]) + anita1-&gt;cwst_RXs[index_phi_sector * 3 + 2].digitized-&gt;at(time_index + offset_steps[2]));</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;      thispower *= thispower;</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;      power += thispower;</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    }</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;      </div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    <span class="comment">//  Make sure that the power is sane for the windows we care about</span></div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    <span class="keywordflow">if</span> (power == 0 &amp;&amp; index_window &lt; 21) {</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      std::cout &lt;&lt; <span class="stringliteral">&quot;Trigger error: a trigger window which should not have had zero power had zero power. Window was\t&quot;</span> &lt;&lt; index_window &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    }</div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;      </div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="comment">//  If this is the highest-power hypothesis for this phi sector, save it to max_power</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;    <span class="keywordflow">if</span> (power &gt; max_power) {max_power = power;}</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;      }</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;    </div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;      max_power_each_sector[index_phi_sector] = max_power;</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;    }</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;      </div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="comment">//  Calculate the power for the neighboring phi sectors</span></div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    summed_power_each_sector[0] = max_power_each_sector[15] + max_power_each_sector[0] + max_power_each_sector[1];</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi_sector = 1; index_phi_sector &lt; 15; ++index_phi_sector) {</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      summed_power_each_sector[index_phi_sector] = max_power_each_sector[index_phi_sector - 1] + max_power_each_sector[index_phi_sector] + max_power_each_sector[index_phi_sector + 1];</div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    }</div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    summed_power_each_sector[15] = max_power_each_sector[14] + max_power_each_sector[15] + max_power_each_sector[1];</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;      </div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;      </div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;    <span class="keywordtype">bool</span> temporary_passing_variable = <span class="keyword">false</span>;</div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> index_phi_sector = 0; index_phi_sector &lt; 16; ++index_phi_sector) {</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;      <span class="comment">//std::cout &lt;&lt; &quot;Max Power, sector\t&quot; &lt;&lt; index_phi_sector &lt;&lt; &quot;\t:\t&quot; &lt;&lt; summed_power_each_sector[index_phi_sector] &lt;&lt; std::endl;</span></div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;      <span class="keywordflow">if</span> (summed_power_each_sector[index_phi_sector] &gt;= SummedPowerThreshold) {</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    std::cout &lt;&lt; <span class="stringliteral">&quot;Passed with SummedPower =\t&quot;</span> &lt;&lt; summed_power_each_sector[index_phi_sector] &lt;&lt; <span class="stringliteral">&quot;\ton sector\t&quot;</span> &lt;&lt; index_phi_sector &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;    <span class="comment">//return 1;</span></div><div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    temporary_passing_variable = <span class="keyword">true</span>;</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;      }</div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    }</div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keywordflow">if</span> (temporary_passing_variable) {index_window=31;} <span class="comment">//exit</span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  }</div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;} <span class="comment">// end of PassesTriggerSummedPower</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;</div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::PassesTriggerScheme5(Anita *anita1,<span class="keywordtype">double</span> this_threshold, <span class="keywordtype">int</span> *thispasses) {</div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;  <span class="keywordtype">double</span> threshold=this_threshold;</div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    </div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;  <span class="comment">// need to find how many in a set of 6 pass</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    </div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;  <span class="keywordtype">int</span> maxsample=TMath::MaxElement(5,anita1-&gt;imaxbin);</div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;  <span class="keywordtype">int</span> minsample=TMath::MinElement(5,anita1-&gt;iminbin);</div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    </div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;  <span class="keywordtype">int</span> nstayhigh=(int)(anita1-&gt;l1window/anita1-&gt;TIMESTEP);</div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;  <span class="comment">// now make each flag stay high for the required amount of time</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    </div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;</div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;  minsample=(int)(anita1-&gt;maxt_diode/anita1-&gt;TIMESTEP)+(anita1-&gt;NFOUR/4-(int)(anita1-&gt;maxt_diode/anita1-&gt;TIMESTEP))+(<span class="keywordtype">int</span>)(anita1-&gt;arrival_times[0][anita1-&gt;rx_minarrivaltime]/anita1-&gt;TIMESTEP);</div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;  maxsample=anita1-&gt;NFOUR/2-(int)(anita1-&gt;arrival_times[0][anita1-&gt;rx_minarrivaltime]/anita1-&gt;TIMESTEP);</div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;</div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;5;i++) {</div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    anita1-&gt;iminbin[i]=minsample;</div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    anita1-&gt;imaxbin[i]=maxsample;</div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;  }</div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;</div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> center_phi_sector_index = 0; center_phi_sector_index &lt; 16; ++center_phi_sector_index) {</div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <span class="comment">// for (unsigned center_phi_sector_index = 0; center_phi_sector_index &lt; 16; center_phi_sector_index+=2) {</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;      </div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;</div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index_hyp=0;index_hyp&lt;anita1-&gt;vdifferent_offsets.size();index_hyp++) {</div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;</div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;</div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; anita1-&gt;N_SUMMED_LAYERS; ++i_layer) {</div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_sector = 0; i_sector &lt; anita1-&gt;N_SUMMED_PHI_SECTORS; ++i_sector) {</div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;</div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordtype">int</span> rx=anita1-&gt;GetRxTriggerNumbering(i_layer,(center_phi_sector_index+i_sector)%16);</div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;      </div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;      </div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;      <span class="keywordtype">double</span> timedomain_output_1_corrected[Anita::NFOUR/2]; <span class="comment">// these are corrected for their delays so that they should line up in time</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;      <span class="keywordtype">double</span> timedomain_output_2_corrected[Anita::NFOUR/2];</div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;      <span class="comment">// if we&#39;re doing an anita 3 trigger, adjust for delays in the diode outputs so that we can do a time coincidence trigger </span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;      </div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NFOUR/2;i++) {</div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;        timedomain_output_1_corrected[i]=anita1-&gt;timedomain_output_allantennas[0][rx][i];</div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;        timedomain_output_2_corrected[i]=anita1-&gt;timedomain_output_allantennas[1][rx][i];</div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;      }</div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;      </div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;      <span class="comment">//      Tools::ShiftLeft(timedomain_output_1_corrected,anita1-&gt;NFOUR/2,anita1-&gt;arrival_times[rx]);</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;      <span class="comment">//Tools::ShiftLeft(timedomain_output_2_corrected,anita1-&gt;NFOUR/2,anita1-&gt;arrival_times[rx]);</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;   </div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      Tools::ShiftLeft(timedomain_output_1_corrected,anita1-&gt;NFOUR/2,anita1-&gt;vdifferent_offsets[index_hyp][anita1-&gt;N_SUMMED_PHI_SECTORS*i_layer+i_sector]);</div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;      Tools::ShiftLeft(timedomain_output_2_corrected,anita1-&gt;NFOUR/2,anita1-&gt;vdifferent_offsets[index_hyp][anita1-&gt;N_SUMMED_PHI_SECTORS*i_layer+i_sector]);</div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        </div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;</div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;      <span class="comment">//for (int k=0;k&lt;5;k++) {</span></div><div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;      <span class="comment">//anita1-&gt;ston[k]=anita1-&gt;peak_v_banding_rfcm_e[k]/anita1-&gt;bwslice_vrms[k];</span></div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="comment">//} // end loop over bands</span></div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      </div><div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="keywordflow">if</span> (rx==anita1-&gt;rx_minarrivaltime) {</div><div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NFOUR/2;i++) {</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;          anita1-&gt;timedomain_output_corrected_forplotting[0][0][i]=timedomain_output_1_corrected[i];</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;          anita1-&gt;timedomain_output_corrected_forplotting[1][0][i]=timedomain_output_2_corrected[i];</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        }</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      }</div><div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      flag_e_L1[rx].clear();</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;      flag_h_L1[rx].clear();        </div><div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;      </div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;</div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=minsample;i&lt;maxsample;i++) {         </div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <span class="comment">//      for (int i=minsample;i&lt;maxsample;i++) {</span></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    </div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;timedomain_output_1_corrected[i], threshold, bwslice_rmsdiode[4] are &quot; &lt;&lt; timedomain_output_1_corrected[i] &lt;&lt; &quot;\t&quot; &lt;&lt; threshold*anita1-&gt;bwslice_rmsdiode[4] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">if</span> (timedomain_output_1_corrected[i]&lt;threshold*anita1-&gt;bwslice_rmsdiode[0][4]) {</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;          flag_e_L1[rx].push_back(1);</div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;          <span class="comment">//cout &lt;&lt; &quot;passes.\n&quot;;</span></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        }</div><div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;        <span class="keywordflow">else</span> {</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;          flag_e_L1[rx].push_back(0);</div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;          <span class="comment">//cout &lt;&lt; &quot;doesn&#39;t pass.\n&quot;;</span></div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        }</div><div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    </div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="keywordflow">if</span> (timedomain_output_2_corrected[i]&lt;threshold*anita1-&gt;bwslice_rmsdiode[1][4])</div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          flag_h_L1[rx].push_back(1);</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;          flag_h_L1[rx].push_back(0);</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    </div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;      } <span class="comment">// end loop over samples in window where we look for single channel trigger firing</span></div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=minsample;i&lt;maxsample;i++) {         </div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        <span class="comment">//  for (int i=minsample;i&lt;maxsample;i++) { // loop over samples in window where we looked for a single channel trigger</span></div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;      </div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;        <span class="keywordflow">if</span> (flag_e_L1[rx][i-minsample]==1) <span class="comment">// if the flag is high (remember the second index of flag_e counts from the start of the window)</span></div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=nstayhigh-1; k&gt;0 &amp;&amp; i&lt;maxsample-1; k--) { <span class="comment">// then for nstayhigh-1 samples after than we keep it high</span></div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;        <span class="comment">// i&lt;maxsample-1 makes sure that the second index of flag_e is always less than maxsample-minsample-1.</span></div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        i++;</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        flag_e_L1[rx][i-minsample]=1;</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;          </div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;          }</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;      </div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <span class="comment">//      if (flag_e[j][i]==1) {</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;        <span class="comment">//  for (int k=i;k&lt;i+nstayhigh;k++) {</span></div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;        <span class="comment">//    if (k&lt;NSAMPLES)</span></div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;        <span class="comment">//      flag_e[j][k]=1;</span></div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        <span class="comment">//  } // end loop over samples where we want it to stay high</span></div><div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      </div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="comment">//       } // end if flag is high</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;      }</div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    </div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=minsample;i&lt;maxsample;i++) {</div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;        <span class="keywordflow">if</span> (flag_h_L1[rx][i-minsample]==1)</div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=nstayhigh-1; k&gt;0 &amp;&amp; i&lt;maxsample-1; k--) {</div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;        i++;</div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;        flag_h_L1[rx][i-minsample]=1;</div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;          }</div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;      </div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <span class="comment">//      if (flag_h[j][i]==1) {</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        <span class="comment">//  for (int k=i;k&lt;i+nstayhigh;k++) {</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;        <span class="comment">//    if (k&lt;NSAMPLES)</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;        <span class="comment">//      flag_h[j][k]=1;</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <span class="comment">//  } // end loop over samples where we want it to stay high</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      </div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;        <span class="comment">//       } // end if flag is high</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;      </div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;      } <span class="comment">// end loop over samples</span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    </div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    } <span class="comment">// end loop over phi sectors being considered for this L1</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;      } <span class="comment">// end loop over layers being considered for this L1</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;</div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    </div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="comment">// now find the sample with the highest number of bands that pass</span></div><div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    <span class="comment">// int maxbands=0;</span></div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="comment">// int nbands_pass=0;</span></div><div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;  </div><div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    </div><div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=minsample;i&lt;maxsample;i++) { </div><div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;      </div><div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    <span class="keywordtype">int</span> nbands_pass[2]={0};</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    <span class="keywordtype">int</span> maxbands[2]={0};</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;      </div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_layer = 0; i_layer &lt; anita1-&gt;N_SUMMED_LAYERS; ++i_layer) {</div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i_sector = 0; i_sector &lt; anita1-&gt;N_SUMMED_PHI_SECTORS; ++i_sector) {</div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;      </div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordtype">int</span> rx=anita1-&gt;GetRxTriggerNumbering(i_layer,(center_phi_sector_index+i_sector)%16);</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;      </div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;      </div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;      </div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="keywordflow">if</span> (flag_e_L1[rx][i-minsample]==1)</div><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;          nbands_pass[0]++;</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;        <span class="keywordflow">if</span> (flag_h_L1[rx][i-minsample]==1)</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;          nbands_pass[1]++;</div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      </div><div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      </div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;      }</div><div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    }</div><div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;      </div><div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">if</span> (nbands_pass[0]&gt;maxbands[0]) </div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;      maxbands[0]=nbands_pass[0];</div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keywordflow">if</span> (nbands_pass[1]&gt;maxbands[1]) </div><div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;      maxbands[1]=nbands_pass[1];</div><div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;      </div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span> (maxbands[0]&gt;=anita1-&gt;NCH_PASS) </div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;      thispasses[0]=1.; </div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <span class="keywordflow">if</span> ( maxbands[1]&gt;=anita1-&gt;NCH_PASS)  </div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;      thispasses[1]=1.; </div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;      </div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;      } <span class="comment">// end loop over layers</span></div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    </div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    }</div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;      </div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;  } <span class="comment">// end loop over center phi sectors    </span></div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;} <span class="comment">// end of PassesTriggerScheme5</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;</div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#aa9f1e933356b9295c10bdb70f9a447e5"> 1352</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">GlobalTrigger::FillInNadir</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> ant) { <span class="comment">//overloaded function</span></div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;  <span class="keywordtype">int</span> antarray[<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]={0};</div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;  <span class="comment">//here the ant array is an array of binary numbers</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;  <span class="keywordtype">int</span> whichphi;</div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    </div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NRX_PHI[2];iphi++) {</div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        </div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    whichphi = 1 &lt;&lt; <a class="code" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GetPhiSector</a>(settings1,2,iphi); <span class="comment">// get trigger phi sector</span></div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    <span class="keywordflow">if</span> (whichphi &amp; ant) { <span class="comment">// if this phi sector is masked</span></div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      antarray[<a class="code" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GetPhiSector</a>(settings1,2,iphi)]=1;</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            </div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    }</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;  }</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    </div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    </div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;  <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">FillInNadir</a>(anita1,antarray);</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    </div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    </div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;  ant=0;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;NTRIGPHISECTORS;iphi++) {</div><div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    <span class="keywordflow">if</span> (antarray[iphi])</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;      ant+=(1&lt;&lt;iphi);</div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;  }</div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;    </div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    </div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;    </div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;}</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;</div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;</div><div class="line"><a name="l01395"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5"> 1395</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">GlobalTrigger::FillInNadir</a>(Anita *anita1,<span class="keywordtype">int</span> *ant) {</div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;  <span class="keywordtype">int</span> ileft,iright;</div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;ntrigphisectors is &quot; &lt;&lt; ntrigphisectors &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;  <span class="comment">//   for (int i=0;i&lt;ntrigphisectors;i++) {</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;  <span class="comment">//   cout &lt;&lt; &quot;before, ant is &quot; &lt;&lt; ant[2][i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;  <span class="comment">//   }</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    </div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;anita1-&gt;NTRIGPHISECTORS/2;i++) {</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    ileft=(2*i+anita1-&gt;NTRIGPHISECTORS-1)%anita1-&gt;NTRIGPHISECTORS;</div><div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    iright=(2*i+1)%anita1-&gt;NTRIGPHISECTORS;</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <span class="keywordflow">if</span> (ant[ileft] || ant[iright])</div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;      ant[2*i]=1;</div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;  }</div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    </div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;  <span class="comment">//    for (int i=0;i&lt;anita1-&gt;NTRIGPHISECTORS;i++) {</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;  <span class="comment">//   cout &lt;&lt; &quot;after, ant is &quot; &lt;&lt; ant[2][i] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;  <span class="comment">//   }</span></div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    </div><div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;    </div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;}</div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;</div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;</div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;</div><div class="line"><a name="l01426"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739"> 1426</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GlobalTrigger::GetPhiSector</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j) { <span class="comment">// given trigger layer and index, get phi sector.</span></div><div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;  <span class="comment">// for the upper two layers, the phi sector is just j</span></div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;  <span class="comment">// for the nadir layer, the phi sector is 2*j+1</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;  <span class="comment">// warning this counts from 0</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;  <span class="keywordflow">if</span> (i&lt;2)</div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <span class="keywordflow">return</span> j;</div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;  <span class="keywordflow">if</span> (i==2) {</div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;DISCONES==2)</div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;      <span class="keywordflow">return</span> 2*j+1;</div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;      <span class="keywordflow">return</span> j;</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;  }</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    {</div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;      cout &lt;&lt; <span class="stringliteral">&quot;Input non-existent layer!\n&quot;</span>;</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;      <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        </div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    }</div><div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;  <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;}</div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;</div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;</div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;</div><div class="line"><a name="l01457"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a8d88f561ec14573c139ee67d100813ff"> 1457</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a8d88f561ec14573c139ee67d100813ff">GlobalTrigger::GetAnitaLayerPhiSector</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,<span class="keywordtype">int</span> i,<span class="keywordtype">int</span> j,<span class="keywordtype">int</span> &amp;whichlayer,<span class="keywordtype">int</span> &amp;whichphisector) {</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    </div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    </div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;  <span class="keywordflow">if</span> (settings1-&gt;WHICH==6 || settings1-&gt;WHICH==2 || settings1-&gt;WHICH==8) {<span class="comment">// If Anita 1 or Anita 2</span></div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">if</span> (i==0) {</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;      whichlayer=0;</div><div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;      whichphisector=2*j+1;</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    }</div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==1) {</div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;      whichlayer=0;</div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;      whichphisector=2*j;</div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    }</div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==2) {</div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;      whichlayer=1;</div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;      whichphisector=j;</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    }</div><div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==3) {</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;      whichlayer=2;</div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;      whichphisector=2*j+1;</div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;    }</div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;  } <span class="comment">// end anita 1 or anita 2</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (settings1-&gt;WHICH==9 || settings1-&gt;WHICH==10) { <span class="comment">// anita 3 or anita 4</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;    <span class="keywordflow">if</span> (i==0) {</div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;      whichlayer=0;</div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;      whichphisector=2*j;</div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;    }</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==1) {</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;      whichlayer=0;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;      whichphisector=2*j+1;</div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    }</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==2) {</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;      whichlayer=1;</div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;      whichphisector=j;</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    }</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (i==3) {</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;      whichlayer=2;</div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;      whichphisector=j;</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;    }</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  }  <span class="comment">// end anita 3 or 4</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;    whichlayer=i;</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    whichphisector=j;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        </div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  }</div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    </div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;}</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a9d27c09a9a6363f4f37dc4cb4f21cf3e"> 1540</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a9d27c09a9a6363f4f37dc4cb4f21cf3e">GlobalTrigger::L3Trigger</a>(<a class="code" href="../../db/d2b/class_settings.html">Settings</a> *settings1,Anita *anita1,<span class="keywordtype">int</span> loctrig[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NLAYERS_MAX][Anita::NPHI_MAX],<span class="keywordtype">int</span> loctrig_nadironly[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][Anita::NPHI_MAX],<span class="keywordtype">int</span> discones_passing,<span class="keywordtype">int</span> *l3trig,</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                  <span class="keywordtype">int</span> *thispasses) {</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;  </div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;  <span class="keywordtype">int</span> whichphipass[<a class="code" href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a>][<a class="code" href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a>]={{0}};</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;   </div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;Anita::NTRIG;i++)</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    triggerbits[i]=0;</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;    </div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;  <span class="comment">// shouldn&#39;t get here for anita3 or anita4 anymore.</span></div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;  <span class="comment">//assumes the number of trigger phi sectors are the same in each layer</span></div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;anita1-&gt;PHITRIG[0];i++) {</div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        </div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        </div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="comment">//     if (settings1-&gt;WHICH==9) { // anita 3</span></div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    <span class="comment">//       for (int ipolar=0;ipolar&lt;2;ipolar++) {</span></div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="comment">//  if (loctrig[ipolar][0][i]&gt;0 &amp;&amp; loctrig[ipolar][1][i]&gt;0 &amp;&amp; loctrig[ipolar][2][i]&gt;0) {</span></div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="comment">//    thispasses[ipolar]=1;</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;    <span class="comment">//    whichphipass[ipolar][i]=1;</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    <span class="comment">//    if (!(triggerbits[3] &amp; (1&lt;&lt;i)))</span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    <span class="comment">//      triggerbits[3]+=(1&lt;&lt;i);</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="comment">//  }</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <span class="comment">//       }</span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <span class="comment">//     }</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="comment">//    else { // anita 1 or anita 2</span></div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;      </div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ilayer=0;ilayer&lt;anita1-&gt;NTRIGGERLAYERS-1;ilayer++) {</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="comment">// check this - does ilayer and ilayer+1 include just 1 and 2, or also 2 and 3, and is that ok?</span></div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="keywordflow">if</span> (loctrig[ipolar][ilayer][i]&gt;0 &amp;&amp; loctrig[ipolar][ilayer+1][i]&gt;0) { <span class="comment">// upper two layers</span></div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;        </div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;      <span class="comment">//l3trig += (1&lt;&lt;i);</span></div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;      thispasses[ipolar]=1;</div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;      whichphipass[ipolar][i]=1;</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        </div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;      <span class="keywordflow">if</span>(loctrig[ipolar][0][i]&gt;0 &amp;&amp; loctrig[ipolar][1][i]&gt;0) {</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordflow">if</span> (!(triggerbits[0] &amp; (1&lt;&lt;i)))</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;          triggerbits[0] += (1&lt;&lt;i);</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;      }</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        </div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160; </div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    }</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;      }</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    }</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;    </div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;    <span class="comment">// anita 1, anita 1 kurt, anita 2 kurt, anita 3</span></div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    <span class="comment">// but this is inside a set of brackets for !anita3 </span></div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;    <span class="keywordflow">if</span> (settings1-&gt;WHICH==2 || settings1-&gt;WHICH==6 || settings1-&gt;WHICH==8) { <span class="comment">// Anita 1, 2</span></div><div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;                </div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    <span class="keywordflow">if</span> (((settings1-&gt;DISCONES==2) &amp;&amp; (loctrig[ipolar][1][i]&gt;0 &amp;&amp; loctrig[ipolar][2][i]&gt;0)) || <span class="comment">// second layer and nadir?</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        ((settings1-&gt;DISCONES==2) &amp;&amp; (loctrig[ipolar][0][i]&gt;0 &amp;&amp; loctrig[ipolar][2][i]&gt;0)) || <span class="comment">// first layer and nadir?</span></div><div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        ((settings1-&gt;DISCONES==2) &amp;&amp; loctrig_nadironly[ipolar][i]&gt;0) || <span class="comment">// just nadir - does this mean having just a nadir pass makes the whole event pass?</span></div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        (settings1-&gt;DISCONES==1 &amp;&amp; (loctrig[ipolar][1][i]&gt;0 &amp;&amp; discones_passing&gt;=settings1-&gt;NDISCONES_PASS)) || <span class="comment">// second layer and discones</span></div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        (settings1-&gt;DISCONES==1 &amp;&amp; (loctrig[ipolar][0][i]&gt;0 &amp;&amp; discones_passing&gt;=settings1-&gt;NDISCONES_PASS))   <span class="comment">// top layer and discones</span></div><div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;        ) {</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                    </div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;      thispasses[ipolar]=1;</div><div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;      whichphipass[ipolar][i]=1;</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;      <span class="comment">// this is just for nadir studies-&gt;</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;      <span class="comment">//how many of each trigger condition</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                    </div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;      <span class="keywordflow">if</span>(loctrig[ipolar][1][i]&gt;0 &amp;&amp; loctrig[ipolar][2][i]&gt;0) {</div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        triggerbits[1] += (1&lt;&lt;i);</div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                        </div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;      }</div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;      <span class="keywordflow">if</span>(loctrig[ipolar][0][i]&gt;0 &amp;&amp; loctrig[ipolar][2][i]&gt;0) {</div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;        triggerbits[2]+=(1&lt;&lt;i);</div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                        </div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;      }</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;      <span class="comment">//    if (loctrig_nadironly[i]&gt;0)</span></div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;      <span class="comment">//      triggerbits[3]+=weight2;</span></div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;      <span class="comment">//    if ((loctrig_nadironly[i]&gt;0 ||</span></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;      <span class="comment">//         (loctrig[1][i]&gt;0 &amp;&amp; loctrig[2][i]&gt;0) ||</span></div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;      <span class="comment">//         (loctrig[0][i]&gt;0 &amp;&amp; loctrig[2][i]&gt;0)) &amp;&amp;</span></div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;      <span class="comment">//        !(loctrig[0][i]&gt;0 &amp;&amp; loctrig[1][i]&gt;0))</span></div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;      <span class="comment">//      triggerbits[4]+=weight2;</span></div><div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                    </div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                    </div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;      thispasses[ipolar]=1;</div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                    </div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    }</div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                </div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;      } <span class="comment">//if it&#39;s the anita 1 payload</span></div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;    }   </div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            </div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;    <span class="comment">//    } // if it&#39;s not anita 3</span></div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;        </div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        </div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;      <span class="keywordflow">if</span> (whichphipass[ipolar][i])</div><div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    l3trig[ipolar]+=(1&lt;&lt;i);</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;      <span class="comment">// std::cout &lt;&lt; ipolar &lt;&lt; &quot; &quot; &lt;&lt; whichphipass[ipolar][i] &lt;&lt; &quot; &quot; &lt;&lt; l3trig[ipolar] &lt;&lt; std::endl;</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;    }</div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;        </div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;  } <span class="comment">// end looping over phi</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    </div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;</div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;}</div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;</div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;<span class="comment">// void GlobalTrigger::GetArrivalTimes(int inu, Anita *anita1, const Vector&amp; rf_direction) {</span></div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    </div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    </div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;<span class="comment">//     for (int antenna_index = 0; antenna_index &lt; (anita1-&gt;number_all_antennas); antenna_index++) { //loop over layers on the payload</span></div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;<span class="comment">//      arrival_times[antenna_index] = (anita1-&gt;antenna_positions[antenna_index] * rf_direction) / CLIGHT;</span></div><div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;<span class="comment">//     } // for: loop over antenna layers</span></div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    </div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;<span class="comment">//     double first_trigger_time = Tools::dMin(arrival_times,(anita1-&gt;number_all_antennas));</span></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    </div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;<span class="comment">//     for (int i=0;i&lt;(anita1-&gt;number_all_antennas);i++){</span></div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;<span class="comment">//      arrival_times[i] -= first_trigger_time;</span></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;<span class="comment">//      if (arrival_times[i] == 0){</span></div><div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;<span class="comment">//          first_phi_sector_hit = floor(i / 16);</span></div><div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="comment">//      }</span></div><div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">//     }</span></div><div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    </div><div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">// } // GetArrivalTimes</span></div><div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div><div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;</div><div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;</div><div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;</div><div class="line"><a name="l01713"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a48113d648786aa91b1076824af045864"> 1713</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a48113d648786aa91b1076824af045864">GlobalTrigger::delay_align_antenna_waveforms</a>(<span class="keyword">const</span> vector&lt; vector &lt; vector &lt;double&gt; &gt; &gt;&amp; waveforms, <span class="keyword">const</span> vector &lt; vector &lt;unsigned int&gt; &gt;&amp; delays, vector &lt; vector &lt;double&gt; &gt;&amp; output){</div><div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;  <span class="comment">// The waveforms vector is accessed by waveforms[phi_sector_id][antenna_id][sample_id]</span></div><div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;  <span class="comment">// the delays are accessed by delays[phi_sector_id][antenna_id]</span></div><div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    </div><div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;  <span class="comment">// the output is in the same format as the input, but will only include samples which have all elements</span></div><div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;  output.clear();</div><div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    </div><div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;  <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shortest_waveform = waveforms[0][0].size();</div><div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;  vector &lt;double&gt; temp_antenna_waveform;</div><div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> phi_sector_index = 0; phi_sector_index &lt; 3; phi_sector_index++){</div><div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> antenna_index = 0; antenna_index &lt; waveforms[phi_sector_index].size(); antenna_index++){</div><div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;      temp_antenna_waveform.clear();</div><div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sample_index = delays[phi_sector_index][antenna_index]; sample_index &lt; waveforms[phi_sector_index][antenna_index].size(); sample_index++){</div><div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    temp_antenna_waveform.push_back(waveforms[phi_sector_index][antenna_index][sample_index]);</div><div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;      }</div><div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;      <span class="keywordflow">if</span> (temp_antenna_waveform.size() &lt; shortest_waveform){</div><div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;    shortest_waveform = temp_antenna_waveform.size();</div><div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;      }</div><div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;      output.push_back(temp_antenna_waveform);</div><div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;    }</div><div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;  }</div><div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;  <span class="comment">// Must now make all have the same length</span></div><div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> antenna_index = 0; antenna_index &lt; output.size(); antenna_index++){</div><div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    output[antenna_index].resize(shortest_waveform);</div><div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;  }</div><div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;}</div><div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;</div><div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;</div><div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;</div><div class="line"><a name="l01750"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a51307d40e79fad867b83acdea276a2d6"> 1750</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a51307d40e79fad867b83acdea276a2d6">GlobalTrigger::sum_aligned_waveforms</a>(<span class="keyword">const</span> vector &lt; vector &lt;double&gt; &gt;&amp; waveforms, vector &lt;double&gt;&amp; output){</div><div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;  output.clear();</div><div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;  <span class="keywordtype">unsigned</span> waveform_size = waveforms[0].size();</div><div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;  <span class="keywordtype">unsigned</span> waveforms_size = waveforms.size();</div><div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> element_index = 0; element_index &lt; waveform_size; ++element_index) {</div><div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordtype">double</span> element = 0.;</div><div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> antenna_index = 0; antenna_index &lt; waveforms_size; ++antenna_index) {</div><div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;      element += waveforms[antenna_index][element_index];</div><div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    }</div><div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;    output.push_back(element);</div><div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;  }</div><div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;}</div><div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;</div><div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;</div><div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;</div><div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;</div><div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;</div><div class="line"><a name="l01778"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a6bde1c1fb756b5a0ba4eea731d5bafc5"> 1778</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a6bde1c1fb756b5a0ba4eea731d5bafc5">GlobalTrigger::square_waveform_elements</a>(<span class="keyword">const</span> vector &lt;double&gt;&amp; waveform, vector &lt;double&gt;&amp; output){</div><div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;  output.clear();</div><div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    </div><div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> element_index = 0; element_index &lt; waveform.size(); element_index++){</div><div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    output.push_back(waveform[element_index] * waveform[element_index]);</div><div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;  }</div><div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;}</div><div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;</div><div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;</div><div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;</div><div class="line"><a name="l01795"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a4468958c2847209f5c84c21f616734be"> 1795</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a4468958c2847209f5c84c21f616734be">GlobalTrigger::summed_power_window</a>(<span class="keyword">const</span> vector &lt;double&gt;&amp; waveform, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> start_index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> length){</div><div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;  <span class="keywordtype">double</span> result = 0;</div><div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = start_index; index &lt; start_index + length; index++){</div><div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;    result += waveform[index];</div><div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;  }</div><div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;}</div><div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;</div><div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;</div><div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;</div><div class="line"><a name="l01812"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08"> 1812</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08">GlobalTrigger::three_bit_round</a>(<span class="keywordtype">double</span> input, <span class="keywordtype">bool</span> round_zero_up, <span class="keywordtype">bool</span> allow_zero) {</div><div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;  <span class="comment">// </span></div><div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;  <span class="keywordtype">double</span> result = 0.;</div><div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;  <span class="keywordflow">if</span> (input &lt; -3.5){</div><div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;    result = -3.5;</div><div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (input &gt; 3.5){</div><div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    result = 3.5;</div><div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (floor(input) == input){</div><div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    <span class="keywordflow">if</span> (!allow_zero) {</div><div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;      <span class="keywordflow">if</span> (round_zero_up) {</div><div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;    result = input + 0.5;</div><div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;      } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    result = input + -0.5;</div><div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;      }</div><div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;      result = input;</div><div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;    }</div><div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (floor(input) + 0.5 &gt; input){</div><div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;    result = ceil(input) - 0.5;</div><div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;  }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (floor(input) + 0.5 &lt; input){</div><div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;    result = floor(input) + 0.5;</div><div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;  }</div><div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;    </div><div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;  <span class="keywordflow">return</span> result;</div><div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;}</div><div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;</div><div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;<span class="comment">/*  </span></div><div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;<span class="comment"> *  This function takes a waveform array as a parameter and returns a vector &lt;double&gt; of 3 bit waveforms</span></div><div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l01842"></a><span class="lineno"><a class="line" href="../../d7/d39/class_global_trigger.html#a25c961e78eb253bdf7bffb90b9e31be0"> 1842</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d7/d39/class_global_trigger.html#a25c961e78eb253bdf7bffb90b9e31be0">GlobalTrigger::convert_wfm_to_3_bit</a>(<span class="keyword">const</span> vector &lt;double&gt;&amp; wfm, <span class="keywordtype">double</span> rms, vector &lt;double&gt;&amp; output){</div><div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;  output.clear();</div><div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0; index &lt; wfm.size(); index++){</div><div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;    output.push_back(<a class="code" href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08">three_bit_round</a>(wfm[index]/rms));</div><div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;  }</div><div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;}</div><div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::findahit(vector&lt;int&gt; myvector,<span class="keywordtype">int</span> first,<span class="keywordtype">int</span> last) {</div><div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;</div><div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;  <span class="keywordtype">int</span> yes=0;</div><div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;  <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)myvector.size()&lt;=last)</div><div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;    <span class="keywordflow">return</span> yes;</div><div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;</div><div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=first;i&lt;=last;i++) {</div><div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;    <span class="keywordflow">if</span> (myvector[i]==1) {</div><div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;      yes=1;</div><div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;      <span class="keywordflow">continue</span>;</div><div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;    }</div><div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;  }</div><div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;  <span class="keywordflow">return</span> yes;</div><div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;}</div><div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::findanl3(<span class="keywordtype">int</span> *l3,<span class="keywordtype">int</span> NPHISECTORS) {</div><div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;</div><div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0;j&lt;NPHISECTORS;j++) {</div><div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;    <span class="keywordflow">if</span> (l3[j]==1)</div><div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;  }</div><div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;}</div><div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L2Anita3and4(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl1trig,</div><div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                 std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; &amp;vl2trig) {</div><div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;</div><div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;  </div><div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;iphi, ipolar, size is &quot; &lt;&lt;  iphi &lt;&lt; &quot;\t&quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; vl1trig[ipolar][iphi].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl1trig[ipolar][iphi].size();ibin++) {</div><div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;ipolar, iphi , ibin are &quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; ibin &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;    <span class="comment">//  if (vl1trig[ipolar][iphi][ibin])</span></div><div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;actually a nonzero l1trig.\n&quot;;</span></div><div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;    vl2trig[ipolar][iphi].push_back(vl1trig[ipolar][iphi][ibin]);</div><div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;      }</div><div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;    }</div><div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;  }</div><div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;</div><div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;  </div><div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;</div><div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;</div><div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;}</div><div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L3Anita3and4(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl2trig,</div><div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                 <span class="keywordtype">int</span> vl3trig[2][16],<span class="keywordtype">int</span> *thispasses) {</div><div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;</div><div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;  <span class="keywordtype">int</span> iphimod16_neighbor;</div><div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;</div><div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;</div><div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi_neighbor=iphi-1;iphi_neighbor&lt;=iphi+1;iphi_neighbor++) {</div><div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;    <span class="keywordflow">if</span> (iphi_neighbor!=iphi) {</div><div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;      iphimod16_neighbor=(iphi_neighbor+16)%16;</div><div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;L3_COINCIDENCE is &quot; &lt;&lt; L3_COINCIDENCE &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl2trig[ipolar][iphi].size();ibin++) {</div><div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;        <span class="keywordflow">if</span> (ibin+(<span class="keywordtype">int</span>)(L3_COINCIDENCE/TRIGTIMESTEP)&lt;vl2trig[ipolar][iphimod16_neighbor].size()) {</div><div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;          <span class="keywordflow">if</span> (vl2trig[ipolar][iphi][ibin] &amp;&amp; </div><div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;          findahit(vl2trig[ipolar][iphimod16_neighbor],ibin,ibin+(<span class="keywordtype">int</span>)(L3_COINCIDENCE/TRIGTIMESTEP))) {</div><div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;passes: &quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; ibin &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <span class="comment">//cout &lt;&lt; &quot;neighbor: &quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; iphimod16_neighbor &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;        vl3trig[ipolar][iphi]=1;</div><div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        thispasses[ipolar]=1;</div><div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;        ibin = vl2trig[ipolar][iphi].size(); <span class="comment">// ends this loop</span></div><div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;        iphi_neighbor=iphi+2; <span class="comment">// ends outer loop</span></div><div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;          }</div><div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;          <span class="keywordflow">else</span></div><div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;        vl3trig[ipolar][iphi]=0;</div><div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160; </div><div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160;        } <span class="comment">// end if so we&#39;re not going off the end of vl2trig</span></div><div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="keywordflow">else</span></div><div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;          vl3trig[ipolar][iphi]=0;</div><div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;      }</div><div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    }</div><div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;      }</div><div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;    }</div><div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;  }</div><div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;</div><div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;}</div><div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;</div><div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;<span class="comment">// L1 trigger is at the antenna level again.  Just require coincidence between LCP and RCP</span></div><div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L1Anita4LR_ScB_OneBin(<span class="keywordtype">int</span> IZERO,vector&lt;int&gt; vleft,vector&lt;int&gt; vright,</div><div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;                      vector&lt;int&gt; &amp;vl1trig) {</div><div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;</div><div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;  <span class="keywordflow">if</span> ((vleft[IZERO] &amp;&amp; findahit(vright,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP))) ||</div><div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;      </div><div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;      (vright[IZERO] &amp;&amp; findahit(vleft,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP)))) {</div><div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;    vl1trig.push_back(1);</div><div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;</div><div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;  }</div><div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    vl1trig.push_back(0);</div><div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;</div><div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;</div><div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;}</div><div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;<span class="comment">// L1 trigger is at the antenna level again.  Just require coincidence between LCP and RCP</span></div><div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L1Anita4LR_ScB_AllAntennas_OneBin(<span class="keywordtype">int</span> IZERO,Anita *anita1,std::array&lt; std::array&lt; vector&lt;int&gt;,16&gt;,3&gt; &amp;vl1trig_anita4lr_scb,<span class="keywordtype">int</span> &amp;npassesl1) {</div><div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160; </div><div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;</div><div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> itriglayer=0;itriglayer&lt;anita1-&gt;NTRIGGERLAYERS;itriglayer++) {</div><div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;</div><div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;      <span class="comment">//double time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;      <span class="comment">//int itrigbin=nstepback;</span></div><div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;      </div><div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;      <span class="comment">// i should really do this in a different step so this function has fewer inputs.</span></div><div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;      <span class="comment">//while (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {</span></div><div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;      L1Anita4LR_ScB_OneBin(IZERO,arrayofhits[itriglayer][iphi][0][4],arrayofhits[itriglayer][iphi][1][4],</div><div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;                vl1trig_anita4lr_scb[itriglayer][iphi]);</div><div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;      <span class="keywordflow">if</span> (vl1trig_anita4lr_scb[itriglayer][iphi][vl1trig_anita4lr_scb[itriglayer][iphi].size()-1])</div><div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    npassesl1++;</div><div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;</div><div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;      <span class="comment">//itrigbin++;</span></div><div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;      <span class="comment">//time_thisbin=(double)itrigbin*TRIGTIMESTEP;</span></div><div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;      <span class="comment">// } // loop over time steps</span></div><div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    } <span class="comment">// loop over phi sectors</span></div><div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;  } <span class="comment">// loop over trigger layers</span></div><div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;  </div><div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;</div><div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;</div><div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;}</div><div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;</div><div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;</div><div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;<span class="comment">// void GlobalTrigger::L3Anita4LR_ScB(Anita *anita1,std::array&lt;std::array&lt;vector&lt;int&gt;,3&gt;,16&gt; vl2_realtime_anita4_scb,</span></div><div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;<span class="comment">//                 std::array&lt;vector&lt;int&gt;,16&gt; &amp;vl3trig_type0, std::array&lt;vector&lt;int&gt;,16&gt; &amp;vl3trig_type1,</span></div><div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;<span class="comment">//                 int &amp;thispasses_l3type0,int &amp;thispasses_l3type1) {</span></div><div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;<span class="comment">//   thispasses_l3type0=0;</span></div><div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;<span class="comment">//   thispasses_l3type1=0;</span></div><div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;</div><div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;</div><div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;<span class="comment">//   for (int iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</span></div><div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;</div><div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;<span class="comment">//     vl3trig_type0[iphi].clear();</span></div><div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;<span class="comment">//     vl3trig_type1[iphi].clear();</span></div><div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;</div><div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;<span class="comment">//     int iphi_next=(iphi+1+16)%16;</span></div><div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;<span class="comment">//     int iphi_previous=(iphi-1+16)%16;</span></div><div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;</div><div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;<span class="comment">//     if (L3or30Anita4LR_ScB_TwoPhiSectors( </span></div><div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;<span class="comment">//                   vl2_realtime_anita4_scb[iphi], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;<span class="comment">//                   vl2_realtime_anita4_scb[iphi_previous], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;                     </div><div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;<span class="comment">//                   2,2,   </span></div><div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;<span class="comment">//                   vl3trig_type1[iphi] ))</span></div><div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;<span class="comment">//       thispasses_l3type1=1;</span></div><div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;</div><div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;<span class="comment">//     if (iphi%2==0) {</span></div><div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;<span class="comment">//       if (L3or30Anita4LR_ScB_TwoPhiSectors( </span></div><div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;<span class="comment">//                     vl2_realtime_anita4_scb[iphi], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;<span class="comment">//                     vl2_realtime_anita4_scb[iphi_previous], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;                       </div><div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;<span class="comment">//                     1,3, </span></div><div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;<span class="comment">//                     vl3trig_type0[iphi] ))</span></div><div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;<span class="comment">//  thispasses_l3type0=1;</span></div><div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        </div><div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;</div><div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;</div><div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;<span class="comment">//     }</span></div><div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;<span class="comment">//   }</span></div><div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;  </div><div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;</div><div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;<span class="comment">// }</span></div><div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;<span class="comment">// for each phi sector, does 1, 2 or 3 pass</span></div><div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;<span class="comment">// void GlobalTrigger::L2Anita4LR_ScB_AllPhiSectors(Anita *anita1,std::array&lt; std::array&lt; vector&lt;int&gt;,16&gt;,3&gt; vl1trig_anita4lr_scb,</span></div><div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;<span class="comment">//                       std::array&lt;std::array&lt;vector&lt;int&gt;,3&gt;,16&gt; &amp;vl2_realtime_anita4_scb) {</span></div><div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;</div><div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;<span class="comment">//   double time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;<span class="comment">//   int itrigbin=nstepback;</span></div><div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;</div><div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;<span class="comment">//   while (time_thisbin&lt;LASTTIMETOTESTL2_ANITA4LR_SCB) {</span></div><div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;</div><div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;<span class="comment">//       for (int iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</span></div><div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    </div><div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;<span class="comment">//  //      cout &lt;&lt; &quot;itriglayer, iphi are &quot; &lt;&lt; itriglayer &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;<span class="comment">//  int npassesl2=0;</span></div><div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;<span class="comment">//  int npassesl2type0=0;</span></div><div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;</div><div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;<span class="comment">//  L2Anita4LR_ScB_OnePhiSector_OneBin(itrigbin,vl1trig_anita4lr_scb[2][iphi], </span></div><div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;<span class="comment">//                     vl1trig_anita4lr_scb[1][iphi], </span></div><div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;<span class="comment">//                     vl1trig_anita4lr_scb[0][iphi],       </span></div><div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;<span class="comment">//                     vl2_realtime_anita4_scb[iphi],</span></div><div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;<span class="comment">//                     npassesl2,npassesl2type0);</span></div><div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;</div><div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    </div><div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;<span class="comment">//       }</span></div><div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;      </div><div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;    </div><div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;<span class="comment">//     itrigbin++;</span></div><div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;<span class="comment">//     time_thisbin=(double)itrigbin*TRIGTIMESTEP;</span></div><div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;<span class="comment">//   }</span></div><div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;</div><div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;</div><div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;<span class="comment">// }</span></div><div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;</div><div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;<span class="comment">// for each phi sector, does 1, 2 or 3 pass</span></div><div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L2Anita4LR_ScB_AllPhiSectors_OneBin(<span class="keywordtype">int</span> IZERO,Anita *anita1,std::array&lt; std::array&lt; vector&lt;int&gt;,16&gt;,3&gt; vl1trig_anita4lr_scb,</div><div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;                            std::array&lt;std::array&lt;vector&lt;int&gt;,3&gt;,16&gt; &amp;vl2_realtime_anita4_scb,<span class="keywordtype">int</span> &amp;npassesl2,<span class="keywordtype">int</span> &amp;npassesl2_type0) {</div><div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;</div><div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;      </div><div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="comment">//      cout &lt;&lt; &quot;itriglayer, iphi are &quot; &lt;&lt; itriglayer &lt;&lt; &quot;\t&quot; &lt;&lt; iphi &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;      </div><div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    L2Anita4LR_ScB_OnePhiSector_OneBin(IZERO,vl1trig_anita4lr_scb[2][iphi], </div><div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;                       vl1trig_anita4lr_scb[1][iphi], </div><div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;                       vl1trig_anita4lr_scb[0][iphi],       </div><div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;                       vl2_realtime_anita4_scb[iphi],npassesl2,npassesl2_type0);</div><div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;      </div><div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;      </div><div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;  }</div><div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;    </div><div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;  </div><div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;</div><div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;</div><div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;}</div><div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;</div><div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;<span class="comment">// ask if L3 type 1 (2 and 2) or L3 type 0 (3 and 1 or 1 and 3) passes</span></div><div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;<span class="comment">// int GlobalTrigger::L3or30Anita4LR_ScB_TwoPhiSectors(</span></div><div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;<span class="comment">//                          std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;<span class="comment">//                          std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb_other, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;<span class="comment">//                          int npass1,int npass2,  </span></div><div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;<span class="comment">//                          vector&lt;int&gt; &amp;vl3trig ) {</span></div><div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;</div><div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;  </div><div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;</div><div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;<span class="comment">//   int passaone=0;</span></div><div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;</div><div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;</div><div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;</div><div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;<span class="comment">//   int thispasses=0;</span></div><div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;</div><div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;  </div><div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;<span class="comment">//   if (L3or30Anita4LR_ScB_TwoPhiSectors_OneBin(itrigbin,</span></div><div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;<span class="comment">//                        vl2_realtime_anita4_scb, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;<span class="comment">//                        vl2_realtime_anita4_scb_other, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;<span class="comment">//                        npass1,npass2,    </span></div><div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;<span class="comment">//                        vl3trig )) {</span></div><div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    </div><div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;    </div><div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;<span class="comment">//     thispasses=1;</span></div><div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;<span class="comment">//     passaone=1;</span></div><div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;<span class="comment">//     //cout &lt;&lt; &quot;got an l3 with &quot; &lt;&lt; npass1 &lt;&lt; &quot; and &quot; &lt;&lt; npass2 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;<span class="comment">//   }</span></div><div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;<span class="comment">//   vl3trig.push_back(thispasses);</span></div><div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;  </div><div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;<span class="comment">//   return passaone;</span></div><div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;  </div><div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;<span class="comment">// }</span></div><div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;<span class="comment">// ask if L3 type 1 (2 and 2) or L3 type 0 (3 and 1 or 1 and 3) passes</span></div><div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;<span class="comment">// int GlobalTrigger::L3or30Anita4LR_ScB_TwoPhiSectors_OneBin( int IZERO,</span></div><div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;<span class="comment">//                          std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;<span class="comment">//                          std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb_other, // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">//                          int npass1,int npass2,  </span></div><div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;<span class="comment">//                          vector&lt;int&gt; &amp;vl3trig ) {</span></div><div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;</div><div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;  </div><div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;</div><div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;<span class="comment">//   int passaone=0;</span></div><div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;<span class="comment">//   //double time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;<span class="comment">//   //int itrigbin=nstepback;</span></div><div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;<span class="comment">//   int thispasses=0;</span></div><div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;<span class="comment">//   //while (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {   </span></div><div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;<span class="comment">//     thispasses=0;</span></div><div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;</div><div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;</div><div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;<span class="comment">//     if ((vl2_realtime_anita4_scb[npass1-1][IZERO] &amp;&amp;</span></div><div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;<span class="comment">//   findahit(vl2_realtime_anita4_scb_other[npass2-1],IZERO-nstepback,IZERO-nstepback+(int)(L3_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP)))   ||</span></div><div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;<span class="comment">//  (vl2_realtime_anita4_scb_other[npass2-1][IZERO] &amp;&amp;</span></div><div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;<span class="comment">//   findahit(vl2_realtime_anita4_scb[npass1-1],IZERO-nstepback,IZERO-nstepback+(int)(L3_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP)))) {</span></div><div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;<span class="comment">//       thispasses=1;</span></div><div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;<span class="comment">//       passaone=1;</span></div><div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;<span class="comment">//       //cout &lt;&lt; &quot;got an l3 with &quot; &lt;&lt; npass1 &lt;&lt; &quot; and &quot; &lt;&lt; npass2 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;<span class="comment">//     }</span></div><div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;<span class="comment">//     //    cout &lt;&lt; &quot;adding to vl3trig.\n&quot;;</span></div><div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;<span class="comment">//     vl3trig.push_back(thispasses);</span></div><div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160; </div><div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;<span class="comment">//     //itrigbin++;</span></div><div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;<span class="comment">//     //time_thisbin=(double)itrigbin*TRIGTIMESTEP;</span></div><div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;<span class="comment">//     //}</span></div><div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;<span class="comment">//   return passaone;</span></div><div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;  </div><div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;<span class="comment">// }</span></div><div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;</div><div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L3Anita4LR_ScA(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; vl2trig,</div><div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;                   <span class="keywordtype">int</span> *thispasses) {</div><div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;</div><div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;</div><div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;</div><div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;</div><div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;      </div><div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> ibin=0;ibin&lt;vl2trig[ipolar][iphi].size();ibin++) {</div><div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;</div><div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">if</span> (vl2trig[ipolar][iphi][ibin]) {</div><div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;</div><div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;      thispasses[ipolar]=1;</div><div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    }</div><div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;      }</div><div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;</div><div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;    </div><div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;    }</div><div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;</div><div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;  }</div><div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;</div><div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;}</div><div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L1Anita3_AllPhiSectors(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; &amp;vl1trig) {</div><div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;  vector&lt;int&gt; vl1_realtime_vbottom;</div><div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;  vector&lt;int&gt; vl1_realtime_vmiddle; </div><div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;  vector&lt;int&gt; vl1_realtime_vtop;</div><div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;  vector&lt;int&gt; vl1_realtime_hbottom;</div><div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;  vector&lt;int&gt; vl1_realtime_hmiddle; </div><div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;  vector&lt;int&gt; vl1_realtime_htop;</div><div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;  <span class="keywordtype">double</span> time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;  <span class="keywordtype">int</span> itrigbin=nstepback;</div><div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;phitrig is &quot; &lt;&lt; anita1-&gt;PHITRIG[0] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    itrigbin=nstepback;</div><div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;    time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA3) {</div><div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;</div><div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;      vl1trig[0][iphi].push_back(L1Anita3_OnePhiSector(itrigbin,arrayofhits[2][iphi][0][4], </div><div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;                               arrayofhits[1][iphi][0][4], </div><div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;                               arrayofhits[0][iphi][0][4],</div><div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                               vl1_realtime_vbottom, vl1_realtime_vmiddle, vl1_realtime_vtop));</div><div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;      vl1trig[1][iphi].push_back(L1Anita3_OnePhiSector(itrigbin,arrayofhits[2][iphi][1][4],</div><div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                               arrayofhits[1][iphi][1][4],</div><div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;                               arrayofhits[0][iphi][1][4],</div><div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                               vl1_realtime_hbottom, vl1_realtime_hmiddle, vl1_realtime_htop));</div><div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;      itrigbin++;</div><div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;      <span class="comment">//      if (vl1trig[0][iphi][vl1trig[0][iphi].size()-1]==1) {</span></div><div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;an l1.\n&quot;;</span></div><div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;iphi, bin is &quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; vl1trig[0][iphi].size()-1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;      <span class="comment">//       }</span></div><div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;      time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    }</div><div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;  }</div><div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;inside, vl1trig is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;}</div><div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L1Anita4_AllPhiSectors(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; &amp;vl1trig) {</div><div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;  vector&lt;int&gt; vl1_realtime_vbottom;</div><div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;  vector&lt;int&gt; vl1_realtime_vmiddle; </div><div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;  vector&lt;int&gt; vl1_realtime_vtop;</div><div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;  vector&lt;int&gt; vl1_realtime_hbottom;</div><div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;  vector&lt;int&gt; vl1_realtime_hmiddle; </div><div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;  vector&lt;int&gt; vl1_realtime_htop;</div><div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;  <span class="keywordtype">double</span> time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;  <span class="keywordtype">int</span> itrigbin=nstepback;</div><div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;phitrig is &quot; &lt;&lt; anita1-&gt;PHITRIG[0] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;    itrigbin=nstepback;</div><div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;    <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4) {</div><div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;iphi is &quot; &lt;&lt; iphi &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;      vl1trig[0][iphi].push_back(L1Anita4_OnePhiSector(itrigbin,arrayofhits[2][iphi][0][4], arrayofhits[1][iphi][0][4], arrayofhits[0][iphi][0][4],</div><div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;                               vl1_realtime_vbottom, vl1_realtime_vmiddle, vl1_realtime_vtop));</div><div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;      vl1trig[1][iphi].push_back(L1Anita4_OnePhiSector(itrigbin,arrayofhits[2][iphi][1][4], arrayofhits[1][iphi][1][4], arrayofhits[0][iphi][1][4],</div><div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;                               vl1_realtime_hbottom, vl1_realtime_hmiddle, vl1_realtime_htop));</div><div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;   </div><div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;      <span class="comment">//      if (vl1trig[0][iphi][vl1trig[0][iphi].size()-1]==1) {</span></div><div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;an l1.\n&quot;;</span></div><div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;iphi, bin is &quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; vl1trig[0][iphi].size()-1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;arrayofhits are \n&quot;;</span></div><div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;      <span class="comment">//    int istart=itrigbin-nstepback;</span></div><div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;      <span class="comment">//    int iend=itrigbin-nstepback+(int)(L1_COINCIDENCE_MOREGENERAL[0][1]/TRIGTIMESTEP)-1;</span></div><div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;istart, iend are &quot; &lt;&lt; istart &lt;&lt; &quot;\t&quot; &lt;&lt; iend &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;sizes are &quot; &lt;&lt; arrayofhits[0][iphi][0][4].size() &lt;&lt; &quot;\t&quot; &lt;&lt; arrayofhits[1][iphi][0][4].size() &lt;&lt; &quot;\t&quot; &lt;&lt; arrayofhits[2][iphi][0][4].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;top:\n&quot;;</span></div><div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;      <span class="comment">//    for (int i=istart;i&lt;=iend;i++) {</span></div><div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;      <span class="comment">//      cout &lt;&lt; arrayofhits[0][iphi][0][4][i] &lt;&lt; &quot;\t&quot;;</span></div><div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;      <span class="comment">//    }</span></div><div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;middle:\n&quot;;</span></div><div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;      <span class="comment">//    for (int i=istart;i&lt;=iend;i++) {</span></div><div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;      <span class="comment">//      cout &lt;&lt; arrayofhits[1][iphi][0][4][i] &lt;&lt; &quot;\t&quot;;</span></div><div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;      <span class="comment">//    }</span></div><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;bottom:\n&quot;;</span></div><div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;      <span class="comment">//    for (int i=istart;i&lt;=iend;i++) {</span></div><div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;      <span class="comment">//      cout &lt;&lt; arrayofhits[2][iphi][0][4][i] &lt;&lt; &quot;\t&quot;;</span></div><div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;      <span class="comment">//    }</span></div><div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;      <span class="comment">//    cout &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    </div><div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;      <span class="comment">//       }</span></div><div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;      itrigbin++;</div><div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;      time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    }</div><div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;  }</div><div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;inside, vl1trig is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;}</div><div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L1Anita4LR_ScA_AllPhiSectors(Anita *anita1,std::array&lt;std::array&lt;std::vector&lt;int&gt;,16&gt;,2&gt; &amp;vl1trig) {</div><div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;  vector&lt;int&gt; vl1_realtime_1bottom;</div><div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;  vector&lt;int&gt; vl1_realtime_1middle; </div><div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;  vector&lt;int&gt; vl1_realtime_1top;</div><div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;  vector&lt;int&gt; vl1_realtime_2bottom;</div><div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;  vector&lt;int&gt; vl1_realtime_2middle; </div><div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;  vector&lt;int&gt; vl1_realtime_2top;</div><div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;</div><div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;  <span class="keywordtype">double</span> time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;  <span class="keywordtype">int</span> itrigbin=nstepback;</div><div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;  <span class="keywordtype">int</span> taketheor=0; <span class="comment">// Take the &quot;or&quot; of the L1 with a phi sector and its neighbor to the left, and the L1 with a phi sector and its</span></div><div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;  <span class="comment">// neighbor to the right.</span></div><div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;phitrig is &quot; &lt;&lt; anita1-&gt;PHITRIG[0] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;    itrigbin=nstepback;</div><div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    time_thisbin=(double)nstepback*TRIGTIMESTEP;</div><div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    taketheor=0;</div><div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;    <span class="keywordtype">int</span> iphi_rightneighbor=(iphi+1+16)%16;</div><div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="keywordtype">int</span> iphi_leftneighbor=(iphi-1+16)%16;</div><div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <span class="keywordflow">while</span> (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCA) {</div><div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;      </div><div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;2;ipolar++) {</div><div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;</div><div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    <span class="keywordflow">if</span> (L1Anita4LR_ScA_TwoPhiSectors(itrigbin,ipolar,</div><div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;                     arrayofhits[2][iphi][0][4],arrayofhits[2][iphi][1][4], </div><div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;                     arrayofhits[2][iphi_rightneighbor][0][4],arrayofhits[2][iphi_rightneighbor][1][4], </div><div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;                     arrayofhits[1][iphi][0][4], arrayofhits[1][iphi][1][4], </div><div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;                     arrayofhits[1][iphi_rightneighbor][0][4], arrayofhits[1][iphi_rightneighbor][1][4], </div><div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;                     arrayofhits[0][iphi][0][4], arrayofhits[0][iphi][1][4], </div><div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;                     arrayofhits[0][iphi_rightneighbor][0][4],arrayofhits[0][iphi_rightneighbor][1][4], </div><div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;                     vl1_realtime_1bottom, vl1_realtime_1middle, vl1_realtime_1top) ||</div><div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;      </div><div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;        L1Anita4LR_ScA_TwoPhiSectors(itrigbin,ipolar,</div><div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                     arrayofhits[2][iphi][0][4],arrayofhits[2][iphi][1][4], </div><div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                     arrayofhits[2][iphi_leftneighbor][0][4],arrayofhits[2][iphi_leftneighbor][1][4], </div><div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                     arrayofhits[1][iphi][0][4], arrayofhits[1][iphi][1][4], </div><div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                     arrayofhits[1][iphi_leftneighbor][0][4], arrayofhits[1][iphi_leftneighbor][1][4], </div><div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                     arrayofhits[0][iphi][0][4], arrayofhits[0][iphi][1][4], </div><div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;                     arrayofhits[0][iphi_leftneighbor][0][4],arrayofhits[0][iphi_leftneighbor][1][4], </div><div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;                     vl1_realtime_2bottom, vl1_realtime_2middle, vl1_realtime_2top))</div><div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;      vl1trig[ipolar][iphi].push_back(1);</div><div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;      vl1trig[ipolar][iphi].push_back(0);</div><div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;</div><div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;      </div><div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="comment">//  if (iphi==13) {</span></div><div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;itrigbin is &quot; &lt;&lt; itrigbin &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="comment">// cout &lt;&lt; &quot;first one is &quot; &lt;&lt; L1Anita4LR_ScA_TwoPhiSectors(iphi,itrigbin,ipolar,</span></div><div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="comment">//                     arrayofhits[2][iphi][0][4],arrayofhits[2][iphi][1][4], </span></div><div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    <span class="comment">//                     arrayofhits[2][iphi_rightneighbor][0][4],arrayofhits[2][iphi_rightneighbor][1][4], </span></div><div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;    <span class="comment">//                     arrayofhits[1][iphi][0][4], arrayofhits[1][iphi][1][4], </span></div><div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;    <span class="comment">//                     arrayofhits[1][iphi_rightneighbor][0][4], arrayofhits[1][iphi_rightneighbor][1][4], </span></div><div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <span class="comment">//                     arrayofhits[0][iphi][0][4], arrayofhits[0][iphi][1][4], </span></div><div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;    <span class="comment">//                     arrayofhits[0][iphi_rightneighbor][0][4],arrayofhits[0][iphi_rightneighbor][1][4], </span></div><div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <span class="comment">//                                vl1_realtime_1bottom, vl1_realtime_1middle, vl1_realtime_1top) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;second one is &quot; &lt;&lt; L1Anita4LR_ScA_TwoPhiSectors(iphi,itrigbin,ipolar,</span></div><div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="comment">//                     arrayofhits[2][iphi][0][4],arrayofhits[2][iphi][1][4], </span></div><div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    <span class="comment">//                     arrayofhits[2][iphi_leftneighbor][0][4],arrayofhits[2][iphi_leftneighbor][1][4], </span></div><div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="comment">//                     arrayofhits[1][iphi][0][4], arrayofhits[1][iphi][1][4], </span></div><div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <span class="comment">//                     arrayofhits[1][iphi_leftneighbor][0][4], arrayofhits[1][iphi_leftneighbor][1][4], </span></div><div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    <span class="comment">//                     arrayofhits[0][iphi][0][4], arrayofhits[0][iphi][1][4], </span></div><div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="comment">//                     arrayofhits[0][iphi_leftneighbor][0][4],arrayofhits[0][iphi_leftneighbor][1][4], </span></div><div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <span class="comment">//                                 vl1_realtime_2bottom, vl1_realtime_2middle, vl1_realtime_2top) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;</div><div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;ipolar, iphi, taketheor are &quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; iphi  &lt;&lt; &quot;\t&quot; &lt;&lt; vl1trig[ipolar][iphi][itrigbin] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;</div><div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;    <span class="comment">//  }</span></div><div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;</div><div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;      }</div><div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;</div><div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;      itrigbin++;</div><div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;      time_thisbin=(double)itrigbin*TRIGTIMESTEP;</div><div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    }</div><div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;  }</div><div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;inside, vl1trig is &quot; &lt;&lt; vl1trig[0][0].size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;}</div><div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;</div><div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;</div><div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::L1Anita3_OnePhiSector(<span class="keywordtype">int</span> IZERO,vector&lt;int&gt; &amp;vl0_realtime_bottom, vector&lt;int&gt; &amp;vl0_realtime_middle, vector&lt;int&gt; &amp;vl0_realtime_top,</div><div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;                     vector&lt;int&gt; &amp;vl1_realtime_bottom, vector&lt;int&gt; &amp;vl1_realtime_middle, vector&lt;int&gt; &amp;vl1_realtime_top) {</div><div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;</div><div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;</div><div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;</div><div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;  <span class="comment">// ask if L1 trigger passes</span></div><div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;  <span class="comment">// Patrick says &quot;check every 2 ns for 4 ns back and start 4 ns gate, or 12 ns, or 16 ns.&quot;</span></div><div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_bottom[IZERO]==1) {</div><div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;</div><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;findahit from &quot; &lt;&lt; IZERO-nstepback &lt;&lt; &quot; to &quot; &lt;&lt; IZERO-nstepback+(int)(L1_COINCIDENCE[0]/TRIGTIMESTEP)-1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[0]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    findahit(vl0_realtime_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[0]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;</div><div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;</div><div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;      vl1_realtime_bottom.push_back(1);</div><div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;      <span class="comment">// cout &lt;&lt; &quot;got an l1 here. vl1_realtime_bottom.size() is &quot; &lt;&lt; vl1_realtime_bottom.size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;</div><div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    }</div><div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;      vl1_realtime_bottom.push_back(0);</div><div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;</div><div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;  }</div><div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;    vl1_realtime_bottom.push_back(0);</div><div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;           </div><div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;  }</div><div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;     </div><div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_middle[IZERO]==1) {</div><div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[1]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    findahit(vl0_realtime_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[1]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;     </div><div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;      vl1_realtime_middle.push_back(1);</div><div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;     </div><div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    }</div><div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;      vl1_realtime_middle.push_back(0);</div><div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;</div><div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;  }</div><div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    vl1_realtime_middle.push_back(0);</div><div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;           </div><div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;  }</div><div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;  <span class="comment">//     if (vl1_realtime_bottom[vl1_realtime_bottom.size()-1])</span></div><div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;the bottom bit is &quot; &lt;&lt; vl1_realtime_bottom[vl1_realtime_bottom.size()-1] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_top[IZERO]==1) {</div><div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[2]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;    findahit(vl0_realtime_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_ANITA3[2]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;     </div><div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;      vl1_realtime_top.push_back(1);</div><div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;     </div><div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    }</div><div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;      vl1_realtime_top.push_back(0);</div><div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;</div><div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;  }</div><div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    vl1_realtime_top.push_back(0);</div><div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;           </div><div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;  }</div><div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;     </div><div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;  <span class="keywordflow">if</span> (vl1_realtime_bottom[vl1_realtime_bottom.size()-1]==1 || vl1_realtime_top[vl1_realtime_top.size()-1]==1 || vl1_realtime_middle[vl1_realtime_middle.size()-1]==1) {</div><div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;actually got an l1.\n&quot;;</span></div><div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;</div><div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;  }</div><div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;}</div><div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::L1Anita4_OnePhiSector(<span class="keywordtype">int</span> IZERO,vector&lt;int&gt; &amp;vl0_realtime_bottom, vector&lt;int&gt; &amp;vl0_realtime_middle, vector&lt;int&gt; &amp;vl0_realtime_top,</div><div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                     vector&lt;int&gt; &amp;vl1_realtime_bottom, vector&lt;int&gt; &amp;vl1_realtime_middle, vector&lt;int&gt; &amp;vl1_realtime_top) {</div><div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;</div><div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;</div><div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;</div><div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;  <span class="comment">// ask if L1 trigger passes</span></div><div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;  <span class="comment">// Patrick says &quot;check every 2 ns for 4 ns back and start 4 ns gate, or 12 ns, or 16 ns.&quot;</span></div><div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_bottom[IZERO]==1) {</div><div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;findahit from &quot; &lt;&lt; IZERO-nstepback &lt;&lt; &quot; to &quot; &lt;&lt; IZERO-nstepback+(int)(L1_COINCIDENCE[0]/TRIGTIMESTEP)-1 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[0][0]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;    findahit(vl0_realtime_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[0][1]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;     </div><div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;      vl1_realtime_bottom.push_back(1);</div><div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;     </div><div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    }</div><div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;      vl1_realtime_bottom.push_back(0);</div><div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;</div><div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;  }</div><div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;    vl1_realtime_bottom.push_back(0);</div><div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;           </div><div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;  }</div><div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;</div><div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_middle[IZERO]==1) {</div><div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[1][0]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;    findahit(vl0_realtime_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[1][1]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;     </div><div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;      vl1_realtime_middle.push_back(1);</div><div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;     </div><div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;    }</div><div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;      vl1_realtime_middle.push_back(0);</div><div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;</div><div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;  }</div><div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    vl1_realtime_middle.push_back(0);</div><div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;           </div><div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;  }</div><div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;</div><div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;  <span class="keywordflow">if</span> (vl0_realtime_top[IZERO]==1) {</div><div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <span class="keywordflow">if</span> (findahit(vl0_realtime_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[2][0]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    findahit(vl0_realtime_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_MOREGENERAL[2][1]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;     </div><div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;      vl1_realtime_top.push_back(1);</div><div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;     </div><div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    }</div><div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;      vl1_realtime_top.push_back(0);</div><div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;</div><div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;  }</div><div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;    vl1_realtime_top.push_back(0);</div><div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;           </div><div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;  }</div><div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;</div><div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;  <span class="keywordflow">if</span> (vl1_realtime_bottom[vl1_realtime_bottom.size()-1]==1 || vl1_realtime_top[vl1_realtime_top.size()-1]==1 || vl1_realtime_middle[vl1_realtime_middle.size()-1]==1) </div><div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;}</div><div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::L1Anita4LR_ScA_TwoPhiSectors(<span class="keywordtype">int</span> IZERO,<span class="keywordtype">int</span> ipolar,</div><div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_bottomleft, vector&lt;int&gt; &amp;v2l0_realtime_bottomleft, </div><div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_bottomright, vector&lt;int&gt; &amp;v2l0_realtime_bottomright, </div><div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_middleleft, vector&lt;int&gt; &amp;v2l0_realtime_middleleft,</div><div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_middleright, vector&lt;int&gt; &amp;v2l0_realtime_middleright,</div><div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_topleft, vector&lt;int&gt; &amp;v2l0_realtime_topleft,</div><div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                        vector&lt;int&gt; &amp;v1l0_realtime_topright, vector&lt;int&gt; &amp;v2l0_realtime_topright,</div><div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                        vector&lt;int&gt; &amp;vl1_realtime_bottom, </div><div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                        vector&lt;int&gt; &amp;vl1_realtime_middle, </div><div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                        vector&lt;int&gt; &amp;vl1_realtime_top) {</div><div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;</div><div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;  </div><div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;  <span class="comment">//if (IZERO&gt;=42 &amp;&amp; IZERO&lt;=44 &amp;&amp; iphi==13)</span></div><div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;inside _TwoPhiSectors. IZERO, ipolar are &quot; &lt;&lt;  IZERO &lt;&lt; &quot;\t&quot; &lt;&lt; ipolar &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;</div><div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;  vector&lt;int&gt; vleft;</div><div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;  vector&lt;int&gt; vright;</div><div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;  <span class="keywordflow">if</span> (ipolar==0) {</div><div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;    vleft=v1l0_realtime_bottomleft;</div><div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;    vright=v1l0_realtime_bottomright;</div><div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;  }</div><div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ipolar==1) {</div><div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;    vleft=v2l0_realtime_bottomleft;</div><div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    vright=v2l0_realtime_bottomright;</div><div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;  }</div><div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;</div><div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;  <span class="keywordflow">if</span> (vleft[IZERO]==1 || vright[IZERO]==1) {</div><div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;    <span class="comment">//   if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44 &amp;&amp; iphi==13)</span></div><div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;got a bottom trigger.  iphi, izero, ipolar is &quot; &lt;&lt; iphi &lt;&lt; &quot;\t&quot; &lt;&lt; IZERO &lt;&lt; &quot;\t&quot; &lt;&lt; ipolar &lt;&lt; &quot;\t&quot; &lt;&lt; vleft[IZERO] &lt;&lt; &quot;\t&quot; &lt;&lt; vright[IZERO] &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    <span class="keywordflow">if</span> (PartofL1Anita4LR_ScA_TwoPhiSectors(1,ipolar,IZERO,v1l0_realtime_middleleft, v2l0_realtime_middleleft,</div><div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                       v1l0_realtime_middleright, v2l0_realtime_middleright,</div><div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                       vl1_realtime_middle) &amp;&amp;</div><div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;    PartofL1Anita4LR_ScA_TwoPhiSectors(0,ipolar,IZERO,v1l0_realtime_topleft, v2l0_realtime_topleft,</div><div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                       v1l0_realtime_topright, v2l0_realtime_topright,</div><div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                       vl1_realtime_top)) {</div><div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;      <span class="comment">//if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44 &amp;&amp; iphi==13)</span></div><div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;other two layers triggered too.\n&quot;;</span></div><div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;      <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;    }</div><div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="keywordflow">else</span> {</div><div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;      <span class="comment">//       if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44 &amp;&amp; iphi==13) {</span></div><div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;      <span class="comment">//       cout &lt;&lt; &quot;middle is &quot; &lt;&lt; PartofL1Anita4LR_TwoPhiSectors(iphi,1,ipolar,IZERO,v1l0_realtime_middleleft, v2l0_realtime_middleleft,</span></div><div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;      <span class="comment">//                       v1l0_realtime_middleright, v2l0_realtime_middleright,</span></div><div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;      <span class="comment">//                                 vl1_realtime_middle) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;      <span class="comment">//       cout &lt;&lt; &quot;top is &quot; &lt;&lt; PartofL1Anita4LR_TwoPhiSectors(iphi,0,ipolar,IZERO,v1l0_realtime_topleft, v2l0_realtime_topleft,</span></div><div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;      <span class="comment">//                       v1l0_realtime_topright, v2l0_realtime_topright,</span></div><div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;      <span class="comment">//                              vl1_realtime_top) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;      <span class="comment">//       cout &lt;&lt; &quot;other two layers did not trigger.\n&quot;;</span></div><div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;      <span class="comment">//       }</span></div><div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    }</div><div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;  }</div><div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;</div><div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;</div><div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;}</div><div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;  </div><div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;</div><div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;</div><div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::PartofL1Anita4LR_ScA_TwoPhiSectors(<span class="keywordtype">int</span> ilayerreverse,<span class="keywordtype">int</span> ipolar,<span class="keywordtype">int</span> IZERO,</div><div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                              vector&lt;int&gt; &amp;v1l0_realtime_left, vector&lt;int&gt; &amp;v2l0_realtime_left, </div><div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                              vector&lt;int&gt; &amp;v1l0_realtime_right, vector&lt;int&gt; &amp;v2l0_realtime_right, </div><div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                              vector&lt;int&gt; &amp;vl1_realtime) {</div><div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    </div><div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;  <span class="comment">//  if (iphi==13)</span></div><div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;ilayerreverse is &quot; &lt;&lt; ilayerreverse &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;  <span class="keywordflow">if</span> (WHICHLAYERSLCPRCP[ilayerreverse]==0) {</div><div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    </div><div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    vector&lt;int&gt; vleft;</div><div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    vector&lt;int&gt; vright;</div><div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;</div><div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;    <span class="keywordflow">if</span> (ipolar==0) {</div><div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;      vleft=v1l0_realtime_left;</div><div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;      vright=v1l0_realtime_right;</div><div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;    }</div><div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ipolar==1) {</div><div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;      vleft=v2l0_realtime_left;</div><div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;      vright=v2l0_realtime_right;</div><div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;</div><div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;    }</div><div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;</div><div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    <span class="comment">//    if (iphi==13 &amp;&amp; IZERO&gt;=40 &amp;&amp; IZERO&lt;=44) {</span></div><div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="comment">//       cout &lt;&lt; &quot;start, stop are &quot; &lt;&lt; IZERO-nstepback &lt;&lt; &quot;\t&quot; &lt;&lt; IZERO-nstepback+(int)(L1_COINCIDENCE_LR[ilayerreverse]/TRIGTIMESTEP) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="comment">//       cout &lt;&lt; &quot;vleft is  &quot;;</span></div><div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    <span class="comment">//       for (int i=IZERO-nstepback ;i&lt;=IZERO-nstepback+(int)(L1_COINCIDENCE_LR[ilayerreverse]/TRIGTIMESTEP);i++) {</span></div><div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;    <span class="comment">//  cout &lt;&lt; vleft[i] &lt;&lt; &quot; &quot;;</span></div><div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    <span class="comment">//       }</span></div><div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;    <span class="comment">//       cout &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <span class="comment">//      cout &lt;&lt; &quot;vright is  &quot;;</span></div><div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="comment">//       for (int i=IZERO-nstepback ;i&lt;=IZERO-nstepback+(int)(L1_COINCIDENCE_LR[ilayerreverse]/TRIGTIMESTEP);i++) {</span></div><div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <span class="comment">//  cout &lt;&lt; vright[i] &lt;&lt; &quot; &quot;;</span></div><div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    <span class="comment">//       }</span></div><div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="comment">//       cout &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="comment">// //       cout &lt;&lt; vleft[i] &lt;&lt; &quot; &quot;;</span></div><div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;    <span class="comment">// //       cout &lt;&lt; &quot;left findahit is &quot; &lt;&lt; findahit(vleft,IZERO-nstepback,IZERO-nstepback+(int)(L1_COINCIDENCE_LR[ilayerreverse]/TRIGTIMESTEP)) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    <span class="comment">// //       cout &lt;&lt; &quot;right findahit is &quot; &lt;&lt; findahit(vleft,IZERO-nstepback,IZERO-nstepback+(int)(L1_COINCIDENCE_LR[ilayerreverse]/TRIGTIMESTEP)) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;    <span class="comment">//     }</span></div><div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="keywordflow">if</span> (findahit(vleft,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;    findahit(vright,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP))) {</div><div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;      </div><div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;      vl1_realtime.push_back(1);</div><div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;      <span class="comment">//      if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44)</span></div><div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;same pol is triggered in &quot; &lt;&lt; ipolar &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    }</div><div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;      vl1_realtime.push_back(0);</div><div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;  }</div><div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;  <span class="keywordflow">else</span> {</div><div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    <span class="keywordflow">if</span> ( (findahit(v1l0_realtime_left,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP)) &amp;&amp;</div><div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;      findahit(v2l0_realtime_left,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP))) ||</div><div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;     (findahit(v1l0_realtime_right,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP)) &amp;&amp;</div><div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;      findahit(v2l0_realtime_right,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L1_COINCIDENCE_LR_SCA[ilayerreverse]/TRIGTIMESTEP))) ) {</div><div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;      vl1_realtime.push_back(1);</div><div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;      <span class="comment">//if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44)</span></div><div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;      <span class="comment">//cout &lt;&lt; &quot;lcp rcp is triggered in &quot; &lt;&lt; ipolar &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;</div><div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    }</div><div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;      vl1_realtime.push_back(0);</div><div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;</div><div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;  }</div><div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;  <span class="keywordflow">if</span> (vl1_realtime[vl1_realtime.size()-1]) {</div><div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;    <span class="comment">//if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44)</span></div><div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;IZERO, ilayerreverse are &quot; &lt;&lt; IZERO &lt;&lt; &quot;\t&quot; &lt;&lt; ilayerreverse &lt;&lt; &quot; got a 1.\n&quot;;</span></div><div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;    <span class="keywordflow">return</span> 1;</div><div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;  }</div><div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;  <span class="comment">//  if (IZERO&gt;=40 &amp;&amp; IZERO&lt;=44)</span></div><div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;returning zero.  IZERO, ilayerreverse are &quot; &lt;&lt; IZERO &lt;&lt; &quot;\t&quot; &lt;&lt; ilayerreverse &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;</div><div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;  <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;</div><div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;}</div><div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L3Anita4LR_ScB_OneBin(<span class="keywordtype">int</span> IZERO,Anita *anita1,std::array&lt;std::array&lt;vector&lt;int&gt;,3&gt;,16&gt; vl2_realtime_anita4_scb,</div><div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;                      std::array&lt;vector&lt;int&gt;,16&gt; &amp;vl3trig_type0, std::array&lt;vector&lt;int&gt;,16&gt; &amp;vl3trig_type1,</div><div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;                      <span class="keywordtype">int</span> &amp;thispasses_l3type0,<span class="keywordtype">int</span> &amp;thispasses_l3type1) {</div><div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;</div><div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;</div><div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;</div><div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;</div><div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;</div><div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="keywordtype">int</span> iphi_next=(iphi+1+16)%16;</div><div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordtype">int</span> iphi_previous=(iphi-1+16)%16;</div><div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;</div><div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;iphi is &quot; &lt;&lt; iphi &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;    <span class="comment">//    cout &lt;&lt; &quot;calling the first l3.\n&quot;;</span></div><div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;    <span class="keywordflow">if</span> (L3or30Anita4LR_ScB_TwoPhiSectors_OneBin(IZERO, </div><div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                        vl2_realtime_anita4_scb[iphi], <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                        vl2_realtime_anita4_scb[iphi_previous], <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                     </div><div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                        2,2) ||</div><div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;    L3or30Anita4LR_ScB_TwoPhiSectors_OneBin(IZERO, </div><div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;                        vl2_realtime_anita4_scb[iphi], <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;                        vl2_realtime_anita4_scb[iphi_next], <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;                        </div><div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;                        2,2)</div><div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;</div><div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    ) {</div><div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;</div><div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;      thispasses_l3type1=1;</div><div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;      vl3trig_type1[iphi].push_back(1);</div><div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;</div><div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;    }</div><div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;      vl3trig_type1[iphi].push_back(0);</div><div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;</div><div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;    <span class="comment">// //cout &lt;&lt; &quot;calling the second l3.\n&quot;;</span></div><div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="comment">// if ((iphi%2==0 &amp;&amp; L3or30Anita4LR_ScB_TwoPhiSectors_OneBin( IZERO,</span></div><div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;    <span class="comment">//                                 vl2_realtime_anita4_scb[iphi], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    <span class="comment">//                                 vl2_realtime_anita4_scb[iphi_next], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;                                  </div><div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="comment">//                                 1,3)   </span></div><div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;    <span class="comment">//   ) ||</span></div><div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;    <span class="comment">//  (</span></div><div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;    <span class="comment">//   iphi%2==1 &amp;&amp; L3or30Anita4LR_ScB_TwoPhiSectors_OneBin( IZERO,</span></div><div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;    <span class="comment">//                                 vl2_realtime_anita4_scb[iphi], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;    <span class="comment">//                                 vl2_realtime_anita4_scb[iphi_previous], // 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                                   </div><div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;    <span class="comment">//                                 1,3)</span></div><div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;</div><div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;    <span class="comment">//   )) {</span></div><div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;    <span class="comment">//   thispasses_l3type0=1;</span></div><div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;    <span class="comment">//   vl3trig_type0[iphi].push_back(1);</span></div><div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;      </div><div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;    <span class="comment">// }</span></div><div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;</div><div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;</div><div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;</div><div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    <span class="comment">// else</span></div><div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="comment">//   vl3trig_type0[iphi].push_back(0);</span></div><div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;  }</div><div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;</div><div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;}</div><div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;</div><div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;</div><div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::L2Anita4LR_ScB_OnePhiSector_OneBin(<span class="keywordtype">int</span> IZERO,vector&lt;int&gt; vl1_bottom, </div><div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;                               vector&lt;int&gt; vl1_middle,</div><div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                               vector&lt;int&gt; vl1_top,</div><div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                               std::array&lt;vector&lt;int&gt;,3&gt; &amp;vl2_realtime_anita4_scb,<span class="keywordtype">int</span> &amp;npassesl2,<span class="keywordtype">int</span> &amp;npassesl2_type0) {</div><div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;  <span class="comment">// keep track of whether you get a coincidence between 1, 2 or 3 antennas in a phi sector with the right windows.</span></div><div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;  </div><div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;</div><div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160; </div><div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;  <span class="comment">// If any of them pass l1, then the 0th element of the vpartofl2_realtime_anita4_scb array goes to one.</span></div><div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;doing the one-hits.\n&quot;;</span></div><div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;  </div><div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;</div><div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;  <span class="keywordflow">if</span> (vl1_bottom[IZERO] || vl1_middle[IZERO] || vl1_top[IZERO]) {</div><div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;    vl2_realtime_anita4_scb[0].push_back(1);</div><div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;got a one-hit.\n&quot;;</span></div><div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;  }</div><div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;    vl2_realtime_anita4_scb[0].push_back(0);</div><div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;  </div><div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;doing the two-hits.\n&quot;;</span></div><div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;  <span class="comment">// If you get a coincidence betw. any two, then the 1st element of the vl2_realtime_anita4_scb array goes to one.</span></div><div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;  <span class="comment">//double time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;  <span class="comment">//int itrigbin=nstepback;</span></div><div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;</div><div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;  <span class="comment">//  cout &lt;&lt; &quot;sizes are &quot; &lt;&lt; vl1_bottom.size() &lt;&lt; &quot;\t&quot; &lt;&lt; vl1_middle.size() &lt;&lt; &quot;\t&quot; &lt;&lt; vl1_top.size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160; </div><div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;</div><div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;  <span class="comment">//  while (time_thisbin&lt;LASTTIMETOTESTL2_ANITA4LR_SCB) {</span></div><div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;</div><div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;</div><div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;  <span class="keywordflow">if</span> ((vl1_bottom[IZERO] &amp;&amp;</div><div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;       (    findahit(vl1_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[1]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        findahit(vl1_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[0]/TRIGTIMESTEP)) )) ||</div><div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;    </div><div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;      (vl1_middle[IZERO] &amp;&amp;</div><div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;       (    findahit(vl1_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[1]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;        findahit(vl1_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[2]/TRIGTIMESTEP)))) ||</div><div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;    </div><div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;      (vl1_top[IZERO] &amp;&amp;</div><div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;       (    findahit(vl1_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[0]/TRIGTIMESTEP)) ||</div><div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;        findahit(vl1_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[2]/TRIGTIMESTEP))))</div><div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;      ) {</div><div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;    vl2_realtime_anita4_scb[1].push_back(1);</div><div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    npassesl2++;</div><div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <span class="comment">//      cout &lt;&lt; &quot;start, stop bins  are &quot; &lt;&lt; IZERO-nstepback &lt;&lt; &quot;\t&quot; &lt;&lt; IZERO-nstepback+(int)(L2_COINCIDENCE_ANITA4LR_SCB[1]/TRIGTIMESTEP) &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;sizes are &quot; &lt;&lt; vl1_bottom.size() &lt;&lt; &quot;\t&quot; &lt;&lt; vl1_middle.size() &lt;&lt; &quot;\t&quot; &lt;&lt; vl1_top.size() &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;got a two-hit.\n&quot;;</span></div><div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;  }</div><div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;    vl2_realtime_anita4_scb[1].push_back(0);</div><div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;  <span class="comment">//itrigbin++;</span></div><div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;  <span class="comment">//time_thisbin=(double)itrigbin*TRIGTIMESTEP;</span></div><div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;  <span class="comment">//}</span></div><div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;</div><div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;  <span class="comment">//cout &lt;&lt; &quot;doing the three-hits.\n&quot;;</span></div><div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;  <span class="comment">// If you get a coincidence betw. all three, then the 2nd element of the vl2_realtime_anita4_scb array goes to one.</span></div><div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;  <span class="comment">//time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;  <span class="comment">//IZERO=nstepback;</span></div><div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;</div><div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;  <span class="comment">//  while (time_thisbin&lt;LASTTIMETOTESTL2_ANITA4LR_SCB) {</span></div><div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;</div><div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;  <span class="keywordflow">if</span> ((vl1_bottom[IZERO] &amp;&amp;</div><div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;       (    findahit(vl1_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[1]/TRIGTIMESTEP)) &amp;&amp;</div><div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;        findahit(vl1_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[0]/TRIGTIMESTEP)) )) ||</div><div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    </div><div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;      (vl1_middle[IZERO] &amp;&amp;</div><div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;       (    findahit(vl1_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[1]/TRIGTIMESTEP)) &amp;&amp;</div><div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;        findahit(vl1_top,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[2]/TRIGTIMESTEP)))) ||</div><div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;    </div><div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;      (vl1_top[IZERO] &amp;&amp;</div><div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;       (    findahit(vl1_bottom,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[0]/TRIGTIMESTEP)) &amp;&amp;</div><div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        findahit(vl1_middle,IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L2_COINCIDENCE_ANITA4LR_SCB[2]/TRIGTIMESTEP))))</div><div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;      ) {</div><div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    vl2_realtime_anita4_scb[2].push_back(1);</div><div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;    npassesl2_type0++;</div><div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;  }</div><div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    vl2_realtime_anita4_scb[2].push_back(0);</div><div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;  <span class="comment">//itrigbin++;</span></div><div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;  <span class="comment">//time_thisbin=(double)itrigbin*TRIGTIMESTEP;</span></div><div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;  <span class="comment">//}  </span></div><div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;}</div><div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;<span class="comment">// ask if L3 type 1 (2 and 2) or L3 type 0 (3 and 1 or 1 and 3) passes</span></div><div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="keywordtype">int</span> GlobalTrigger::L3or30Anita4LR_ScB_TwoPhiSectors_OneBin( <span class="keywordtype">int</span> IZERO,</div><div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;                                std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb, <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;                                std::array&lt;vector&lt;int&gt;,3&gt; vl2_realtime_anita4_scb_other, <span class="comment">// 3 neighbors, whether 1, 2 or 3 pass</span></div><div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                                <span class="keywordtype">int</span> npass1,<span class="keywordtype">int</span> npass2) {</div><div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;</div><div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;  </div><div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;</div><div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;  <span class="keywordtype">int</span> passaone=0;</div><div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;  <span class="comment">//double time_thisbin=(double)nstepback*TRIGTIMESTEP;</span></div><div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;  <span class="comment">//int itrigbin=nstepback;</span></div><div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;  <span class="keywordtype">int</span> thispasses=0;</div><div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;  <span class="comment">//while (time_thisbin&lt;LASTTIMETOTESTL1_ANITA4LR_SCB) {   </span></div><div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;  thispasses=0;</div><div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;</div><div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;</div><div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;  <span class="keywordflow">if</span> ((vl2_realtime_anita4_scb[npass1-1][IZERO] &amp;&amp;</div><div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;       findahit(vl2_realtime_anita4_scb_other[npass2-1],IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L3_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP)))   ||</div><div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;      (vl2_realtime_anita4_scb_other[npass2-1][IZERO] &amp;&amp;</div><div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;       findahit(vl2_realtime_anita4_scb[npass1-1],IZERO-nstepback,IZERO-nstepback+(<span class="keywordtype">int</span>)(L3_COINCIDENCE_ANITA4LR_SCB/TRIGTIMESTEP)))) {</div><div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;    thispasses=1;</div><div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    passaone=1;</div><div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;    <span class="comment">//cout &lt;&lt; &quot;got an l3 with &quot; &lt;&lt; npass1 &lt;&lt; &quot; and &quot; &lt;&lt; npass2 &lt;&lt; &quot;\n&quot;;</span></div><div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;  }</div><div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;</div><div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;  <span class="keywordflow">return</span> passaone;</div><div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;  </div><div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;}</div><div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;</div><div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::delayL0(vector&lt;int&gt; &amp;vl0,<span class="keywordtype">double</span> delay) {</div><div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;  <span class="keywordtype">int</span> ndelay=(int)(delay/TRIGTIMESTEP);</div><div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;ndelay;i++) {</div><div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    vl0.insert(vl0.begin(),0);</div><div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;    vl0.erase(vl0.end()-1);</div><div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;  }</div><div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;  </div><div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;}</div><div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;<span class="keywordtype">void</span> GlobalTrigger::delay_AllAntennas(Anita *anita1) {</div><div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">int</span> itriglayer=0;itriglayer&lt;anita1-&gt;NTRIGGERLAYERS;itriglayer++) {</div><div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> iphi=0;iphi&lt;anita1-&gt;PHITRIG[0];iphi++) {</div><div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">int</span> ipolar=0;ipolar&lt;anita1-&gt;NPOL;ipolar++) {</div><div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;     </div><div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;      </div><div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    delayL0(arrayofhits[itriglayer][iphi][ipolar][4],DELAYS[itriglayer]);</div><div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;      }</div><div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    }</div><div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;  }</div><div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;</div><div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;</div><div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;</div><div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;}</div><div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;</div><div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;</div><div class="ttc" id="class_global_trigger_html_ad9a6e5103964af4c4e78f934304def57"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#ad9a6e5103964af4c4e78f934304def57">GlobalTrigger::PassesTrigger</a></div><div class="ttdeci">void PassesTrigger(Settings *settings1, Anita *anita1, int discones_passing, int mode, int *l3trig, int l2trig[Anita::NPOL][Anita::NTRIGGERLAYERS_MAX], int l1trig[Anita::NPOL][Anita::NTRIGGERLAYERS_MAX], int antennaclump, int loctrig[Anita::NPOL][Anita::NLAYERS_MAX][Anita::NPHI_MAX], int loctrig_nadironly[Anita::NPOL][Anita::NPHI_MAX], int inu, int *thispasses, bool noiseOnly=false)</div><div class="ttdoc">Evaluate the full trigger simulation for a given payload configuration. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l00211">GlobalTrigger.cc:211</a></div></div>
<div class="ttc" id="class_global_trigger_html_a9d27c09a9a6363f4f37dc4cb4f21cf3e"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a9d27c09a9a6363f4f37dc4cb4f21cf3e">GlobalTrigger::L3Trigger</a></div><div class="ttdeci">void L3Trigger(Settings *settings1, Anita *anita1, int loctrig[Anita::NPOL][Anita::NLAYERS_MAX][Anita::NPHI_MAX], int loctrig_nadironly[Anita::NPOL][Anita::NPHI_MAX], int discones_passing, int *l3trigy, int *thispasses)</div><div class="ttdoc">Level 3 Trigger Function. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01540">GlobalTrigger.cc:1540</a></div></div>
<div class="ttc" id="class_anita_html_a1c7ef28c5f83fa1e858a7d7bb64d666a"><div class="ttname"><a href="../../df/da2/class_anita.html#a1c7ef28c5f83fa1e858a7d7bb64d666a">Anita::NPOL</a></div><div class="ttdeci">static const int NPOL</div><div class="ttdoc">number of polarizations </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00051">anita.hh:51</a></div></div>
<div class="ttc" id="class_global_trigger_html_a6bde1c1fb756b5a0ba4eea731d5bafc5"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a6bde1c1fb756b5a0ba4eea731d5bafc5">GlobalTrigger::square_waveform_elements</a></div><div class="ttdeci">void square_waveform_elements(const vector&lt; double &gt; &amp;waveform, vector&lt; double &gt; &amp;output)</div><div class="ttdoc">Performs an element-wise squaring of the values of the input array. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01778">GlobalTrigger.cc:1778</a></div></div>
<div class="ttc" id="class_settings_html"><div class="ttname"><a href="../../db/d2b/class_settings.html">Settings</a></div><div class="ttdoc">Reads in and stores input settings for the run. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d4a/_settings_8h_source.html#l00037">Settings.h:37</a></div></div>
<div class="ttc" id="class_global_trigger_html_a8d88f561ec14573c139ee67d100813ff"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a8d88f561ec14573c139ee67d100813ff">GlobalTrigger::GetAnitaLayerPhiSector</a></div><div class="ttdeci">void GetAnitaLayerPhiSector(Settings *settings1, int i, int j, int &amp;whichlayer, int &amp;whichphisector)</div><div class="ttdoc">Provides a mapping between the 4 layers and 16 phi sectors physically to the 3 layers and 16 sectors ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01457">GlobalTrigger.cc:1457</a></div></div>
<div class="ttc" id="class_global_trigger_html_a51307d40e79fad867b83acdea276a2d6"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a51307d40e79fad867b83acdea276a2d6">GlobalTrigger::sum_aligned_waveforms</a></div><div class="ttdeci">void sum_aligned_waveforms(const vector&lt; vector&lt; double &gt; &gt; &amp;waveforms, vector&lt; double &gt; &amp;output)</div><div class="ttdoc">Given a number of waveforms (usually 3) which are delay-aligned, it sums them. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01750">GlobalTrigger.cc:1750</a></div></div>
<div class="ttc" id="class_global_trigger_html_a4468958c2847209f5c84c21f616734be"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a4468958c2847209f5c84c21f616734be">GlobalTrigger::summed_power_window</a></div><div class="ttdeci">double summed_power_window(const vector&lt; double &gt; &amp;waveform, unsigned int start_index, unsigned int length)</div><div class="ttdoc">Sum a window from the specified starting index. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01795">GlobalTrigger.cc:1795</a></div></div>
<div class="ttc" id="class_global_trigger_html_a25c961e78eb253bdf7bffb90b9e31be0"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a25c961e78eb253bdf7bffb90b9e31be0">GlobalTrigger::convert_wfm_to_3_bit</a></div><div class="ttdeci">void convert_wfm_to_3_bit(const vector&lt; double &gt; &amp;wfm, double rms, vector&lt; double &gt; &amp;output)</div><div class="ttdoc">Converts a waveform by sampling it into 3 bits, after it is normalized to the RMS. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01842">GlobalTrigger.cc:1842</a></div></div>
<div class="ttc" id="class_anita_html_a6bc753f453f91e30ed38f3cc4c30fbc3"><div class="ttname"><a href="../../df/da2/class_anita.html#a6bc753f453f91e30ed38f3cc4c30fbc3">Anita::NLAYERS_MAX</a></div><div class="ttdeci">static const int NLAYERS_MAX</div><div class="ttdoc">max number of layers (in smex design, it&amp;#39;s 4) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00059">anita.hh:59</a></div></div>
<div class="ttc" id="class_global_trigger_html_ad1f3b7a07744e70e36f5b42cb37d1739"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#ad1f3b7a07744e70e36f5b42cb37d1739">GlobalTrigger::GetPhiSector</a></div><div class="ttdeci">int GetPhiSector(Settings *settings1, int i, int j)</div><div class="ttdoc">Provides a mapping between the 4 layers and 16 phi sectors physically to the 3 layers and 16 sectors ...</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01426">GlobalTrigger.cc:1426</a></div></div>
<div class="ttc" id="class_global_trigger_html_a2b34e0d891fc6a1a21c6be05ea9bbed5"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a2b34e0d891fc6a1a21c6be05ea9bbed5">GlobalTrigger::FillInNadir</a></div><div class="ttdeci">void FillInNadir(Anita *anita1, int *ant)</div><div class="ttdoc">Virtual nadir antennas had effective L2 triggers based on neighbor antennas. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01395">GlobalTrigger.cc:1395</a></div></div>
<div class="ttc" id="class_global_trigger_html_a48113d648786aa91b1076824af045864"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a48113d648786aa91b1076824af045864">GlobalTrigger::delay_align_antenna_waveforms</a></div><div class="ttdeci">void delay_align_antenna_waveforms(const vector&lt; vector&lt; vector&lt; double &gt; &gt; &gt; &amp;waveforms, const vector&lt; vector&lt; unsigned int &gt; &gt; &amp;delays, vector&lt; vector&lt; double &gt; &gt; &amp;output)</div><div class="ttdoc">Calculate the difference in each arrival time due to propagation delay of the signal. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01713">GlobalTrigger.cc:1713</a></div></div>
<div class="ttc" id="class_global_trigger_html_a0adb9d2ba6e5fc5702fae520583b5e08"><div class="ttname"><a href="../../d7/d39/class_global_trigger.html#a0adb9d2ba6e5fc5702fae520583b5e08">GlobalTrigger::three_bit_round</a></div><div class="ttdeci">double three_bit_round(double input, bool round_zero_up=true, bool allow_zero=false)</div><div class="ttdoc">Three bit rounding function. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d06/_global_trigger_8cc_source.html#l01812">GlobalTrigger.cc:1812</a></div></div>
<div class="ttc" id="class_anita_html_af367aa78f54d08086f0f9c283ee3105e"><div class="ttname"><a href="../../df/da2/class_anita.html#af367aa78f54d08086f0f9c283ee3105e">Anita::NPHI_MAX</a></div><div class="ttdeci">static const int NPHI_MAX</div><div class="ttdoc">max number of antennas around in phi (in smex, 16) </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d52/anita_8hh_source.html#l00061">anita.hh:61</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 5 2021 19:55:40 for ANITA Software by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
